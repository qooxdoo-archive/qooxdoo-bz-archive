<bug>
          <bug_id>5699</bug_id>
          
          <creation_ts>2011-10-11 03:27:00 +0200</creation_ts>
          <short_desc>Table can&#39;t drag after editing cell content</short_desc>
          <delta_ts>2014-03-03 08:46:41 +0100</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>framework</product>
          <component>desktop.table</component>
          <version>1.5</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>LATER</resolution>
          
          
          <bug_file_loc>http://demo.qooxdoo.org/1.5/demobrowser/#table~Table_Drag_And_Drop.html</bug_file_loc>
          
          
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>unspecified</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Weibo Zhang">datouxia</reporter>
          <assigned_to name="Martin Wittemann">martin.wittemann</assigned_to>
          
          <qa_contact name="Martin Wittemann">martin.wittemann</qa_contact>
          <cf_browser>---</cf_browser>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>27168</commentid>
            <who name="Weibo Zhang">datouxia</who>
            <bug_when>2011-10-11 03:27:47 +0200</bug_when>
            <thetext>http://demo.qooxdoo.org/1.5/demobrowser/#table~Table_Drag_And_Drop.html

1、Try drag &amp; drop on any row
2、Edit col (a number) cell
3、Try drag on any row, you find you can&#39;t repeate step 1.

in Chrome 14, Firefox 7 and IE6 and in my project just enable drag &amp; drop</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>28436</commentid>
              <attachid>1115</attachid>
            <who name="Weibo Zhang">datouxia</who>
            <bug_when>2012-02-07 12:30:24 +0100</bug_when>
            <thetext>Created attachment 1115
This is the fix

Please have some additional test for it. Thanks!</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>35629</commentid>
            <who name="Martin Wittemann">martin.wittemann</who>
            <bug_when>2014-03-03 08:46:41 +0100</bug_when>
            <thetext>Move open issues to RESOLVED – LATER, whose last comment is older than a year.</thetext>
          </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0" isurl="0">
            <attachid>1115</attachid>
            <date>2012-02-07 12:30:00 +0100</date>
            <delta_ts>2012-02-07 12:30:24 +0100</delta_ts>
            <desc>This is the fix</desc>
            <filename>Scroller.js</filename>
            <type>text/plain</type>
            <size>69003</size>
            <attacher>datouxia</attacher>
            
              <data encoding="base64">LyogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqCgogICBxb294ZG9vIC0gdGhlIG5ldyBlcmEgb2Ygd2ViIGRldmVs
b3BtZW50CgogICBodHRwOi8vcW9veGRvby5vcmcKCiAgIENvcHlyaWdodDoKICAgICAyMDA2IFNU
Wi1JREEsIEdlcm1hbnksIGh0dHA6Ly93d3cuc3R6LWlkYS5kZQoKICAgTGljZW5zZToKICAgICBM
R1BMOiBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvbGdwbC5odG1sCiAgICAgRVBMOiBodHRw
Oi8vd3d3LmVjbGlwc2Uub3JnL29yZy9kb2N1bWVudHMvZXBsLXYxMC5waHAKICAgICBTZWUgdGhl
IExJQ0VOU0UgZmlsZSBpbiB0aGUgcHJvamVjdCdzIHRvcC1sZXZlbCBkaXJlY3RvcnkgZm9yIGRl
dGFpbHMuCgogICBBdXRob3JzOgogICAgICogVGlsIFNjaG5laWRlciAodGlsMTMyKQogICAgICog
Sm9uYXRoYW4gV2Vpw58gKGpvbmF0aGFuX3Jhc3MpCgoqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8KCi8qKgog
KiBTaG93cyBhIHdob2xlIG1ldGEgY29sdW1uLiBUaGlzIGluY2x1ZGVzIGEge0BsaW5rIEhlYWRl
cn0sCiAqIGEge0BsaW5rIFBhbmV9IGFuZCB0aGUgbmVlZGVkIHNjcm9sbCBiYXJzLiBUaGlzIGNs
YXNzIGhhbmRsZXMgdGhlCiAqIHZpcnR1YWwgc2Nyb2xsaW5nIGFuZCBkb2VzIGFsbCB0aGUgbW91
c2UgZXZlbnQgaGFuZGxpbmcuCiAqCiAqIEBjaGlsZENvbnRyb2wgaGVhZGVyIHtxeC51aS50YWJs
ZS5wYW5lLkhlYWRlcn0gaGVhZGVyIHBhbmUKICogQGNoaWxkQ29udHJvbCBwYW5lIHtxeC51aS50
YWJsZS5wYW5lLlBhbmV9IHRhYmxlIHBhbmUgdG8gc2hvdyB0aGUgZGF0YQogKiBAY2hpbGRDb250
cm9sIGZvY3VzLWluZGljYXRvciB7cXgudWkudGFibGUucGFuZS5Gb2N1c0luZGljYXRvcn0gc2hv
d3MgdGhlIGN1cnJlbnQgZm9jdXNlZCBjZWxsCiAqIEBjaGlsZENvbnRyb2wgcmVzaXplLWxpbmUg
e3F4LnVpLmNvcmUuV2lkZ2V0fSByZXNpemUgbGluZSB3aWRnZXQKICogQGNoaWxkQ29udHJvbCBz
Y3JvbGxiYXIteCB7cXgudWkuY29yZS5zY3JvbGwuU2Nyb2xsQmFyP3F4LnVpLmNvcmUuc2Nyb2xs
Lk5hdGl2ZVNjcm9sbEJhcn0KICogICAgICAgICAgICAgICBob3Jpem9udGFsIHNjcm9sbGJhciB3
aWRnZXQgKGRlcGVuZHMgb24gdGhlICJxeC5uYXRpdmVTY3JvbGxCYXJzIiBzZXR0aW5nIHdoaWNo
IGltcGxlbWVudGF0aW9uIGlzIHVzZWQpCiAqIEBjaGlsZENvbnRyb2wgc2Nyb2xsYmFyLXkge3F4
LnVpLmNvcmUuc2Nyb2xsLlNjcm9sbEJhcj9xeC51aS5jb3JlLnNjcm9sbC5OYXRpdmVTY3JvbGxC
YXJ9CiAqICAgICAgICAgICAgICAgdmVydGljYWwgc2Nyb2xsYmFyIHdpZGdldCAoZGVwZW5kcyBv
biB0aGUgInF4Lm5hdGl2ZVNjcm9sbEJhcnMiIHNldHRpbmcgd2hpY2ggaW1wbGVtZW50YXRpb24g
aXMgdXNlZCkKICovCnF4LkNsYXNzLmRlZmluZSgicXgudWkudGFibGUucGFuZS5TY3JvbGxlciIs
CnsKICBleHRlbmQgOiBxeC51aS5jb3JlLldpZGdldCwKICBpbmNsdWRlIDogcXgudWkuY29yZS5z
Y3JvbGwuTVNjcm9sbEJhckZhY3RvcnksCgoKCiAgLyoKICAqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgog
ICAgIENPTlNUUlVDVE9SCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAqLwoKICAvKioKICAgKiBA
cGFyYW0gdGFibGUge3F4LnVpLnRhYmxlLlRhYmxlfSB0aGUgdGFibGUgdGhlIHNjcm9sbGVyIGJl
bG9uZ3MgdG8uCiAgICovCiAgY29uc3RydWN0IDogZnVuY3Rpb24odGFibGUpCiAgewogICAgdGhp
cy5iYXNlKGFyZ3VtZW50cyk7CgogICAgdGhpcy5fX3RhYmxlID0gdGFibGU7CgogICAgLy8gaW5p
dCBsYXlvdXQKICAgIHZhciBncmlkID0gbmV3IHF4LnVpLmxheW91dC5HcmlkKCk7CiAgICBncmlk
LnNldENvbHVtbkZsZXgoMCwgMSk7CiAgICBncmlkLnNldFJvd0ZsZXgoMSwgMSk7CiAgICB0aGlz
Ll9zZXRMYXlvdXQoZ3JpZCk7CgogICAgLy8gaW5pdCBjaGlsZCBjb250cm9scwogICAgdGhpcy5f
X2hlYWRlciA9IHRoaXMuX3Nob3dDaGlsZENvbnRyb2woImhlYWRlciIpOwogICAgdGhpcy5fX3Rh
YmxlUGFuZSA9IHRoaXMuX3Nob3dDaGlsZENvbnRyb2woInBhbmUiKTsKCiAgICAvLyB0aGUgdG9w
IGxpbmUgY29udGFpbmluZyB0aGUgaGVhZGVyIGNsaXBwZXIgYW5kIHRoZSB0b3AgcmlnaHQgd2lk
Z2V0CiAgICB0aGlzLl9fdG9wID0gbmV3IHF4LnVpLmNvbnRhaW5lci5Db21wb3NpdGUobmV3IHF4
LnVpLmxheW91dC5IQm94KCkpLnNldCh7CiAgICAgIG1pbldpZHRoOiAwCiAgICB9KTsKICAgIHRo
aXMuX2FkZCh0aGlzLl9fdG9wLCB7cm93OiAwLCBjb2x1bW46IDAsIGNvbFNwYW46IDJ9KTsKCiAg
ICAvLyBlbWJlZCBoZWFkZXIgaW50byBhIHNjcm9sbGFibGUgY29udGFpbmVyCiAgICB0aGlzLl9f
aGVhZGVyQ2xpcHBlciA9IG5ldyBxeC51aS50YWJsZS5wYW5lLkNsaXBwZXIoKTsKICAgIHRoaXMu
X19oZWFkZXJDbGlwcGVyLmFkZCh0aGlzLl9faGVhZGVyKTsKICAgIHRoaXMuX19oZWFkZXJDbGlw
cGVyLmFkZExpc3RlbmVyKCJsb3NlY2FwdHVyZSIsIHRoaXMuX29uQ2hhbmdlQ2FwdHVyZUhlYWRl
ciwgdGhpcyk7CiAgICB0aGlzLl9faGVhZGVyQ2xpcHBlci5hZGRMaXN0ZW5lcigibW91c2Vtb3Zl
IiwgdGhpcy5fb25Nb3VzZW1vdmVIZWFkZXIsIHRoaXMpOwogICAgdGhpcy5fX2hlYWRlckNsaXBw
ZXIuYWRkTGlzdGVuZXIoIm1vdXNlZG93biIsIHRoaXMuX29uTW91c2Vkb3duSGVhZGVyLCB0aGlz
KTsKICAgIHRoaXMuX19oZWFkZXJDbGlwcGVyLmFkZExpc3RlbmVyKCJtb3VzZXVwIiwgdGhpcy5f
b25Nb3VzZXVwSGVhZGVyLCB0aGlzKTsKICAgIHRoaXMuX19oZWFkZXJDbGlwcGVyLmFkZExpc3Rl
bmVyKCJjbGljayIsIHRoaXMuX29uQ2xpY2tIZWFkZXIsIHRoaXMpOwogICAgdGhpcy5fX3RvcC5h
ZGQodGhpcy5fX2hlYWRlckNsaXBwZXIsIHtmbGV4OiAxfSk7CgogICAgLy8gZW1iZWQgcGFuZSBp
bnRvIGEgc2Nyb2xsYWJsZSBjb250YWluZXIKICAgIHRoaXMuX19wYW5lQ2xpcHBlciA9IG5ldyBx
eC51aS50YWJsZS5wYW5lLkNsaXBwZXIoKTsKICAgIHRoaXMuX19wYW5lQ2xpcHBlci5hZGQodGhp
cy5fX3RhYmxlUGFuZSk7CiAgICB0aGlzLl9fcGFuZUNsaXBwZXIuYWRkTGlzdGVuZXIoIm1vdXNl
d2hlZWwiLCB0aGlzLl9vbk1vdXNld2hlZWwsIHRoaXMpOwogICAgdGhpcy5fX3BhbmVDbGlwcGVy
LmFkZExpc3RlbmVyKCJtb3VzZW1vdmUiLCB0aGlzLl9vbk1vdXNlbW92ZVBhbmUsIHRoaXMpOwog
ICAgdGhpcy5fX3BhbmVDbGlwcGVyLmFkZExpc3RlbmVyKCJtb3VzZWRvd24iLCB0aGlzLl9vbk1v
dXNlZG93blBhbmUsIHRoaXMpOwogICAgdGhpcy5fX3BhbmVDbGlwcGVyLmFkZExpc3RlbmVyKCJt
b3VzZXVwIiwgdGhpcy5fb25Nb3VzZXVwUGFuZSwgdGhpcyk7CiAgICB0aGlzLl9fcGFuZUNsaXBw
ZXIuYWRkTGlzdGVuZXIoImNsaWNrIiwgdGhpcy5fb25DbGlja1BhbmUsIHRoaXMpOwogICAgdGhp
cy5fX3BhbmVDbGlwcGVyLmFkZExpc3RlbmVyKCJjb250ZXh0bWVudSIsIHRoaXMuX29uQ29udGV4
dE1lbnUsIHRoaXMpOwogICAgdGhpcy5fX3BhbmVDbGlwcGVyLmFkZExpc3RlbmVyKCJkYmxjbGlj
ayIsIHRoaXMuX29uRGJsY2xpY2tQYW5lLCB0aGlzKTsKICAgIHRoaXMuX19wYW5lQ2xpcHBlci5h
ZGRMaXN0ZW5lcigicmVzaXplIiwgdGhpcy5fb25SZXNpemVQYW5lLCB0aGlzKTsKCiAgICAvLyBp
ZiB3ZSBoYXZlIG92ZXJsYXllZCBzY3JvbGwgYmFycywgd2Ugc2hvdWxkIHVzZSBhIHNlcGFyYXRl
IGNvbnRhaW5lcgogICAgaWYgKHF4LmNvcmUuRW52aXJvbm1lbnQuZ2V0KCJvcy5zY3JvbGxCYXJP
dmVybGF5ZWQiKSkgewogICAgICB0aGlzLl9fY2xpcHBlckNvbnRhaW5lciA9IG5ldyBxeC51aS5j
b250YWluZXIuQ29tcG9zaXRlKCk7CiAgICAgIHRoaXMuX19jbGlwcGVyQ29udGFpbmVyLnNldExh
eW91dChuZXcgcXgudWkubGF5b3V0LkNhbnZhcygpKTsKICAgICAgdGhpcy5fX2NsaXBwZXJDb250
YWluZXIuYWRkKHRoaXMuX19wYW5lQ2xpcHBlciwge2VkZ2U6IDB9KTsKICAgICAgdGhpcy5fYWRk
KHRoaXMuX19jbGlwcGVyQ29udGFpbmVyLCB7cm93OiAxLCBjb2x1bW46IDB9KTsKICAgIH0gZWxz
ZSB7CiAgICAgIHRoaXMuX2FkZCh0aGlzLl9fcGFuZUNsaXBwZXIsIHtyb3c6IDEsIGNvbHVtbjog
MH0pOwogICAgfQoKICAgIC8vIGluaXQgc2Nyb2xsIGJhcnMKICAgIHRoaXMuX19ob3JTY3JvbGxC
YXIgPSB0aGlzLl9zaG93Q2hpbGRDb250cm9sKCJzY3JvbGxiYXIteCIpOwogICAgdGhpcy5fX3Zl
clNjcm9sbEJhciA9IHRoaXMuX3Nob3dDaGlsZENvbnRyb2woInNjcm9sbGJhci15Iik7CgogICAg
Ly8gaW5pdCBmb2N1cyBpbmRpY2F0b3IKICAgIHRoaXMuX19mb2N1c0luZGljYXRvciA9IHRoaXMu
Z2V0Q2hpbGRDb250cm9sKCJmb2N1cy1pbmRpY2F0b3IiKTsKICAgIC8vIG5lZWQgdG8gcnVuIHRo
ZSBhcHBseSBtZXRob2QgYXQgbGVhc3Qgb25jZSBbQlVHICM0MDU3XQogICAgdGhpcy5pbml0U2hv
d0NlbGxGb2N1c0luZGljYXRvcigpOwoKICAgIC8vIGZvcmNlIGNyZWF0aW9uIG9mIHRoZSByZXNp
emUgbGluZQogICAgdGhpcy5nZXRDaGlsZENvbnRyb2woInJlc2l6ZS1saW5lIikuaGlkZSgpOwog
ICAgCiAgICB0aGlzLmFkZExpc3RlbmVyKCJtb3VzZW91dCIsIHRoaXMuX29uTW91c2VvdXQsIHRo
aXMpOwogICAgdGhpcy5hZGRMaXN0ZW5lcigiYXBwZWFyIiwgdGhpcy5fb25BcHBlYXIsIHRoaXMp
OwogICAgdGhpcy5hZGRMaXN0ZW5lcigiZGlzYXBwZWFyIiwgdGhpcy5fb25EaXNhcHBlYXIsIHRo
aXMpOwoKICAgIHRoaXMuX190aW1lciA9IG5ldyBxeC5ldmVudC5UaW1lcigpOwogICAgdGhpcy5f
X3RpbWVyLmFkZExpc3RlbmVyKCJpbnRlcnZhbCIsIHRoaXMuX29uaW50ZXJ2YWwsIHRoaXMpOwog
ICAgdGhpcy5pbml0U2Nyb2xsVGltZW91dCgpOwoKICB9LAoKCgoKICAvKgogICoqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqCiAgICAgU1RBVElDUwogICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgKi8KCiAgc3Rh
dGljcyA6CiAgewoKICAgIC8qKiB7aW50fSBUaGUgbWluaW11bSB3aWR0aCBhIGNvbHVtbiBjb3Vs
ZCBnZXQgaW4gcGl4ZWxzLiAqLwogICAgTUlOX0NPTFVNTl9XSURUSCAgICAgICAgIDogMTAsCgog
ICAgLyoqIHtpbnR9IFRoZSByYWRpdXMgb2YgdGhlIHJlc2l6ZSByZWdpb24gaW4gcGl4ZWxzLiAq
LwogICAgUkVTSVpFX1JFR0lPTl9SQURJVVMgICAgIDogNSwKCgogICAgLyoqCiAgICAgKiAoaW50
KSBUaGUgbnVtYmVyIG9mIHBpeGVscyB0aGUgbW91c2UgbWF5IG1vdmUgYmV0d2VlbiBtb3VzZSBk
b3duIGFuZCBtb3VzZSB1cAogICAgICogaW4gb3JkZXIgdG8gY291bnQgYXMgYSBjbGljay4KICAg
ICAqLwogICAgQ0xJQ0tfVE9MRVJBTkNFICAgICAgICAgIDogNSwKCgogICAgLyoqCiAgICAgKiAo
aW50KSBUaGUgbWFzayBmb3IgdGhlIGhvcml6b250YWwgc2Nyb2xsIGJhci4KICAgICAqIE1heSBi
ZSBjb21iaW5lZCB3aXRoIHtAbGluayAjVkVSVElDQUxfU0NST0xMQkFSfS4KICAgICAqCiAgICAg
KiBAc2VlICNnZXROZWVkZWRTY3JvbGxCYXJzCiAgICAgKi8KICAgIEhPUklaT05UQUxfU0NST0xM
QkFSICAgICA6IDEsCgoKICAgIC8qKgogICAgICogKGludCkgVGhlIG1hc2sgZm9yIHRoZSB2ZXJ0
aWNhbCBzY3JvbGwgYmFyLgogICAgICogTWF5IGJlIGNvbWJpbmVkIHdpdGgge0BsaW5rICNIT1JJ
Wk9OVEFMX1NDUk9MTEJBUn0uCiAgICAgKgogICAgICogQHNlZSAjZ2V0TmVlZGVkU2Nyb2xsQmFy
cwogICAgICovCiAgICBWRVJUSUNBTF9TQ1JPTExCQVIgICAgICAgOiAyCiAgfSwKCgoKCiAgLyoK
ICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKgogICAgIFBST1BFUlRJRVMKICAqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKgogICovCgogIGV2ZW50cyA6CiAgewogICAgLyoqIERpc3BhdGNoZWQgaWYgdGhlIHBhbmUg
aXMgc2NvbGxlZCBob3Jpem9udGFsbHkgKi8KICAgICJjaGFuZ2VTY3JvbGxZIiA6ICJxeC5ldmVu
dC50eXBlLkRhdGEiLAoKICAgIC8qKiBEaXNwYXRjaGVkIGlmIHRoZSBwYW5lIGlzIHNjcm9sbGVk
IHZlcnRpY2FsbHkgKi8KICAgICJjaGFuZ2VTY3JvbGxYIiA6ICJxeC5ldmVudC50eXBlLkRhdGEi
LAoKICAgIC8qKlNlZSB7QGxpbmsgcXgudWkudGFibGUuVGFibGUjY2VsbENsaWNrfS4qLwogICAg
ImNlbGxDbGljayIgOiAicXgudWkudGFibGUucGFuZS5DZWxsRXZlbnQiLAoKICAgIC8qKiogU2Vl
IHtAbGluayBxeC51aS50YWJsZS5UYWJsZSNjZWxsRGJsY2xpY2t9LiovCiAgICAiY2VsbERibGNs
aWNrIiA6ICJxeC51aS50YWJsZS5wYW5lLkNlbGxFdmVudCIsCgogICAgLyoqU2VlIHtAbGluayBx
eC51aS50YWJsZS5UYWJsZSNjZWxsQ29udGV4dG1lbnV9LiovCiAgICAiY2VsbENvbnRleHRtZW51
IiA6ICJxeC51aS50YWJsZS5wYW5lLkNlbGxFdmVudCIsCgogICAgLyoqIERpc3BhdGNoZWQgd2hl
biBhIHNvcnRhYmxlIGhlYWRlciB3YXMgY2xpY2tlZCAqLwogICAgImJlZm9yZVNvcnQiIDogInF4
LmV2ZW50LnR5cGUuRGF0YSIKICB9LAoKCgoKCiAgLyoKICAqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgog
ICAgIFBST1BFUlRJRVMKICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICovCgogIHByb3BlcnRpZXMg
OgogIHsKCiAgICAvKiogV2hldGhlciB0byBzaG93IHRoZSBob3Jpem9udGFsIHNjcm9sbCBiYXIg
Ki8KICAgIGhvcml6b250YWxTY3JvbGxCYXJWaXNpYmxlIDoKICAgIHsKICAgICAgY2hlY2sgOiAi
Qm9vbGVhbiIsCiAgICAgIGluaXQgOiBmYWxzZSwKICAgICAgYXBwbHkgOiAiX2FwcGx5SG9yaXpv
bnRhbFNjcm9sbEJhclZpc2libGUiLAogICAgICBldmVudCA6ICJjaGFuZ2VIb3Jpem9udGFsU2Ny
b2xsQmFyVmlzaWJsZSIKICAgIH0sCgogICAgLyoqIFdoZXRoZXIgdG8gc2hvdyB0aGUgdmVydGlj
YWwgc2Nyb2xsIGJhciAqLwogICAgdmVydGljYWxTY3JvbGxCYXJWaXNpYmxlIDoKICAgIHsKICAg
ICAgY2hlY2sgOiAiQm9vbGVhbiIsCiAgICAgIGluaXQgOiBmYWxzZSwKICAgICAgYXBwbHkgOiAi
X2FwcGx5VmVydGljYWxTY3JvbGxCYXJWaXNpYmxlIiwKICAgICAgZXZlbnQgOiAiY2hhbmdlVmVy
dGljYWxTY3JvbGxCYXJWaXNpYmxlIgogICAgfSwKCiAgICAvKiogVGhlIHRhYmxlIHBhbmUgbW9k
ZWwuICovCiAgICB0YWJsZVBhbmVNb2RlbCA6CiAgICB7CiAgICAgIGNoZWNrIDogInF4LnVpLnRh
YmxlLnBhbmUuTW9kZWwiLAogICAgICBhcHBseSA6ICJfYXBwbHlUYWJsZVBhbmVNb2RlbCIsCiAg
ICAgIGV2ZW50IDogImNoYW5nZVRhYmxlUGFuZU1vZGVsIgogICAgfSwKCgogICAgLyoqCiAgICAg
KiBXaGV0aGVyIGNvbHVtbiByZXNpemUgc2hvdWxkIGJlIGxpdmUuIElmIGZhbHNlLCBkdXJpbmcg
cmVzaXplIG9ubHkgYSBsaW5lIGlzCiAgICAgKiBzaG93biBhbmQgdGhlIHJlYWwgcmVzaXplIGhh
cHBlbnMgd2hlbiB0aGUgdXNlciByZWxlYXNlcyB0aGUgbW91c2UgYnV0dG9uLgogICAgICovCiAg
ICBsaXZlUmVzaXplIDoKICAgIHsKICAgICAgY2hlY2sgOiAiQm9vbGVhbiIsCiAgICAgIGluaXQg
OiBmYWxzZQogICAgfSwKCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBmb2N1cyBzaG91bGQg
bW92ZWQgd2hlbiB0aGUgbW91c2UgaXMgbW92ZWQgb3ZlciBhIGNlbGwuIElmIGZhbHNlCiAgICAg
KiB0aGUgZm9jdXMgaXMgb25seSBtb3ZlZCBvbiBtb3VzZSBjbGlja3MuCiAgICAgKi8KICAgIGZv
Y3VzQ2VsbE9uTW91c2VNb3ZlIDoKICAgIHsKICAgICAgY2hlY2sgOiAiQm9vbGVhbiIsCiAgICAg
IGluaXQgOiBmYWxzZQogICAgfSwKCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGhhbmRsZSBz
ZWxlY3Rpb25zIHZpYSB0aGUgc2VsZWN0aW9uIG1hbmFnZXIgYmVmb3JlIHNldHRpbmcgdGhlCiAg
ICAgKiBmb2N1cy4gIFRoZSB0cmFkaXRpb25hbCBiZWhhdmlvciBpcyB0byBoYW5kbGUgc2VsZWN0
aW9ucyBhZnRlciBzZXR0aW5nIHRoZQogICAgICogZm9jdXMsIGJ1dCBzZXR0aW5nIHRoZSBmb2N1
cyBtZWFucyByZWRyYXdpbmcgcG9ydGlvbnMgb2YgdGhlIHRhYmxlLCBhbmQKICAgICAqIHNvbWUg
c3ViY2xhc3NlcyBtYXkgd2FudCB0byBtb2RpZnkgdGhlIGRhdGEgdG8gYmUgZGlzcGxheWVkIGJh
c2VkIG9uIHRoZQogICAgICogc2VsZWN0aW9uLgogICAgICovCiAgICBzZWxlY3RCZWZvcmVGb2N1
cyA6CiAgICB7CiAgICAgIGNoZWNrIDogIkJvb2xlYW4iLAogICAgICBpbml0IDogZmFsc2UKICAg
IH0sCgoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgY2VsbCBmb2N1cyBpbmRpY2F0b3Igc2hv
dWxkIGJlIHNob3duCiAgICAgKi8KICAgIHNob3dDZWxsRm9jdXNJbmRpY2F0b3IgOgogICAgewog
ICAgICBjaGVjayA6ICJCb29sZWFuIiwKICAgICAgaW5pdCA6IHRydWUsCiAgICAgIGFwcGx5IDog
Il9hcHBseVNob3dDZWxsRm9jdXNJbmRpY2F0b3IiCiAgICB9LAoKCiAgICAvKioKICAgICAqIEJ5
IGRlZmF1bHQsIHRoZSAiY2VsbENvbnRleHRtZW51IiBldmVudCBpcyBmaXJlZCBvbmx5IHdoZW4g
YSBkYXRhIGNlbGwKICAgICAqIGlzIHJpZ2h0LWNsaWNrZWQuIEl0IGlzIG5vdCBmaXJlZCB3aGVu
IGEgcmlnaHQtY2xpY2sgb2NjdXJzIGluIHRoZQogICAgICogZW1wdHkgYXJlYSBvZiB0aGUgdGFi
bGUgYmVsb3cgdGhlIGxhc3QgZGF0YSByb3cuIEJ5IHR1cm5pbmcgb24gdGhpcwogICAgICogcHJv
cGVydHksICJjZWxsQ29udGV4dE1lbnUiIGV2ZW50cyB3aWxsIGFsc28gYmUgZ2VuZXJhdGVkIHdo
ZW4gYQogICAgICogcmlnaHQtY2xpY2sgb2NjdXJzIGluIHRoYXQgZW1wdHkgYXJlYS4gSW4gc3Vj
aCBhIGNhc2UsIHJvdyBpZGVudGlmaWVyCiAgICAgKiBpbiB0aGUgZXZlbnQgZGF0YSB3aWxsIGJl
IG51bGwsIHNvIGV2ZW50IGhhbmRsZXJzIGNhbiBjaGVjayAocm93ID09PQogICAgICogbnVsbCkg
dG8gaGFuZGxlIHRoaXMgY2FzZS4KICAgICAqLwogICAgY29udGV4dE1lbnVGcm9tRGF0YUNlbGxz
T25seSA6CiAgICB7CiAgICAgIGNoZWNrIDogIkJvb2xlYW4iLAogICAgICBpbml0IDogdHJ1ZQog
ICAgfSwKCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHJlc2V0IHRoZSBzZWxlY3Rpb24gd2hl
biBhIGhlYWRlciBjZWxsIGlzIGNsaWNrZWQuIFNpbmNlCiAgICAgKiBtb3N0IGRhdGEgbW9kZWxz
IGRvIG5vdCBoYXZlIHByb3Zpc2lvbnMgdG8gcmV0YWluIGEgc2VsZWN0aW9uIGFmdGVyCiAgICAg
KiBzb3J0aW5nLCB0aGUgZGVmYXVsdCBpcyB0byByZXNldCB0aGUgc2VsZWN0aW9uIGluIHRoaXMg
Y2FzZS4gU29tZSBkYXRhCiAgICAgKiBtb2RlbHMsIGhvd2V2ZXIsIGRvIGhhdmUgdGhlIGNhcGFi
aWxpdHkgdG8gcmV0YWluIHRoZSBzZWxlY3Rpb24sIHNvCiAgICAgKiB3aGVuIHVzaW5nIHRob3Nl
LCB0aGlzIHByb3BlcnR5IHNob3VsZCBiZSBzZXQgdG8gZmFsc2UuCiAgICAgKi8KICAgIHJlc2V0
U2VsZWN0aW9uT25IZWFkZXJDbGljayA6CiAgICB7CiAgICAgIGNoZWNrIDogIkJvb2xlYW4iLAog
ICAgICBpbml0IDogdHJ1ZQogICAgfSwKCgogICAgLyoqCiAgICAgKiBJbnRlcnZhbCB0aW1lIChp
biBtaWxsaXNlY29uZHMpIGZvciB0aGUgdGFibGUgdXBkYXRlIHRpbWVyLgogICAgICogU2V0dGlu
ZyB0aGlzIHRvIDAgY2xlYXJzIHRoZSB0aW1lci4KICAgICAqLwogICAgc2Nyb2xsVGltZW91dCA6
CiAgICB7CiAgICAgIGNoZWNrIDogIkludGVnZXIiLAogICAgICBpbml0IDogMTAwLAogICAgICBh
cHBseSA6ICJfYXBwbHlTY3JvbGxUaW1lb3V0IgogICAgfSwKCgogICAgYXBwZWFyYW5jZSA6CiAg
ICB7CiAgICAgIHJlZmluZSA6IHRydWUsCiAgICAgIGluaXQgOiAidGFibGUtc2Nyb2xsZXIiCiAg
ICB9CiAgfSwKCgoKCiAgLyoKICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgIE1FTUJFUlMKICAq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKgogICovCgogIG1lbWJlcnMgOgogIHsKICAgIF9fbGFzdFJvd0Nv
dW50IDogbnVsbCwKICAgIF9fdGFibGUgOiBudWxsLAoKICAgIF9fdXBkYXRlSW50ZXJ2YWwgOiBu
dWxsLAogICAgX191cGRhdGVDb250ZW50UGxhbm5lZCA6IG51bGwsCiAgICBfX29uaW50ZXJ2YWxX
cmFwcGVyIDogbnVsbCwKCiAgICBfX21vdmVDb2x1bW4gOiBudWxsLAogICAgX19sYXN0TW92ZUNv
bFBvcyA6IG51bGwsCiAgICBfX2xhc3RNb3ZlVGFyZ2V0WCA6IG51bGwsCiAgICBfX2xhc3RNb3Zl
VGFyZ2V0U2Nyb2xsZXIgOiBudWxsLAogICAgX19sYXN0TW92ZU1vdXNlUGFnZVggOiBudWxsLAoK
ICAgIF9fcmVzaXplQ29sdW1uIDogbnVsbCwKICAgIF9fbGFzdFJlc2l6ZU1vdXNlUGFnZVggOiBu
dWxsLAogICAgX19sYXN0UmVzaXplV2lkdGggOiBudWxsLAoKICAgIF9fbGFzdE1vdXNlRG93bkNl
bGwgOiBudWxsLAogICAgX19maXJlZENsaWNrRXZlbnQgOiBmYWxzZSwKICAgIF9faWdub3JlQ2xp
Y2sgOiBudWxsLAogICAgX19sYXN0TW91c2VQYWdlWCA6IG51bGwsCiAgICBfX2xhc3RNb3VzZVBh
Z2VZIDogbnVsbCwKCiAgICBfX2ZvY3VzZWRDb2wgOiBudWxsLAogICAgX19mb2N1c2VkUm93IDog
bnVsbCwKCiAgICBfX2NlbGxFZGl0b3IgOiBudWxsLAogICAgX19jZWxsRWRpdG9yRmFjdG9yeSA6
IG51bGwsCgogICAgX190b3BSaWdodFdpZGdldCA6IG51bGwsCiAgICBfX2hvclNjcm9sbEJhciA6
IG51bGwsCiAgICBfX3ZlclNjcm9sbEJhciA6IG51bGwsCiAgICBfX2hlYWRlciA6IG51bGwsCiAg
ICBfX2hlYWRlckNsaXBwZXIgOiBudWxsLAogICAgX190YWJsZVBhbmUgOiBudWxsLAogICAgX19w
YW5lQ2xpcHBlciA6IG51bGwsCiAgICBfX2NsaXBwZXJDb250YWluZXIgOiBudWxsLAogICAgX19m
b2N1c0luZGljYXRvciA6IG51bGwsCiAgICBfX3RvcCA6IG51bGwsCgogICAgX190aW1lciA6IG51
bGwsCgoKICAgIC8qKgogICAgICogVGhlIHJpZ2h0IGluc2V0IG9mIHRoZSBwYW5lLiBUaGUgcmln
aHQgaW5zZXQgaXMgdGhlIG1heGltdW0gb2YgdGhlCiAgICAgKiB0b3AgcmlnaHQgd2lkZ2V0IHdp
ZHRoIGFuZCB0aGUgc2Nyb2xsYmFyIHdpZHRoIChpZiB2aXNpYmxlKS4KICAgICAqCiAgICAgKiBA
cmV0dXJuIHtJbnRlZ2VyfSBUaGUgcmlnaHQgaW5zZXQgb2YgdGhlIHBhbmUKICAgICAqLwogICAg
Z2V0UGFuZUluc2V0UmlnaHQgOiBmdW5jdGlvbigpCiAgICB7CiAgICAgIHZhciB0b3BSaWdodCA9
IHRoaXMuZ2V0VG9wUmlnaHRXaWRnZXQoKTsKICAgICAgdmFyIHRvcFJpZ2h0V2lkdGggPQogICAg
ICAgIHRvcFJpZ2h0ICYmIHRvcFJpZ2h0LmlzVmlzaWJsZSgpICYmIHRvcFJpZ2h0LmdldEJvdW5k
cygpID8KICAgICAgICAgIHRvcFJpZ2h0LmdldEJvdW5kcygpLndpZHRoICsgdG9wUmlnaHQuZ2V0
TWFyZ2luTGVmdCgpICsgdG9wUmlnaHQuZ2V0TWFyZ2luUmlnaHQoKSA6CiAgICAgICAgICAwOwoK
ICAgICAgdmFyIHNjcm9sbEJhciA9IHRoaXMuX192ZXJTY3JvbGxCYXI7CiAgICAgIHZhciBzY3Jv
bGxCYXJXaWR0aCA9IHRoaXMuZ2V0VmVydGljYWxTY3JvbGxCYXJWaXNpYmxlKCkgPwogICAgICAg
IHRoaXMuZ2V0VmVydGljYWxTY3JvbGxCYXJXaWR0aCgpICsgc2Nyb2xsQmFyLmdldE1hcmdpbkxl
ZnQoKSArIHNjcm9sbEJhci5nZXRNYXJnaW5SaWdodCgpIDoKICAgICAgICAwOwoKICAgICAgcmV0
dXJuIE1hdGgubWF4KHRvcFJpZ2h0V2lkdGgsIHNjcm9sbEJhcldpZHRoKTsKICAgIH0sCgoKICAg
IC8qKgogICAgICogU2V0IHRoZSBwYW5lJ3Mgd2lkdGgKICAgICAqCiAgICAgKiBAcGFyYW0gd2lk
dGgge0ludGVnZXJ9IFRoZSBwYW5lJ3Mgd2lkdGgKICAgICAqLwogICAgc2V0UGFuZVdpZHRoIDog
ZnVuY3Rpb24od2lkdGgpCiAgICB7CiAgICAgIGlmICh0aGlzLmlzVmVydGljYWxTY3JvbGxCYXJW
aXNpYmxlKCkpIHsKICAgICAgICB3aWR0aCArPSB0aGlzLmdldFBhbmVJbnNldFJpZ2h0KCk7CiAg
ICAgIH0KICAgICAgdGhpcy5zZXRXaWR0aCh3aWR0aCk7CiAgICB9LAoKCiAgICAvLyBvdmVycmlk
ZGVuCiAgICBfY3JlYXRlQ2hpbGRDb250cm9sSW1wbCA6IGZ1bmN0aW9uKGlkLCBoYXNoKQogICAg
ewogICAgICB2YXIgY29udHJvbDsKCiAgICAgIHN3aXRjaChpZCkKICAgICAgewogICAgICAgIGNh
c2UgImhlYWRlciI6CiAgICAgICAgICBjb250cm9sID0gKHRoaXMuZ2V0VGFibGUoKS5nZXROZXdU
YWJsZVBhbmVIZWFkZXIoKSkodGhpcyk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAi
cGFuZSI6CiAgICAgICAgICBjb250cm9sID0gKHRoaXMuZ2V0VGFibGUoKS5nZXROZXdUYWJsZVBh
bmUoKSkodGhpcyk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiZm9jdXMtaW5kaWNh
dG9yIjoKICAgICAgICAgIGNvbnRyb2wgPSBuZXcgcXgudWkudGFibGUucGFuZS5Gb2N1c0luZGlj
YXRvcih0aGlzKTsKICAgICAgICAgIGNvbnRyb2wuc2V0VXNlckJvdW5kcygwLCAwLCAwLCAwKTsK
ICAgICAgICAgIGNvbnRyb2wuc2V0WkluZGV4KDEwMDApOwogICAgICAgICAgY29udHJvbC5hZGRM
aXN0ZW5lcigibW91c2V1cCIsIHRoaXMuX29uTW91c2V1cEZvY3VzSW5kaWNhdG9yLCB0aGlzKTsK
ICAgICAgICAgIHRoaXMuX19wYW5lQ2xpcHBlci5hZGQoY29udHJvbCk7CiAgICAgICAgICBjb250
cm9sLnNob3coKTsgICAgICAgICAgICAgLy8gbXVzdCBiZSBhY3RpdmUgZm9yIGVkaXRvciB0byBv
cGVyYXRlCiAgICAgICAgICBjb250cm9sLnNldERlY29yYXRvcihudWxsKTsgLy8gaXQgY2FuIGJl
IGluaXRpYWxseSBpbnZpc2libGUsIHRob3VnaC4KICAgICAgICAgIGJyZWFrOwoKICAgICAgICBj
YXNlICJyZXNpemUtbGluZSI6CiAgICAgICAgICBjb250cm9sID0gbmV3IHF4LnVpLmNvcmUuV2lk
Z2V0KCk7CiAgICAgICAgICBjb250cm9sLnNldFVzZXJCb3VuZHMoMCwgMCwgMCwgMCk7CiAgICAg
ICAgICBjb250cm9sLnNldFpJbmRleCgxMDAwKTsKICAgICAgICAgIHRoaXMuX19wYW5lQ2xpcHBl
ci5hZGQoY29udHJvbCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAic2Nyb2xsYmFy
LXgiOgogICAgICAgICAgY29udHJvbCA9IHRoaXMuX2NyZWF0ZVNjcm9sbEJhcigiaG9yaXpvbnRh
bCIpLnNldCh7CiAgICAgICAgICAgIG1pbldpZHRoOiAwLAogICAgICAgICAgICBhbGlnblk6ICJi
b3R0b20iCiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnRyb2wuYWRkTGlzdGVuZXIoInNjcm9s
bCIsIHRoaXMuX29uU2Nyb2xsWCwgdGhpcyk7CgogICAgICAgICAgaWYgKHRoaXMuX19jbGlwcGVy
Q29udGFpbmVyICE9IG51bGwpIHsKICAgICAgICAgICAgY29udHJvbC5zZXRNaW5IZWlnaHQocXgu
Ym9tLmVsZW1lbnQuT3ZlcmZsb3cuREVGQVVMVF9TQ1JPTExCQVJfV0lEVEgpOwogICAgICAgICAg
ICB0aGlzLl9fY2xpcHBlckNvbnRhaW5lci5hZGQoY29udHJvbCwge2JvdHRvbTogMCwgcmlnaHQ6
IDAsIGxlZnQ6IDB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX2FkZChj
b250cm9sLCB7cm93OiAyLCBjb2x1bW46IDB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFr
OwoKICAgICAgICBjYXNlICJzY3JvbGxiYXIteSI6CiAgICAgICAgICBjb250cm9sID0gdGhpcy5f
Y3JlYXRlU2Nyb2xsQmFyKCJ2ZXJ0aWNhbCIpOwogICAgICAgICAgY29udHJvbC5hZGRMaXN0ZW5l
cigic2Nyb2xsIiwgdGhpcy5fb25TY3JvbGxZLCB0aGlzKTsKCiAgICAgICAgICBpZiAodGhpcy5f
X2NsaXBwZXJDb250YWluZXIgIT0gbnVsbCkgewogICAgICAgICAgICBjb250cm9sLnNldE1pbldp
ZHRoKHF4LmJvbS5lbGVtZW50Lk92ZXJmbG93LkRFRkFVTFRfU0NST0xMQkFSX1dJRFRIKTsKICAg
ICAgICAgICAgdGhpcy5fX2NsaXBwZXJDb250YWluZXIuYWRkKGNvbnRyb2wsIHtyaWdodDogMCwg
Ym90dG9tOiAwLCB0b3A6IDB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMu
X2FkZChjb250cm9sLCB7cm93OiAxLCBjb2x1bW46IDF9KTsKICAgICAgICAgIH0KICAgICAgICAg
IGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gY29udHJvbCB8fCB0aGlzLmJhc2UoYXJndW1l
bnRzLCBpZCk7CiAgICB9LAoKCiAgICAvLyBwcm9wZXJ0eSBtb2RpZmllcgogICAgX2FwcGx5SG9y
aXpvbnRhbFNjcm9sbEJhclZpc2libGUgOiBmdW5jdGlvbih2YWx1ZSwgb2xkKSB7CiAgICAgIHRo
aXMuX19ob3JTY3JvbGxCYXIuc2V0VmlzaWJpbGl0eSh2YWx1ZSA/ICJ2aXNpYmxlIiA6ICJleGNs
dWRlZCIpOwogICAgfSwKCgogICAgLy8gcHJvcGVydHkgbW9kaWZpZXIKICAgIF9hcHBseVZlcnRp
Y2FsU2Nyb2xsQmFyVmlzaWJsZSA6IGZ1bmN0aW9uKHZhbHVlLCBvbGQpIHsKICAgICAgdGhpcy5f
X3ZlclNjcm9sbEJhci5zZXRWaXNpYmlsaXR5KHZhbHVlID8gInZpc2libGUiIDogImV4Y2x1ZGVk
Iik7CiAgICB9LAoKCiAgICAvLyBwcm9wZXJ0eSBtb2RpZmllcgogICAgX2FwcGx5VGFibGVQYW5l
TW9kZWwgOiBmdW5jdGlvbih2YWx1ZSwgb2xkKQogICAgewogICAgICBpZiAob2xkICE9IG51bGwp
IHsKICAgICAgICBvbGQucmVtb3ZlTGlzdGVuZXIoIm1vZGVsQ2hhbmdlZCIsIHRoaXMuX29uUGFu
ZU1vZGVsQ2hhbmdlZCwgdGhpcyk7CiAgICAgIH0KCiAgICAgIHZhbHVlLmFkZExpc3RlbmVyKCJt
b2RlbENoYW5nZWQiLCB0aGlzLl9vblBhbmVNb2RlbENoYW5nZWQsIHRoaXMpOwogICAgfSwKCgog
ICAgLy8gcHJvcGVydHkgbW9kaWZpZXIKICAgIF9hcHBseVNob3dDZWxsRm9jdXNJbmRpY2F0b3Ig
OiBmdW5jdGlvbih2YWx1ZSwgb2xkKQogICAgewogICAgICBpZih2YWx1ZSkgewogICAgICAgIHRo
aXMuX19mb2N1c0luZGljYXRvci5zZXREZWNvcmF0b3IoInRhYmxlLXNjcm9sbGVyLWZvY3VzLWlu
ZGljYXRvciIpOwogICAgICAgIHRoaXMuX3VwZGF0ZUZvY3VzSW5kaWNhdG9yKCk7CiAgICAgIH0K
ICAgICAgZWxzZSB7CiAgICAgICAgaWYodGhpcy5fX2ZvY3VzSW5kaWNhdG9yKSB7CiAgICAgICAg
ICB0aGlzLl9fZm9jdXNJbmRpY2F0b3Iuc2V0RGVjb3JhdG9yKG51bGwpOwogICAgICAgIH0KICAg
ICAgfQogICAgfSwKCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcG9zaXRpb24gb2Yg
dGhlIHZlcnRpY2FsIHNjcm9sbCBiYXIuCiAgICAgKgogICAgICogQHJldHVybiB7SW50ZWdlcn0g
VGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uLgogICAgICovCiAgICBnZXRTY3JvbGxZIDogZnVu
Y3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl9fdmVyU2Nyb2xsQmFyLmdldFBvc2l0aW9uKCk7
CiAgICB9LAoKCiAgICAvKioKICAgICAqIFNldCB0aGUgY3VycmVudCBwb3NpdGlvbiBvZiB0aGUg
dmVydGljYWwgc2Nyb2xsIGJhci4KICAgICAqCiAgICAgKiBAcGFyYW0gc2Nyb2xsWSB7SW50ZWdl
cn0gVGhlIG5ldyBzY3JvbGwgcG9zaXRpb24uCiAgICAgKiBAcGFyYW0gcmVuZGVyU3luYyB7Qm9v
bGVhbj9mYWxzZX0gV2hldGhlciB0aGUgdGFibGUgdXBkYXRlIHNob3VsZCBiZQogICAgICogICAg
IHBlcmZvcm1lZCBzeW5jaG9ub3VzbHkuCiAgICAgKi8KICAgIHNldFNjcm9sbFkgOiBmdW5jdGlv
bihzY3JvbGxZLCByZW5kZXJTeW5jKQogICAgewogICAgICB0aGlzLl9fdmVyU2Nyb2xsQmFyLnNj
cm9sbFRvKHNjcm9sbFkpOwogICAgICBpZiAocmVuZGVyU3luYykgewogICAgICAgIHRoaXMuX3Vw
ZGF0ZUNvbnRlbnQoKTsKICAgICAgfQogICAgfSwKCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1
cnJlbnQgcG9zaXRpb24gb2YgdGhlIHZlcnRpY2FsIHNjcm9sbCBiYXIuCiAgICAgKgogICAgICog
QHJldHVybiB7SW50ZWdlcn0gVGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uLgogICAgICovCiAg
ICBnZXRTY3JvbGxYIDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl9faG9yU2Nyb2xs
QmFyLmdldFBvc2l0aW9uKCk7CiAgICB9LAoKCiAgICAvKioKICAgICAqIFNldCB0aGUgY3VycmVu
dCBwb3NpdGlvbiBvZiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhci4KICAgICAqCiAgICAgKiBAcGFy
YW0gc2Nyb2xsWCB7SW50ZWdlcn0gVGhlIG5ldyBzY3JvbGwgcG9zaXRpb24uCiAgICAgKi8KICAg
IHNldFNjcm9sbFggOiBmdW5jdGlvbihzY3JvbGxYKSB7CiAgICAgIHRoaXMuX19ob3JTY3JvbGxC
YXIuc2Nyb2xsVG8oc2Nyb2xsWCk7CiAgICB9LAoKCiAgICAvKioKICAgICAqIFJldHVybnMgdGhl
IHRhYmxlIHRoaXMgc2Nyb2xsZXIgYmVsb25ncyB0by4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtx
eC51aS50YWJsZS5UYWJsZX0gdGhlIHRhYmxlLgogICAgICovCiAgICBnZXRUYWJsZSA6IGZ1bmN0
aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fX3RhYmxlOwogICAgfSwKCgogICAgLyoqCiAgICAg
KiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdmlzaWJpbGl0eSBvZiBhIGNvbHVtbiBo
YXMgY2hhbmdlZC4KICAgICAqLwogICAgb25Db2xWaXNpYmlsaXR5Q2hhbmdlZCA6IGZ1bmN0aW9u
KCkKICAgIHsKICAgICAgdGhpcy51cGRhdGVIb3JTY3JvbGxCYXJNYXhpbXVtKCk7CiAgICAgIHRo
aXMuX3VwZGF0ZUZvY3VzSW5kaWNhdG9yKCk7CiAgICB9LAoKCiAgICAvKioKICAgICAqIFNldHMg
dGhlIGNvbHVtbiB3aWR0aC4KICAgICAqCiAgICAgKiBAcGFyYW0gY29sIHtJbnRlZ2VyfSB0aGUg
Y29sdW1uIHRvIGNoYW5nZSB0aGUgd2lkdGggZm9yLgogICAgICogQHBhcmFtIHdpZHRoIHtJbnRl
Z2VyfSB0aGUgbmV3IHdpZHRoLgogICAgICogQHJldHVybiB7dm9pZH0KICAgICAqLwogICAgc2V0
Q29sdW1uV2lkdGggOiBmdW5jdGlvbihjb2wsIHdpZHRoKQogICAgewogICAgICB0aGlzLl9faGVh
ZGVyLnNldENvbHVtbldpZHRoKGNvbCwgd2lkdGgpOwogICAgICB0aGlzLl9fdGFibGVQYW5lLnNl
dENvbHVtbldpZHRoKGNvbCwgd2lkdGgpOwoKICAgICAgdmFyIHBhbmVNb2RlbCA9IHRoaXMuZ2V0
VGFibGVQYW5lTW9kZWwoKTsKICAgICAgdmFyIHggPSBwYW5lTW9kZWwuZ2V0WChjb2wpOwoKICAg
ICAgaWYgKHggIT0gLTEpCiAgICAgIHsKICAgICAgICAvLyBUaGUgY2hhbmdlIHdhcyBpbiB0aGlz
IHNjcm9sbGVyCiAgICAgICAgdGhpcy51cGRhdGVIb3JTY3JvbGxCYXJNYXhpbXVtKCk7CiAgICAg
ICAgdGhpcy5fdXBkYXRlRm9jdXNJbmRpY2F0b3IoKTsKICAgICAgfQogICAgfSwKCgogICAgLyoq
CiAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgY29sdW1uIG9yZGVyIGhhcyBj
aGFuZ2VkLgogICAgICoKICAgICAqIEByZXR1cm4ge3ZvaWR9CiAgICAgKi8KICAgIG9uQ29sT3Jk
ZXJDaGFuZ2VkIDogZnVuY3Rpb24oKQogICAgewogICAgICB0aGlzLl9faGVhZGVyLm9uQ29sT3Jk
ZXJDaGFuZ2VkKCk7CiAgICAgIHRoaXMuX190YWJsZVBhbmUub25Db2xPcmRlckNoYW5nZWQoKTsK
CiAgICAgIHRoaXMudXBkYXRlSG9yU2Nyb2xsQmFyTWF4aW11bSgpOwogICAgfSwKCgogICAgLyoq
CiAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgbW9kZWwgaGFzIGNo
YW5nZWQuCiAgICAgKgogICAgICogQHBhcmFtIGZpcnN0Um93IHtJbnRlZ2VyfSBUaGUgaW5kZXgg
b2YgdGhlIGZpcnN0IHJvdyB0aGF0IGhhcyBjaGFuZ2VkLgogICAgICogQHBhcmFtIGxhc3RSb3cg
e0ludGVnZXJ9IFRoZSBpbmRleCBvZiB0aGUgbGFzdCByb3cgdGhhdCBoYXMgY2hhbmdlZC4KICAg
ICAqIEBwYXJhbSBmaXJzdENvbHVtbiB7SW50ZWdlcn0gVGhlIG1vZGVsIGluZGV4IG9mIHRoZSBm
aXJzdCBjb2x1bW4gdGhhdCBoYXMgY2hhbmdlZC4KICAgICAqIEBwYXJhbSBsYXN0Q29sdW1uIHtJ
bnRlZ2VyfSBUaGUgbW9kZWwgaW5kZXggb2YgdGhlIGxhc3QgY29sdW1uIHRoYXQgaGFzIGNoYW5n
ZWQuCiAgICAgKi8KICAgIG9uVGFibGVNb2RlbERhdGFDaGFuZ2VkIDogZnVuY3Rpb24oZmlyc3RS
b3csIGxhc3RSb3csIGZpcnN0Q29sdW1uLCBsYXN0Q29sdW1uKQogICAgewogICAgICB0aGlzLl9f
dGFibGVQYW5lLm9uVGFibGVNb2RlbERhdGFDaGFuZ2VkKGZpcnN0Um93LCBsYXN0Um93LCBmaXJz
dENvbHVtbiwgbGFzdENvbHVtbik7CiAgICAgIHZhciByb3dDb3VudCA9IHRoaXMuZ2V0VGFibGUo
KS5nZXRUYWJsZU1vZGVsKCkuZ2V0Um93Q291bnQoKTsKCiAgICAgIGlmIChyb3dDb3VudCAhPSB0
aGlzLl9fbGFzdFJvd0NvdW50KQogICAgICB7CiAgICAgICAgdGhpcy51cGRhdGVWZXJTY3JvbGxC
YXJNYXhpbXVtKCk7CgogICAgICAgIGlmICh0aGlzLmdldEZvY3VzZWRSb3coKSA+PSByb3dDb3Vu
dCkKICAgICAgICB7CiAgICAgICAgICBpZiAocm93Q291bnQgPT0gMCkgewogICAgICAgICAgICB0
aGlzLnNldEZvY3VzZWRDZWxsKG51bGwsIG51bGwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAg
ICAgICAgdGhpcy5zZXRGb2N1c2VkQ2VsbCh0aGlzLmdldEZvY3VzZWRDb2x1bW4oKSwgcm93Q291
bnQgLSAxKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5fX2xhc3RSb3dDb3Vu
dCA9IHJvd0NvdW50OwogICAgICB9CiAgICB9LAoKCiAgICAvKioKICAgICAqIEV2ZW50IGhhbmRs
ZXIuIENhbGxlZCB3aGVuIHRoZSBzZWxlY3Rpb24gaGFzIGNoYW5nZWQuCiAgICAgKi8KICAgIG9u
U2VsZWN0aW9uQ2hhbmdlZCA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLl9fdGFibGVQYW5lLm9u
U2VsZWN0aW9uQ2hhbmdlZCgpOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBFdmVudCBoYW5kbGVy
LiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgZ2V0cyBvciBsb29zZXMgdGhlIGZvY3VzLgogICAgICov
CiAgICBvbkZvY3VzQ2hhbmdlZCA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLl9fdGFibGVQYW5l
Lm9uRm9jdXNDaGFuZ2VkKCk7CiAgICB9LAoKCiAgICAvKioKICAgICAqIEV2ZW50IGhhbmRsZXIu
IENhbGxlZCB3aGVuIHRoZSB0YWJsZSBtb2RlbCBtZXRhIGRhdGEgaGFzIGNoYW5nZWQuCiAgICAg
KgogICAgICogQHJldHVybiB7dm9pZH0KICAgICAqLwogICAgb25UYWJsZU1vZGVsTWV0YURhdGFD
aGFuZ2VkIDogZnVuY3Rpb24oKQogICAgewogICAgICB0aGlzLl9faGVhZGVyLm9uVGFibGVNb2Rl
bE1ldGFEYXRhQ2hhbmdlZCgpOwogICAgICB0aGlzLl9fdGFibGVQYW5lLm9uVGFibGVNb2RlbE1l
dGFEYXRhQ2hhbmdlZCgpOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBFdmVudCBoYW5kbGVyLiBD
YWxsZWQgd2hlbiB0aGUgcGFuZSBtb2RlbCBoYXMgY2hhbmdlZC4KICAgICAqLwogICAgX29uUGFu
ZU1vZGVsQ2hhbmdlZCA6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgdGhpcy5fX2hlYWRlci5vblBh
bmVNb2RlbENoYW5nZWQoKTsKICAgICAgdGhpcy5fX3RhYmxlUGFuZS5vblBhbmVNb2RlbENoYW5n
ZWQoKTsKICAgIH0sCgoKICAgIC8qKgogICAgICogRXZlbnQgbGlzdGVuZXIgZm9yIHRoZSBwYW5l
IGNsaXBwZXIncyByZXNpemUgZXZlbnQKICAgICAqLwogICAgX29uUmVzaXplUGFuZSA6IGZ1bmN0
aW9uKCkKICAgIHsKICAgICAgdGhpcy51cGRhdGVIb3JTY3JvbGxCYXJNYXhpbXVtKCk7CiAgICAg
IHRoaXMudXBkYXRlVmVyU2Nyb2xsQmFyTWF4aW11bSgpOwoKICAgICAgLy8gVGhlIGhlaWdodCBo
YXMgY2hhbmdlZCAtPiBVcGRhdGUgY29udGVudAogICAgICB0aGlzLl91cGRhdGVDb250ZW50KCk7
CiAgICAgIHRoaXMuX19oZWFkZXIuX3VwZGF0ZUNvbnRlbnQoKTsKICAgICAgdGhpcy5fX3RhYmxl
Ll91cGRhdGVTY3JvbGxCYXJWaXNpYmlsaXR5KCk7CiAgICB9LAoKCiAgICAvKioKICAgICAqIFVw
ZGF0ZXMgdGhlIG1heGltdW0gb2YgdGhlIGhvcml6b250YWwgc2Nyb2xsIGJhciwgc28gaXQgY29y
cmVzcG9uZHMgdG8gdGhlCiAgICAgKiB0b3RhbCB3aWR0aCBvZiB0aGUgY29sdW1ucyBpbiB0aGUg
dGFibGUgcGFuZS4KICAgICAqLwogICAgdXBkYXRlSG9yU2Nyb2xsQmFyTWF4aW11bSA6IGZ1bmN0
aW9uKCkKICAgIHsKICAgICAgdmFyIHBhbmVTaXplID0gdGhpcy5fX3BhbmVDbGlwcGVyLmdldElu
bmVyU2l6ZSgpOwogICAgICBpZiAoIXBhbmVTaXplKSB7CiAgICAgICAgLy8gd2lsbCBiZSBjYWxs
ZWQgb24gdGhlIG5leHQgcmVzaXplIGV2ZW50IGFnYWluCiAgICAgICAgcmV0dXJuOwogICAgICB9
CiAgICAgIHZhciBzY3JvbGxTaXplID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpLmdldFRvdGFs
V2lkdGgoKTsKCiAgICAgIHZhciBzY3JvbGxCYXIgPSB0aGlzLl9faG9yU2Nyb2xsQmFyOwoKICAg
ICAgaWYgKHBhbmVTaXplLndpZHRoIDwgc2Nyb2xsU2l6ZSkKICAgICAgewogICAgICAgIHZhciBt
YXggPSBNYXRoLm1heCgwLCBzY3JvbGxTaXplIC0gcGFuZVNpemUud2lkdGgpOwoKICAgICAgICBz
Y3JvbGxCYXIuc2V0TWF4aW11bShtYXgpOwogICAgICAgIHNjcm9sbEJhci5zZXRLbm9iRmFjdG9y
KHBhbmVTaXplLndpZHRoIC8gc2Nyb2xsU2l6ZSk7CgogICAgICAgIHZhciBwb3MgPSBzY3JvbGxC
YXIuZ2V0UG9zaXRpb24oKTsKICAgICAgICBzY3JvbGxCYXIuc2V0UG9zaXRpb24oTWF0aC5taW4o
cG9zLCBtYXgpKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBzY3JvbGxCYXIu
c2V0TWF4aW11bSgwKTsKICAgICAgICBzY3JvbGxCYXIuc2V0S25vYkZhY3RvcigxKTsKICAgICAg
ICBzY3JvbGxCYXIuc2V0UG9zaXRpb24oMCk7CiAgICAgIH0KICAgIH0sCgoKICAgIC8qKgogICAg
ICogVXBkYXRlcyB0aGUgbWF4aW11bSBvZiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhciwgc28gaXQg
Y29ycmVzcG9uZHMgdG8gdGhlCiAgICAgKiBudW1iZXIgb2Ygcm93cyBpbiB0aGUgdGFibGUuCiAg
ICAgKi8KICAgIHVwZGF0ZVZlclNjcm9sbEJhck1heGltdW0gOiBmdW5jdGlvbigpCiAgICB7CiAg
ICAgIHZhciBwYW5lU2l6ZSA9IHRoaXMuX19wYW5lQ2xpcHBlci5nZXRJbm5lclNpemUoKTsKICAg
ICAgaWYgKCFwYW5lU2l6ZSkgewogICAgICAgIC8vIHdpbGwgYmUgY2FsbGVkIG9uIHRoZSBuZXh0
IHJlc2l6ZSBldmVudCBhZ2FpbgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHRh
YmxlTW9kZWwgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVNb2RlbCgpOwogICAgICB2YXIgcm93
Q291bnQgPSB0YWJsZU1vZGVsLmdldFJvd0NvdW50KCk7CgogICAgICBpZiAodGhpcy5nZXRUYWJs
ZSgpLmdldEtlZXBGaXJzdFZpc2libGVSb3dDb21wbGV0ZSgpKSB7CiAgICAgICAgcm93Q291bnQg
Kz0gMTsKICAgICAgfQoKICAgICAgdmFyIHJvd0hlaWdodCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRS
b3dIZWlnaHQoKTsKICAgICAgdmFyIHNjcm9sbFNpemUgPSByb3dDb3VudCAqIHJvd0hlaWdodDsK
ICAgICAgdmFyIHNjcm9sbEJhciA9IHRoaXMuX192ZXJTY3JvbGxCYXI7CgogICAgICBpZiAocGFu
ZVNpemUuaGVpZ2h0IDwgc2Nyb2xsU2l6ZSkKICAgICAgewogICAgICAgIHZhciBtYXggPSBNYXRo
Lm1heCgwLCBzY3JvbGxTaXplIC0gcGFuZVNpemUuaGVpZ2h0KTsKCiAgICAgICAgc2Nyb2xsQmFy
LnNldE1heGltdW0obWF4KTsKICAgICAgICBzY3JvbGxCYXIuc2V0S25vYkZhY3RvcihwYW5lU2l6
ZS5oZWlnaHQgLyBzY3JvbGxTaXplKTsKCiAgICAgICAgdmFyIHBvcyA9IHNjcm9sbEJhci5nZXRQ
b3NpdGlvbigpOwogICAgICAgIHNjcm9sbEJhci5zZXRQb3NpdGlvbihNYXRoLm1pbihwb3MsIG1h
eCkpOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHNjcm9sbEJhci5zZXRNYXhp
bXVtKDApOwogICAgICAgIHNjcm9sbEJhci5zZXRLbm9iRmFjdG9yKDEpOwogICAgICAgIHNjcm9s
bEJhci5zZXRQb3NpdGlvbigwKTsKICAgICAgfQogICAgfSwKCgogICAgLyoqCiAgICAgKiBFdmVu
dCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgcHJvcGVydHkgImtlZXBGaXJzdFZpc2li
bGVSb3dDb21wbGV0ZSIKICAgICAqIGNoYW5nZWQuCiAgICAgKi8KICAgIG9uS2VlcEZpcnN0Vmlz
aWJsZVJvd0NvbXBsZXRlQ2hhbmdlZCA6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgdGhpcy51cGRh
dGVWZXJTY3JvbGxCYXJNYXhpbXVtKCk7CiAgICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnQoKTsKICAg
IH0sCgoKICAgIC8qKgogICAgICogRXZlbnQgaGFuZGxlciBmb3IgdGhlIHNjcm9sbGVyJ3MgYXBw
ZWFyIGV2ZW50CiAgICAgKi8KICAgIF9vbkFwcGVhciA6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAg
Ly8gYWZ0ZXIgdGhlIFNjcm9sbGVyIGFwcGVhcnMgd2Ugc3RhcnQgdGhlIGludGVydmFsIGFnYWlu
CiAgICAgIHRoaXMuX3N0YXJ0SW50ZXJ2YWwodGhpcy5nZXRTY3JvbGxUaW1lb3V0KCkpOwogICAg
fSwKCgogICAgLyoqCiAgICAgKiBFdmVudCBoYW5kbGVyIGZvciB0aGUgZGlzYXBwZWFyIGV2ZW50
CiAgICAgKi8KICAgIF9vbkRpc2FwcGVhciA6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgLy8gYmVm
b3JlIHRoZSBzY3JvbGxlciBkaXNhcHBlYXJzIHdlIG5lZWQgdG8gc3RvcCBpdAogICAgICB0aGlz
Ll9zdG9wSW50ZXJ2YWwoKTsKICAgIH0sCgoKICAgIC8qKgogICAgICogRXZlbnQgaGFuZGxlci4g
Q2FsbGVkIHdoZW4gdGhlIGhvcml6b250YWwgc2Nyb2xsIGJhciBtb3ZlZC4KICAgICAqCiAgICAg
KiBAcGFyYW0gZSB7TWFwfSB0aGUgZXZlbnQuCiAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICov
CiAgICBfb25TY3JvbGxYIDogZnVuY3Rpb24oZSkKICAgIHsKICAgICAgdmFyIHNjcm9sbExlZnQg
PSBlLmdldERhdGEoKTsKCiAgICAgIHRoaXMuZmlyZURhdGFFdmVudCgiY2hhbmdlU2Nyb2xsWCIs
IHNjcm9sbExlZnQsIGUuZ2V0T2xkRGF0YSgpKTsKICAgICAgdGhpcy5fX2hlYWRlckNsaXBwZXIu
c2Nyb2xsVG9YKHNjcm9sbExlZnQpOwogICAgICB0aGlzLl9fcGFuZUNsaXBwZXIuc2Nyb2xsVG9Y
KHNjcm9sbExlZnQpOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxs
ZWQgd2hlbiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhciBtb3ZlZC4KICAgICAqCiAgICAgKiBAcGFy
YW0gZSB7TWFwfSB0aGUgZXZlbnQuCiAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICovCiAgICBf
b25TY3JvbGxZIDogZnVuY3Rpb24oZSkKICAgIHsKICAgICAgdGhpcy5maXJlRGF0YUV2ZW50KCJj
aGFuZ2VTY3JvbGxZIiwgZS5nZXREYXRhKCksIGUuZ2V0T2xkRGF0YSgpKTsKICAgICAgdGhpcy5f
cG9zdHBvbmVkVXBkYXRlQ29udGVudCgpOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBFdmVudCBo
YW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdXNlciBtb3ZlZCB0aGUgbW91c2Ugd2hlZWwuCiAgICAg
KgogICAgICogQHBhcmFtIGUge01hcH0gdGhlIGV2ZW50LgogICAgICogQHJldHVybiB7dm9pZH0K
ICAgICAqLwogICAgX29uTW91c2V3aGVlbCA6IGZ1bmN0aW9uKGUpCiAgICB7CiAgICAgIHZhciB0
YWJsZSA9IHRoaXMuZ2V0VGFibGUoKTsKCiAgICAgIGlmICghdGFibGUuZ2V0RW5hYmxlZCgpKSB7
CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyB2ZXJ0aWNhbCBzY3JvbGxpbmcKICAg
ICAgdmFyIGRlbHRhID0gZS5nZXRXaGVlbERlbHRhKCJ5Iik7CiAgICAgIC8vIG5vcm1hbGl6ZSB0
aGF0IGF0IGxlYXN0IG9uZSBzdGVwIGlzIHNjcm9sbGVkIGF0IGEgdGltZQogICAgICBpZiAoZGVs
dGEgPiAwICYmIGRlbHRhIDwgMSkgewogICAgICAgIGRlbHRhID0gMTsKICAgICAgfSBlbHNlIGlm
IChkZWx0YSA8IDAgJiYgZGVsdGEgPiAtMSkgewogICAgICAgIGRlbHRhID0gLTE7CiAgICAgIH0K
ICAgICAgdGhpcy5fX3ZlclNjcm9sbEJhci5zY3JvbGxCeVN0ZXBzKGRlbHRhKTsKCiAgICAgIC8v
IGhvcml6b250YWwgc2Nyb2xsaW5nCiAgICAgIGRlbHRhID0gZS5nZXRXaGVlbERlbHRhKCJ4Iik7
CiAgICAgIC8vIG5vcm1hbGl6ZSB0aGF0IGF0IGxlYXN0IG9uZSBzdGVwIGlzIHNjcm9sbGVkIGF0
IGEgdGltZQogICAgICBpZiAoZGVsdGEgPiAwICYmIGRlbHRhIDwgMSkgewogICAgICAgIGRlbHRh
ID0gMTsKICAgICAgfSBlbHNlIGlmIChkZWx0YSA8IDAgJiYgZGVsdGEgPiAtMSkgewogICAgICAg
IGRlbHRhID0gLTE7CiAgICAgIH0KICAgICAgdGhpcy5fX2hvclNjcm9sbEJhci5zY3JvbGxCeVN0
ZXBzKGRlbHRhKTsKCiAgICAgIC8vIFVwZGF0ZSB0aGUgZm9jdXMKICAgICAgaWYgKHRoaXMuX19s
YXN0TW91c2VQYWdlWCAmJiB0aGlzLmdldEZvY3VzQ2VsbE9uTW91c2VNb3ZlKCkpIHsKICAgICAg
ICB0aGlzLl9mb2N1c0NlbGxBdFBhZ2VQb3ModGhpcy5fX2xhc3RNb3VzZVBhZ2VYLCB0aGlzLl9f
bGFzdE1vdXNlUGFnZVkpOwogICAgICB9CgogICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLl9fdmVy
U2Nyb2xsQmFyLmdldFBvc2l0aW9uKCk7CiAgICAgIHZhciBtYXggPSB0aGlzLl9fdmVyU2Nyb2xs
QmFyLmdldE1heGltdW0oKTsKICAgICAgLy8gcGFzcyB0aGUgZXZlbnQgdG8gdGhlIHBhcmVudCBp
ZiB0aGUgc2Nyb2xsYmFyIGlzIGF0IGFuIGVkZ2UKICAgICAgaWYgKGRlbHRhIDwgMCAmJiBwb3Np
dGlvbiA8PSAwIHx8IGRlbHRhID4gMCAmJiBwb3NpdGlvbiA+PSBtYXgpIHsKICAgICAgICByZXR1
cm47CiAgICAgIH0KCiAgICAgIGUuc3RvcCgpOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBDb21t
b24gY29sdW1uIHJlc2l6ZSBsb2dpYy4KICAgICAqCiAgICAgKiBAcGFyYW0gcGFnZVgge0ludGVn
ZXJ9IHRoZSBjdXJyZW50IG1vdXNlIHggcG9zaXRpb24uCiAgICAgKiBAcmV0dXJuIHt2b2lkfQog
ICAgICovCiAgICBfX2hhbmRsZVJlc2l6ZUNvbHVtbiA6IGZ1bmN0aW9uKHBhZ2VYKQogICAgewog
ICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7CiAgICAgIC8vIFdlIGFyZSBjdXJyZW50
bHkgcmVzaXppbmcgLT4gVXBkYXRlIHRoZSBwb3NpdGlvbgogICAgICB2YXIgaGVhZGVyQ2VsbCA9
IHRoaXMuX19oZWFkZXIuZ2V0SGVhZGVyV2lkZ2V0QXRDb2x1bW4odGhpcy5fX3Jlc2l6ZUNvbHVt
bik7CiAgICAgIHZhciBtaW5Db2x1bW5XaWR0aCA9IGhlYWRlckNlbGwuZ2V0U2l6ZUhpbnQoKS5t
aW5XaWR0aDsKCiAgICAgIHZhciBuZXdXaWR0aCA9IE1hdGgubWF4KG1pbkNvbHVtbldpZHRoLCB0
aGlzLl9fbGFzdFJlc2l6ZVdpZHRoICsgcGFnZVggLSB0aGlzLl9fbGFzdFJlc2l6ZU1vdXNlUGFn
ZVgpOwoKICAgICAgaWYgKHRoaXMuZ2V0TGl2ZVJlc2l6ZSgpKSB7CiAgICAgICAgdmFyIGNvbHVt
bk1vZGVsID0gdGFibGUuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwogICAgICAgIGNvbHVtbk1vZGVs
LnNldENvbHVtbldpZHRoKHRoaXMuX19yZXNpemVDb2x1bW4sIG5ld1dpZHRoLCB0cnVlKTsKICAg
ICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9faGVhZGVyLnNldENvbHVtbldpZHRoKHRoaXMuX19y
ZXNpemVDb2x1bW4sIG5ld1dpZHRoLCB0cnVlKTsKCiAgICAgICAgdmFyIHBhbmVNb2RlbCA9IHRo
aXMuZ2V0VGFibGVQYW5lTW9kZWwoKTsKICAgICAgICB0aGlzLl9zaG93UmVzaXplTGluZShwYW5l
TW9kZWwuZ2V0Q29sdW1uTGVmdCh0aGlzLl9fcmVzaXplQ29sdW1uKSArIG5ld1dpZHRoKTsKICAg
ICAgfQoKICAgICAgdGhpcy5fX2xhc3RSZXNpemVNb3VzZVBhZ2VYICs9IG5ld1dpZHRoIC0gdGhp
cy5fX2xhc3RSZXNpemVXaWR0aDsKICAgICAgdGhpcy5fX2xhc3RSZXNpemVXaWR0aCA9IG5ld1dp
ZHRoOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBDb21tb24gY29sdW1uIG1vdmUgbG9naWMuCiAg
ICAgKgogICAgICogQHBhcmFtIHBhZ2VYIHtJbnRlZ2VyfSB0aGUgY3VycmVudCBtb3VzZSB4IHBv
c2l0aW9uLgogICAgICogQHJldHVybiB7dm9pZH0KICAgICAqCiAgICAgKi8KICAgIF9faGFuZGxl
TW92ZUNvbHVtbiA6IGZ1bmN0aW9uKHBhZ2VYKQogICAgewogICAgICAvLyBXZSBhcmUgbW92aW5n
IGEgY29sdW1uCgogICAgICAvLyBDaGVjayB3aGV0aGVyIHdlIG1vdmVkIG91dHNpZGUgdGhlIGNs
aWNrIHRvbGVyYW5jZSBzbyB3ZSBjYW4gc3RhcnQKICAgICAgLy8gc2hvd2luZyB0aGUgY29sdW1u
IG1vdmUgZmVlZGJhY2sKICAgICAgLy8gKHNob3dpbmcgdGhlIGNvbHVtbiBtb3ZlIGZlZWRiYWNr
IHByZXZlbnRzIHRoZSBvbmNsaWNrIGV2ZW50KQogICAgICB2YXIgY2xpY2tUb2xlcmFuY2UgPSBx
eC51aS50YWJsZS5wYW5lLlNjcm9sbGVyLkNMSUNLX1RPTEVSQU5DRTsKICAgICAgaWYgKHRoaXMu
X19oZWFkZXIuaXNTaG93aW5nQ29sdW1uTW92ZUZlZWRiYWNrKCkKICAgICAgICB8fCBwYWdlWCA+
IHRoaXMuX19sYXN0TW92ZU1vdXNlUGFnZVggKyBjbGlja1RvbGVyYW5jZQogICAgICAgIHx8IHBh
Z2VYIDwgdGhpcy5fX2xhc3RNb3ZlTW91c2VQYWdlWCAtIGNsaWNrVG9sZXJhbmNlKQogICAgICB7
CiAgICAgICAgdGhpcy5fX2xhc3RNb3ZlQ29sUG9zICs9IHBhZ2VYIC0gdGhpcy5fX2xhc3RNb3Zl
TW91c2VQYWdlWDsKCiAgICAgICAgdGhpcy5fX2hlYWRlci5zaG93Q29sdW1uTW92ZUZlZWRiYWNr
KHRoaXMuX19tb3ZlQ29sdW1uLCB0aGlzLl9fbGFzdE1vdmVDb2xQb3MpOwoKICAgICAgICAvLyBH
ZXQgdGhlIHJlc3BvbnNpYmxlIHNjcm9sbGVyCiAgICAgICAgdmFyIHRhcmdldFNjcm9sbGVyID0g
dGhpcy5fX3RhYmxlLmdldFRhYmxlUGFuZVNjcm9sbGVyQXRQYWdlWChwYWdlWCk7CiAgICAgICAg
aWYgKHRoaXMuX19sYXN0TW92ZVRhcmdldFNjcm9sbGVyICYmIHRoaXMuX19sYXN0TW92ZVRhcmdl
dFNjcm9sbGVyICE9IHRhcmdldFNjcm9sbGVyKSB7CiAgICAgICAgICB0aGlzLl9fbGFzdE1vdmVU
YXJnZXRTY3JvbGxlci5oaWRlQ29sdW1uTW92ZUZlZWRiYWNrKCk7CiAgICAgICAgfQogICAgICAg
IGlmICh0YXJnZXRTY3JvbGxlciAhPSBudWxsKSB7CiAgICAgICAgICB0aGlzLl9fbGFzdE1vdmVU
YXJnZXRYID0gdGFyZ2V0U2Nyb2xsZXIuc2hvd0NvbHVtbk1vdmVGZWVkYmFjayhwYWdlWCk7CiAg
ICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX19sYXN0TW92ZVRhcmdldFggPSBudWxsOwog
ICAgICAgIH0KCiAgICAgICAgdGhpcy5fX2xhc3RNb3ZlVGFyZ2V0U2Nyb2xsZXIgPSB0YXJnZXRT
Y3JvbGxlcjsKICAgICAgICB0aGlzLl9fbGFzdE1vdmVNb3VzZVBhZ2VYID0gcGFnZVg7CiAgICAg
IH0KICAgIH0sCgoKICAgIC8qKgogICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhl
IHVzZXIgbW92ZWQgdGhlIG1vdXNlIG92ZXIgdGhlIGhlYWRlci4KICAgICAqCiAgICAgKiBAcGFy
YW0gZSB7TWFwfSB0aGUgZXZlbnQuCiAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICovCiAgICBf
b25Nb3VzZW1vdmVIZWFkZXIgOiBmdW5jdGlvbihlKQogICAgewogICAgICB2YXIgdGFibGUgPSB0
aGlzLmdldFRhYmxlKCk7CgogICAgICBpZiAoISB0YWJsZS5nZXRFbmFibGVkKCkpIHsKICAgICAg
ICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB1c2VSZXNpemVDdXJzb3IgPSBmYWxzZTsKICAg
ICAgdmFyIG1vdXNlT3ZlckNvbHVtbiA9IG51bGw7CgogICAgICB2YXIgcGFnZVggPSBlLmdldERv
Y3VtZW50TGVmdCgpOwogICAgICB2YXIgcGFnZVkgPSBlLmdldERvY3VtZW50VG9wKCk7CgogICAg
ICAvLyBXb3JrYXJvdW5kOiBJbiBvbm1vdXNld2hlZWwgdGhlIGV2ZW50IGhhcyB3cm9uZyBjb29y
ZGluYXRlcyBmb3IgcGFnZVgKICAgICAgLy8gICAgICAgYW5kIHBhZ2VZLiBTbyB3ZSByZW1lbWJl
ciB0aGUgbGFzdCBtb3ZlIGV2ZW50LgogICAgICB0aGlzLl9fbGFzdE1vdXNlUGFnZVggPSBwYWdl
WDsKICAgICAgdGhpcy5fX2xhc3RNb3VzZVBhZ2VZID0gcGFnZVk7CgogICAgICBpZiAodGhpcy5f
X3Jlc2l6ZUNvbHVtbiAhPSBudWxsKQogICAgICB7CiAgICAgICAgLy8gV2UgYXJlIGN1cnJlbnRs
eSByZXNpemluZyAtPiBVcGRhdGUgdGhlIHBvc2l0aW9uCiAgICAgICAgdGhpcy5fX2hhbmRsZVJl
c2l6ZUNvbHVtbihwYWdlWCk7CiAgICAgICAgdXNlUmVzaXplQ3Vyc29yID0gdHJ1ZTsKICAgICAg
ICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoaXMuX19tb3Zl
Q29sdW1uICE9IG51bGwpCiAgICAgIHsKICAgICAgICAvLyBXZSBhcmUgbW92aW5nIGEgY29sdW1u
CiAgICAgICAgdGhpcy5fX2hhbmRsZU1vdmVDb2x1bW4ocGFnZVgpOwogICAgICAgIGUuc3RvcFBy
b3BhZ2F0aW9uKCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgdmFyIHJlc2l6
ZUNvbCA9IHRoaXMuX2dldFJlc2l6ZUNvbHVtbkZvclBhZ2VYKHBhZ2VYKTsKICAgICAgICBpZiAo
cmVzaXplQ29sICE9IC0xKQogICAgICAgIHsKICAgICAgICAgIC8vIFRoZSBtb3VzZSBpcyBvdmVy
IGEgcmVzaXplIHJlZ2lvbiAtPiBTaG93IHRoZSByaWdodCBjdXJzb3IKICAgICAgICAgIHVzZVJl
c2l6ZUN1cnNvciA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAg
ICAgICB2YXIgdGFibGVNb2RlbCA9IHRhYmxlLmdldFRhYmxlTW9kZWwoKTsKICAgICAgICAgIHZh
ciBjb2wgPSB0aGlzLl9nZXRDb2x1bW5Gb3JQYWdlWChwYWdlWCk7CiAgICAgICAgICBpZiAoY29s
ICE9IG51bGwgJiYgdGFibGVNb2RlbC5pc0NvbHVtblNvcnRhYmxlKGNvbCkpIHsKICAgICAgICAg
ICAgbW91c2VPdmVyQ29sdW1uID0gY29sOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoK
ICAgICAgdmFyIGN1cnNvciA9IHVzZVJlc2l6ZUN1cnNvciA/ICJjb2wtcmVzaXplIiA6IG51bGw7
CiAgICAgIHRoaXMuZ2V0QXBwbGljYXRpb25Sb290KCkuc2V0R2xvYmFsQ3Vyc29yKGN1cnNvcik7
CiAgICAgIHRoaXMuc2V0Q3Vyc29yKGN1cnNvcik7CiAgICAgIHRoaXMuX19oZWFkZXIuc2V0TW91
c2VPdmVyQ29sdW1uKG1vdXNlT3ZlckNvbHVtbik7CiAgICB9LAoKCiAgICAvKioKICAgICAqIEV2
ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIG1vdmVkIHRoZSBtb3VzZSBvdmVyIHRo
ZSBwYW5lLgogICAgICoKICAgICAqIEBwYXJhbSBlIHtNYXB9IHRoZSBldmVudC4KICAgICAqIEBy
ZXR1cm4ge3ZvaWR9CiAgICAgKi8KICAgIF9vbk1vdXNlbW92ZVBhbmUgOiBmdW5jdGlvbihlKQog
ICAgewogICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7CgogICAgICBpZiAoISB0YWJs
ZS5nZXRFbmFibGVkKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vdmFyIHVz
ZVJlc2l6ZUN1cnNvciA9IGZhbHNlOwoKICAgICAgdmFyIHBhZ2VYID0gZS5nZXREb2N1bWVudExl
ZnQoKTsKICAgICAgdmFyIHBhZ2VZID0gZS5nZXREb2N1bWVudFRvcCgpOwoKICAgICAgLy8gV29y
a2Fyb3VuZDogSW4gb25tb3VzZXdoZWVsIHRoZSBldmVudCBoYXMgd3JvbmcgY29vcmRpbmF0ZXMg
Zm9yIHBhZ2VYCiAgICAgIC8vICAgICAgIGFuZCBwYWdlWS4gU28gd2UgcmVtZW1iZXIgdGhlIGxh
c3QgbW92ZSBldmVudC4KICAgICAgdGhpcy5fX2xhc3RNb3VzZVBhZ2VYID0gcGFnZVg7CiAgICAg
IHRoaXMuX19sYXN0TW91c2VQYWdlWSA9IHBhZ2VZOwoKICAgICAgdmFyIHJvdyA9IHRoaXMuX2dl
dFJvd0ZvclBhZ2VQb3MocGFnZVgsIHBhZ2VZKTsKICAgICAgaWYgKHJvdyAhPSBudWxsICYmIHRo
aXMuX2dldENvbHVtbkZvclBhZ2VYKHBhZ2VYKSAhPSBudWxsKSB7CiAgICAgICAgLy8gVGhlIG1v
dXNlIGlzIG92ZXIgdGhlIGRhdGEgLT4gdXBkYXRlIHRoZSBmb2N1cwogICAgICAgIGlmICh0aGlz
LmdldEZvY3VzQ2VsbE9uTW91c2VNb3ZlKCkpIHsKICAgICAgICAgIHRoaXMuX2ZvY3VzQ2VsbEF0
UGFnZVBvcyhwYWdlWCwgcGFnZVkpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLl9faGVh
ZGVyLnNldE1vdXNlT3ZlckNvbHVtbihudWxsKTsKICAgIH0sCgoKICAgIC8qKgogICAgICogRXZl
bnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHVzZXIgcHJlc3NlZCBhIG1vdXNlIGJ1dHRvbiBv
dmVyIHRoZSBoZWFkZXIuCiAgICAgKgogICAgICogQHBhcmFtIGUge01hcH0gdGhlIGV2ZW50Lgog
ICAgICogQHJldHVybiB7dm9pZH0KICAgICAqLwogICAgX29uTW91c2Vkb3duSGVhZGVyIDogZnVu
Y3Rpb24oZSkKICAgIHsKICAgICAgaWYgKCEgdGhpcy5nZXRUYWJsZSgpLmdldEVuYWJsZWQoKSkg
ewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhZ2VYID0gZS5nZXREb2N1bWVu
dExlZnQoKTsKCiAgICAgIC8vIG1vdXNlIGlzIGluIGhlYWRlcgogICAgICB2YXIgcmVzaXplQ29s
ID0gdGhpcy5fZ2V0UmVzaXplQ29sdW1uRm9yUGFnZVgocGFnZVgpOwogICAgICBpZiAocmVzaXpl
Q29sICE9IC0xKQogICAgICB7CiAgICAgICAgLy8gVGhlIG1vdXNlIGlzIG92ZXIgYSByZXNpemUg
cmVnaW9uIC0+IFN0YXJ0IHJlc2l6aW5nCiAgICAgICAgdGhpcy5fc3RhcnRSZXNpemVIZWFkZXIo
cmVzaXplQ29sLCBwYWdlWCk7CiAgICAgICAgZS5zdG9wKCk7CiAgICAgIH0KICAgICAgZWxzZQog
ICAgICB7CiAgICAgICAgLy8gVGhlIG1vdXNlIGlzIG5vdCBpbiBhIHJlc2l6ZSByZWdpb24KICAg
ICAgICB2YXIgbW92ZUNvbCA9IHRoaXMuX2dldENvbHVtbkZvclBhZ2VYKHBhZ2VYKTsKICAgICAg
ICBpZiAobW92ZUNvbCAhPSBudWxsKQogICAgICAgIHsKICAgICAgICAgIHRoaXMuX3N0YXJ0TW92
ZUhlYWRlcihtb3ZlQ29sLCBwYWdlWCk7CiAgICAgICAgICBlLnN0b3AoKTsKICAgICAgICB9CiAg
ICAgIH0KICAgIH0sCgoKICAgIC8qKgogICAgICogU3RhcnQgYSByZXNpemUgc2Vzc2lvbiBvZiB0
aGUgaGVhZGVyLgogICAgICoKICAgICAqIEBwYXJhbSByZXNpemVDb2wge0ludGVnZXJ9IHRoZSBj
b2x1bW4gaW5kZXgKICAgICAqIEBwYXJhbSBwYWdlWCB7SW50ZWdlcn0geCBjb29yZGluYXRlIG9m
IHRoZSBtb3VzZSBldmVudAogICAgICogQHJldHVybiB7dm9pZH0KICAgICAqLwogICAgX3N0YXJ0
UmVzaXplSGVhZGVyIDogZnVuY3Rpb24ocmVzaXplQ29sLCBwYWdlWCkKICAgIHsKICAgICAgdmFy
IGNvbHVtbk1vZGVsID0gdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlQ29sdW1uTW9kZWwoKTsKCiAg
ICAgIC8vIFRoZSBtb3VzZSBpcyBvdmVyIGEgcmVzaXplIHJlZ2lvbiAtPiBTdGFydCByZXNpemlu
ZwogICAgICB0aGlzLl9fcmVzaXplQ29sdW1uID0gcmVzaXplQ29sOwogICAgICB0aGlzLl9fbGFz
dFJlc2l6ZU1vdXNlUGFnZVggPSBwYWdlWDsKICAgICAgdGhpcy5fX2xhc3RSZXNpemVXaWR0aCA9
IGNvbHVtbk1vZGVsLmdldENvbHVtbldpZHRoKHRoaXMuX19yZXNpemVDb2x1bW4pOwogICAgICB0
aGlzLl9faGVhZGVyQ2xpcHBlci5jYXB0dXJlKCk7CiAgICB9LAoKCiAgICAvKioKICAgICAqIFN0
YXJ0IGEgbW92ZSBzZXNzaW9uIG9mIHRoZSBoZWFkZXIuCiAgICAgKgogICAgICogQHBhcmFtIG1v
dmVDb2wge0ludGVnZXJ9IHRoZSBjb2x1bW4gaW5kZXgKICAgICAqIEBwYXJhbSBwYWdlWCB7SW50
ZWdlcn0geCBjb29yZGluYXRlIG9mIHRoZSBtb3VzZSBldmVudAogICAgICogQHJldHVybiB7dm9p
ZH0KICAgICAqLwogICAgX3N0YXJ0TW92ZUhlYWRlciA6IGZ1bmN0aW9uKG1vdmVDb2wsIHBhZ2VY
KQogICAgewogICAgICAvLyBQcmVwYXJlIGNvbHVtbiBtb3ZpbmcKICAgICAgdGhpcy5fX21vdmVD
b2x1bW4gPSBtb3ZlQ29sOwogICAgICB0aGlzLl9fbGFzdE1vdmVNb3VzZVBhZ2VYID0gcGFnZVg7
CiAgICAgIHRoaXMuX19sYXN0TW92ZUNvbFBvcyA9IHRoaXMuZ2V0VGFibGVQYW5lTW9kZWwoKS5n
ZXRDb2x1bW5MZWZ0KG1vdmVDb2wpOwogICAgICB0aGlzLl9faGVhZGVyQ2xpcHBlci5jYXB0dXJl
KCk7CiAgICB9LAoKCgogICAgLyoqCiAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0
aGUgdXNlciBwcmVzc2VkIGEgbW91c2UgYnV0dG9uIG92ZXIgdGhlIHBhbmUuCiAgICAgKgogICAg
ICogQHBhcmFtIGUge01hcH0gdGhlIGV2ZW50LgogICAgICogQHJldHVybiB7dm9pZH0KICAgICAq
LwogICAgX29uTW91c2Vkb3duUGFuZSA6IGZ1bmN0aW9uKGUpCiAgICB7CiAgICAgIHZhciB0YWJs
ZSA9IHRoaXMuZ2V0VGFibGUoKTsKCiAgICAgIGlmICghIHRhYmxlLmdldEVuYWJsZWQoKSkgewog
ICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRhYmxlLmlzRWRpdGluZygpKSB7CiAg
ICAgICAgdGFibGUuc3RvcEVkaXRpbmcoKTsKICAgICAgfQoKICAgICAgdmFyIHBhZ2VYID0gZS5n
ZXREb2N1bWVudExlZnQoKTsKICAgICAgdmFyIHBhZ2VZID0gZS5nZXREb2N1bWVudFRvcCgpOwog
ICAgICB2YXIgcm93ID0gdGhpcy5fZ2V0Um93Rm9yUGFnZVBvcyhwYWdlWCwgcGFnZVkpOwogICAg
ICB2YXIgY29sID0gdGhpcy5fZ2V0Q29sdW1uRm9yUGFnZVgocGFnZVgpOwoKICAgICAgaWYgKHJv
dyAhPT0gbnVsbCkKICAgICAgewogICAgICAgIC8vIFRoZSBmb2N1cyBpbmRpY2F0b3IgYmxvY2tz
IHRoZSBjbGljayBldmVudCBvbiB0aGUgc2Nyb2xsZXIgc28gd2UKICAgICAgICAvLyBzdG9yZSB0
aGUgY3VycmVudCBjZWxsIGFuZCBsaXN0ZW4gZm9yIHRoZSBtb3VzZXVwIGV2ZW50IG9uIHRoZQog
ICAgICAgIC8vIGZvY3VzIGluZGljYXRvcgogICAgICAgIC8vCiAgICAgICAgLy8gSU5WQVJJQU5U
OgogICAgICAgIC8vICBUaGUgbWVtYmVycyBvZiB0aGlzIG9iamVjdCBhbHdheXMgY29udGFpbiB0
aGUgbGFzdCBwb3NpdGlvbiBvZgogICAgICAgIC8vICB0aGUgY2VsbCBvbiB3aGljaCB0aGUgbW91
c2Vkb3duIGV2ZW50IG9jY3VycmVkLgogICAgICAgIC8vICAqKiogVGhlc2UgdmFsdWVzIGFyZSBu
ZXZlciBjbGVhcmVkISAqKiouCiAgICAgICAgLy8gIERpZmZlcmVudCBicm93c2Vycy9PUyBjb21i
aW5hdGlvbnMgaXNzdWUgZXZlbnRzIGluIGRpZmZlcmVudAogICAgICAgIC8vICBvcmRlcnMsIGFu
ZCB0aGUgY29udGV4dCBtZW51IGV2ZW50LCBpbiBwYXJ0aWN1bGFyLCBjYW4gYmUgaXNzdWVkCiAg
ICAgICAgLy8gIGVhcmx5IG9yIGxhdGUgKEZpcmVmb3ggb24gTGludXggaXNzdWVzIGl0IGVhcmx5
OyBGaXJlZm94IG9uCiAgICAgICAgLy8gIFdpbmRvd3MgaXNzdWVzIGl0IGxhdGUpIHNvIG5vIG9u
ZSBtYXkgY2xlYXIgdGhlc2UgdmFsdWVzLgogICAgICAgIC8vCiAgICAgICAgdGhpcy5fX2xhc3RN
b3VzZURvd25DZWxsID0gewogICAgICAgICAgcm93IDogcm93LAogICAgICAgICAgY29sIDogY29s
CiAgICAgICAgfTsKCiAgICAgICAgLy8gT24gdGhlIG90aGVyIGhhbmQsIHdlIG5lZWQgdG8ga25v
dyBpZiB3ZSd2ZSBpc3N1ZWQgdGhlIGNsaWNrIGV2ZW50CiAgICAgICAgLy8gc28gd2UgZG9uJ3Qg
aXNzdWUgaXQgdHdpY2UsIGJvdGggZnJvbSBtb3VzZS11cCBvbiB0aGUgZm9jdXMKICAgICAgICAv
LyBpbmRpY2F0b3IsIGFuZCBmcm9tIHRoZSBjbGljayBldmVuIG9uIHRoZSBwYW5lLiBCb3RoIHBv
c3NpYmlsaXRpZXMKICAgICAgICAvLyBhcmUgbmVjZXNzYXJ5LCBob3dldmVyLCB0byBtYWludGFp
biB0aGUgcW9veGRvbyBvcmRlciBvZiBldmVudHMuCiAgICAgICAgdGhpcy5fX2ZpcmVkQ2xpY2tF
dmVudCA9IGZhbHNlOwoKICAgICAgICB2YXIgc2VsZWN0QmVmb3JlRm9jdXMgPSB0aGlzLmdldFNl
bGVjdEJlZm9yZUZvY3VzKCk7CgogICAgICAgIGlmIChzZWxlY3RCZWZvcmVGb2N1cykgewogICAg
ICAgICAgdGFibGUuZ2V0U2VsZWN0aW9uTWFuYWdlcigpLmhhbmRsZU1vdXNlRG93bihyb3csIGUp
OwogICAgICAgIH0KCiAgICAgICAgLy8gVGhlIG1vdXNlIGlzIG92ZXIgdGhlIGRhdGEgLT4gdXBk
YXRlIHRoZSBmb2N1cwogICAgICAgIGlmICghIHRoaXMuZ2V0Rm9jdXNDZWxsT25Nb3VzZU1vdmUo
KSkgewogICAgICAgICAgdGhpcy5fZm9jdXNDZWxsQXRQYWdlUG9zKHBhZ2VYLCBwYWdlWSk7CiAg
ICAgICAgfQoKICAgICAgICBpZiAoISBzZWxlY3RCZWZvcmVGb2N1cykgewogICAgICAgICAgdGFi
bGUuZ2V0U2VsZWN0aW9uTWFuYWdlcigpLmhhbmRsZU1vdXNlRG93bihyb3csIGUpOwogICAgICAg
IH0KICAgICAgfQogICAgfSwKCgogICAgLyoqCiAgICAgKiBFdmVudCBoYW5kbGVyIGZvciB0aGUg
Zm9jdXMgaW5kaWNhdG9yJ3MgbW91c2V1cCBldmVudAogICAgICoKICAgICAqIEBwYXJhbSBlIHtx
eC5ldmVudC50eXBlLk1vdXNlfSBUaGUgbW91c2UgZXZlbnQKICAgICAqLwogICAgX29uTW91c2V1
cEZvY3VzSW5kaWNhdG9yIDogZnVuY3Rpb24oZSkKICAgIHsKICAgICAgaWYgKHRoaXMuX19sYXN0
TW91c2VEb3duQ2VsbCAmJgogICAgICAgICAgIXRoaXMuX19maXJlZENsaWNrRXZlbnQgJiYKICAg
ICAgICAgICF0aGlzLmlzRWRpdGluZygpICYmCiAgICAgICAgICB0aGlzLl9fZm9jdXNJbmRpY2F0
b3IuZ2V0Um93KCkgPT0gdGhpcy5fX2xhc3RNb3VzZURvd25DZWxsLnJvdyAmJgogICAgICAgICAg
dGhpcy5fX2ZvY3VzSW5kaWNhdG9yLmdldENvbHVtbigpID09IHRoaXMuX19sYXN0TW91c2VEb3du
Q2VsbC5jb2wpCiAgICAgIHsKICAgICAgICB0aGlzLmZpcmVFdmVudCgiY2VsbENsaWNrIiwKICAg
ICAgICAgICAgICAgICAgICAgICBxeC51aS50YWJsZS5wYW5lLkNlbGxFdmVudCwKICAgICAgICAg
ICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLAogICAgICAgICAg
ICAgICAgICAgICAgICAgZSwKICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX19sYXN0TW91
c2VEb3duQ2VsbC5yb3csCiAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9fbGFzdE1vdXNl
RG93bkNlbGwuY29sCiAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAg
ICAgICB0cnVlKTsKICAgICAgICB0aGlzLl9fZmlyZWRDbGlja0V2ZW50ID0gdHJ1ZTsKICAgICAg
fSBlbHNlIGlmICghdGhpcy5pc0VkaXRpbmcoKSkgewogICAgICAgIC8vIGlmIG5vIGNlbGxDbGlj
ayBldmVudCBzaG91bGQgYmUgZmlyZWQsIGFjdCBsaWtlIGEgbW91c2Vkb3duIHdoaWNoCiAgICAg
ICAgLy8gaW52b2tlcyB0aGUgY2hhbmdlIG9mIHRoZSBzZWxlY3Rpb24gZS5nLiBbQlVHICMxNjMy
XQogICAgICAgIHRoaXMuX29uTW91c2Vkb3duUGFuZShlKTsKICAgICAgfQogICAgfSwKCgogICAg
LyoqCiAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgZXZlbnQgY2FwdHVyaW5n
IG9mIHRoZSBoZWFkZXIgY2hhbmdlZC4KICAgICAqIFN0b3BzL2ZpbmlzaGVzIGFuIGFjdGl2ZSBo
ZWFkZXIgcmVzaXplL21vdmUgc2Vzc2lvbiBpZiBpdCBsb3N0IGNhcHR1cmluZwogICAgICogZHVy
aW5nIHRoZSBzZXNzaW9uIHRvIHN0YXkgaW4gYSBzdGFibGUgc3RhdGUuCiAgICAgKgogICAgICog
QHBhcmFtIGUge3F4LmV2ZW50LnR5cGUuRGF0YX0gVGhlIGRhdGEgZXZlbnQKICAgICAqLwogICAg
X29uQ2hhbmdlQ2FwdHVyZUhlYWRlciA6IGZ1bmN0aW9uKGUpCiAgICB7CiAgICAgIGlmICh0aGlz
Ll9fcmVzaXplQ29sdW1uICE9IG51bGwpIHsKICAgICAgICB0aGlzLl9zdG9wUmVzaXplSGVhZGVy
KCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9fbW92ZUNvbHVtbiAhPSBudWxsKSB7CiAgICAg
ICAgdGhpcy5fc3RvcE1vdmVIZWFkZXIoKTsKICAgICAgfQogICAgfSwKCgogICAgLyoqCiAgICAg
KiBTdG9wIGEgcmVzaXplIHNlc3Npb24gb2YgdGhlIGhlYWRlci4KICAgICAqCiAgICAgKiBAcmV0
dXJuIHt2b2lkfQogICAgICovCiAgICBfc3RvcFJlc2l6ZUhlYWRlciA6IGZ1bmN0aW9uKCkKICAg
IHsKICAgICAgdmFyIGNvbHVtbk1vZGVsID0gdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlQ29sdW1u
TW9kZWwoKTsKCiAgICAgIC8vIFdlIGFyZSBjdXJyZW50bHkgcmVzaXppbmcgLT4gRmluaXNoIHJl
c2l6aW5nCiAgICAgIGlmICghIHRoaXMuZ2V0TGl2ZVJlc2l6ZSgpKSB7CiAgICAgICAgdGhpcy5f
aGlkZVJlc2l6ZUxpbmUoKTsKICAgICAgICBjb2x1bW5Nb2RlbC5zZXRDb2x1bW5XaWR0aCh0aGlz
Ll9fcmVzaXplQ29sdW1uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMu
X19sYXN0UmVzaXplV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1
ZSk7CiAgICAgIH0KCiAgICAgIHRoaXMuX19yZXNpemVDb2x1bW4gPSBudWxsOwogICAgICB0aGlz
Ll9faGVhZGVyQ2xpcHBlci5yZWxlYXNlQ2FwdHVyZSgpOwoKICAgICAgdGhpcy5nZXRBcHBsaWNh
dGlvblJvb3QoKS5zZXRHbG9iYWxDdXJzb3IobnVsbCk7CiAgICAgIHRoaXMuc2V0Q3Vyc29yKG51
bGwpOwoKICAgICAgLy8gaGFuZGxlIGVkaXQgY2VsbCBpZiBhdmFpbGFibGUKICAgICAgaWYgKHRo
aXMuaXNFZGl0aW5nKCkpIHsKICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5fX2NlbGxFZGl0b3Iu
Z2V0Qm91bmRzKCkuaGVpZ2h0OwogICAgICAgIHRoaXMuX19jZWxsRWRpdG9yLnNldFVzZXJCb3Vu
ZHMoMCwgMCwgdGhpcy5fX2xhc3RSZXNpemVXaWR0aCwgaGVpZ2h0KTsKICAgICAgfQogICAgfSwK
CgogICAgLyoqCiAgICAgKiBTdG9wIGEgbW92ZSBzZXNzaW9uIG9mIHRoZSBoZWFkZXIuCiAgICAg
KgogICAgICogQHJldHVybiB7dm9pZH0KICAgICAqLwogICAgX3N0b3BNb3ZlSGVhZGVyIDogZnVu
Y3Rpb24oKQogICAgewogICAgICB2YXIgY29sdW1uTW9kZWwgPSB0aGlzLmdldFRhYmxlKCkuZ2V0
VGFibGVDb2x1bW5Nb2RlbCgpOwogICAgICB2YXIgcGFuZU1vZGVsID0gdGhpcy5nZXRUYWJsZVBh
bmVNb2RlbCgpOwoKICAgICAgLy8gV2UgYXJlIG1vdmluZyBhIGNvbHVtbiAtPiBEcm9wIHRoZSBj
b2x1bW4KICAgICAgdGhpcy5fX2hlYWRlci5oaWRlQ29sdW1uTW92ZUZlZWRiYWNrKCk7CiAgICAg
IGlmICh0aGlzLl9fbGFzdE1vdmVUYXJnZXRTY3JvbGxlcikgewogICAgICAgIHRoaXMuX19sYXN0
TW92ZVRhcmdldFNjcm9sbGVyLmhpZGVDb2x1bW5Nb3ZlRmVlZGJhY2soKTsKICAgICAgfQoKICAg
ICAgaWYgKHRoaXMuX19sYXN0TW92ZVRhcmdldFggIT0gbnVsbCkKICAgICAgewogICAgICAgIHZh
ciBmcm9tVmlzWFBvcyA9IHBhbmVNb2RlbC5nZXRGaXJzdENvbHVtblgoKSArIHBhbmVNb2RlbC5n
ZXRYKHRoaXMuX19tb3ZlQ29sdW1uKTsKICAgICAgICB2YXIgdG9WaXNYUG9zID0gdGhpcy5fX2xh
c3RNb3ZlVGFyZ2V0WDsKICAgICAgICBpZiAodG9WaXNYUG9zICE9IGZyb21WaXNYUG9zICYmIHRv
VmlzWFBvcyAhPSBmcm9tVmlzWFBvcyArIDEpCiAgICAgICAgewogICAgICAgICAgLy8gVGhlIGNv
bHVtbiB3YXMgcmVhbGx5IG1vdmVkIHRvIGFub3RoZXIgcG9zaXRpb24KICAgICAgICAgIC8vIChh
bmQgbm90IG1vdmVkIGJlZm9yZSBvciBhZnRlciBpdHNlbGYsIHdoaWNoIGlzIGEgbm9vcCkKCiAg
ICAgICAgICAvLyBUcmFuc2xhdGUgdmlzaWJsZSBwb3NpdGlvbnMgdG8gb3ZlcmFsbCBwb3NpdGlv
bnMKICAgICAgICAgIHZhciBmcm9tQ29sID0gY29sdW1uTW9kZWwuZ2V0VmlzaWJsZUNvbHVtbkF0
WChmcm9tVmlzWFBvcyk7CiAgICAgICAgICB2YXIgdG9Db2wgICA9IGNvbHVtbk1vZGVsLmdldFZp
c2libGVDb2x1bW5BdFgodG9WaXNYUG9zKTsKICAgICAgICAgIHZhciBmcm9tT3ZlclhQb3MgPSBj
b2x1bW5Nb2RlbC5nZXRPdmVyYWxsWChmcm9tQ29sKTsKICAgICAgICAgIHZhciB0b092ZXJYUG9z
ID0gKHRvQ29sICE9IG51bGwpID8gY29sdW1uTW9kZWwuZ2V0T3ZlcmFsbFgodG9Db2wpIDogY29s
dW1uTW9kZWwuZ2V0T3ZlcmFsbENvbHVtbkNvdW50KCk7CgogICAgICAgICAgaWYgKHRvT3ZlclhQ
b3MgPiBmcm9tT3ZlclhQb3MpIHsKICAgICAgICAgICAgLy8gRG9uJ3QgY291bnQgdGhlIGNvbHVt
biBpdHNlbGYKICAgICAgICAgICAgdG9PdmVyWFBvcy0tOwogICAgICAgICAgfQoKICAgICAgICAg
IC8vIE1vdmUgdGhlIGNvbHVtbgogICAgICAgICAgY29sdW1uTW9kZWwubW92ZUNvbHVtbihmcm9t
T3ZlclhQb3MsIHRvT3ZlclhQb3MpOwoKICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgZm9jdXMgaW5k
aWNhdG9yIGluY2x1ZGluZyB0aGUgZWRpdG9yCiAgICAgICAgICB0aGlzLl91cGRhdGVGb2N1c0lu
ZGljYXRvcigpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5fX21vdmVDb2x1bW4gPSBu
dWxsOwogICAgICB0aGlzLl9fbGFzdE1vdmVUYXJnZXRYID0gbnVsbDsKICAgICAgdGhpcy5fX2hl
YWRlckNsaXBwZXIucmVsZWFzZUNhcHR1cmUoKTsKICAgIH0sCgoKICAgIC8qKgogICAgICogRXZl
bnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHVzZXIgcmVsZWFzZWQgYSBtb3VzZSBidXR0b24g
b3ZlciB0aGUgcGFuZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZSB7TWFwfSB0aGUgZXZlbnQuCiAg
ICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICovCiAgICBfb25Nb3VzZXVwUGFuZSA6IGZ1bmN0aW9u
KGUpCiAgICB7CiAgICAgIHZhciB0YWJsZSA9IHRoaXMuZ2V0VGFibGUoKTsKCiAgICAgIGlmICgh
IHRhYmxlLmdldEVuYWJsZWQoKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFy
IHJvdyA9IHRoaXMuX2dldFJvd0ZvclBhZ2VQb3MoZS5nZXREb2N1bWVudExlZnQoKSwgZS5nZXRE
b2N1bWVudFRvcCgpKTsKICAgICAgaWYgKHJvdyAhPSAtMSAmJiByb3cgIT0gbnVsbCAmJiB0aGlz
Ll9nZXRDb2x1bW5Gb3JQYWdlWChlLmdldERvY3VtZW50TGVmdCgpKSAhPSBudWxsKSB7CiAgICAg
ICAgdGFibGUuZ2V0U2VsZWN0aW9uTWFuYWdlcigpLmhhbmRsZU1vdXNlVXAocm93LCBlKTsKICAg
ICAgfQogICAgfSwKCgogICAgLyoqCiAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0
aGUgdXNlciByZWxlYXNlZCBhIG1vdXNlIGJ1dHRvbiBvdmVyIHRoZSBoZWFkZXIuCiAgICAgKgog
ICAgICogQHBhcmFtIGUge01hcH0gdGhlIGV2ZW50LgogICAgICogQHJldHVybiB7dm9pZH0KICAg
ICAqLwogICAgX29uTW91c2V1cEhlYWRlciA6IGZ1bmN0aW9uKGUpCiAgICB7CiAgICAgIHZhciB0
YWJsZSA9IHRoaXMuZ2V0VGFibGUoKTsKCiAgICAgIGlmICghIHRhYmxlLmdldEVuYWJsZWQoKSkg
ewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX19yZXNpemVDb2x1bW4g
IT0gbnVsbCkKICAgICAgewogICAgICAgIHRoaXMuX3N0b3BSZXNpemVIZWFkZXIoKTsKICAgICAg
ICB0aGlzLl9faWdub3JlQ2xpY2sgPSB0cnVlOwogICAgICAgIGUuc3RvcCgpOwogICAgICB9CiAg
ICAgIGVsc2UgaWYgKHRoaXMuX19tb3ZlQ29sdW1uICE9IG51bGwpCiAgICAgIHsKICAgICAgICB0
aGlzLl9zdG9wTW92ZUhlYWRlcigpOwogICAgICAgIGUuc3RvcCgpOwogICAgICB9CiAgICB9LAoK
CiAgICAvKioKICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIGNsaWNr
ZWQgYSBtb3VzZSBidXR0b24gb3ZlciB0aGUgaGVhZGVyLgogICAgICoKICAgICAqIEBwYXJhbSBl
IHtNYXB9IHRoZSBldmVudC4KICAgICAqIEByZXR1cm4ge3ZvaWR9CiAgICAgKi8KICAgIF9vbkNs
aWNrSGVhZGVyIDogZnVuY3Rpb24oZSkKICAgIHsKICAgICAgaWYgKHRoaXMuX19pZ25vcmVDbGlj
aykKICAgICAgewogICAgICAgIHRoaXMuX19pZ25vcmVDbGljayA9IGZhbHNlOwogICAgICAgIHJl
dHVybjsKICAgICAgfQoKICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOwoKICAgICAg
aWYgKCF0YWJsZS5nZXRFbmFibGVkKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAg
IHZhciB0YWJsZU1vZGVsID0gdGFibGUuZ2V0VGFibGVNb2RlbCgpOwoKICAgICAgdmFyIHBhZ2VY
ID0gZS5nZXREb2N1bWVudExlZnQoKTsKCiAgICAgIHZhciByZXNpemVDb2wgPSB0aGlzLl9nZXRS
ZXNpemVDb2x1bW5Gb3JQYWdlWChwYWdlWCk7CgogICAgICBpZiAocmVzaXplQ29sID09IC0xKQog
ICAgICB7CiAgICAgICAgLy8gbW91c2UgaXMgbm90IGluIGEgcmVzaXplIHJlZ2lvbgogICAgICAg
IHZhciBjb2wgPSB0aGlzLl9nZXRDb2x1bW5Gb3JQYWdlWChwYWdlWCk7CgogICAgICAgIGlmIChj
b2wgIT0gbnVsbCAmJiB0YWJsZU1vZGVsLmlzQ29sdW1uU29ydGFibGUoY29sKSkKICAgICAgICB7
CiAgICAgICAgICAvLyBTb3J0IHRoYXQgY29sdW1uCiAgICAgICAgICB2YXIgc29ydENvbCA9IHRh
YmxlTW9kZWwuZ2V0U29ydENvbHVtbkluZGV4KCk7CiAgICAgICAgICB2YXIgYXNjZW5kaW5nID0g
KGNvbCAhPSBzb3J0Q29sKSA/IHRydWUgOiAhdGFibGVNb2RlbC5pc1NvcnRBc2NlbmRpbmcoKTsK
CiAgICAgICAgICB2YXIgZGF0YSA9CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb2x1bW4g
ICAgIDogY29sLAogICAgICAgICAgICAgIGFzY2VuZGluZyAgOiBhc2NlbmRpbmcsCiAgICAgICAg
ICAgICAgY2xpY2tFdmVudCA6IGUKICAgICAgICAgICAgfTsKCiAgICAgICAgICBpZiAodGhpcy5m
aXJlRGF0YUV2ZW50KCJiZWZvcmVTb3J0IiwgZGF0YSwgbnVsbCwgdHJ1ZSkpCiAgICAgICAgICB7
CiAgICAgICAgICAgIHRhYmxlTW9kZWwuc29ydEJ5Q29sdW1uKGNvbCwgYXNjZW5kaW5nKTsKICAg
ICAgICAgICAgaWYgKHRoaXMuZ2V0UmVzZXRTZWxlY3Rpb25PbkhlYWRlckNsaWNrKCkpCiAgICAg
ICAgICAgIHsKICAgICAgICAgICAgICB0YWJsZS5nZXRTZWxlY3Rpb25Nb2RlbCgpLnJlc2V0U2Vs
ZWN0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAg
ICAgIGUuc3RvcCgpOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxs
ZWQgd2hlbiB0aGUgdXNlciBjbGlja2VkIGEgbW91c2UgYnV0dG9uIG92ZXIgdGhlIHBhbmUuCiAg
ICAgKgogICAgICogQHBhcmFtIGUge01hcH0gdGhlIGV2ZW50LgogICAgICogQHJldHVybiB7dm9p
ZH0KICAgICAqLwogICAgX29uQ2xpY2tQYW5lIDogZnVuY3Rpb24oZSkKICAgIHsKICAgICAgdmFy
IHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOwoKICAgICAgaWYgKCF0YWJsZS5nZXRFbmFibGVkKCkp
IHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBwYWdlWCA9IGUuZ2V0RG9jdW1l
bnRMZWZ0KCk7CiAgICAgIHZhciBwYWdlWSA9IGUuZ2V0RG9jdW1lbnRUb3AoKTsKICAgICAgdmFy
IHJvdyA9IHRoaXMuX2dldFJvd0ZvclBhZ2VQb3MocGFnZVgsIHBhZ2VZKTsKICAgICAgdmFyIGNv
bCA9IHRoaXMuX2dldENvbHVtbkZvclBhZ2VYKHBhZ2VYKTsKCiAgICAgIGlmIChyb3cgIT0gbnVs
bCAmJiBjb2wgIT0gbnVsbCkKICAgICAgewogICAgICAgIHRhYmxlLmdldFNlbGVjdGlvbk1hbmFn
ZXIoKS5oYW5kbGVDbGljayhyb3csIGUpOwoKICAgICAgICBpZiAodGhpcy5fX2ZvY3VzSW5kaWNh
dG9yLmlzSGlkZGVuKCkgfHwKICAgICAgICAgICAgKHRoaXMuX19sYXN0TW91c2VEb3duQ2VsbCAm
JgogICAgICAgICAgICAgIXRoaXMuX19maXJlZENsaWNrRXZlbnQgJiYKICAgICAgICAgICAgICF0
aGlzLmlzRWRpdGluZygpICYmCiAgICAgICAgICAgICByb3cgPT0gdGhpcy5fX2xhc3RNb3VzZURv
d25DZWxsLnJvdyAmJgogICAgICAgICAgICAgY29sID09IHRoaXMuX19sYXN0TW91c2VEb3duQ2Vs
bC5jb2wpKQogICAgICAgIHsKICAgICAgICAgIHRoaXMuZmlyZUV2ZW50KCJjZWxsQ2xpY2siLAog
ICAgICAgICAgICAgICAgICAgICAgICAgcXgudWkudGFibGUucGFuZS5DZWxsRXZlbnQsCiAgICAg
ICAgICAgICAgICAgICAgICAgICBbdGhpcywgZSwgcm93LCBjb2xdLAogICAgICAgICAgICAgICAg
ICAgICAgICAgdHJ1ZSk7CiAgICAgICAgICB0aGlzLl9fZmlyZWRDbGlja0V2ZW50ID0gdHJ1ZTsK
ICAgICAgICB9CiAgICAgIH0KICAgIH0sCgoKICAgIC8qKgogICAgICogRXZlbnQgaGFuZGxlci4g
Q2FsbGVkIHdoZW4gYSBjb250ZXh0IG1lbnUgaXMgaW52b2tlZCBpbiBhIGNlbGwuCiAgICAgKgog
ICAgICogQHBhcmFtIGUge3F4LmV2ZW50LnR5cGUuTW91c2V9IHRoZSBldmVudC4KICAgICAqIEBy
ZXR1cm4ge3ZvaWR9CiAgICAgKi8KICAgIF9vbkNvbnRleHRNZW51IDogZnVuY3Rpb24oZSkKICAg
IHsKICAgICAgdmFyIHBhZ2VYID0gZS5nZXREb2N1bWVudExlZnQoKTsKICAgICAgdmFyIHBhZ2VZ
ID0gZS5nZXREb2N1bWVudFRvcCgpOwogICAgICB2YXIgcm93ID0gdGhpcy5fZ2V0Um93Rm9yUGFn
ZVBvcyhwYWdlWCwgcGFnZVkpOwogICAgICB2YXIgY29sID0gdGhpcy5fZ2V0Q29sdW1uRm9yUGFn
ZVgocGFnZVgpOwoKICAgICAgLyoKICAgICAgICogVGhlICdyb3cnIHZhbHVlIHdpbGwgYmUgbnVs
bCBpZiB0aGUgcmlnaHQtY2xpY2sgd2FzIGluIHRoZSBibGFuawogICAgICAgKiBhcmVhIGJlbG93
IHRoZSBsYXN0IGRhdGEgcm93LiBTb21lIGFwcGxpY2F0aW9ucyBkZXNpcmUgdG8gcmVjZWl2ZQog
ICAgICAgKiB0aGUgY29udGV4dCBtZW51IGV2ZW50IGFueXdheSwgYW5kIGNhbiBzZXQgdGhlIHBy
b3BlcnR5IHZhbHVlIG9mCiAgICAgICAqIGNvbnRleHRNZW51RnJvbURhdGFDZWxsc09ubHkgdG8g
ZmFsc2UgdG8gYWNoaWV2ZSB0aGF0LgogICAgICAgKi8KICAgICAgaWYgKHJvdyA9PT0gbnVsbCAm
JiB0aGlzLmdldENvbnRleHRNZW51RnJvbURhdGFDZWxsc09ubHkoKSkKICAgICAgewogICAgICAg
IHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCEgdGhpcy5nZXRTaG93Q2VsbEZvY3VzSW5kaWNh
dG9yKCkgfHwKICAgICAgICAgIHJvdyA9PT0gbnVsbCB8fAogICAgICAgICAgKHRoaXMuX19sYXN0
TW91c2VEb3duQ2VsbCAmJgogICAgICAgICAgIHJvdyA9PSB0aGlzLl9fbGFzdE1vdXNlRG93bkNl
bGwucm93ICYmCiAgICAgICAgICAgY29sID09IHRoaXMuX19sYXN0TW91c2VEb3duQ2VsbC5jb2wp
KQogICAgICB7CiAgICAgICAgdGhpcy5maXJlRXZlbnQoImNlbGxDb250ZXh0bWVudSIsCiAgICAg
ICAgICAgICAgICAgICAgICAgcXgudWkudGFibGUucGFuZS5DZWxsRXZlbnQsCiAgICAgICAgICAg
ICAgICAgICAgICAgW3RoaXMsIGUsIHJvdywgY29sXSwKICAgICAgICAgICAgICAgICAgICAgICB0
cnVlKTsKCiAgICAgICAgLy8gTm93IHRoYXQgdGhlIGNlbGxDb250ZXh0bWVudSBoYW5kbGVyIGhh
cyBoYWQgYSBjaGFuY2UgdG8gYnVpbGQKICAgICAgICAvLyB0aGUgbWVudSBmb3IgdGhpcyBjZWxs
LCBkaXNwbGF5IGl0IChpZiB0aGVyZSBpcyBvbmUpLgogICAgICAgIHZhciBtZW51ID0gdGhpcy5n
ZXRUYWJsZSgpLmdldENvbnRleHRNZW51KCk7CiAgICAgICAgaWYgKG1lbnUpCiAgICAgICAgewog
ICAgICAgICAgLy8gQSBtZW51IHdpdGggbm8gY2hpbGRyZW4gbWVhbnMgZG9uJ3QgZGlzcGxheSBh
bnkgY29udGV4dCBtZW51CiAgICAgICAgICAvLyBpbmNsdWRpbmcgdGhlIGRlZmF1bHQgY29udGV4
dCBtZW51IGV2ZW4gaWYgdGhlIGRlZmF1bHQgY29udGV4dAogICAgICAgICAgLy8gbWVudSBpcyBh
bGxvd2VkIHRvIGJlIGRpc3BsYXllZCBub3JtYWxseS4gVGhlcmUncyBubyBuZWVkIHRvCiAgICAg
ICAgICAvLyBhY3R1YWxseSBzaG93IGFuIGVtcHR5IG1lbnUsIHRob3VnaC4KICAgICAgICAgIGlm
IChtZW51LmdldENoaWxkcmVuKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICBtZW51Lm9wZW5B
dE1vdXNlKGUpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgewogICAgICAg
ICAgICBtZW51LmV4Y2x1ZGUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBEbyBub3Qgc2hv
dyBuYXRpdmUgbWVudQogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KICAg
ICAgfQogICAgfSwKCgogICAgLy8gb3ZlcnJpZGRlbgogICAgX29uQ29udGV4dE1lbnVPcGVuIDog
ZnVuY3Rpb24oZSkKICAgIHsKICAgICAgLy8gVGhpcyBpcyBXaWRnZXQncyBjb250ZXh0IG1lbnUg
aGFuZGxlciB3aGljaCB0eXBpY2FsbHkgcmV0cmlldmVzCiAgICAgIC8vIGFuZCBkaXNwbGF5cyB0
aGUgbWVudSBhcyBzb29uIGFzIGl0IHJlY2VpdmVzIGEgImNvbnRleHRtZW51IiBldmVudC4KICAg
ICAgLy8gV2Ugd2FudCB0byBhbGxvdyB0aGUgY2VsbENvbnRleHRtZW51IGhhbmRsZXIgdG8gY3Jl
YXRlIHRoZSBtZW51LAogICAgICAvLyBzbyB3ZSdsbCBvdmVycmlkZSB0aGlzIG1ldGhvZCB3aXRo
IGEgbnVsbCBvbmUsIGFuZCBkbyB0aGUgbWVudQogICAgICAvLyBwbGFjZW1lbnQgYW5kIGRpc3Bs
YXkgaGFuZGxpbmcgaW4gb3VyIF9vbkNvbnRleHRNZW51IG1ldGhvZC4KICAgIH0sCgoKICAgIC8q
KgogICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHVzZXIgZG91YmxlIGNsaWNr
ZWQgYSBtb3VzZSBidXR0b24gb3ZlciB0aGUgcGFuZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZSB7
TWFwfSB0aGUgZXZlbnQuCiAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICovCiAgICBfb25EYmxj
bGlja1BhbmUgOiBmdW5jdGlvbihlKQogICAgewogICAgICB2YXIgcGFnZVggPSBlLmdldERvY3Vt
ZW50TGVmdCgpOwogICAgICB2YXIgcGFnZVkgPSBlLmdldERvY3VtZW50VG9wKCk7CgoKICAgICAg
dGhpcy5fZm9jdXNDZWxsQXRQYWdlUG9zKHBhZ2VYLCBwYWdlWSk7CiAgICAgIHRoaXMuc3RhcnRF
ZGl0aW5nKCk7CgogICAgICB2YXIgcm93ID0gdGhpcy5fZ2V0Um93Rm9yUGFnZVBvcyhwYWdlWCwg
cGFnZVkpOwogICAgICBpZiAocm93ICE9IC0xICYmIHJvdyAhPSBudWxsKSB7CiAgICAgICAgdGhp
cy5maXJlRXZlbnQoImNlbGxEYmxjbGljayIsIHF4LnVpLnRhYmxlLnBhbmUuQ2VsbEV2ZW50LCBb
dGhpcywgZSwgcm93XSwgdHJ1ZSk7CiAgICAgIH0KICAgIH0sCgoKICAgIC8qKgogICAgICogRXZl
bnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIG1vdXNlIG1vdmVkIG91dC4KICAgICAqCiAgICAg
KiBAcGFyYW0gZSB7TWFwfSB0aGUgZXZlbnQuCiAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICov
CiAgICBfb25Nb3VzZW91dCA6IGZ1bmN0aW9uKGUpCiAgICB7CiAgICAgIHZhciB0YWJsZSA9IHRo
aXMuZ2V0VGFibGUoKTsKCiAgICAgIGlmICghdGFibGUuZ2V0RW5hYmxlZCgpKSB7CiAgICAgICAg
cmV0dXJuOwogICAgICB9CgogICAgICAvLyBSZXNldCB0aGUgcmVzaXplIGN1cnNvciB3aGVuIHRo
ZSBtb3VzZSBsZWF2ZXMgdGhlIGhlYWRlcgogICAgICAvLyBJZiBjdXJyZW50bHkgYSBjb2x1bW4g
aXMgcmVzaXplZCB0aGVuIGRvIG5vdGhpbmcKICAgICAgLy8gKHRoZSBjdXJzb3Igd2lsbCBiZSBy
ZXNldCBvbiBtb3VzZXVwKQogICAgICBpZiAodGhpcy5fX3Jlc2l6ZUNvbHVtbiA9PSBudWxsKQog
ICAgICB7CiAgICAgICAgdGhpcy5zZXRDdXJzb3IobnVsbCk7CiAgICAgICAgdGhpcy5nZXRBcHBs
aWNhdGlvblJvb3QoKS5zZXRHbG9iYWxDdXJzb3IobnVsbCk7CiAgICAgIH0KCiAgICAgIHRoaXMu
X19oZWFkZXIuc2V0TW91c2VPdmVyQ29sdW1uKG51bGwpOwoKICAgICAgLy8gaW4gY2FzZSB0aGUg
Zm9jdXMgZm9sbG93cyB0aGUgbW91c2UsIGl0IHNob3VsZCBiZSByZW1vdmUgb24gbW91c2VvdXQK
ICAgICAgLyogICAgLy8hISFkYXRvdXhpYSBhZGRlZAogICAgICBpZiAodGhpcy5nZXRGb2N1c0Nl
bGxPbk1vdXNlTW92ZSgpKSB7CiAgICAgICAgdGhpcy5fX3RhYmxlLnNldEZvY3VzZWRDZWxsKCk7
CiAgICAgIH0KICAgICAgKi8KICAgIH0sCgoKICAgIC8qKgogICAgICogU2hvd3MgdGhlIHJlc2l6
ZSBsaW5lLgogICAgICoKICAgICAqIEBwYXJhbSB4IHtJbnRlZ2VyfSB0aGUgcG9zaXRpb24gd2hl
cmUgdG8gc2hvdyB0aGUgbGluZSAoaW4gcGl4ZWxzLCByZWxhdGl2ZSB0bwogICAgICogICAgICB0
aGUgbGVmdCBzaWRlIG9mIHRoZSBwYW5lKS4KICAgICAqIEByZXR1cm4ge3ZvaWR9CiAgICAgKi8K
ICAgIF9zaG93UmVzaXplTGluZSA6IGZ1bmN0aW9uKHgpCiAgICB7CiAgICAgIHZhciByZXNpemVM
aW5lID0gdGhpcy5fc2hvd0NoaWxkQ29udHJvbCgicmVzaXplLWxpbmUiKTsKCiAgICAgIHZhciB3
aWR0aCA9IHJlc2l6ZUxpbmUuZ2V0V2lkdGgoKTsKICAgICAgdmFyIHBhbmVCb3VuZHMgPSB0aGlz
Ll9fcGFuZUNsaXBwZXIuZ2V0Qm91bmRzKCk7CiAgICAgIHJlc2l6ZUxpbmUuc2V0VXNlckJvdW5k
cygKICAgICAgICB4IC0gTWF0aC5yb3VuZCh3aWR0aC8yKSwgMCwgd2lkdGgsIHBhbmVCb3VuZHMu
aGVpZ2h0CiAgICAgICk7CiAgICB9LAoKCiAgICAvKioKICAgICAqIEhpZGVzIHRoZSByZXNpemUg
bGluZS4KICAgICAqLwogICAgX2hpZGVSZXNpemVMaW5lIDogZnVuY3Rpb24oKSB7CiAgICAgIHRo
aXMuX2V4Y2x1ZGVDaGlsZENvbnRyb2woInJlc2l6ZS1saW5lIik7CiAgICB9LAoKCiAgICAvKioK
ICAgICAqIFNob3dzIHRoZSBmZWVkYmFjayBzaG93biB3aGlsZSBhIGNvbHVtbiBpcyBtb3ZlZCBi
eSB0aGUgdXNlci4KICAgICAqCiAgICAgKiBAcGFyYW0gcGFnZVgge0ludGVnZXJ9IHRoZSB4IHBv
c2l0aW9uIG9mIHRoZSBtb3VzZSBpbiB0aGUgcGFnZSAoaW4gcGl4ZWxzKS4KICAgICAqIEByZXR1
cm4ge0ludGVnZXJ9IHRoZSB2aXNpYmxlIHggcG9zaXRpb24gb2YgdGhlIGNvbHVtbiBpbiB0aGUg
d2hvbGUgdGFibGUuCiAgICAgKi8KICAgIHNob3dDb2x1bW5Nb3ZlRmVlZGJhY2sgOiBmdW5jdGlv
bihwYWdlWCkKICAgIHsKICAgICAgdmFyIHBhbmVNb2RlbCA9IHRoaXMuZ2V0VGFibGVQYW5lTW9k
ZWwoKTsKICAgICAgdmFyIGNvbHVtbk1vZGVsID0gdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlQ29s
dW1uTW9kZWwoKTsKICAgICAgdmFyIHBhbmVMZWZ0ID0gdGhpcy5fX3RhYmxlUGFuZS5nZXRDb250
YWluZXJMb2NhdGlvbigpLmxlZnQ7CiAgICAgIHZhciBjb2xDb3VudCA9IHBhbmVNb2RlbC5nZXRD
b2x1bW5Db3VudCgpOwoKICAgICAgdmFyIHRhcmdldFhQb3MgPSAwOwogICAgICB2YXIgdGFyZ2V0
WCA9IDA7CiAgICAgIHZhciBjdXJyWCA9IHBhbmVMZWZ0OwoKICAgICAgZm9yICh2YXIgeFBvcz0w
OyB4UG9zPGNvbENvdW50OyB4UG9zKyspCiAgICAgIHsKICAgICAgICB2YXIgY29sID0gcGFuZU1v
ZGVsLmdldENvbHVtbkF0WCh4UG9zKTsKICAgICAgICB2YXIgY29sV2lkdGggPSBjb2x1bW5Nb2Rl
bC5nZXRDb2x1bW5XaWR0aChjb2wpOwoKICAgICAgICBpZiAocGFnZVggPCBjdXJyWCArIGNvbFdp
ZHRoIC8gMikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBjdXJyWCArPSBj
b2xXaWR0aDsKICAgICAgICB0YXJnZXRYUG9zID0geFBvcyArIDE7CiAgICAgICAgdGFyZ2V0WCA9
IGN1cnJYIC0gcGFuZUxlZnQ7CiAgICAgIH0KCiAgICAgIC8vIEVuc3VyZSB0YXJnZXRYIGlzIHZp
c2libGUKICAgICAgdmFyIHNjcm9sbGVyTGVmdCA9IHRoaXMuX19wYW5lQ2xpcHBlci5nZXRDb250
YWluZXJMb2NhdGlvbigpLmxlZnQ7CiAgICAgIHZhciBzY3JvbGxlcldpZHRoID0gdGhpcy5fX3Bh
bmVDbGlwcGVyLmdldEJvdW5kcygpLndpZHRoOwogICAgICB2YXIgc2Nyb2xsWCA9IHNjcm9sbGVy
TGVmdCAtIHBhbmVMZWZ0OwoKICAgICAgLy8gTk9URTogKzIvLTEgYmVjYXVzZSBvZiBmZWVkYmFj
ayB3aWR0aAogICAgICB0YXJnZXRYID0gcXgubGFuZy5OdW1iZXIubGltaXQodGFyZ2V0WCwgc2Ny
b2xsWCArIDIsIHNjcm9sbFggKyBzY3JvbGxlcldpZHRoIC0gMSk7CgogICAgICB0aGlzLl9zaG93
UmVzaXplTGluZSh0YXJnZXRYKTsKCiAgICAgIC8vIFJldHVybiB0aGUgb3ZlcmFsbCB0YXJnZXQg
eCBwb3NpdGlvbgogICAgICByZXR1cm4gcGFuZU1vZGVsLmdldEZpcnN0Q29sdW1uWCgpICsgdGFy
Z2V0WFBvczsKICAgIH0sCgoKICAgIC8qKgogICAgICogSGlkZXMgdGhlIGZlZWRiYWNrIHNob3du
IHdoaWxlIGEgY29sdW1uIGlzIG1vdmVkIGJ5IHRoZSB1c2VyLgogICAgICovCiAgICBoaWRlQ29s
dW1uTW92ZUZlZWRiYWNrIDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuX2hpZGVSZXNpemVMaW5l
KCk7CiAgICB9LAoKCiAgICAvKioKICAgICAqIFNldHMgdGhlIGZvY3VzIHRvIHRoZSBjZWxsIHRo
YXQncyBsb2NhdGVkIGF0IHRoZSBwYWdlIHBvc2l0aW9uCiAgICAgKiA8Y29kZT5wYWdlWDwvY29k
ZT4vPGNvZGU+cGFnZVk8L2NvZGU+LiBJZiB0aGVyZSBpcyBubyBjZWxsIGF0IHRoYXQgcG9zaXRp
b24sCiAgICAgKiBub3RoaW5nIGhhcHBlbnMuCiAgICAgKgogICAgICogQHBhcmFtIHBhZ2VYIHtJ
bnRlZ2VyfSB0aGUgeCBwb3NpdGlvbiBpbiB0aGUgcGFnZSAoaW4gcGl4ZWxzKS4KICAgICAqIEBw
YXJhbSBwYWdlWSB7SW50ZWdlcn0gdGhlIHkgcG9zaXRpb24gaW4gdGhlIHBhZ2UgKGluIHBpeGVs
cykuCiAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICovCiAgICBfZm9jdXNDZWxsQXRQYWdlUG9z
IDogZnVuY3Rpb24ocGFnZVgsIHBhZ2VZKQogICAgewogICAgICB2YXIgcm93ID0gdGhpcy5fZ2V0
Um93Rm9yUGFnZVBvcyhwYWdlWCwgcGFnZVkpOwoKICAgICAgaWYgKHJvdyAhPSAtMSAmJiByb3cg
IT0gbnVsbCkKICAgICAgewogICAgICAgIC8vIFRoZSBtb3VzZSBpcyBvdmVyIHRoZSBkYXRhIC0+
IHVwZGF0ZSB0aGUgZm9jdXMKICAgICAgICB2YXIgY29sID0gdGhpcy5fZ2V0Q29sdW1uRm9yUGFn
ZVgocGFnZVgpOwogICAgICAgIHRoaXMuX190YWJsZS5zZXRGb2N1c2VkQ2VsbChjb2wsIHJvdyk7
CiAgICAgIH0KICAgIH0sCgoKICAgIC8qKgogICAgICogU2V0cyB0aGUgY3VycmVudGx5IGZvY3Vz
ZWQgY2VsbC4KICAgICAqCiAgICAgKiBAcGFyYW0gY29sIHtJbnRlZ2VyfSB0aGUgbW9kZWwgaW5k
ZXggb2YgdGhlIGZvY3VzZWQgY2VsbCdzIGNvbHVtbi4KICAgICAqIEBwYXJhbSByb3cge0ludGVn
ZXJ9IHRoZSBtb2RlbCBpbmRleCBvZiB0aGUgZm9jdXNlZCBjZWxsJ3Mgcm93LgogICAgICogQHJl
dHVybiB7dm9pZH0KICAgICAqLwogICAgc2V0Rm9jdXNlZENlbGwgOiBmdW5jdGlvbihjb2wsIHJv
dykKICAgIHsKICAgICAgaWYgKCF0aGlzLmlzRWRpdGluZygpKQogICAgICB7CiAgICAgICAgdGhp
cy5fX3RhYmxlUGFuZS5zZXRGb2N1c2VkQ2VsbChjb2wsIHJvdywgdGhpcy5fX3VwZGF0ZUNvbnRl
bnRQbGFubmVkKTsKCiAgICAgICAgdGhpcy5fX2ZvY3VzZWRDb2wgPSBjb2w7CiAgICAgICAgdGhp
cy5fX2ZvY3VzZWRSb3cgPSByb3c7CgogICAgICAgIHRoaXMuX3VwZGF0ZUZvY3VzSW5kaWNhdG9y
KCk7CiAgICAgIH0KICAgIH0sCgoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY29sdW1uIG9m
IGN1cnJlbnRseSBmb2N1c2VkIGNlbGwuCiAgICAgKgogICAgICogQHJldHVybiB7SW50ZWdlcn0g
dGhlIG1vZGVsIGluZGV4IG9mIHRoZSBmb2N1c2VkIGNlbGwncyBjb2x1bW4uCiAgICAgKi8KICAg
IGdldEZvY3VzZWRDb2x1bW4gOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuX19mb2N1
c2VkQ29sOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSByb3cgb2YgY3VycmVu
dGx5IGZvY3VzZWQgY2VsbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtJbnRlZ2VyfSB0aGUgbW9k
ZWwgaW5kZXggb2YgdGhlIGZvY3VzZWQgY2VsbCdzIGNvbHVtbi4KICAgICAqLwogICAgZ2V0Rm9j
dXNlZFJvdyA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fX2ZvY3VzZWRSb3c7CiAg
ICB9LAoKCiAgICAvKioKICAgICAqIFNjcm9sbHMgYSBjZWxsIHZpc2libGUuCiAgICAgKgogICAg
ICogQHBhcmFtIGNvbCB7SW50ZWdlcn0gdGhlIG1vZGVsIGluZGV4IG9mIHRoZSBjb2x1bW4gdGhl
IGNlbGwgYmVsb25ncyB0by4KICAgICAqIEBwYXJhbSByb3cge0ludGVnZXJ9IHRoZSBtb2RlbCBp
bmRleCBvZiB0aGUgcm93IHRoZSBjZWxsIGJlbG9uZ3MgdG8uCiAgICAgKiBAcmV0dXJuIHt2b2lk
fQogICAgICovCiAgICBzY3JvbGxDZWxsVmlzaWJsZSA6IGZ1bmN0aW9uKGNvbCwgcm93KQogICAg
ewogICAgICB2YXIgcGFuZU1vZGVsID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpOwogICAgICB2
YXIgeFBvcyA9IHBhbmVNb2RlbC5nZXRYKGNvbCk7CgogICAgICBpZiAoeFBvcyAhPSAtMSkKICAg
ICAgewogICAgICAgIHZhciBjbGlwcGVyU2l6ZSA9IHRoaXMuX19wYW5lQ2xpcHBlci5nZXRJbm5l
clNpemUoKTsKICAgICAgICBpZiAoIWNsaXBwZXJTaXplKSB7CiAgICAgICAgICByZXR1cm47CiAg
ICAgICAgfQoKICAgICAgICB2YXIgY29sdW1uTW9kZWwgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFi
bGVDb2x1bW5Nb2RlbCgpOwoKICAgICAgICB2YXIgY29sTGVmdCA9IHBhbmVNb2RlbC5nZXRDb2x1
bW5MZWZ0KGNvbCk7CiAgICAgICAgdmFyIGNvbFdpZHRoID0gY29sdW1uTW9kZWwuZ2V0Q29sdW1u
V2lkdGgoY29sKTsKICAgICAgICB2YXIgcm93SGVpZ2h0ID0gdGhpcy5nZXRUYWJsZSgpLmdldFJv
d0hlaWdodCgpOwogICAgICAgIHZhciByb3dUb3AgPSByb3cgKiByb3dIZWlnaHQ7CgogICAgICAg
IHZhciBzY3JvbGxYID0gdGhpcy5nZXRTY3JvbGxYKCk7CiAgICAgICAgdmFyIHNjcm9sbFkgPSB0
aGlzLmdldFNjcm9sbFkoKTsKCiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIHF4Lmxhbmcu
TnVtYmVyLmxpbWl0LCBiZWNhdXNlIG1pbiBzaG91bGQgd2luIGlmIG1heCA8IG1pbgogICAgICAg
IHZhciBtaW5TY3JvbGxYID0gTWF0aC5taW4oY29sTGVmdCwgY29sTGVmdCArIGNvbFdpZHRoIC0g
Y2xpcHBlclNpemUud2lkdGgpOwogICAgICAgIHZhciBtYXhTY3JvbGxYID0gY29sTGVmdDsKICAg
ICAgICB0aGlzLnNldFNjcm9sbFgoTWF0aC5tYXgobWluU2Nyb2xsWCwgTWF0aC5taW4obWF4U2Ny
b2xsWCwgc2Nyb2xsWCkpKTsKCiAgICAgICAgdmFyIG1pblNjcm9sbFkgPSByb3dUb3AgKyByb3dI
ZWlnaHQgLSBjbGlwcGVyU2l6ZS5oZWlnaHQ7CgogICAgICAgIGlmICh0aGlzLmdldFRhYmxlKCku
Z2V0S2VlcEZpcnN0VmlzaWJsZVJvd0NvbXBsZXRlKCkpIHsKICAgICAgICAgIG1pblNjcm9sbFkg
Kz0gcm93SGVpZ2h0OwogICAgICAgIH0KCiAgICAgICAgdmFyIG1heFNjcm9sbFkgPSByb3dUb3A7
CiAgICAgICAgdGhpcy5zZXRTY3JvbGxZKE1hdGgubWF4KG1pblNjcm9sbFksIE1hdGgubWluKG1h
eFNjcm9sbFksIHNjcm9sbFkpKSwgdHJ1ZSk7CiAgICAgIH0KICAgIH0sCgoKICAgIC8qKgogICAg
ICogUmV0dXJucyB3aGV0aGVyIGN1cnJlbnRseSBhIGNlbGwgaXMgZWRpdGluZy4KICAgICAqCiAg
ICAgKiBAcmV0dXJuIHt2YXJ9IHdoZXRoZXIgY3VycmVudGx5IGEgY2VsbCBpcyBlZGl0aW5nLgog
ICAgICovCiAgICBpc0VkaXRpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuX19j
ZWxsRWRpdG9yICE9IG51bGw7CiAgICB9LAoKCiAgICAvKioKICAgICAqIFN0YXJ0cyBlZGl0aW5n
IHRoZSBjdXJyZW50bHkgZm9jdXNlZCBjZWxsLiBEb2VzIG5vdGhpbmcgaWYgYWxyZWFkeQogICAg
ICogZWRpdGluZywgaWYgdGhlIGNvbHVtbiBpcyBub3QgZWRpdGFibGUsIG9yIGlmIHRoZSBjZWxs
IGVkaXRvciBmb3IgdGhlCiAgICAgKiBjb2x1bW4gYXNjZXJ0YWlucyB0aGF0IHRoZSBwYXJ0aWN1
bGFyIGNlbGwgaXMgbm90IGVkaXRhYmxlLgogICAgICoKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59
IHdoZXRoZXIgZWRpdGluZyB3YXMgc3RhcnRlZAogICAgICovCiAgICBzdGFydEVkaXRpbmcgOiBm
dW5jdGlvbigpCiAgICB7CiAgICAgIHZhciB0YWJsZSA9IHRoaXMuZ2V0VGFibGUoKTsKICAgICAg
dmFyIHRhYmxlTW9kZWwgPSB0YWJsZS5nZXRUYWJsZU1vZGVsKCk7CiAgICAgIHZhciBjb2wgPSB0
aGlzLl9fZm9jdXNlZENvbDsKCiAgICAgIGlmICgKICAgICAgICAhdGhpcy5pc0VkaXRpbmcoKSAm
JgogICAgICAgIChjb2wgIT0gbnVsbCkgJiYKICAgICAgICB0YWJsZU1vZGVsLmlzQ29sdW1uRWRp
dGFibGUoY29sKQogICAgICApIHsKICAgICAgICB2YXIgcm93ID0gdGhpcy5fX2ZvY3VzZWRSb3c7
CiAgICAgICAgdmFyIHhQb3MgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVsKCkuZ2V0WChjb2wpOwog
ICAgICAgIHZhciB2YWx1ZSA9IHRhYmxlTW9kZWwuZ2V0VmFsdWUoY29sLCByb3cpOwoKICAgICAg
ICAvLyBzY3JvbGwgY2VsbCBpbnRvIHZpZXcKICAgICAgICB0aGlzLnNjcm9sbENlbGxWaXNpYmxl
KHhQb3MsIHJvdyk7CgogICAgICAgIHRoaXMuX19jZWxsRWRpdG9yRmFjdG9yeSA9IHRhYmxlLmdl
dFRhYmxlQ29sdW1uTW9kZWwoKS5nZXRDZWxsRWRpdG9yRmFjdG9yeShjb2wpOwoKICAgICAgICB2
YXIgY2VsbEluZm8gPQogICAgICAgIHsKICAgICAgICAgIGNvbCAgIDogY29sLAogICAgICAgICAg
cm93ICAgOiByb3csCiAgICAgICAgICB4UG9zICA6IHhQb3MsCiAgICAgICAgICB2YWx1ZSA6IHZh
bHVlLAogICAgICAgICAgdGFibGUgOiB0YWJsZQogICAgICAgIH07CgogICAgICAgIC8vIEdldCBh
IGNlbGwgZWRpdG9yCiAgICAgICAgdGhpcy5fX2NlbGxFZGl0b3IgPSB0aGlzLl9fY2VsbEVkaXRv
ckZhY3RvcnkuY3JlYXRlQ2VsbEVkaXRvcihjZWxsSW5mbyk7CgogICAgICAgIC8vIFdlIGhhbmRs
ZSB0d28gdHlwZXMgb2YgY2VsbCBlZGl0b3JzOiB0aGUgdHJhZGl0aW9uYWwgaW4tcGxhY2UKICAg
ICAgICAvLyBlZGl0b3IsIHdoZXJlIHRoZSBjZWxsIGVkaXRvciByZXR1cm5lZCBieSB0aGUgZmFj
dG9yeSBtdXN0IGZpdCBpbgogICAgICAgIC8vIHRoZSBzcGFjZSBvZiB0aGUgdGFibGUgY2VsbDsg
YW5kIGEgbW9kYWwgd2luZG93IGluIHdoaWNoIHRoZQogICAgICAgIC8vIGVkaXRpbmcgdGFrZXMg
cGxhY2UuICBBZGRpdGlvbmFsbHksIGlmIHRoZSBjZWxsIGVkaXRvciBkZXRlcm1pbmVzCiAgICAg
ICAgLy8gdGhhdCBpdCBkb2VzIG5vdCB3YW50IHRvIGVkaXQgdGhlIHBhcnRpY3VsYXIgY2VsbCBi
ZWluZyByZXF1ZXN0ZWQsCiAgICAgICAgLy8gaXQgbWF5IHJldHVybiBudWxsIHRvIGluZGljYXRl
IHRoYXQgdGhhdCBjZWxsIGlzIG5vdCBlZGl0YWJsZS4KICAgICAgICBpZiAodGhpcy5fX2NlbGxF
ZGl0b3IgPT09IG51bGwpCiAgICAgICAgewogICAgICAgICAgLy8gVGhpcyBjZWxsIGlzIG5vdCBl
ZGl0YWJsZSBldmVuIHRob3VnaCBpdHMgY29sdW1uIGlzLgogICAgICAgICAgcmV0dXJuIGZhbHNl
OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0aGlzLl9fY2VsbEVkaXRvciBpbnN0YW5jZW9m
IHF4LnVpLndpbmRvdy5XaW5kb3cpCiAgICAgICAgewogICAgICAgICAgLy8gSXQncyBhIHdpbmRv
dy4gIEVuc3VyZSB0aGF0IGl0J3MgbW9kYWwuCiAgICAgICAgICB0aGlzLl9fY2VsbEVkaXRvci5z
ZXRNb2RhbCh0cnVlKTsKCiAgICAgICAgICAvLyBBdCBsZWFzdCBmb3IgdGhlIHRpbWUgYmVpbmcs
IHdlIGRpc2FsbG93IHRoZSBjbG9zZSBidXR0b24uICBJdAogICAgICAgICAgLy8gYWN0cyBkaWZm
ZXJlbnRseSB0aGFuIGEgY2VsbEVkaXRvci5jbG9zZSgpLCBhbmQgaW52b2tlcyBhIGJ1ZwogICAg
ICAgICAgLy8gc29tZXBsYWNlLiAgTW9kYWwgd2luZG93IGNlbGwgZWRpdG9ycyBzaG91bGQgcHJv
dmlkZSB0aGVpciBvd24KICAgICAgICAgIC8vIGJ1dHRvbnMgb3IgbWVhbnMgdG8gYWN0aXZhdGUg
YSBjZWxsRWRpdG9yLmNsb3NlKCkgb3IgZXF1aXZhbGVudGx5CiAgICAgICAgICAvLyBjZWxsRWRp
dG9yLmhpZGUoKS4KICAgICAgICAgIHRoaXMuX19jZWxsRWRpdG9yLnNldFNob3dDbG9zZShmYWxz
ZSk7CgogICAgICAgICAgLy8gQXJyYW5nZSB0byBiZSBub3RpZmllZCB3aGVuIGl0IGlzIGNsb3Nl
ZC4KICAgICAgICAgIHRoaXMuX19jZWxsRWRpdG9yLmFkZExpc3RlbmVyKAogICAgICAgICAgICAi
Y2xvc2UiLAogICAgICAgICAgICB0aGlzLl9vbkNlbGxFZGl0b3JNb2RhbFdpbmRvd0Nsb3NlLAog
ICAgICAgICAgICB0aGlzKTsKCiAgICAgICAgICAvLyBJZiB0aGVyZSdzIGEgcHJlLW9wZW4gZnVu
Y3Rpb24gZGVmaW5lZCBmb3IgdGhlIHRhYmxlLi4uCiAgICAgICAgICB2YXIgZiA9IHRhYmxlLmdl
dE1vZGFsQ2VsbEVkaXRvclByZU9wZW5GdW5jdGlvbigpOwogICAgICAgICAgaWYgKGYgIT0gbnVs
bCkgewogICAgICAgICAgICBmKHRoaXMuX19jZWxsRWRpdG9yLCBjZWxsSW5mbyk7CiAgICAgICAg
ICB9CgogICAgICAgICAgLy8gT3BlbiBpdCBub3cuCiAgICAgICAgICB0aGlzLl9fY2VsbEVkaXRv
ci5vcGVuKCk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAvLyBU
aGUgY2VsbCBlZGl0b3IgaXMgYSB0cmFkaXRpb25hbCBpbi1wbGFjZSBlZGl0b3IuCiAgICAgICAg
ICB2YXIgc2l6ZSA9IHRoaXMuX19mb2N1c0luZGljYXRvci5nZXRJbm5lclNpemUoKTsKICAgICAg
ICAgIHRoaXMuX19jZWxsRWRpdG9yLnNldFVzZXJCb3VuZHMoMCwgMCwgc2l6ZS53aWR0aCwgc2l6
ZS5oZWlnaHQpOwoKICAgICAgICAgIC8vIHByZXZlbnQgY2xpY2sgZXZlbnQgZnJvbSBidWJibGlu
ZyB1cCB0byB0aGUgdGFibGUKICAgICAgICAgIHRoaXMuX19mb2N1c0luZGljYXRvci5hZGRMaXN0
ZW5lcigibW91c2Vkb3duIiwgdGhpcy5fb25TdG9wTW91c2VEb3duLCB0aGlzKTsKCiAgICAgICAg
ICB0aGlzLl9fZm9jdXNJbmRpY2F0b3IuYWRkKHRoaXMuX19jZWxsRWRpdG9yKTsKICAgICAgICAg
IHRoaXMuX19mb2N1c0luZGljYXRvci5hZGRTdGF0ZSgiZWRpdGluZyIpOwogICAgICAgICAgdGhp
cy5fX2ZvY3VzSW5kaWNhdG9yLnNldEtlZXBBY3RpdmUoZmFsc2UpOwoKICAgICAgICAgIC8vIE1h
a2UgdGhlIGZvY3VzIGluZGljYXRvciB2aXNpYmxlIGR1cmluZyBlZGl0aW5nCiAgICAgICAgICB0
aGlzLl9fZm9jdXNJbmRpY2F0b3Iuc2V0RGVjb3JhdG9yKCJ0YWJsZS1zY3JvbGxlci1mb2N1cy1p
bmRpY2F0b3IiKTsKCiAgICAgICAgICB0aGlzLl9fY2VsbEVkaXRvci5mb2N1cygpOwogICAgICAg
ICAgdGhpcy5fX2NlbGxFZGl0b3IuYWN0aXZhdGUoKTsKICAgICAgICB9CgogICAgICAgIHJldHVy
biB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKICAgIF9vblN0b3BN
b3VzZURvd246IGZ1bmN0aW9uKGUpCiAgICB7CiAgICAgICAgdGhpcy5fX2xhc3RNb3VzZURvd25D
ZWxsID0gewogICAgICAgICAgcm93IDogdGhpcy5fX2ZvY3VzZWRSb3csCiAgICAgICAgICBjb2wg
OiB0aGlzLl9fZm9jdXNlZENvbAogICAgICAgIH07CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24o
KTsKICAgIH0sIAoKICAgIC8qKgogICAgICogU3RvcHMgZWRpdGluZyBhbmQgd3JpdGVzIHRoZSBl
ZGl0b3IncyB2YWx1ZSB0byB0aGUgbW9kZWwuCiAgICAgKi8KICAgIHN0b3BFZGl0aW5nIDogZnVu
Y3Rpb24oKQogICAgewogICAgICAvLyBJZiB0aGUgZm9jdXMgaW5kaWNhdG9yIGlzIG5vdCBiZWlu
ZyBzaG93biBub3JtYWxseS4uLgogICAgICBpZiAoISB0aGlzLmdldFNob3dDZWxsRm9jdXNJbmRp
Y2F0b3IoKSkKICAgICAgewogICAgICAgIHRoaXMuX19mb2N1c0luZGljYXRvci5yZW1vdmVMaXN0
ZW5lcigibW91c2Vkb3duIiwgdGhpcy5fb25TdG9wTW91c2VEb3duLCB0aGlzKTsKICAgICAgICAv
LyAuLi4gdGhlbiBoaWRlIGl0IGFnYWluCiAgICAgICAgdGhpcy5fX2ZvY3VzSW5kaWNhdG9yLnNl
dERlY29yYXRvcihudWxsKTsKICAgICAgfQoKICAgICAgdGhpcy5mbHVzaEVkaXRvcigpOwogICAg
ICB0aGlzLmNhbmNlbEVkaXRpbmcoKTsKICAgIH0sCgoKICAgIC8qKgogICAgICogV3JpdGVzIHRo
ZSBlZGl0b3IncyB2YWx1ZSB0byB0aGUgbW9kZWwuCiAgICAgKi8KICAgIGZsdXNoRWRpdG9yIDog
ZnVuY3Rpb24oKQogICAgewogICAgICBpZiAodGhpcy5pc0VkaXRpbmcoKSkKICAgICAgewogICAg
ICAgIHZhciB2YWx1ZSA9IHRoaXMuX19jZWxsRWRpdG9yRmFjdG9yeS5nZXRDZWxsRWRpdG9yVmFs
dWUodGhpcy5fX2NlbGxFZGl0b3IpOwogICAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuZ2V0VGFi
bGUoKS5nZXRUYWJsZU1vZGVsKCkuZ2V0VmFsdWUodGhpcy5fX2ZvY3VzZWRDb2wsIHRoaXMuX19m
b2N1c2VkUm93KTsKICAgICAgICB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVNb2RlbCgpLnNldFZh
bHVlKHRoaXMuX19mb2N1c2VkQ29sLCB0aGlzLl9fZm9jdXNlZFJvdywgdmFsdWUpOwoKICAgICAg
ICB0aGlzLl9fdGFibGUuZm9jdXMoKTsKCiAgICAgICAgLy8gRmlyZSBhbiBldmVudCBjb250YWlu
aW5nIHRoZSB2YWx1ZSBjaGFuZ2UuCiAgICAgICAgdGhpcy5fX3RhYmxlLmZpcmVEYXRhRXZlbnQo
ImRhdGFFZGl0ZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdyAgICAgIDogdGhpcy5fX2ZvY3VzZWRS
b3csCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wgICAgICA6IHRoaXMu
X19mb2N1c2VkQ29sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkVmFs
dWUgOiBvbGRWYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVl
ICAgIDogdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAg
fQogICAgfSwKCgogICAgLyoqCiAgICAgKiBTdG9wcyBlZGl0aW5nIHdpdGhvdXQgd3JpdGluZyB0
aGUgZWRpdG9yJ3MgdmFsdWUgdG8gdGhlIG1vZGVsLgogICAgICovCiAgICBjYW5jZWxFZGl0aW5n
IDogZnVuY3Rpb24oKQogICAgewogICAgICBpZiAodGhpcy5pc0VkaXRpbmcoKSAmJiAhIHRoaXMu
X19jZWxsRWRpdG9yLnBlbmRpbmdEaXNwb3NlKQogICAgICB7CiAgICAgICAgaWYgKHRoaXMuX2Nl
bGxFZGl0b3JJc01vZGFsV2luZG93KQogICAgICAgIHsKICAgICAgICAgIHRoaXMuX19jZWxsRWRp
dG9yLmRlc3Ryb3koKTsKICAgICAgICAgIHRoaXMuX19jZWxsRWRpdG9yID0gbnVsbDsKICAgICAg
ICAgIHRoaXMuX19jZWxsRWRpdG9yRmFjdG9yeSA9IG51bGw7CiAgICAgICAgICB0aGlzLl9fY2Vs
bEVkaXRvci5wZW5kaW5nRGlzcG9zZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAg
ICAgICB7CiAgICAgICAgICB0aGlzLl9fZm9jdXNJbmRpY2F0b3IucmVtb3ZlU3RhdGUoImVkaXRp
bmciKTsKICAgICAgICAgIHRoaXMuX19mb2N1c0luZGljYXRvci5zZXRLZWVwQWN0aXZlKHRydWUp
OwogICAgICAgICAgdGhpcy5fX2NlbGxFZGl0b3IuZGVzdHJveSgpOwogICAgICAgICAgdGhpcy5f
X2NlbGxFZGl0b3IgPSBudWxsOwogICAgICAgICAgdGhpcy5fX2NlbGxFZGl0b3JGYWN0b3J5ID0g
bnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgoKICAgIC8qKgogICAgICogRXZlbnQgaGFu
ZGxlci4gQ2FsbGVkIHdoZW4gdGhlIG1vZGFsIHdpbmRvdyBvZiB0aGUgY2VsbCBlZGl0b3IgY2xv
c2VzLgogICAgICoKICAgICAqIEBwYXJhbSBlIHtNYXB9IHRoZSBldmVudC4KICAgICAqIEByZXR1
cm4ge3ZvaWR9CiAgICAgKi8KICAgIF9vbkNlbGxFZGl0b3JNb2RhbFdpbmRvd0Nsb3NlIDogZnVu
Y3Rpb24oZSkgewogICAgICB0aGlzLnN0b3BFZGl0aW5nKCk7CiAgICB9LAoKCiAgICAvKioKICAg
ICAqIFJldHVybnMgdGhlIG1vZGVsIGluZGV4IG9mIHRoZSBjb2x1bW4gdGhlIG1vdXNlIGlzIG92
ZXIgb3IgbnVsbCBpZiB0aGUgbW91c2UKICAgICAqIGlzIG5vdCBvdmVyIGEgY29sdW1uLgogICAg
ICoKICAgICAqIEBwYXJhbSBwYWdlWCB7SW50ZWdlcn0gdGhlIHggcG9zaXRpb24gb2YgdGhlIG1v
dXNlIGluIHRoZSBwYWdlIChpbiBwaXhlbHMpLgogICAgICogQHJldHVybiB7SW50ZWdlcn0gdGhl
IG1vZGVsIGluZGV4IG9mIHRoZSBjb2x1bW4gdGhlIG1vdXNlIGlzIG92ZXIuCiAgICAgKi8KICAg
IF9nZXRDb2x1bW5Gb3JQYWdlWCA6IGZ1bmN0aW9uKHBhZ2VYKQogICAgewogICAgICB2YXIgY29s
dW1uTW9kZWwgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwogICAgICB2
YXIgcGFuZU1vZGVsID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpOwogICAgICB2YXIgY29sQ291
bnQgPSBwYW5lTW9kZWwuZ2V0Q29sdW1uQ291bnQoKTsKICAgICAgdmFyIGN1cnJYID0gdGhpcy5f
X3RhYmxlUGFuZS5nZXRDb250ZW50TG9jYXRpb24oKS5sZWZ0OwoKICAgICAgZm9yICh2YXIgeD0w
OyB4PGNvbENvdW50OyB4KyspCiAgICAgIHsKICAgICAgICB2YXIgY29sID0gcGFuZU1vZGVsLmdl
dENvbHVtbkF0WCh4KTsKICAgICAgICB2YXIgY29sV2lkdGggPSBjb2x1bW5Nb2RlbC5nZXRDb2x1
bW5XaWR0aChjb2wpOwogICAgICAgIGN1cnJYICs9IGNvbFdpZHRoOwoKICAgICAgICBpZiAocGFn
ZVggPCBjdXJyWCkgewogICAgICAgICAgcmV0dXJuIGNvbDsKICAgICAgICB9CiAgICAgIH0KCiAg
ICAgIHJldHVybiBudWxsOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBtb2Rl
bCBpbmRleCBvZiB0aGUgY29sdW1uIHRoYXQgc2hvdWxkIGJlIHJlc2l6ZWQgd2hlbiBkcmFnZ2lu
ZwogICAgICogc3RhcnRzIGhlcmUuIFJldHVybnMgLTEgaWYgdGhlIG1vdXNlIGlzIGluIG5vIHJl
c2l6ZSByZWdpb24gb2YgYW55IGNvbHVtbi4KICAgICAqCiAgICAgKiBAcGFyYW0gcGFnZVgge0lu
dGVnZXJ9IHRoZSB4IHBvc2l0aW9uIG9mIHRoZSBtb3VzZSBpbiB0aGUgcGFnZSAoaW4gcGl4ZWxz
KS4KICAgICAqIEByZXR1cm4ge0ludGVnZXJ9IHRoZSBjb2x1bW4gaW5kZXguCiAgICAgKi8KICAg
IF9nZXRSZXNpemVDb2x1bW5Gb3JQYWdlWCA6IGZ1bmN0aW9uKHBhZ2VYKQogICAgewogICAgICB2
YXIgY29sdW1uTW9kZWwgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwog
ICAgICB2YXIgcGFuZU1vZGVsID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpOwogICAgICB2YXIg
Y29sQ291bnQgPSBwYW5lTW9kZWwuZ2V0Q29sdW1uQ291bnQoKTsKICAgICAgdmFyIGN1cnJYID0g
dGhpcy5fX2hlYWRlci5nZXRDb250YWluZXJMb2NhdGlvbigpLmxlZnQ7CiAgICAgIHZhciByZWdp
b25SYWRpdXMgPSBxeC51aS50YWJsZS5wYW5lLlNjcm9sbGVyLlJFU0laRV9SRUdJT05fUkFESVVT
OwoKICAgICAgZm9yICh2YXIgeD0wOyB4PGNvbENvdW50OyB4KyspCiAgICAgIHsKICAgICAgICB2
YXIgY29sID0gcGFuZU1vZGVsLmdldENvbHVtbkF0WCh4KTsKICAgICAgICB2YXIgY29sV2lkdGgg
PSBjb2x1bW5Nb2RlbC5nZXRDb2x1bW5XaWR0aChjb2wpOwogICAgICAgIGN1cnJYICs9IGNvbFdp
ZHRoOwoKICAgICAgICBpZiAocGFnZVggPj0gKGN1cnJYIC0gcmVnaW9uUmFkaXVzKSAmJiBwYWdl
WCA8PSAoY3VyclggKyByZWdpb25SYWRpdXMpKSB7CiAgICAgICAgICByZXR1cm4gY29sOwogICAg
ICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIC0xOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBS
ZXR1cm5zIHRoZSBtb2RlbCBpbmRleCBvZiB0aGUgcm93IHRoZSBtb3VzZSBpcyBjdXJyZW50bHkg
b3Zlci4gUmV0dXJucyAtMSBpZgogICAgICogdGhlIG1vdXNlIGlzIG92ZXIgdGhlIGhlYWRlci4g
UmV0dXJucyBudWxsIGlmIHRoZSBtb3VzZSBpcyBub3Qgb3ZlciBhbnkKICAgICAqIGNvbHVtbi4K
ICAgICAqCiAgICAgKiBAcGFyYW0gcGFnZVgge0ludGVnZXJ9IHRoZSBtb3VzZSB4IHBvc2l0aW9u
IGluIHRoZSBwYWdlLgogICAgICogQHBhcmFtIHBhZ2VZIHtJbnRlZ2VyfSB0aGUgbW91c2UgeSBw
b3NpdGlvbiBpbiB0aGUgcGFnZS4KICAgICAqIEByZXR1cm4ge0ludGVnZXJ9IHRoZSBtb2RlbCBp
bmRleCBvZiB0aGUgcm93IHRoZSBtb3VzZSBpcyBjdXJyZW50bHkgb3Zlci4KICAgICAqLwogICAg
X2dldFJvd0ZvclBhZ2VQb3MgOiBmdW5jdGlvbihwYWdlWCwgcGFnZVkpCiAgICB7CiAgICAgIHZh
ciBwYW5lUG9zID0gdGhpcy5fX3RhYmxlUGFuZS5nZXRDb250ZW50TG9jYXRpb24oKTsKCiAgICAg
IGlmIChwYWdlWCA8IHBhbmVQb3MubGVmdCB8fCBwYWdlWCA+IHBhbmVQb3MucmlnaHQpCiAgICAg
IHsKICAgICAgICAvLyBUaGVyZSB3YXMgbm8gY2VsbCBvciBoZWFkZXIgY2VsbCBoaXQKICAgICAg
ICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKHBhZ2VZID49IHBhbmVQb3MudG9wICYm
IHBhZ2VZIDw9IHBhbmVQb3MuYm90dG9tKQogICAgICB7CiAgICAgICAgLy8gVGhpcyBldmVudCBp
cyBpbiB0aGUgcGFuZSAtPiBHZXQgdGhlIHJvdwogICAgICAgIHZhciByb3dIZWlnaHQgPSB0aGlz
LmdldFRhYmxlKCkuZ2V0Um93SGVpZ2h0KCk7CgogICAgICAgIHZhciBzY3JvbGxZID0gdGhpcy5f
X3ZlclNjcm9sbEJhci5nZXRQb3NpdGlvbigpOwoKICAgICAgICBpZiAodGhpcy5nZXRUYWJsZSgp
LmdldEtlZXBGaXJzdFZpc2libGVSb3dDb21wbGV0ZSgpKSB7CiAgICAgICAgICBzY3JvbGxZID0g
TWF0aC5mbG9vcihzY3JvbGxZIC8gcm93SGVpZ2h0KSAqIHJvd0hlaWdodDsKICAgICAgICB9Cgog
ICAgICAgIHZhciB0YWJsZVkgPSBzY3JvbGxZICsgcGFnZVkgLSBwYW5lUG9zLnRvcDsKICAgICAg
ICB2YXIgcm93ID0gTWF0aC5mbG9vcih0YWJsZVkgLyByb3dIZWlnaHQpOwoKICAgICAgICB2YXIg
dGFibGVNb2RlbCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRUYWJsZU1vZGVsKCk7CiAgICAgICAgdmFy
IHJvd0NvdW50ID0gdGFibGVNb2RlbC5nZXRSb3dDb3VudCgpOwoKICAgICAgICByZXR1cm4gKHJv
dyA8IHJvd0NvdW50KSA/IHJvdyA6IG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBoZWFkZXJQb3Mg
PSB0aGlzLl9faGVhZGVyLmdldENvbnRhaW5lckxvY2F0aW9uKCk7CgogICAgICBpZiAoCiAgICAg
ICAgcGFnZVkgPj0gaGVhZGVyUG9zLnRvcCAmJgogICAgICAgIHBhZ2VZIDw9IGhlYWRlclBvcy5i
b3R0b20gJiYKICAgICAgICBwYWdlWCA8PSBoZWFkZXJQb3MucmlnaHQpCiAgICAgIHsKICAgICAg
ICAvLyBUaGlzIGV2ZW50IGlzIGluIHRoZSBwYW5lIC0+IFJldHVybiAtMSBmb3IgdGhlIGhlYWRl
cgogICAgICAgIHJldHVybiAtMTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoK
CiAgICAvKioKICAgICAqIFNldHMgdGhlIHdpZGdldCB0aGF0IHNob3VsZCBiZSBzaG93biBpbiB0
aGUgdG9wIHJpZ2h0IGNvcm5lci4KICAgICAqCiAgICAgKiBUaGUgd2lkZ2V0IHdpbGwgbm90IGJl
IGRpc3Bvc2VkLCB3aGVuIHRoaXMgdGFibGUgc2Nyb2xsZXIgaXMgZGlzcG9zZWQuIFNvIHRoZQog
ICAgICogY2FsbGVyIGhhcyB0byBkaXNwb3NlIGl0LgogICAgICoKICAgICAqIEBwYXJhbSB3aWRn
ZXQge3F4LnVpLmNvcmUuV2lkZ2V0fSBUaGUgd2lkZ2V0IHRvIHNldC4gTWF5IGJlIG51bGwuCiAg
ICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICovCiAgICBzZXRUb3BSaWdodFdpZGdldCA6IGZ1bmN0
aW9uKHdpZGdldCkKICAgIHsKICAgICAgdmFyIG9sZFdpZGdldCA9IHRoaXMuX190b3BSaWdodFdp
ZGdldDsKCiAgICAgIGlmIChvbGRXaWRnZXQgIT0gbnVsbCkgewogICAgICAgIHRoaXMuX190b3Au
cmVtb3ZlKG9sZFdpZGdldCk7CiAgICAgIH0KCiAgICAgIGlmICh3aWRnZXQgIT0gbnVsbCkgewog
ICAgICAgIHRoaXMuX190b3AuYWRkKHdpZGdldCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX190b3BS
aWdodFdpZGdldCA9IHdpZGdldDsKICAgIH0sCgoKICAgIC8qKgogICAgICogR2V0IHRoZSB0b3Ag
cmlnaHQgd2lkZ2V0CiAgICAgKgogICAgICogQHJldHVybiB7cXgudWkuY29yZS5XaWRnZXR9IFRo
ZSB0b3AgcmlnaHQgd2lkZ2V0LgogICAgICovCiAgICBnZXRUb3BSaWdodFdpZGdldCA6IGZ1bmN0
aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fX3RvcFJpZ2h0V2lkZ2V0OwogICAgfSwKCgogICAg
LyoqCiAgICAgKiBSZXR1cm5zIHRoZSBoZWFkZXIuCiAgICAgKgogICAgICogQHJldHVybiB7cXgu
dWkudGFibGUucGFuZS5IZWFkZXJ9IHRoZSBoZWFkZXIuCiAgICAgKi8KICAgIGdldEhlYWRlciA6
IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fX2hlYWRlcjsKICAgIH0sCgoKICAgIC8q
KgogICAgICogUmV0dXJucyB0aGUgdGFibGUgcGFuZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtx
eC51aS50YWJsZS5wYW5lLlBhbmV9IHRoZSB0YWJsZSBwYW5lLgogICAgICovCiAgICBnZXRUYWJs
ZVBhbmUgOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuX190YWJsZVBhbmU7CiAgICB9
LAoKCiAgICAvKioKICAgICAqIEdldCB0aGUgcmVuZGVyZWQgd2lkdGggb2YgdGhlIHZlcnRpY2Fs
IHNjcm9sbCBiYXIuIFRoZSByZXR1cm4gdmFsdWUgaXMKICAgICAqIDxjb2RlPjA8L2NvZGU+IGlm
IHRoZSBzY3JvbGwgYmFyIGlzIGludmlzaWJsZSBvciBub3QgeWV0IHJlbmRlcmVkLgogICAgICoK
ICAgICAqIEBpbnRlcm5hbAogICAgICogQHJldHVybiB7SW50ZWdlcn0gVGhlIHdpZHRoIG9mIHRo
ZSB2ZXJ0aWNhbCBzY3JvbGwgYmFyCiAgICAgKi8KICAgIGdldFZlcnRpY2FsU2Nyb2xsQmFyV2lk
dGggOiBmdW5jdGlvbigpCiAgICB7CiAgICAgIHZhciBzY3JvbGxCYXIgPSB0aGlzLl9fdmVyU2Ny
b2xsQmFyOwogICAgICByZXR1cm4gc2Nyb2xsQmFyLmlzVmlzaWJsZSgpID8gKHNjcm9sbEJhci5n
ZXRTaXplSGludCgpLndpZHRoIHx8IDApIDogMDsKICAgIH0sCgoKICAgIC8qKgogICAgICogUmV0
dXJucyB3aGljaCBzY3JvbGxiYXJzIGFyZSBuZWVkZWQuCiAgICAgKgogICAgICogQHBhcmFtIGZv
cmNlSG9yaXpvbnRhbCB7Qm9vbGVhbiA/IGZhbHNlfSBXaGV0aGVyIHRvIHNob3cgdGhlIGhvcml6
b250YWwKICAgICAqICAgICAgc2Nyb2xsYmFyIGFsd2F5cy4KICAgICAqIEBwYXJhbSBwcmV2ZW50
VmVydGljYWwge0Jvb2xlYW4gPyBmYWxzZX0gV2hldGhlciB0byBzaG93IHRoZSB2ZXJ0aWNhbCBz
Y3JvbGxiYXIKICAgICAqICAgICAgbmV2ZXIuCiAgICAgKiBAcmV0dXJuIHtJbnRlZ2VyfSB3aGlj
aCBzY3JvbGxiYXJzIGFyZSBuZWVkZWQuIFRoaXMgbWF5IGJlIGFueSBjb21iaW5hdGlvbiBvZgog
ICAgICogICAgICB7QGxpbmsgI0hPUklaT05UQUxfU0NST0xMQkFSfSBvciB7QGxpbmsgI1ZFUlRJ
Q0FMX1NDUk9MTEJBUn0KICAgICAqICAgICAgKGNvbWJpbmVkIGJ5IE9SKS4KICAgICAqLwogICAg
Z2V0TmVlZGVkU2Nyb2xsQmFycyA6IGZ1bmN0aW9uKGZvcmNlSG9yaXpvbnRhbCwgcHJldmVudFZl
cnRpY2FsKQogICAgewogICAgICB2YXIgdmVyU2Nyb2xsQmFyID0gdGhpcy5fX3ZlclNjcm9sbEJh
cjsKICAgICAgdmFyIHZlckJhcldpZHRoID0gdmVyU2Nyb2xsQmFyLmdldFNpemVIaW50KCkud2lk
dGgKICAgICAgICArIHZlclNjcm9sbEJhci5nZXRNYXJnaW5MZWZ0KCkgKyB2ZXJTY3JvbGxCYXIu
Z2V0TWFyZ2luUmlnaHQoKTsKICAgICAgdmFyIGhvclNjcm9sbEJhciA9IHRoaXMuX19ob3JTY3Jv
bGxCYXI7CiAgICAgIHZhciBob3JCYXJIZWlnaHQgPSBob3JTY3JvbGxCYXIuZ2V0U2l6ZUhpbnQo
KS5oZWlnaHQKICAgICAgICArIGhvclNjcm9sbEJhci5nZXRNYXJnaW5Ub3AoKSArIGhvclNjcm9s
bEJhci5nZXRNYXJnaW5Cb3R0b20oKTsKCiAgICAgIC8vIEdldCB0aGUgd2lkdGggYW5kIGhlaWdo
dCBvZiB0aGUgdmlldyAod2l0aG91dCBzY3JvbGwgYmFycykKICAgICAgdmFyIGNsaXBwZXJTaXpl
ID0gdGhpcy5fX3BhbmVDbGlwcGVyLmdldElubmVyU2l6ZSgpOwogICAgICB2YXIgdmlld1dpZHRo
ID0gY2xpcHBlclNpemUgPyBjbGlwcGVyU2l6ZS53aWR0aCA6IDA7CgogICAgICBpZiAodGhpcy5n
ZXRWZXJ0aWNhbFNjcm9sbEJhclZpc2libGUoKSkgewogICAgICAgIHZpZXdXaWR0aCArPSB2ZXJC
YXJXaWR0aDsKICAgICAgfQoKICAgICAgdmFyIHZpZXdIZWlnaHQgPSBjbGlwcGVyU2l6ZSA/IGNs
aXBwZXJTaXplLmhlaWdodCA6IDA7CgogICAgICBpZiAodGhpcy5nZXRIb3Jpem9udGFsU2Nyb2xs
QmFyVmlzaWJsZSgpKSB7CiAgICAgICAgdmlld0hlaWdodCArPSBob3JCYXJIZWlnaHQ7CiAgICAg
IH0KCiAgICAgIHZhciB0YWJsZU1vZGVsID0gdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlTW9kZWwo
KTsKICAgICAgdmFyIHJvd0NvdW50ID0gdGFibGVNb2RlbC5nZXRSb3dDb3VudCgpOwoKICAgICAg
Ly8gR2V0IHRoZSAodmlydHVhbCkgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgcGFuZQogICAgICB2
YXIgcGFuZVdpZHRoID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpLmdldFRvdGFsV2lkdGgoKTsK
ICAgICAgdmFyIHBhbmVIZWlnaHQgPSB0aGlzLmdldFRhYmxlKCkuZ2V0Um93SGVpZ2h0KCkgKiBy
b3dDb3VudDsKCiAgICAgIC8vIENoZWNrIHdoaWNoIHNjcm9sbGJhcnMgYXJlIG5lZWRlZAogICAg
ICB2YXIgaG9yTmVlZGVkID0gZmFsc2U7CiAgICAgIHZhciB2ZXJOZWVkZWQgPSBmYWxzZTsKCiAg
ICAgIGlmIChwYW5lV2lkdGggPiB2aWV3V2lkdGgpCiAgICAgIHsKICAgICAgICBob3JOZWVkZWQg
PSB0cnVlOwoKICAgICAgICBpZiAocGFuZUhlaWdodCA+IHZpZXdIZWlnaHQgLSBob3JCYXJIZWln
aHQpIHsKICAgICAgICAgIHZlck5lZWRlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAg
IGVsc2UgaWYgKHBhbmVIZWlnaHQgPiB2aWV3SGVpZ2h0KQogICAgICB7CiAgICAgICAgdmVyTmVl
ZGVkID0gdHJ1ZTsKCiAgICAgICAgaWYgKCFwcmV2ZW50VmVydGljYWwgJiYgKHBhbmVXaWR0aCA+
IHZpZXdXaWR0aCAtIHZlckJhcldpZHRoKSkgewogICAgICAgICAgaG9yTmVlZGVkID0gdHJ1ZTsK
ICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIENyZWF0ZSB0aGUgbWFzawogICAgICB2YXIgaG9y
QmFyID0gcXgudWkudGFibGUucGFuZS5TY3JvbGxlci5IT1JJWk9OVEFMX1NDUk9MTEJBUjsKICAg
ICAgdmFyIHZlckJhciA9IHF4LnVpLnRhYmxlLnBhbmUuU2Nyb2xsZXIuVkVSVElDQUxfU0NST0xM
QkFSOwogICAgICByZXR1cm4gKChmb3JjZUhvcml6b250YWwgfHwgaG9yTmVlZGVkKSA/IGhvckJh
ciA6IDApIHwgKChwcmV2ZW50VmVydGljYWwgfHwgIXZlck5lZWRlZCkgPyAwIDogdmVyQmFyKTsK
ICAgIH0sCgoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwYW5lIGNsaXBwZXIuIEl0IGlzIHNv
bWV0aW1lcyByZXF1aXJlZCBmb3Igc3BlY2lhbCBhY3Rpdml0aWVzCiAgICAgKiBzdWNoIGFzIHRy
YWNraW5nIGV2ZW50cyBmb3IgZHJhZyZkcm9wLgogICAgICoKICAgICAqIEByZXR1cm4ge3F4LnVp
LnRhYmxlLnBhbmUuQ2xpcHBlcn0KICAgICAqICAgVGhlIHBhbmUgY2xpcHBlciBmb3IgdGhpcyBz
Y3JvbGxlci4KICAgICAqLwogICAgZ2V0UGFuZUNsaXBwZXIgOiBmdW5jdGlvbigpCiAgICB7CiAg
ICAgIHJldHVybiB0aGlzLl9fcGFuZUNsaXBwZXI7CiAgICB9LAoKICAgIC8vIHByb3BlcnR5IGFw
cGx5IG1ldGhvZAogICAgX2FwcGx5U2Nyb2xsVGltZW91dCA6IGZ1bmN0aW9uKHZhbHVlLCBvbGQp
IHsKICAgICAgdGhpcy5fc3RhcnRJbnRlcnZhbCh2YWx1ZSk7CiAgICB9LAoKCiAgICAvKioKICAg
ICAqIFN0YXJ0cyB0aGUgY3VycmVudCBydW5uaW5nIGludGVydmFsCiAgICAgKgogICAgICogQHBh
cmFtIHRpbWVvdXQge0ludGVnZXJ9IFRoZSB0aW1lb3V0IGJldHdlZW4gdHdvIHRhYmxlIHVwZGF0
ZXMKICAgICAqLwogICAgX3N0YXJ0SW50ZXJ2YWwgOiBmdW5jdGlvbiAodGltZW91dCkKICAgIHsK
ICAgICAgdGhpcy5fX3RpbWVyLnNldEludGVydmFsKHRpbWVvdXQpOwogICAgICB0aGlzLl9fdGlt
ZXIuc3RhcnQoKTsKICAgIH0sCgoKICAgIC8qKgogICAgICogc3RvcHMgdGhlIGN1cnJlbnQgcnVu
bmluZyBpbnRlcnZhbAogICAgICovCiAgICBfc3RvcEludGVydmFsIDogZnVuY3Rpb24gKCkKICAg
IHsKICAgICAgdGhpcy5fX3RpbWVyLnN0b3AoKTsKICAgIH0sCgoKICAgIC8qKgogICAgICogRG9l
cyBhIHBvc3Rwb25lZCB1cGRhdGUgb2YgdGhlIGNvbnRlbnQuCiAgICAgKgogICAgICogQHNlZSAj
X3VwZGF0ZUNvbnRlbnQKICAgICAqLwogICAgX3Bvc3Rwb25lZFVwZGF0ZUNvbnRlbnQgOiBmdW5j
dGlvbigpCiAgICB7CiAgICAgIC8vdGhpcy5fX3VwZGF0ZUNvbnRlbnRQbGFubmVkID0gdHJ1ZTsK
ICAgICAgdGhpcy5fdXBkYXRlQ29udGVudCgpOwogICAgfSwKCgogICAgLyoqCiAgICAgKiBUaW1l
ciBldmVudCBoYW5kbGVyLiBQZXJpb2RpY2FsbHkgY2hlY2tzIHdoZXRoZXIgYSB0YWJsZSB1cGRh
dGUgaXMKICAgICAqIHJlcXVpcmVkLiBUaGUgdXBkYXRlIGludGVydmFsIGlzIGNvbnRyb2xsZWQg
YnkgdGhlIHtAbGluayAjc2Nyb2xsVGltZW91dH0KICAgICAqIHByb3BlcnR5LgogICAgICoKICAg
ICAqIEBzaWduYXR1cmUgZnVuY3Rpb24oKQogICAgICovCiAgICBfb25pbnRlcnZhbCA6IHF4LmV2
ZW50Lkdsb2JhbEVycm9yLm9ic2VydmVNZXRob2QoZnVuY3Rpb24oKQogICAgewogICAgICBpZiAo
dGhpcy5fX3VwZGF0ZUNvbnRlbnRQbGFubmVkICYmICF0aGlzLl9fdGFibGVQYW5lLl9sYXlvdXRQ
ZW5kaW5nKQogICAgICB7CiAgICAgICAgdGhpcy5fX3VwZGF0ZUNvbnRlbnRQbGFubmVkID0gZmFs
c2U7CiAgICAgICAgdGhpcy5fdXBkYXRlQ29udGVudCgpOwogICAgICB9CiAgICB9KSwKCgogICAg
LyoqCiAgICAgKiBVcGRhdGVzIHRoZSBjb250ZW50LiBTZXRzIHRoZSByaWdodCBzZWN0aW9uIHRo
ZSB0YWJsZSBwYW5lIHNob3VsZCBzaG93IGFuZAogICAgICogZG9lcyB0aGUgc2Nyb2xsaW5nLgog
ICAgICovCiAgICBfdXBkYXRlQ29udGVudCA6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgdmFyIHBh
bmVTaXplID0gdGhpcy5fX3BhbmVDbGlwcGVyLmdldElubmVyU2l6ZSgpOwogICAgICBpZiAoIXBh
bmVTaXplKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBwYW5lSGVpZ2h0ID0g
cGFuZVNpemUuaGVpZ2h0OwoKICAgICAgdmFyIHNjcm9sbFggPSB0aGlzLl9faG9yU2Nyb2xsQmFy
LmdldFBvc2l0aW9uKCk7CiAgICAgIHZhciBzY3JvbGxZID0gdGhpcy5fX3ZlclNjcm9sbEJhci5n
ZXRQb3NpdGlvbigpOwogICAgICB2YXIgcm93SGVpZ2h0ID0gdGhpcy5nZXRUYWJsZSgpLmdldFJv
d0hlaWdodCgpOwoKICAgICAgdmFyIGZpcnN0Um93ID0gTWF0aC5mbG9vcihzY3JvbGxZIC8gcm93
SGVpZ2h0KTsKICAgICAgdmFyIG9sZEZpcnN0Um93ID0gdGhpcy5fX3RhYmxlUGFuZS5nZXRGaXJz
dFZpc2libGVSb3coKTsKICAgICAgdGhpcy5fX3RhYmxlUGFuZS5zZXRGaXJzdFZpc2libGVSb3co
Zmlyc3RSb3cpOwoKICAgICAgdmFyIHZpc2libGVSb3dDb3VudCA9IE1hdGguY2VpbChwYW5lSGVp
Z2h0IC8gcm93SGVpZ2h0KTsKICAgICAgdmFyIHBhbmVPZmZzZXQgPSAwOwogICAgICB2YXIgZmly
c3RWaXNpYmxlUm93Q29tcGxldGUgPSB0aGlzLmdldFRhYmxlKCkuZ2V0S2VlcEZpcnN0VmlzaWJs
ZVJvd0NvbXBsZXRlKCk7CgogICAgICBpZiAoIWZpcnN0VmlzaWJsZVJvd0NvbXBsZXRlKQogICAg
ICB7CgogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IGNvbnNpZGVyIHBhbmVPZmZzZXQsIGJlY2F1
c2UgdGhpcyBtYXkgY2F1c2UgYWx0ZXJuYXRpbmcKICAgICAgICAvLyAgICAgICBhZGRpbmcgYW5k
IGRlbGV0aW5nIG9mIG9uZSByb3cgd2hlbiBzY3JvbGxpbmcuIEluc3RlYWQgd2UgYWRkIG9uZSBy
b3cKICAgICAgICAvLyAgICAgICBpbiBldmVyeSBjYXNlLgogICAgICAgIHZpc2libGVSb3dDb3Vu
dCsrOwoKICAgICAgICBwYW5lT2Zmc2V0ID0gc2Nyb2xsWSAlIHJvd0hlaWdodDsKICAgICAgfQoK
ICAgICAgdGhpcy5fX3RhYmxlUGFuZS5zZXRWaXNpYmxlUm93Q291bnQodmlzaWJsZVJvd0NvdW50
KTsKCiAgICAgIGlmIChmaXJzdFJvdyAhPSBvbGRGaXJzdFJvdykgewogICAgICAgIHRoaXMuX3Vw
ZGF0ZUZvY3VzSW5kaWNhdG9yKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX19wYW5lQ2xpcHBlci5z
Y3JvbGxUb1goc2Nyb2xsWCk7CgogICAgICAvLyBBdm9pZCBleHBlbnNpdmUgY2FsbHMgdG8gc2V0
U2Nyb2xsVG9wIGlmCiAgICAgIC8vIHNjcm9sbGluZyBpcyBub3QgbmVlZGVkCiAgICAgIGlmICgh
IGZpcnN0VmlzaWJsZVJvd0NvbXBsZXRlICkgewogICAgICAgIHRoaXMuX19wYW5lQ2xpcHBlci5z
Y3JvbGxUb1kocGFuZU9mZnNldCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBVcGRh
dGVzIHRoZSBsb2NhdGlvbiBhbmQgdGhlIHZpc2liaWxpdHkgb2YgdGhlIGZvY3VzIGluZGljYXRv
ci4KICAgICAqCiAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICovCiAgICBfdXBkYXRlRm9jdXNJ
bmRpY2F0b3IgOiBmdW5jdGlvbigpCiAgICB7CiAgICAgIHZhciB0YWJsZSA9IHRoaXMuZ2V0VGFi
bGUoKTsKCiAgICAgIGlmICghdGFibGUuZ2V0RW5hYmxlZCgpKSB7CiAgICAgICAgcmV0dXJuOwog
ICAgICB9CgogICAgICB0aGlzLl9fZm9jdXNJbmRpY2F0b3IubW92ZVRvQ2VsbCh0aGlzLl9fZm9j
dXNlZENvbCwgdGhpcy5fX2ZvY3VzZWRSb3cpOwogICAgfQogIH0sCgoKCgogIC8qCiAgKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioKICAgICBERVNUUlVDVE9SCiAgKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAq
LwoKICBkZXN0cnVjdCA6IGZ1bmN0aW9uKCkKICB7CiAgICB0aGlzLl9zdG9wSW50ZXJ2YWwoKTsK
CiAgICAvLyB0aGlzIG9iamVjdCB3YXMgY3JlYXRlZCBieSB0aGUgdGFibGUgb24gaW5pdCBzbyB3
ZSBoYXZlIHRvIGNsZWFuIGl0IHVwLgogICAgdmFyIHRhYmxlUGFuZU1vZGVsID0gdGhpcy5nZXRU
YWJsZVBhbmVNb2RlbCgpOwogICAgaWYgKHRhYmxlUGFuZU1vZGVsKQogICAgewogICAgICB0YWJs
ZVBhbmVNb2RlbC5kaXNwb3NlKCk7CiAgICB9CgogICAgdGhpcy5fX2xhc3RNb3VzZURvd25DZWxs
ID0gdGhpcy5fX3RvcFJpZ2h0V2lkZ2V0ID0gdGhpcy5fX3RhYmxlID0gbnVsbDsKICAgIHRoaXMu
X2Rpc3Bvc2VPYmplY3RzKCJfX2hvclNjcm9sbEJhciIsICJfX3ZlclNjcm9sbEJhciIsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAiX19oZWFkZXJDbGlwcGVyIiwgIl9fcGFuZUNsaXBwZXIiLCAi
X19mb2N1c0luZGljYXRvciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAiX19oZWFkZXIiLCAi
X190YWJsZVBhbmUiLCAiX190b3AiLCAiX190aW1lciIsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAiX19jbGlwcGVyQ29udGFpbmVyIik7CiAgfQp9KTsK
</data>

          </attachment>
      

    </bug>