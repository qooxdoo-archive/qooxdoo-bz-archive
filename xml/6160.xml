<bug>
          <bug_id>6160</bug_id>
          
          <creation_ts>2012-02-21 12:23:00 +0100</creation_ts>
          <short_desc>qx.ui.table.model.Filtered improvement proposal</short_desc>
          <delta_ts>2014-03-03 08:47:24 +0100</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>framework</product>
          <component>desktop.table</component>
          <version>1.6</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>LATER</resolution>
          
          
          
          
          
          <priority>P4</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>unspecified</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="saaj">id</reporter>
          <assigned_to name="Martin Wittemann">martin.wittemann</assigned_to>
          
          <qa_contact name="Martin Wittemann">martin.wittemann</qa_contact>
          <cf_browser>---</cf_browser>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>28609</commentid>
              <attachid>1128</attachid>
            <who name="saaj">id</who>
            <bug_when>2012-02-21 12:23:07 +0100</bug_when>
            <thetext>Created attachment 1128
proposal patch

Well, filterable table model is rather useful thing. For example, some complex table form where you need to expose only a part of data at a time, depending on, say, selectbox. And when I used the model with small number of rows it is ok. Today in the case I may have up to 500 rows, it took my Firefox ~8 seconds to apply filter in source mode.

Looking in code, first the flaring naming exposes. E.g. constructor

    this.numericAllowed = new Array(&quot;==&quot;, &quot;!=&quot;, &quot;&gt;&quot;, &quot;&lt;&quot;, &quot;&gt;=&quot;, &quot;&lt;=&quot;);
    this.betweenAllowed = new Array(&quot;between&quot;, &quot;!between&quot;);
    this.__applyingFilters = false;
    this.Filters = new Array();

_js_in_array is quite strange way for membership check. 

Second, incorrect expectation on how qx.ui.table.model.removeRows() works. This expectation causes k + 1 events of dataChanged, where k is number of filtered out rows. dataChanged is slow, so when I need 20 rows from ~500 it takes a lot of time.

I refactored the class in a quick manner and it works for my case as fast as I expect. I didn&#39;t test it for any case other than numeric equality filtering. The patch is made against 1.6.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>35890</commentid>
            <who name="Martin Wittemann">martin.wittemann</who>
            <bug_when>2014-03-03 08:47:24 +0100</bug_when>
            <thetext>Move open issues to RESOLVED â€“ LATER, whose last comment is older than a year.</thetext>
          </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0" isurl="0">
            <attachid>1128</attachid>
            <date>2012-02-21 12:23:00 +0100</date>
            <delta_ts>2012-02-21 12:23:07 +0100</delta_ts>
            <desc>proposal patch</desc>
            <filename>Filtered.patch</filename>
            <type>text/plain</type>
            <size>12416</size>
            <attacher>id</attacher>
            
              <data encoding="base64">SW5kZXg6IEZpbHRlcmVkLmpzDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gRmlsdGVyZWQuanMJKHJldmlzaW9u
IDI5MDEyKQ0KKysrIEZpbHRlcmVkLmpzCSh3b3JraW5nIGNvcHkpDQpAQCAtNiw2ICs2LDcgQEAN
CiAKICAgICBDb3B5cmlnaHQ6CiAgICAgICAyMDA3IGJ5IFRhcnRhbiBTb2x1dGlvbnMsIEluYywg
aHR0cDovL3d3dy50YXJ0YW5zb2x1dGlvbnMuY29tCisgICAgICAyMDEyIGJ5IHNhYWoKIAogICAg
ICBMaWNlbnNlOgogICAgICAgIExHUEw6IGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3Bs
Lmh0bWwKQEAgLTE0LDYgKzE1LDcgQEANCiAKICAgICBBdXRob3JzOgogICAgICAgKiBEYW4gSHVt
bW9uCisgICAgICAqIHNhYWoKIAogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovCiAKQEAgLTMwLDQyICszMiwy
MyBAQA0KICAgewogICAgIHRoaXMuYmFzZShhcmd1bWVudHMpOwogCi0gICAgdGhpcy5udW1lcmlj
QWxsb3dlZCA9IG5ldyBBcnJheSgiPT0iLCAiIT0iLCAiPiIsICI8IiwgIj49IiwgIjw9Iik7Ci0g
ICAgdGhpcy5iZXR3ZWVuQWxsb3dlZCA9IG5ldyBBcnJheSgiYmV0d2VlbiIsICIhYmV0d2VlbiIp
OworICAgIHRoaXMuX19udW1lcmljQWxsb3dlZCAgPSBbIj09IiwgIiE9IiwgIj4iLCAiPCIsICI+
PSIsICI8PSJdOworICAgIHRoaXMuX19iZXR3ZWVuQWxsb3dlZCAgPSBbImJldHdlZW4iLCAiIWJl
dHdlZW4iXTsKKyAgICB0aGlzLl9fZmlsdGVycyAgICAgICAgID0gW107CiAgICAgdGhpcy5fX2Fw
cGx5aW5nRmlsdGVycyA9IGZhbHNlOwotICAgIHRoaXMuRmlsdGVycyA9IG5ldyBBcnJheSgpOwot
CiAgIH0sCiAKIAogICBtZW1iZXJzIDoKICAgewotICAgIF9fZnVsbEFyciA6IG51bGwsCisgICAg
X19udW1lcmljQWxsb3dlZCAgOiBudWxsLAorICAgIF9fYmV0d2VlbkFsbG93ZWQgIDogbnVsbCwK
KyAgICBfX2ZpbHRlcnMgICAgICAgICA6IG51bGwsCisgICAgX19mdWxsQXJyICAgICAgICAgOiBu
dWxsLAogICAgIF9fYXBwbHlpbmdGaWx0ZXJzIDogbnVsbCwKIAogCiAgICAgLyoqCi0gICAgICog
V2hldGhlciB0aGUgZ2l2ZW4gc3RyaW5nIChuZWVkbGUpIGlzIGluIHRoZSBhcnJheSAoaGF5c3Rh
Y2spCi0gICAgICoKLSAgICAgKiBAcGFyYW0gdGhlX25lZWRsZSB7U3RyaW5nfSBTdHJpbmcgdG8g
c2VhcmNoCi0gICAgICogQHBhcmFtIHRoZV9oYXlzdGFjayB7QXJyYXl9IEFycmF5LCB3aGljaCBz
aG91bGQgYmUgc2VhcmNoZWQKLSAgICAgKiBAcmV0dXJuIHtCb29sZWFufSB3aGV0aGVyIHRoZSBz
ZWFyY2ggc3RyaW5nIHdhcyBmb3VuZC4KLSAgICAgKi8KLSAgICBfanNfaW5fYXJyYXkgOiBmdW5j
dGlvbih0aGVfbmVlZGxlLCB0aGVfaGF5c3RhY2spCi0gICAgewotICAgICAgdmFyIHRoZV9oYXkg
PSB0aGVfaGF5c3RhY2sudG9TdHJpbmcoKTsKLQotICAgICAgaWYgKHRoZV9oYXkgPT0gJycpIHsK
LSAgICAgICAgcmV0dXJuIGZhbHNlOwotICAgICAgfQotCi0gICAgICB2YXIgdGhlX3BhdHRlcm4g
PSBuZXcgUmVnRXhwKHRoZV9uZWVkbGUsICdnJyk7Ci0gICAgICB2YXIgbWF0Y2hlZCA9IHRoZV9w
YXR0ZXJuLnRlc3QodGhlX2hheXN0YWNrKTsKLSAgICAgIHJldHVybiBtYXRjaGVkOwotICAgIH0s
Ci0KLQotICAgIC8qKgogICAgICAqIFRoZSBhZGRCZXR3ZWVuRmlsdGVyIG1ldGhvZCBpcyB1c2Vk
IHRvIGFkZCBhIGJldHdlZW4gZmlsdGVyIHRvIHRoZQogICAgICAqIHRhYmxlIG1vZGVsLgogICAg
ICAqCkBAIC04OCwxNSArNzEsMTUgQEANCiAgICAgICovCiAgICAgYWRkQmV0d2VlbkZpbHRlciA6
IGZ1bmN0aW9uKGZpbHRlciwgdmFsdWUxLCB2YWx1ZTIsIHRhcmdldCkKICAgICB7Ci0gICAgICBp
ZiAodGhpcy5fanNfaW5fYXJyYXkoZmlsdGVyLCB0aGlzLmJldHdlZW5BbGxvd2VkKSAmJiB0YXJn
ZXQgIT0gbnVsbCkKKyAgICAgIGlmIChxeC5sYW5nLkFycmF5LmNvbnRhaW5zKHRoaXMuX19iZXR3
ZWVuQWxsb3dlZCwgZmlsdGVyKSAmJiB0YXJnZXQgIT0gbnVsbCkKICAgICAgIHsKICAgICAgICAg
aWYgKHZhbHVlMSAhPSBudWxsICYmIHZhbHVlMiAhPSBudWxsKSB7Ci0gICAgICAgICAgdmFyIHRl
bXAgPSBuZXcgQXJyYXkoZmlsdGVyLCB2YWx1ZTEsIHZhbHVlMiwgdGFyZ2V0KTsKKyAgICAgICAg
ICB2YXIgdGVtcCA9IFtmaWx0ZXIsIHZhbHVlMSwgdmFsdWUyLCB0YXJnZXRdOwogICAgICAgICB9
CiAgICAgICB9CiAKICAgICAgIGlmICh0ZW1wICE9IG51bGwpIHsKLSAgICAgICAgdGhpcy5GaWx0
ZXJzLnB1c2godGVtcCk7CisgICAgICAgIHRoaXMuX19maWx0ZXJzLnB1c2godGVtcCk7CiAgICAg
ICB9IGVsc2UgewogICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkZpbHRlciBub3QgcmVjb2duaXpl
ZCBvciB2YWx1ZTEvdmFsdWUyIGlzIG51bGwhIik7CiAgICAgICB9CkBAIC0xMjUsNyArMTA4LDcg
QEANCiAgICAgewogICAgICAgdmFyIHRlbXAgPSBudWxsOwogCi0gICAgICBpZiAodGhpcy5fanNf
aW5fYXJyYXkoZmlsdGVyLCB0aGlzLm51bWVyaWNBbGxvd2VkKSAmJiB0YXJnZXQgIT0gbnVsbCkK
KyAgICAgIGlmIChxeC5sYW5nLkFycmF5LmNvbnRhaW5zKHRoaXMuX19udW1lcmljQWxsb3dlZCwg
ZmlsdGVyKSAmJiB0YXJnZXQgIT0gbnVsbCkKICAgICAgIHsKICAgICAgICAgaWYgKHZhbHVlMSAh
PSBudWxsKSB7CiAgICAgICAgICAgdGVtcCA9IFtmaWx0ZXIsIHZhbHVlMSwgdGFyZ2V0XTsKQEAg
LTEzMyw3ICsxMTYsNyBAQA0KICAgICAgIH0KIAogICAgICAgaWYgKHRlbXAgIT0gbnVsbCkgewot
ICAgICAgICB0aGlzLkZpbHRlcnMucHVzaCh0ZW1wKTsKKyAgICAgICAgdGhpcy5fX2ZpbHRlcnMu
cHVzaCh0ZW1wKTsKICAgICAgIH0gZWxzZSB7CiAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRmls
dGVyIG5vdCByZWNvZ25pemVkOiB2YWx1ZSBvciB0YXJnZXQgaXMgbnVsbCEiKTsKICAgICAgIH0K
QEAgLTE1OSwxNCArMTQyLDE0IEBADQogICAgICAqLwogICAgIGFkZFJlZ2V4IDogZnVuY3Rpb24o
cmVnZXgsIHRhcmdldCwgaWdub3JlY2FzZSkKICAgICB7Ci0gICAgICB2YXIgcmVnZXhhcmc7Ci0g
ICAgICBpZiAoaWdub3JlY2FzZSkgeyByZWdleGFyZyA9J2dpJzsgfSBlbHNlIHsgcmVnZXhhcmcg
PSdnJzsgfQorICAgICAgdmFyIHJlZ2V4YXJnID0gaWdub3JlY2FzZSA/ICdnaScgOiAnZyc7Cisg
ICAgICAKICAgICAgIGlmIChyZWdleCAhPSBudWxsICYmIHRhcmdldCAhPSBudWxsKSB7Ci0gICAg
ICAgIHZhciB0ZW1wID0gbmV3IEFycmF5KCJyZWdleCIsIHJlZ2V4LCB0YXJnZXQsIHJlZ2V4YXJn
KTsKKyAgICAgICAgdmFyIHRlbXAgPSBbInJlZ2V4IiwgcmVnZXgsIHRhcmdldCwgcmVnZXhhcmdd
OwogICAgICAgfQogCiAgICAgICBpZiAodGVtcCAhPSBudWxsKSB7Ci0gICAgICAgIHRoaXMuRmls
dGVycy5wdXNoKHRlbXApOworICAgICAgICB0aGlzLl9fZmlsdGVycy5wdXNoKHRlbXApOwogICAg
ICAgfSBlbHNlIHsKICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJyZWdleCBjYW5ub3QgYmUgbnVs
bCEiKTsKICAgICAgIH0KQEAgLTE5MiwxNCArMTc1LDE0IEBADQogICAgICAqLwogICAgIGFkZE5v
dFJlZ2V4IDogZnVuY3Rpb24ocmVnZXgsIHRhcmdldCwgaWdub3JlY2FzZSkKICAgICB7Ci0gICAg
ICB2YXIgcmVnZXhhcmc7Ci0gICAgICBpZiAoaWdub3JlY2FzZSkgeyByZWdleGFyZyA9J2dpJzsg
fSBlbHNlIHsgcmVnZXhhcmcgPSdnJzsgfQorICAgICAgdmFyIHJlZ2V4YXJnID0gaWdub3JlY2Fz
ZSA/ICdnaScgOiAnZyc7CisgICAgICAKICAgICAgIGlmIChyZWdleCAhPSBudWxsICYmIHRhcmdl
dCAhPSBudWxsKSB7Ci0gICAgICAgIHZhciB0ZW1wID0gbmV3IEFycmF5KCJub3RyZWdleCIsIHJl
Z2V4LCB0YXJnZXQsIHJlZ2V4YXJnKTsKKyAgICAgICAgdmFyIHRlbXAgPSBbIm5vdHJlZ2V4Iiwg
cmVnZXgsIHRhcmdldCwgcmVnZXhhcmddOwogICAgICAgfQogCiAgICAgICBpZiAodGVtcCAhPSBu
dWxsKSB7Ci0gICAgICAgIHRoaXMuRmlsdGVycy5wdXNoKHRlbXApOworICAgICAgICB0aGlzLl9f
ZmlsdGVycy5wdXNoKHRlbXApOwogICAgICAgfSBlbHNlIHsKICAgICAgICAgdGhyb3cgbmV3IEVy
cm9yKCJub3RyZWdleCBjYW5ub3QgYmUgbnVsbCEiKTsKICAgICAgIH0KQEAgLTIxMSwxODEgKzE5
NCwxMDkgQEANCiAgICAgICovCiAgICAgYXBwbHlGaWx0ZXJzIDogZnVuY3Rpb24oKQogICAgIHsK
LSAgICAgIHZhciBpOwotICAgICAgdmFyIGZpbHRlcl90ZXN0OwotICAgICAgdmFyIGNvbXBhcmVW
YWx1ZTsKLSAgICAgIHZhciByb3dBcnIgPSB0aGlzLmdldERhdGEoKTsKLSAgICAgIHZhciByb3dM
ZW5ndGggPSByb3dBcnIubGVuZ3RoOwotICAgICAgZm9yICh2YXIgcm93ID0gMDsgcm93PHJvd0xl
bmd0aDtyb3crKykKKyAgICAgIHRoaXMuX19hcHBseWluZ0ZpbHRlcnMgPSB0cnVlOworICAgICAg
dGhpcy5zZXREYXRhKHRoaXMuZ2V0RGF0YSgpLmZpbHRlcihmdW5jdGlvbihyb3csIHJvd0luZGV4
KQogICAgICAgewotICAgICAgICBmaWx0ZXJfdGVzdCA9IGZhbHNlOwotICAgICAgICBmb3IgKGkg
aW4gdGhpcy5GaWx0ZXJzKQorICAgICAgICB2YXIgY29tcGFyZVZhbHVlOworICAgICAgICB2YXIg
ZmlsdGVyVGVzdCA9IGZhbHNlOworICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuX19maWx0ZXJz
KQogICAgICAgICB7Ci0KLSAgICAgICAgICBpZiAodGhpcy5fanNfaW5fYXJyYXkodGhpcy5GaWx0
ZXJzW2ldWzBdLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm51bWVyaWNB
bGxvd2VkKSAmJgotICAgICAgICAgICAgICBmaWx0ZXJfdGVzdCA9PSBmYWxzZSkKKyAgICAgICAg
ICBpZiAocXgubGFuZy5BcnJheS5jb250YWlucyh0aGlzLl9fbnVtZXJpY0FsbG93ZWQsIHRoaXMu
X19maWx0ZXJzW2ldWzBdKSAmJiAKKyAgICAgICAgICAgICAgZmlsdGVyVGVzdCA9PSBmYWxzZSkK
ICAgICAgICAgICB7Ci0gICAgICAgICAgICBjb21wYXJlVmFsdWUgPSB0aGlzLmdldFZhbHVlQnlJ
ZCh0aGlzLkZpbHRlcnNbaV1bMl0sIHJvdyk7Ci0gICAgICAgICAgICBzd2l0Y2godGhpcy5GaWx0
ZXJzW2ldWzBdKQorICAgICAgICAgICAgY29tcGFyZVZhbHVlID0gdGhpcy5nZXRWYWx1ZUJ5SWQo
dGhpcy5fX2ZpbHRlcnNbaV1bMl0sIHJvd0luZGV4KTsKKyAgICAgICAgICAgIHN3aXRjaCh0aGlz
Ll9fZmlsdGVyc1tpXVswXSkKICAgICAgICAgICAgIHsKICAgICAgICAgICAgIGNhc2UgIj09IjoK
LSAgICAgICAgICAgICAgaWYgKGNvbXBhcmVWYWx1ZSA9PSB0aGlzLkZpbHRlcnNbaV1bMV0pIHsK
LSAgICAgICAgICAgICAgICBmaWx0ZXJfdGVzdCA9IHRydWU7CisgICAgICAgICAgICAgIGlmIChj
b21wYXJlVmFsdWUgPT0gdGhpcy5fX2ZpbHRlcnNbaV1bMV0pIHsKKyAgICAgICAgICAgICAgICBm
aWx0ZXJUZXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgfQogCiAgICAgICAgICAgICAgIGJyZWFr
OwogCiAgICAgICAgICAgICBjYXNlICIhPSI6Ci0gICAgICAgICAgICAgIGlmIChjb21wYXJlVmFs
dWUgIT0gdGhpcy5GaWx0ZXJzW2ldWzFdKSB7Ci0gICAgICAgICAgICAgICAgZmlsdGVyX3Rlc3Qg
PSB0cnVlOworICAgICAgICAgICAgICBpZiAoY29tcGFyZVZhbHVlICE9IHRoaXMuX19maWx0ZXJz
W2ldWzFdKSB7CisgICAgICAgICAgICAgICAgZmlsdGVyVGVzdCA9IHRydWU7CiAgICAgICAgICAg
ICAgIH0KIAogICAgICAgICAgICAgICBicmVhazsKIAogICAgICAgICAgICAgY2FzZSAiPiI6Ci0g
ICAgICAgICAgICAgIGlmIChjb21wYXJlVmFsdWUgPiB0aGlzLkZpbHRlcnNbaV1bMV0pIHsKLSAg
ICAgICAgICAgICAgICBmaWx0ZXJfdGVzdCA9IHRydWU7CisgICAgICAgICAgICAgIGlmIChjb21w
YXJlVmFsdWUgPiB0aGlzLl9fZmlsdGVyc1tpXVsxXSkgeworICAgICAgICAgICAgICAgIGZpbHRl
clRlc3QgPSB0cnVlOwogICAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgICAgYnJlYWs7CiAK
ICAgICAgICAgICAgIGNhc2UgIjwiOgotICAgICAgICAgICAgICBpZiAoY29tcGFyZVZhbHVlIDwg
dGhpcy5GaWx0ZXJzW2ldWzFdKSB7Ci0gICAgICAgICAgICAgICAgZmlsdGVyX3Rlc3QgPSB0cnVl
OworICAgICAgICAgICAgICBpZiAoY29tcGFyZVZhbHVlIDwgdGhpcy5fX2ZpbHRlcnNbaV1bMV0p
IHsKKyAgICAgICAgICAgICAgICBmaWx0ZXJUZXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgfQog
CiAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICBjYXNlICI+PSI6Ci0gICAgICAg
ICAgICAgIGlmIChjb21wYXJlVmFsdWUgPj0gdGhpcy5GaWx0ZXJzW2ldWzFdKSB7Ci0gICAgICAg
ICAgICAgICAgZmlsdGVyX3Rlc3QgPSB0cnVlOworICAgICAgICAgICAgICBpZiAoY29tcGFyZVZh
bHVlID49IHRoaXMuX19maWx0ZXJzW2ldWzFdKSB7CisgICAgICAgICAgICAgICAgZmlsdGVyVGVz
dCA9IHRydWU7CiAgICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgICBicmVhazsKIAogICAg
ICAgICAgICAgY2FzZSAiPD0iOgotICAgICAgICAgICAgICBpZiAoY29tcGFyZVZhbHVlIDw9IHRo
aXMuRmlsdGVyc1tpXVsxXSkgewotICAgICAgICAgICAgICAgIGZpbHRlcl90ZXN0ID0gdHJ1ZTsK
KyAgICAgICAgICAgICAgaWYgKGNvbXBhcmVWYWx1ZSA8PSB0aGlzLl9fZmlsdGVyc1tpXVsxXSkg
eworICAgICAgICAgICAgICAgIGZpbHRlclRlc3QgPSB0cnVlOwogICAgICAgICAgICAgICB9CiAK
ICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgfQotICAgICAg
ICAgIGVsc2UgaWYgKHRoaXMuX2pzX2luX2FycmF5KHRoaXMuRmlsdGVyc1tpXVswXSwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJldHdlZW5BbGxvd2VkKSAmJgot
ICAgICAgICAgICAgICAgICAgIGZpbHRlcl90ZXN0ID09IGZhbHNlKQorICAgICAgICAgIGVsc2Ug
aWYgKHF4LmxhbmcuQXJyYXkuY29udGFpbnModGhpcy5fX2JldHdlZW5BbGxvd2VkLCB0aGlzLl9f
ZmlsdGVyc1tpXVswXSkgJiYKKyAgICAgICAgICAgICAgICAgICBmaWx0ZXJUZXN0ID09IGZhbHNl
KQogICAgICAgICAgIHsKLSAgICAgICAgICAgIGNvbXBhcmVWYWx1ZSA9IHRoaXMuZ2V0VmFsdWVC
eUlkKHRoaXMuRmlsdGVyc1tpXVszXSwgcm93KTsKKyAgICAgICAgICAgIGNvbXBhcmVWYWx1ZSA9
IHRoaXMuZ2V0VmFsdWVCeUlkKHRoaXMuX19maWx0ZXJzW2ldWzNdLCByb3dJbmRleCk7CiAKLSAg
ICAgICAgICAgIHN3aXRjaCh0aGlzLkZpbHRlcnNbaV1bMF0pCisgICAgICAgICAgICBzd2l0Y2go
dGhpcy5fX2ZpbHRlcnNbaV1bMF0pCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICBjYXNlICJi
ZXR3ZWVuIjoKLSAgICAgICAgICAgICAgaWYgKGNvbXBhcmVWYWx1ZSA+PSB0aGlzLkZpbHRlcnNb
aV1bMV0gJiYKLSAgICAgICAgICAgICAgICAgIGNvbXBhcmVWYWx1ZSA8PSB0aGlzLkZpbHRlcnNb
aV1bMl0pIHsKLSAgICAgICAgICAgICAgICBmaWx0ZXJfdGVzdCA9IHRydWU7CisgICAgICAgICAg
ICAgIGlmIChjb21wYXJlVmFsdWUgPj0gdGhpcy5fX2ZpbHRlcnNbaV1bMV0gJiYKKyAgICAgICAg
ICAgICAgICAgIGNvbXBhcmVWYWx1ZSA8PSB0aGlzLl9fZmlsdGVyc1tpXVsyXSkgeworICAgICAg
ICAgICAgICAgIGZpbHRlclRlc3QgPSB0cnVlOwogICAgICAgICAgICAgICB9CiAKICAgICAgICAg
ICAgICAgYnJlYWs7CiAKICAgICAgICAgICAgIGNhc2UgIiFiZXR3ZWVuIjoKLSAgICAgICAgICAg
ICAgaWYgKGNvbXBhcmVWYWx1ZSA8IHRoaXMuRmlsdGVyc1tpXVsxXSAmJgotICAgICAgICAgICAg
ICAgICAgY29tcGFyZVZhbHVlID4gdGhpcy5GaWx0ZXJzW2ldWzJdKSB7Ci0gICAgICAgICAgICAg
ICAgZmlsdGVyX3Rlc3QgPSB0cnVlOworICAgICAgICAgICAgICBpZiAoY29tcGFyZVZhbHVlIDwg
dGhpcy5fX2ZpbHRlcnNbaV1bMV0gJiYKKyAgICAgICAgICAgICAgICAgIGNvbXBhcmVWYWx1ZSA+
IHRoaXMuX19maWx0ZXJzW2ldWzJdKSB7CisgICAgICAgICAgICAgICAgZmlsdGVyVGVzdCA9IHRy
dWU7CiAgICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg
IH0KICAgICAgICAgICB9Ci0gICAgICAgICAgZWxzZSBpZiAodGhpcy5GaWx0ZXJzW2ldWzBdID09
ICJyZWdleCIgJiYgZmlsdGVyX3Rlc3QgPT0gZmFsc2UpCisgICAgICAgICAgZWxzZSBpZiAodGhp
cy5fX2ZpbHRlcnNbaV1bMF0gPT0gInJlZ2V4IiAmJiBmaWx0ZXJUZXN0ID09IGZhbHNlKQogICAg
ICAgICAgIHsKLSAgICAgICAgICAgIGNvbXBhcmVWYWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeUlkKHRo
aXMuRmlsdGVyc1tpXVsyXSwgcm93KTsKKyAgICAgICAgICAgIGNvbXBhcmVWYWx1ZSA9IHRoaXMu
Z2V0VmFsdWVCeUlkKHRoaXMuX19maWx0ZXJzW2ldWzJdLCByb3dJbmRleCk7CiAKLSAgICAgICAg
ICAgIHZhciB0aGVfcGF0dGVybiA9IG5ldyBSZWdFeHAodGhpcy5GaWx0ZXJzW2ldWzFdLCB0aGlz
LkZpbHRlcnNbaV1bM10pOwotICAgICAgICAgICAgZmlsdGVyX3Rlc3QgPSB0aGVfcGF0dGVybi50
ZXN0KGNvbXBhcmVWYWx1ZSk7CisgICAgICAgICAgICB2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAo
dGhpcy5fX2ZpbHRlcnNbaV1bMV0sIHRoaXMuX19maWx0ZXJzW2ldWzNdKTsKKyAgICAgICAgICAg
IGZpbHRlclRlc3QgPSBwYXR0ZXJuLnRlc3QoY29tcGFyZVZhbHVlKTsKICAgICAgICAgICB9Ci0g
ICAgICAgICAgZWxzZSBpZiAodGhpcy5GaWx0ZXJzW2ldWzBdID09ICJub3RyZWdleCIgJiYgZmls
dGVyX3Rlc3QgPT0gZmFsc2UpCisgICAgICAgICAgZWxzZSBpZiAodGhpcy5fX2ZpbHRlcnNbaV1b
MF0gPT0gIm5vdHJlZ2V4IiAmJiBmaWx0ZXJUZXN0ID09IGZhbHNlKQogICAgICAgICAgIHsKLSAg
ICAgICAgICAgIGNvbXBhcmVWYWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeUlkKHRoaXMuRmlsdGVyc1tp
XVsyXSwgcm93KTsKKyAgICAgICAgICAgIGNvbXBhcmVWYWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeUlk
KHRoaXMuX19maWx0ZXJzW2ldWzJdLCByb3dJbmRleCk7CiAKLSAgICAgICAgICAgIHZhciB0aGVf
cGF0dGVybiA9IG5ldyBSZWdFeHAodGhpcy5GaWx0ZXJzW2ldWzFdLCB0aGlzLkZpbHRlcnNbaV1b
M10pOwotICAgICAgICAgICAgZmlsdGVyX3Rlc3QgPSAhdGhlX3BhdHRlcm4udGVzdChjb21wYXJl
VmFsdWUpOworICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKHRoaXMuX19maWx0
ZXJzW2ldWzFdLCB0aGlzLl9fZmlsdGVyc1tpXVszXSk7CisgICAgICAgICAgICBmaWx0ZXJUZXN0
ID0gIXBhdHRlcm4udGVzdChjb21wYXJlVmFsdWUpOwogICAgICAgICAgIH0KICAgICAgICAgfQog
Ci0gICAgICAgIC8vIEhpZGUgcm93IGlmIG5lY2Vzc2FyeS4KLSAgICAgICAgaWYgKGZpbHRlcl90
ZXN0ID09IHRydWUpIHsKLSAgICAgICAgICB0aGlzLmhpZGVSb3dzKHJvdywgMSwgZmFsc2UpOwot
ICAgICAgICAgIHJvdy0tOwotICAgICAgICAgIHJvd0xlbmd0aC0tOwotICAgICAgICB9Ci0gICAg
ICB9Ci0KLSAgICAgIHZhciBkYXRhID0KLSAgICAgIHsKLSAgICAgICAgZmlyc3RSb3cgICAgOiAw
LAotICAgICAgICBsYXN0Um93ICAgICA6IHJvd0xlbmd0aCAtIDEsCi0gICAgICAgIGZpcnN0Q29s
dW1uIDogMCwKLSAgICAgICAgbGFzdENvbHVtbiAgOiB0aGlzLmdldENvbHVtbkNvdW50KCkgLSAx
Ci0gICAgICB9OwotCi0gICAgICAvLyBJbmZvcm0gdGhlIGxpc3RlbmVycwotICAgICAgdGhpcy5m
aXJlRGF0YUV2ZW50KCJkYXRhQ2hhbmdlZCIsIGRhdGEpOworICAgICAgICByZXR1cm4gIWZpbHRl
clRlc3Q7CisgICAgICB9LCB0aGlzKSk7CisgICAgICB0aGlzLl9fYXBwbHlpbmdGaWx0ZXJzID0g
ZmFsc2U7CiAgICAgfSwKIAogCiAgICAgLyoqCi0gICAgICogSGlkZXMgYSBzcGVjaWZpZWQgbnVt
YmVyIG9mIHJvd3MuCi0gICAgICoKLSAgICAgKiBAcGFyYW0gcm93TnVtIHtJbnRlZ2VyfQotICAg
ICAqICAgIEluZGV4IG9mIHRoZSBmaXJzdCByb3cgdG8gYmUgaGlkZGVuIGluIHRoZSB0YWJsZS4K
LSAgICAgKgotICAgICAqIEBwYXJhbSBudW1PZlJvd3Mge0ludGVnZXJ9Ci0gICAgICogICAgVGhl
IG51bWJlciBvZiByb3dzIHRvIGJlIGhpZGRlbiBzZXF1ZW50aWFsbHkgYWZ0ZXIgcm93TnVtLgot
ICAgICAqCi0gICAgICogQHBhcmFtIGRpc3BhdGNoRXZlbnQge0Jvb2xlYW4/dHJ1ZX0gV2hldGhl
ciBhIG1vZGVsIGNoYW5nZSBldmVudCBzaG91bGQKLSAgICAgKiAgICBiZSBmaXJlZC4KLSAgICAg
KgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgaGlkZVJvd3MgOiBmdW5jdGlv
bihyb3dOdW0sIG51bU9mUm93cywgZGlzcGF0Y2hFdmVudCkKLSAgICB7Ci0gICAgICB2YXIgcm93
QXJyID0gdGhpcy5nZXREYXRhKCk7Ci0KLSAgICAgIGRpc3BhdGNoRXZlbnQgPSAoZGlzcGF0Y2hF
dmVudCAhPSBudWxsID8gZGlzcGF0Y2hFdmVudCA6IHRydWUpOwotICAgICAgaWYgKCF0aGlzLl9f
YXBwbHlpbmdGaWx0ZXJzKSB7Ci0gICAgICAgIHRoaXMuX19mdWxsQXJyID0gcm93QXJyLnNsaWNl
KDApOwotICAgICAgICB0aGlzLl9fYXBwbHlpbmdGaWx0ZXJzID0gdHJ1ZTsKLSAgICAgIH0KLQot
ICAgICAgaWYgKG51bU9mUm93cyA9PSBudWxsIHx8IG51bU9mUm93cyA8IDEpIHsKLSAgICAgICAg
bnVtT2ZSb3dzID0gMTsKLSAgICAgIH0KLQotICAgICAgZm9yICh2YXIga2x1ZGdlID0gcm93TnVt
OwotICAgICAgICAgICBrbHVkZ2U8KHJvd0Fyci5sZW5ndGggLSBudW1PZlJvd3MpOwotICAgICAg
ICAgICBrbHVkZ2UrKykgewotICAgICAgICByb3dBcnJba2x1ZGdlXSA9IHJvd0FycltrbHVkZ2Ug
KyBudW1PZlJvd3NdOwotICAgICAgfQotICAgICAgdGhpcy5yZW1vdmVSb3dzKGtsdWRnZSwgbnVt
T2ZSb3dzKTsKLQotICAgICAgLy8gSW5mb3JtIHRoZSBsaXN0ZW5lcnMKLSAgICAgIGlmIChkaXNw
YXRjaEV2ZW50KQotICAgICAgewotICAgICAgICB2YXIgZGF0YSA9Ci0gICAgICAgIHsKLSAgICAg
ICAgICBmaXJzdFJvdyAgICA6IDAsCi0gICAgICAgICAgbGFzdFJvdyAgICAgOiByb3dBcnIubGVu
Z3RoIC0gMSwKLSAgICAgICAgICBmaXJzdENvbHVtbiA6IDAsCi0gICAgICAgICAgbGFzdENvbHVt
biAgOiB0aGlzLmdldENvbHVtbkNvdW50KCkgLSAxCi0gICAgICAgIH07Ci0KLSAgICAgICAgdGhp
cy5maXJlRGF0YUV2ZW50KCJkYXRhQ2hhbmdlZCIsIGRhdGEpOwotICAgICAgfQotICAgIH0sCi0K
LQotICAgIC8qKgogICAgICAqIFJldHVybiB0aGUgdGFibGUgdG8gdGhlIG9yaWdpbmFsIHN0YXRl
IHdpdGggYWxsIHJvd3Mgc2hvd24gYW5kIGNsZWFycwogICAgICAqIGFsbCBmaWx0ZXJzLgogICAg
ICAqCkBAIC0zOTMsMjEgKzMwNCwyMCBAQA0KICAgICAgKi8KICAgICByZXNldEhpZGRlblJvd3Mg
OiBmdW5jdGlvbigpCiAgICAgewotICAgICAgaWYgKCF0aGlzLl9fZnVsbEFycikgewotICAgICAg
ICAvLyBub3RoaW5nIHRvIHJlc2V0Ci0gICAgICAgIHJldHVybjsKKyAgICAgIHRoaXMuX19maWx0
ZXJzID0gW107CisgICAgICBpZiAodGhpcy5fX2Z1bGxBcnIpIHsKKyAgICAgICAgdGhpcy5zZXRE
YXRhKHF4LmxhbmcuQXJyYXkuY2xvbmUodGhpcy5fX2Z1bGxBcnIpKTsKICAgICAgIH0KLSAgICAg
IHRoaXMuRmlsdGVycyA9IFtdOwotCi0gICAgICB0aGlzLnNldERhdGEocXgubGFuZy5BcnJheS5j
bG9uZSh0aGlzLl9fZnVsbEFycikpOwogICAgIH0sCiAKIAogICAgIC8vIG92ZXJyaWRkZW4KICAg
ICBzZXREYXRhIDogZnVuY3Rpb24ocm93QXJyLCBjbGVhclNvcnRpbmcpCiAgICAgewotICAgICAg
dGhpcy5fX2Z1bGxBcnIgPSBxeC5sYW5nLkFycmF5LmNsb25lKHJvd0Fycik7Ci0gICAgICB0aGlz
LkZpbHRlcnMgPSBbXTsKKyAgICAgIGlmICghdGhpcy5fX2FwcGx5aW5nRmlsdGVycykgeworICAg
ICAgICB0aGlzLl9fZnVsbEFyciA9IHF4LmxhbmcuQXJyYXkuY2xvbmUocm93QXJyKTsKKyAgICAg
ICAgdGhpcy5fX2ZpbHRlcnMgPSBbXTsKKyAgICAgIH0KICAgICAgIHRoaXMuYmFzZShhcmd1bWVu
dHMsIHJvd0FyciwgY2xlYXJTb3J0aW5nKTsKICAgICB9CiAgIH0sCkBAIC00MTUsNyArMzI1LDcg
QEANCiAKICAgZGVzdHJ1Y3QgOiBmdW5jdGlvbigpCiAgIHsKLSAgICB0aGlzLl9fZnVsbEFyciA9
IHRoaXMubnVtZXJpY0FsbG93ZWQgPSB0aGlzLmJldHdlZW5BbGxvd2VkID0KLSAgICAgIHRoaXMu
RmlsdGVycyA9IG51bGw7CisgICAgdGhpcy5fX2Z1bGxBcnIgPSB0aGlzLl9fbnVtZXJpY0FsbG93
ZWQgPSB0aGlzLl9fYmV0d2VlbkFsbG93ZWQgPQorICAgICAgdGhpcy5fX2ZpbHRlcnMgPSBudWxs
OwogICB9Ci19KTsKK30pOw0KXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlDQo=
</data>

          </attachment>
      

    </bug>