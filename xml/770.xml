<bug>
          <bug_id>770</bug_id>
          
          <creation_ts>2008-01-24 16:28:00 +0100</creation_ts>
          <short_desc>Re-using table causes flicker when using remote table data model</short_desc>
          <delta_ts>2008-06-09 13:32:42 +0200</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>framework</product>
          <component>desktop.table</component>
          <version>0.7.3</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>unspecified</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hugh Gibson">hgibson</reporter>
          <assigned_to name="Unassigned">none</assigned_to>
          
          <qa_contact name="qooxdoo bugs mailing list">qooxdoo-bugs</qa_contact>
          <cf_browser>---</cf_browser>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>2796</commentid>
            <who name="Hugh Gibson">hgibson</who>
            <bug_when>2008-01-24 16:28:17 +0100</bug_when>
            <thetext>If you re-use table instances (as recommended) then there is an issue with using the remote table data model.

The sequence runs like this:

1. Table created, loaded with one set of data.
2. Table removed from DOM ready for re-use. Note that _element retains table HTML data including old row content.
3. Table put under new parent layout object.
4. Now, code in qx.ui.table.pane.Pane.js prevents reload of remote table data until table is visible. Therefore table must be made visible.
5. Old table content is shown because DOM element preserves HTML.
6. New data arrives from server and replaces old table content.

The specific code which is the problem is in Pane.js - search for _updateWantedWhileInvisible. This kicks in _updateContent - when the pane is not visible, the flag is set. When the pane becomes visible (in _afterAppear) _updateContent is called if the flag is set. 

The problem with this is that the act of calling _updateContent is the trigger for the remote table data model to start loading data. Therefore there is a period of time, dependent on the server, before the new data arrives and is displayed.

Therefore when switching between different re-used table instances I see the following:
 - old data
 - blank panel (put in while preparing for the change)
 - old data for an appreciable fraction of a second
 - new data

This problem can be fixed by changing the test for isVisible in _updateContent to be isCreated. In this case the first load of remote data is delayed until the table elements are created. Subsequently the reload can start without delay and the table can be made visible *after* the data has arrived.

Hugh</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>2797</commentid>
              <attachid>283</attachid>
            <who name="Hugh Gibson">hgibson</who>
            <bug_when>2008-01-24 16:31:16 +0100</bug_when>
            <thetext>Created attachment 283
Allow remote table content to be updated while invisible</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>2798</commentid>
              <attachid>284</attachid>
            <who name="Hugh Gibson">hgibson</who>
            <bug_when>2008-01-24 17:07:21 +0100</bug_when>
            <thetext>Created attachment 284
New patch without changes to line endings

Sorry, the initial patch changed line endings in the file. Now fixed with this patch which makes the lines that have changed much easier to identify!

Note that it also includes a fix for bug 760 which was in this file.

Hugh</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>3126</commentid>
            <who name="Derrell Lipman">derrell.lipman</who>
            <bug_when>2008-05-30 17:42:21 +0200</bug_when>
            <thetext>Hugh, please test r13779 in svn.

Derrell
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>3201</commentid>
            <who name="Hugh Gibson">hgibson</who>
            <bug_when>2008-06-06 08:40:52 +0200</bug_when>
            <thetext>Derrell, thanks for applying that. A few things:

Your checkin message at http://qooxdoo.svn.sourceforge.net/viewvc/qooxdoo?view=rev&amp;revision=13779 didn&#39;t mention the bug number. Tsk tsk! ;-)

You will need to apply the change from bug 775 as well.

I note that the trunk version of this file (in qx.legacy.ui.table.pane) hasn&#39;t been changed in the same way. I know that you&#39;re keeping away from trunk, but what mechanism is in place to make sure the fix is ported to trunk?  It could be as simple as changing the version from 0.7.3 to 0.8. Or a new bug could be raised.

I&#39;m re-opening the bug until that is clear to me.

Hugh


</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>3216</commentid>
            <who name="Derrell Lipman">derrell.lipman</who>
            <bug_when>2008-06-06 18:07:20 +0200</bug_when>
            <thetext>There are LOTS of fixes in legacy_0_7_x&#39;s Table that are not yet in trunk.  Sebastian and I discussed all of the changes going into 0.7 and not into trunk quite a while ago.  When it&#39;s time to port Table to trunk, they&#39;ll have to start with what&#39;s currently in in legacy_0_7_x, not with what&#39;s in trunk/qx/legacy.  The latter is, I believe, seriously out of date.

If you&#39;d like, you can open a new ticket specifically for the purpose of ensuring that trunk&#39;s Table starts with an up-to-date legacy Table.

Closing this ticket.  (I&#39;ve also committed the related changes from bug #775.

Derrell
</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>3228</commentid>
            <who name="Hugh Gibson">hgibson</who>
            <bug_when>2008-06-09 13:32:42 +0200</bug_when>
            <thetext>I&#39;ve raised bug 952 to cover using fresh table source code when porting Table to 0.8.

Hugh</thetext>
          </long_desc>
      
          <attachment isobsolete="1" ispatch="1" isprivate="0" isurl="0">
            <attachid>283</attachid>
            <date>2008-01-24 16:31:00 +0100</date>
            <delta_ts>2008-01-24 17:07:21 +0100</delta_ts>
            <desc>Allow remote table content to be updated while invisible</desc>
            <filename>qxBug770.patch</filename>
            <type>text/plain</type>
            <size>41325</size>
            <attacher>hgibson</attacher>
            
              <data encoding="base64">SW5kZXg6IFBhbmUuanMNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBQYW5lLmpzCShyZXZpc2lvbiAxMTI5MCkN
CisrKyBQYW5lLmpzCSh3b3JraW5nIGNvcHkpDQpAQCAtMSw3MjggKzEsNzI4IEBADQotLyogKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqCi0KLSAgIHFvb3hkb28gLSB0aGUgbmV3IGVyYSBvZiB3ZWIgZGV2ZWxvcG1l
bnQKLQotICAgaHR0cDovL3Fvb3hkb28ub3JnCi0KLSAgIENvcHlyaWdodDoKLSAgICAgMjAwNiBT
VFotSURBLCBHZXJtYW55LCBodHRwOi8vd3d3LnN0ei1pZGEuZGUKLQotICAgTGljZW5zZToKLSAg
ICAgTEdQTDogaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2xncGwuaHRtbAotICAgICBFUEw6
IGh0dHA6Ly93d3cuZWNsaXBzZS5vcmcvb3JnL2RvY3VtZW50cy9lcGwtdjEwLnBocAotICAgICBT
ZWUgdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcHJvamVjdCdzIHRvcC1sZXZlbCBkaXJlY3Rvcnkg
Zm9yIGRldGFpbHMuCi0KLSAgIEF1dGhvcnM6Ci0gICAgICogVGlsIFNjaG5laWRlciAodGlsMTMy
KQotICAgICAqIEZhYmlhbiBKYWtvYnMgKGZqYWtvYnMpCi0KLSoqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwot
Ci0vKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioKLQotI21vZHVsZSh1aV90YWJsZSkKLQotKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqICovCi0KLS8qKgotICogVGhlIHRhYmxlIHBhbmUgdGhhdCBzaG93cyBhIGNlcnRhaW4gc2Vj
dGlvbiBmcm9tIGEgdGFibGUuIFRoaXMgY2xhc3MgaGFuZGxlcwotICogdGhlIGRpc3BsYXkgb2Yg
dGhlIGRhdGEgcGFydCBvZiBhIHRhYmxlIGFuZCBpcyB0aGVyZWZvcmUgdGhlIGJhc2UgZm9yIHZp
cnR1YWwKLSAqIHNjcm9sbGluZy4KLSAqLwotcXguQ2xhc3MuZGVmaW5lKCJxeC51aS50YWJsZS5w
YW5lLlBhbmUiLAotewotICBleHRlbmQgOiBxeC51aS5iYXNpYy5UZXJtaW5hdG9yLAotCi0KLQot
Ci0gIC8qCi0gICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi0gICAgIENPTlNUUlVDVE9SCi0gICoqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqCi0gICovCi0KLSAgLyoqCi0gICAqIEBwYXJhbSBwYW5lU2Nyb2xsZXIg
e3F4LnVpLnRhYmxlLnBhbmUuU2Nyb2xsZXJ9IHRoZSBUYWJsZVBhbmVTY3JvbGxlciB0aGUgaGVh
ZGVyIGJlbG9uZ3MgdG8uCi0gICAqLwotICBjb25zdHJ1Y3QgOiBmdW5jdGlvbihwYW5lU2Nyb2xs
ZXIpCi0gIHsKLSAgICB0aGlzLmJhc2UoYXJndW1lbnRzKTsKLQotICAgIHRoaXMuX3BhbmVTY3Jv
bGxlciA9IHBhbmVTY3JvbGxlcjsKLQotICAgIHRoaXMuX2xhc3RDb2xDb3VudCA9IDA7Ci0gICAg
dGhpcy5fbGFzdFJvd0NvdW50ID0gMDsKLSAgfSwKLQotCi0KLQotICAvKgotICAqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKgotICAgICBQUk9QRVJUSUVTCi0gICoqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi0gICov
Ci0KLSAgcHJvcGVydGllcyA6Ci0gIHsKLSAgICBhcHBlYXJhbmNlIDoKLSAgICB7Ci0gICAgICBy
ZWZpbmUgOiB0cnVlLAotICAgICAgaW5pdCA6ICJ0YWJsZS1wYW5lIgotICAgIH0sCi0KLSAgICAv
KiogVGhlIGluZGV4IG9mIHRoZSBmaXJzdCByb3cgdG8gc2hvdy4gKi8KLSAgICBmaXJzdFZpc2li
bGVSb3cgOgotICAgIHsKLSAgICAgIGNoZWNrIDogIk51bWJlciIsCi0gICAgICBpbml0IDogMCwK
LSAgICAgIGFwcGx5IDogIl9hcHBseUZpcnN0VmlzaWJsZVJvdyIKLSAgICB9LAotCi0gICAgLyoq
IFRoZSBudW1iZXIgb2Ygcm93cyB0byBzaG93LiAqLwotICAgIHZpc2libGVSb3dDb3VudCA6Ci0g
ICAgewotICAgICAgY2hlY2sgOiAiTnVtYmVyIiwKLSAgICAgIGluaXQgOiAwLAotICAgICAgYXBw
bHkgOiAiX2FwcGx5VmlzaWJsZVJvd0NvdW50IgotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAq
IE1heGltdW0gbnVtYmVyIG9mIGNhY2hlZCByb3dzLiBJZiB0aGUgdmFsdWUgaXMgPGNvZGU+LTE8
L2NvZGU+IHRoZSBjYWNoZQotICAgICAqIHNpemUgaXMgdW5saW1pdGVkCi0gICAgICovCi0gICAg
bWF4Q2FjaGVMaW5lcyA6Ci0gICAgewotICAgICAgY2hlY2sgOiAiTnVtYmVyIiwKLSAgICAgIGlu
aXQgOiAxMDAwLAotICAgICAgYXBwbHkgOiAiX2FwcGx5TWF4Q2FjaGVMaW5lcyIKLSAgICB9Ci0K
LSAgfSwKLQotCi0KLQotICAvKgotICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgotICAgICBNRU1CRVJT
Ci0gICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqCi0gICovCi0KLSAgbWVtYmVycyA6Ci0gIHsKLSAgICAv
LyBwcm9wZXJ0eSBtb2RpZmllcgotICAgIF9hcHBseUZpcnN0VmlzaWJsZVJvdyA6IGZ1bmN0aW9u
KHZhbHVlLCBvbGQpIHsKLSAgICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnQoZmFsc2UsIHZhbHVlLW9s
ZCk7Ci0gICAgfSwKLQotICAgIC8vIHByb3BlcnR5IG1vZGlmaWVyCi0gICAgX2FwcGx5VmlzaWJs
ZVJvd0NvdW50IDogZnVuY3Rpb24odmFsdWUsIG9sZCkgewotICAgICAgdGhpcy5fdXBkYXRlQ29u
dGVudCgpOwotICAgIH0sCi0KLQotICAgIC8vIG92ZXJyaWRkZW4KLSAgICBfYWZ0ZXJBcHBlYXIg
OiBmdW5jdGlvbigpCi0gICAgewotICAgICAgdGhpcy5iYXNlKGFyZ3VtZW50cyk7Ci0KLSAgICAg
IGlmICh0aGlzLl91cGRhdGVXYW50ZWRXaGlsZUludmlzaWJsZSkKLSAgICAgIHsKLSAgICAgICAg
Ly8gV2UgYXJlIHZpc2libGUgbm93IGFuZCBhbiB1cGRhdGUgd2FzIHdhbnRlZCB3aGlsZSB3ZSB3
ZXJlIGludmlzaWJsZQotICAgICAgICAvLyAtPiBEbyB0aGUgdXBkYXRlIG5vdwotICAgICAgICB0
aGlzLl91cGRhdGVDb250ZW50KCk7Ci0gICAgICAgIHRoaXMuX3VwZGF0ZVdhbnRlZFdoaWxlSW52
aXNpYmxlID0gZmFsc2U7Ci0gICAgICB9Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogUmV0
dXJucyB0aGUgVGFibGVQYW5lU2Nyb2xsZXIgdGhpcyBwYW5lIGJlbG9uZ3MgdG8uCi0gICAgICoK
LSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcmV0dXJuIHtxeC51aS50YWJsZS5wYW5lLlNj
cm9sbGVyfSB0aGUgVGFibGVQYW5lU2Nyb2xsZXIuCi0gICAgICovCi0gICAgZ2V0UGFuZVNjcm9s
bGVyIDogZnVuY3Rpb24oKSB7Ci0gICAgICByZXR1cm4gdGhpcy5fcGFuZVNjcm9sbGVyOwotICAg
IH0sCi0KLQotICAgIC8qKgotICAgICAqIFJldHVybnMgdGhlIHRhYmxlIHRoaXMgcGFuZSBiZWxv
bmdzIHRvLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHJldHVybiB7cXgu
dWkudGFibGUuVGFibGV9IHRoZSB0YWJsZS4KLSAgICAgKi8KLSAgICBnZXRUYWJsZSA6IGZ1bmN0
aW9uKCkgewotICAgICAgcmV0dXJuIHRoaXMuX3BhbmVTY3JvbGxlci5nZXRUYWJsZSgpOwotICAg
IH0sCi0KLQotICAgIC8qKgotICAgICAqIFNldHMgdGhlIGN1cnJlbnRseSBmb2N1c2VkIGNlbGwu
Ci0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcGFyYW0gY29sIHtJbnRlZ2Vy
fSB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGZvY3VzZWQgY2VsbCdzIGNvbHVtbi4KLSAgICAgKiBA
cGFyYW0gcm93IHtJbnRlZ2VyfSB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGZvY3VzZWQgY2VsbCdz
IHJvdy4KLSAgICAgKiBAcGFyYW0gbWFzc1VwZGF0ZSB7Qm9vbGVhbiA/IGZhbHNlfSBXaGV0aGVy
IG90aGVyIHVwZGF0ZXMgYXJlIHBsYW5uZWQgYXMgd2VsbC4KLSAgICAgKiAgICAgICAgICBJZiB0
cnVlLCBubyByZXBhaW50IHdpbGwgYmUgZG9uZS4KLSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAg
ICAqLwotICAgIHNldEZvY3VzZWRDZWxsIDogZnVuY3Rpb24oY29sLCByb3csIG1hc3NVcGRhdGUp
Ci0gICAgewotICAgICAgaWYgKGNvbCAhPSB0aGlzLl9mb2N1c2VkQ29sIHx8IHJvdyAhPSB0aGlz
Ll9mb2N1c2VkUm93KQotICAgICAgewotICAgICAgICB2YXIgb2xkUm93ID0gdGhpcy5fZm9jdXNl
ZFJvdzsKLSAgICAgICAgdGhpcy5fZm9jdXNlZENvbCA9IGNvbDsKLSAgICAgICAgdGhpcy5fZm9j
dXNlZFJvdyA9IHJvdzsKLQotICAgICAgICAvLyBVcGRhdGUgdGhlIGZvY3VzZWQgcm93IGJhY2tn
cm91bmQKLSAgICAgICAgaWYgKHJvdyAhPSBvbGRSb3cgJiYgIW1hc3NVcGRhdGUpCi0gICAgICAg
IHsKLSAgICAgICAgICAvLyBOT1RFOiBPbmx5IHRoZSBvbGQgYW5kIHRoZSBuZXcgcm93IG5lZWQg
dXBkYXRlCi0gICAgICAgICAgdGhpcy5fdXBkYXRlQ29udGVudChmYWxzZSwgbnVsbCwgb2xkUm93
LCB0cnVlKTsKLSAgICAgICAgICB0aGlzLl91cGRhdGVDb250ZW50KGZhbHNlLCBudWxsLCByb3cs
IHRydWUpOwotICAgICAgICB9Ci0gICAgICB9Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICog
RXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHNlbGVjdGlvbiBoYXMgY2hhbmdlZC4KLSAg
ICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2
ZW50LgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX29uU2VsZWN0aW9uQ2hh
bmdlZCA6IGZ1bmN0aW9uKGV2dCkgewotICAgICAgdGhpcy5fdXBkYXRlQ29udGVudChmYWxzZSwg
bnVsbCwgbnVsbCwgdHJ1ZSk7Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogRXZlbnQgaGFu
ZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHRhYmxlIGdldHMgb3IgbG9vc2VzIHRoZSBmb2N1cy4KLSAg
ICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2
ZW50LgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX29uRm9jdXNDaGFuZ2Vk
IDogZnVuY3Rpb24oZXZ0KSB7Ci0gICAgICB0aGlzLl91cGRhdGVDb250ZW50KGZhbHNlLCBudWxs
LCBudWxsLCB0cnVlKTsKLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBFdmVudCBoYW5kbGVy
LiBDYWxsZWQgd2hlbiB0aGUgd2lkdGggb2YgYSBjb2x1bW4gaGFzIGNoYW5nZWQuCi0gICAgICoK
LSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4K
LSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAgICAqLwotICAgIF9vbkNvbFdpZHRoQ2hhbmdlZCA6
IGZ1bmN0aW9uKGV2dCkgewotICAgICAgdGhpcy5fdXBkYXRlQ29udGVudCh0cnVlKTsKLSAgICB9
LAotCi0KLSAgICAvKioKLSAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgdGhlIGNvbHVtbiBv
cmRlciBoYXMgY2hhbmdlZC4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBw
YXJhbSBldnQge01hcH0gdGhlIGV2ZW50LgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICov
Ci0gICAgX29uQ29sT3JkZXJDaGFuZ2VkIDogZnVuY3Rpb24oZXZ0KSB7Ci0gICAgICB0aGlzLl91
cGRhdGVDb250ZW50KHRydWUpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEV2ZW50IGhh
bmRsZXIuIENhbGxlZCB3aGVuIHRoZSBwYW5lIG1vZGVsIGhhcyBjaGFuZ2VkLgotICAgICAqCi0g
ICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuCi0g
ICAgICogQHJldHVybiB7dm9pZH0KLSAgICAgKi8KLSAgICBfb25QYW5lTW9kZWxDaGFuZ2VkIDog
ZnVuY3Rpb24oZXZ0KSB7Ci0gICAgICB0aGlzLl91cGRhdGVDb250ZW50KHRydWUpOwotICAgIH0s
Ci0KLQotICAgIC8qKgotICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB0YWJs
ZSBtb2RlbCBkYXRhIGhhcyBjaGFuZ2VkLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0g
ICAgICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuCi0gICAgICogQHJldHVybiB7dm9pZH0K
LSAgICAgKi8KLSAgICBfb25UYWJsZU1vZGVsRGF0YUNoYW5nZWQgOiBmdW5jdGlvbihldnQpCi0g
ICAgewotICAgICAgdmFyIGRhdGEgPSBldnQuZ2V0RGF0YSA/IGV2dC5nZXREYXRhKCkgOiBudWxs
OwotICAgICAgdGhpcy5fX3Jvd0NhY2hlQ2xlYXIoKTsKLQotICAgICAgdmFyIGZpcnN0Um93ID0g
dGhpcy5nZXRGaXJzdFZpc2libGVSb3coKTsKLSAgICAgIHZhciByb3dDb3VudCA9IHRoaXMuZ2V0
VmlzaWJsZVJvd0NvdW50KCk7Ci0KLSAgICAgIGlmIChkYXRhID09IG51bGwgfHwgZGF0YS5sYXN0
Um93ID09IC0xIHx8IGRhdGEubGFzdFJvdyA+PSBmaXJzdFJvdyAmJiBkYXRhLmZpcnN0Um93IDwg
Zmlyc3RSb3cgKyByb3dDb3VudCkKLSAgICAgIHsKLSAgICAgICAgLy8gVGhlIGNoYW5nZSBpbnRl
cnNlY3RzIHRoaXMgcGFuZQotICAgICAgICB0aGlzLl91cGRhdGVDb250ZW50KCk7Ci0gICAgICB9
Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4g
dGhlIHRhYmxlIG1vZGVsIG1ldGEgZGF0YSBoYXMgY2hhbmdlZC4KLSAgICAgKgotICAgICAqIEB0
eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50LgotICAgICAqIEBy
ZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX29uVGFibGVNb2RlbE1ldGFEYXRhQ2hhbmdlZCA6
IGZ1bmN0aW9uKGV2dCkgewotICAgICAgdGhpcy5fdXBkYXRlQ29udGVudCh0cnVlKTsKLSAgICB9
LAotCi0KLSAgICAvLyBzcGFyc2UgYXJyYXkgdG8gY2FjaGUgcmVuZGVyZWQgcm93cwotICAgIF9f
cm93Q2FjaGUgOiBbXSwKLSAgICBfX3Jvd0NhY2hlQ291bnQgOiAwLAotCi0KLSAgICAvLyBwcm9w
ZXJ0eSBhcHBseSBtZXRob2QKLSAgICBfYXBwbHlNYXhDYWNoZUxpbmVzIDogZnVuY3Rpb24odmFs
dWUsIG9sZCkKLSAgICB7Ci0gICAgICBpZiAodGhpcy5fX3Jvd0NhY2hlQ291bnQgPj0gdmFsdWUg
JiYgdmFsdWUgIT09IC0xKSB7Ci0gICAgICAgIHRoaXMuX19yb3dDYWNoZUNsZWFyKCk7Ci0gICAg
ICB9Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogQ2xlYXIgdGhlIHJvdyBjYWNoZQotICAg
ICAqLwotICAgIF9fcm93Q2FjaGVDbGVhciA6IGZ1bmN0aW9uKCkgewotICAgICAgdGhpcy5fX3Jv
d0NhY2hlID0gW107Ci0gICAgICB0aGlzLl9fcm93Q2FjaGVDb3VudCA9IDA7Ci0gICAgfSwKLQot
Ci0gICAgLyoqCi0gICAgICogR2V0IGEgbGluZSBmcm9tIHRoZSByb3cgY2FjaGUuCi0gICAgICoK
LSAgICAgKiBAcGFyYW0gcm93IHtJbnRlZ2VyfSBSb3cgaW5kZXggdG8gZ2V0Ci0gICAgICogQHBh
cmFtIHNlbGVjdGVkIHtCb29sZWFufSBXaGV0aGVyIHRoZSByb3cgaXMgY3VycmVudGx5IHNlbGVj
dGVkCi0gICAgICogQHBhcmFtIGZvY3VzZWQge0Jvb2xlYW59IFdoZXRoZXIgdGhlIHJvdyBpcyBj
dXJyZW50bHkgZm9jdXNlZAotICAgICAqIEByZXR1cm4ge1N0cmluZ3xudWxsfSBUaGUgY2FjaGVk
IHJvdyBvciBudWxsIGlmIGEgcm93IHdpdGggdGhlIGdpdmVuCi0gICAgICogICAgIGluZGV4IGlz
IG5vdCBjYWNoZWQuCi0gICAgICovCi0gICAgX19yb3dDYWNoZUdldCA6IGZ1bmN0aW9uKHJvdywg
c2VsZWN0ZWQsIGZvY3VzZWQpCi0gICAgewotICAgICAgaWYgKCFzZWxlY3RlZCAmJiAhZm9jdXNl
ZCAmJiB0aGlzLl9fcm93Q2FjaGVbcm93XSkgewotICAgICAgICByZXR1cm4gdGhpcy5fX3Jvd0Nh
Y2hlW3Jvd107Ci0gICAgICB9IGVsc2UgewotICAgICAgICByZXR1cm4gbnVsbDsKLSAgICAgIH0K
LSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBBZGQgYSBsaW5lIHRvIHRoZSByb3cgY2FjaGUu
Ci0gICAgICoKLSAgICAgKiBAcGFyYW0gcm93IHtJbnRlZ2VyfSBSb3cgaW5kZXggdG8gc2V0Ci0g
ICAgICogQHBhcmFtIHJvd1N0cmluZyB7U3RyaW5nfSBjb21wdXRlZCByb3cgc3RyaW5nIHRvIGNh
Y2hlCi0gICAgICogQHBhcmFtIHNlbGVjdGVkIHtCb29sZWFufSBXaGV0aGVyIHRoZSByb3cgaXMg
Y3VycmVudGx5IHNlbGVjdGVkCi0gICAgICogQHBhcmFtIGZvY3VzZWQge0Jvb2xlYW59IFdoZXRo
ZXIgdGhlIHJvdyBpcyBjdXJyZW50bHkgZm9jdXNlZAotICAgICAqLwotICAgIF9fcm93Q2FjaGVT
ZXQgOiBmdW5jdGlvbihyb3csIHJvd1N0cmluZywgc2VsZWN0ZWQsIGZvY3VzZWQpCi0gICAgewot
ICAgICAgaWYgKCFzZWxlY3RlZCAmJiAhZm9jdXNlZCAmJiAhdGhpcy5fX3Jvd0NhY2hlW3Jvd10p
IHsKLSAgICAgICAgdGhpcy5fYXBwbHlNYXhDYWNoZUxpbmVzKHRoaXMuZ2V0TWF4Q2FjaGVMaW5l
cygpKTsKLSAgICAgICAgdGhpcy5fX3Jvd0NhY2hlW3Jvd10gPSByb3dTdHJpbmc7Ci0gICAgICAg
IHRoaXMuX19yb3dDYWNoZUNvdW50ICs9IDE7Ci0gICAgICB9Ci0gICAgfSwKLQotCi0gICAgLyoq
Ci0gICAgICogVXBkYXRlcyB0aGUgY29udGVudCBvZiB0aGUgcGFuZS4KLSAgICAgKgotICAgICAq
IEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBjb21wbGV0ZVVwZGF0ZSB7Qm9vbGVhbiA/IGZh
bHNlfSBpZiB0cnVlIGEgY29tcGxldGUgdXBkYXRlIGlzIHBlcmZvcm1lZC4KLSAgICAgKiAgICAg
IE9uIGEgY29tcGxldGUgdXBkYXRlIGFsbCBjZWxsIHdpZGdldHMgYXJlIHJlY3JlYXRlZC4KLSAg
ICAgKiBAcGFyYW0gc2Nyb2xsT2Zmc2V0IHtJbnRlZ2VyID8gbnVsbH0gSWYgc2V0IHNwZWNpZmll
cyBob3cgbWFueSByb3dzIHRvIHNjcm9sbC4KLSAgICAgKiBAcGFyYW0gb25seVJvdyB7SW50ZWdl
ciA/IG51bGx9IGlmIHNldCBvbmx5IHRoZSBzcGVjaWZpZWQgcm93IHdpbGwgYmUgdXBkYXRlZC4K
LSAgICAgKiBAcGFyYW0gb25seVNlbGVjdGlvbk9yRm9jdXNDaGFuZ2VkIHtCb29sZWFuID8gZmFs
c2V9IGlmIHRydWUsIGNlbGwgdmFsdWVzIHdvbid0Ci0gICAgICogICAgICAgICAgYmUgdXBkYXRl
ZC4gT25seSB0aGUgcm93IGJhY2tncm91bmQgd2lsbC4KLSAgICAgKiBAcmV0dXJuIHt2b2lkfQot
ICAgICAqLwotICAgIF91cGRhdGVDb250ZW50IDogZnVuY3Rpb24oY29tcGxldGVVcGRhdGUsIHNj
cm9sbE9mZnNldCwgb25seVJvdywgb25seVNlbGVjdGlvbk9yRm9jdXNDaGFuZ2VkKQotICAgIHsK
LSAgICAgIGlmIChjb21wbGV0ZVVwZGF0ZSkgewotICAgICAgICB0aGlzLl9fcm93Q2FjaGVDbGVh
cigpOwotICAgICAgfQotCi0gICAgICBpZiAoIXRoaXMuaXNTZWVhYmxlKCkpCi0gICAgICB7Ci0g
ICAgICAgIHRoaXMuX3VwZGF0ZVdhbnRlZFdoaWxlSW52aXNpYmxlID0gdHJ1ZTsKLSAgICAgICAg
cmV0dXJuOwotICAgICAgfQotCi0gICAgICBpZiAodGhpcy5fbGF5b3V0UGVuZGluZykKLSAgICAg
IHsKLSAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLl9sYXlvdXRQZW5kaW5nKTsKLSAg
ICAgICAgdGhpcy5fdXBkYXRlQWxsUm93cygpOwotICAgICAgICByZXR1cm47Ci0gICAgICB9Ci0K
LSAgICAgIC8vdmFyIHN0YXJ0ID0gbmV3IERhdGUoKTsKLQotICAgICAgaWYgKHNjcm9sbE9mZnNl
dCAmJiBNYXRoLmFicyhzY3JvbGxPZmZzZXQpIDw9IE1hdGgubWluKDEwLCB0aGlzLmdldFZpc2li
bGVSb3dDb3VudCgpKSkKLSAgICAgIHsKLSAgICAgICAgLy90aGlzLmRlYnVnKCJzY3JvbGwiLCBz
Y3JvbGxPZmZzZXQpOwotICAgICAgICB0aGlzLl9zY3JvbGxDb250ZW50KHNjcm9sbE9mZnNldCk7
Ci0gICAgICB9Ci0gICAgICBlbHNlIGlmIChvbmx5U2VsZWN0aW9uT3JGb2N1c0NoYW5nZWQgJiYg
IXRoaXMuZ2V0VGFibGUoKS5nZXRBbHdheXNVcGRhdGVDZWxscygpKQotICAgICAgewotICAgICAg
ICAvL3RoaXMuZGVidWcoInVwZGF0ZSByb3cgc3R5bGVzIik7Ci0gICAgICAgIHRoaXMuX3VwZGF0
ZVJvd1N0eWxlcyhvbmx5Um93KTsKLSAgICAgIH0KLSAgICAgIGVsc2UKLSAgICAgIHsKLSAgICAg
ICAgLy90aGlzLmRlYnVnKCJmdWxsIHVwZGF0ZSIpOwotICAgICAgICB0aGlzLl91cGRhdGVBbGxS
b3dzKCk7Ci0gICAgICB9Ci0KLSAgICAgIC8vdGhpcy5kZWJ1ZygicmVuZGVyIHRpbWU6ICIgKyAo
bmV3IERhdGUoKSAtIHN0YXJ0KSArICJtcyIpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAq
IElmIG9ubHkgZm9jdXMgb3Igc2VsZWN0aW9uIGNoYW5nZXMgaXQgaXMgc3VmZmljaWVudCB0byBv
bmx5IHVwZGF0ZSB0aGUKLSAgICAgKiByb3cgc3R5bGVzLiBUaGlzIG1ldGhvZCB1cGRhdGVzIHRo
ZSByb3cgc3R5bGVzIG9mIGFsbCB2aXNpYmxlIHJvd3Mgb3IKLSAgICAgKiBvZiBqdXN0IG9uZSBy
b3cuCi0gICAgICoKLSAgICAgKiBAcGFyYW0gb25seVJvdyB7SW50ZWdlcnxudWxsID8gbnVsbH0g
SWYgdGhpcyBwYXJhbWV0ZXIgaXMgc2V0IG9ubHkgdGhlIHJvdwotICAgICAqICAgICB3aXRoIHRo
aXMgaW5kZXggaXMgdXBkYXRlZC4KLSAgICAgKi8KLSAgICBfdXBkYXRlUm93U3R5bGVzIDogZnVu
Y3Rpb24ob25seVJvdykKLSAgICB7Ci0gICAgICB2YXIgZWxlbSA9IHRoaXMuZ2V0RWxlbWVudCgp
OwotICAgICAgaWYgKCFlbGVtLmZpcnN0Q2hpbGQpIHsKLSAgICAgICAgdGhpcy5fdXBkYXRlQWxs
Um93cygpOwotICAgICAgICByZXR1cm47Ci0gICAgICB9Ci0KLSAgICAgIHZhciB0YWJsZSA9IHRo
aXMuZ2V0VGFibGUoKTsKLSAgICAgIHZhciBzZWxlY3Rpb25Nb2RlbCA9IHRhYmxlLmdldFNlbGVj
dGlvbk1vZGVsKCk7Ci0gICAgICB2YXIgdGFibGVNb2RlbCA9IHRhYmxlLmdldFRhYmxlTW9kZWwo
KTsKLSAgICAgIHZhciByb3dSZW5kZXJlciA9IHRhYmxlLmdldERhdGFSb3dSZW5kZXJlcigpOwot
ICAgICAgdmFyIHJvd05vZGVzID0gZWxlbS5maXJzdENoaWxkLmNoaWxkTm9kZXM7Ci0gICAgICB2
YXIgY2VsbEluZm8gPSB7IHRhYmxlIDogdGFibGUgfTsKLQotICAgICAgLy8gV2UgZG9uJ3Qgd2Fu
dCB0byBleGVjdXRlIHRoZSByb3cgbG9vcCBiZWxvdyBtb3JlIHRoYW4gbmVjZXNzYXJ5LiBJZgot
ICAgICAgLy8gb25seXJvdyBpcyBub3QgbnVsbCwgd2Ugd2FudCB0byBkbyB0aGUgbG9vcCBvbmx5
IGZvciB0aGF0IHJvdy4KLSAgICAgIC8vIEluIHRoYXQgY2FzZSwgd2FzIHN0YXJ0IGF0IChzZXQg
dGhlICJyb3ciIHZhcmlhYmxlIHRvKSB0aGF0IHJvdywgYW5kCi0gICAgICAvLyBzdG9wIGF0IChz
ZXQgdGhlICJlbmQiIHZhcmlhYmxlIHRvIHRoZSBvZmZzZXQgb2YpIHRoZSBuZXh0IHJvdzsgLgot
ICAgICAgdmFyIHJvdyA9IHRoaXMuZ2V0Rmlyc3RWaXNpYmxlUm93KCk7Ci0gICAgICB2YXIgeSA9
IDA7Ci0KLSAgICAgIC8vIEhvdyBtYW55IHJvd3MgZG8gd2UgbmVlZCB0byB1cGRhdGU/Ci0gICAg
ICB2YXIgZW5kID0gcm93Tm9kZXMubGVuZ3RoOwotCi0gICAgICBpZiAob25seVJvdyAhPSBudWxs
KQotICAgICAgewotICAgICAgICAvLyBIb3cgbWFueSByb3dzIGFyZSB3ZSBza2lwcGluZz8KLSAg
ICAgICAgdmFyIG9mZnNldCA9IG9ubHlSb3cgLSByb3c7Ci0gICAgICAgIGlmIChvZmZzZXQgPj0g
MCAmJiBvZmZzZXQgPCBlbmQpCi0gICAgICAgIHsKLSAgICAgICAgICByb3cgPSBvbmx5Um93Owot
ICAgICAgICAgIHkgPSBvZmZzZXQ7Ci0gICAgICAgICAgZW5kID0gb2Zmc2V0ICsgMTsKLSAgICAg
ICAgfQotICAgICAgICBlbHNlCi0gICAgICAgICAgcmV0dXJuOwotICAgICAgfQotCi0gICAgICBm
b3IgKDsgeTxlbmQ7IHkrKywgcm93KyspCi0gICAgICB7Ci0gICAgICAgIGNlbGxJbmZvLnJvdyA9
IHJvdzsKLSAgICAgICAgY2VsbEluZm8uc2VsZWN0ZWQgPSBzZWxlY3Rpb25Nb2RlbC5pc1NlbGVj
dGVkSW5kZXgocm93KTsKLSAgICAgICAgY2VsbEluZm8uZm9jdXNlZFJvdyA9ICh0aGlzLl9mb2N1
c2VkUm93ID09IHJvdyk7Ci0gICAgICAgIGNlbGxJbmZvLnJvd0RhdGEgPSB0YWJsZU1vZGVsLmdl
dFJvd0RhdGEocm93KTsKLQotICAgICAgICByb3dSZW5kZXJlci51cGRhdGVEYXRhUm93RWxlbWVu
dChjZWxsSW5mbywgcm93Tm9kZXNbeV0pOwotICAgICAgfTsKLSAgICB9LAotCi0KLSAgICAvKioK
LSAgICAgKiBHZXQgdGhlIEhUTUwgdGFibGUgZnJhZ21lbnQgZm9yIHRoZSBnaXZlbiByb3cgcmFu
Z2UuCi0gICAgICoKLSAgICAgKiBAcGFyYW0gZmlyc3RSb3cge0ludGVnZXJ9IEluZGV4IG9mIHRo
ZSBmaXJzdCByb3cKLSAgICAgKiBAcGFyYW0gcm93Q291bnQge0ludGVnZXJ9IE51bWJlciBvZiBy
b3dzCi0gICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgSFRNTCB0YWJsZSBmcmFnbWVudCBmb3Ig
dGhlIGdpdmVuIHJvdyByYW5nZS4KLSAgICAgKi8KLSAgICBfZ2V0Um93c0h0bWwgOiBmdW5jdGlv
bihmaXJzdFJvdywgcm93Q291bnQpCi0gICAgewotICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRU
YWJsZSgpOwotCi0gICAgICB2YXIgc2VsZWN0aW9uTW9kZWwgPSB0YWJsZS5nZXRTZWxlY3Rpb25N
b2RlbCgpOwotICAgICAgdmFyIHRhYmxlTW9kZWwgPSB0YWJsZS5nZXRUYWJsZU1vZGVsKCk7Ci0g
ICAgICB2YXIgY29sdW1uTW9kZWwgPSB0YWJsZS5nZXRUYWJsZUNvbHVtbk1vZGVsKCk7Ci0gICAg
ICB2YXIgcGFuZU1vZGVsID0gdGhpcy5nZXRQYW5lU2Nyb2xsZXIoKS5nZXRUYWJsZVBhbmVNb2Rl
bCgpOwotICAgICAgdmFyIHJvd1JlbmRlcmVyID0gdGFibGUuZ2V0RGF0YVJvd1JlbmRlcmVyKCk7
Ci0KLSAgICAgIHRhYmxlTW9kZWwucHJlZmV0Y2hSb3dzKGZpcnN0Um93LCBmaXJzdFJvdyArIHJv
d0NvdW50IC0gMSk7Ci0KLSAgICAgIHZhciByb3dIZWlnaHQgPSB0YWJsZS5nZXRSb3dIZWlnaHQo
KTsKLSAgICAgIHZhciBjb2xDb3VudCA9IHBhbmVNb2RlbC5nZXRDb2x1bW5Db3VudCgpOwotICAg
ICAgdmFyIGxlZnQgPSAwOwotICAgICAgdmFyIGNvbHMgPSBbXTsKLQotICAgICAgLy8gcHJlY29t
cHV0ZSBjb2x1bW4gcHJvcGVydGllcwotICAgICAgZm9yICh2YXIgeD0wOyB4PGNvbENvdW50OyB4
KyspCi0gICAgICB7Ci0gICAgICAgIHZhciBjb2wgPSBwYW5lTW9kZWwuZ2V0Q29sdW1uQXRYKHgp
OwotICAgICAgICB2YXIgY2VsbFdpZHRoID0gY29sdW1uTW9kZWwuZ2V0Q29sdW1uV2lkdGgoY29s
KTsKLSAgICAgICAgY29scy5wdXNoKHsKLSAgICAgICAgICBjb2w6IGNvbCwKLSAgICAgICAgICB4
UG9zOiB4LAotICAgICAgICAgIGVkaXRhYmxlOiB0YWJsZU1vZGVsLmlzQ29sdW1uRWRpdGFibGUo
Y29sKSwKLSAgICAgICAgICBmb2N1c2VkQ29sOiB0aGlzLl9mb2N1c2VkQ29sID09IGNvbCwKLSAg
ICAgICAgICBzdHlsZUxlZnQ6IGxlZnQsCi0gICAgICAgICAgc3R5bGVXaWR0aDogY2VsbFdpZHRo
Ci0gICAgICAgIH0pOwotCi0gICAgICAgIGxlZnQgKz0gY2VsbFdpZHRoOwotICAgICAgfQotCi0g
ICAgICB2YXIgcm93c0FyciA9IFtdOwotICAgICAgZm9yICh2YXIgcm93PWZpcnN0Um93OyByb3cg
PCBmaXJzdFJvdyArIHJvd0NvdW50OyByb3crKykKLSAgICAgIHsKLSAgICAgICAgdmFyIHNlbGVj
dGVkID0gc2VsZWN0aW9uTW9kZWwuaXNTZWxlY3RlZEluZGV4KHJvdyk7Ci0gICAgICAgIHZhciBm
b2N1c2VkUm93ID0gKHRoaXMuX2ZvY3VzZWRSb3cgPT0gcm93KTsKLQotICAgICAgICB2YXIgY2Fj
aGVkUm93ID0gdGhpcy5fX3Jvd0NhY2hlR2V0KHJvdywgc2VsZWN0ZWQsIGZvY3VzZWRSb3cpOwot
ICAgICAgICBpZiAoY2FjaGVkUm93KSB7Ci0gICAgICAgICAgcm93c0Fyci5wdXNoKGNhY2hlZFJv
dyk7Ci0gICAgICAgICAgY29udGludWU7Ci0gICAgICAgIH0KLQotICAgICAgICB2YXIgcm93SHRt
bCA9IFtdOwotCi0gICAgICAgIHZhciBjZWxsSW5mbyA9IHsgdGFibGUgOiB0YWJsZSB9OwotICAg
ICAgICBjZWxsSW5mby5zdHlsZUhlaWdodCA9IHJvd0hlaWdodDsKLQotICAgICAgICBjZWxsSW5m
by5yb3cgPSByb3c7Ci0gICAgICAgIGNlbGxJbmZvLnNlbGVjdGVkID0gc2VsZWN0ZWQ7Ci0gICAg
ICAgIGNlbGxJbmZvLmZvY3VzZWRSb3cgPSBmb2N1c2VkUm93OwotICAgICAgICBjZWxsSW5mby5y
b3dEYXRhID0gdGFibGVNb2RlbC5nZXRSb3dEYXRhKHJvdyk7Ci0KLSAgICAgICAgcm93SHRtbC5w
dXNoKCc8ZGl2ICcpOwotCi0gICAgICAgIHZhciByb3dDbGFzcyA9IHJvd1JlbmRlcmVyLmdldFJv
d0NsYXNzKGNlbGxJbmZvKTsKLSAgICAgICAgaWYgKHJvd0NsYXNzKSB7Ci0gICAgICAgICAgcm93
SHRtbC5wdXNoKCdjbGFzcz0iJywgcm93Q2xhc3MsICciICcpOwotICAgICAgICB9Ci0KLSAgICAg
ICAgdmFyIHJvd1N0eWxlID0gcm93UmVuZGVyZXIuY3JlYXRlUm93U3R5bGUoY2VsbEluZm8pOwot
ICAgICAgICByb3dTdHlsZSArPSAiO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDoiICsgcm93SGVp
Z2h0ICsgInB4OyB3aWR0aDoiICsgcGFuZU1vZGVsLmdldFRvdGFsV2lkdGgoKSArICJweDsiOwot
ICAgICAgICBpZiAocm93U3R5bGUpIHsKLSAgICAgICAgICByb3dIdG1sLnB1c2goJ3N0eWxlPSIn
LCByb3dTdHlsZSwgJyIgJyk7Ci0gICAgICAgIH0KLSAgICAgICAgcm93SHRtbC5wdXNoKCc+Jyk7
Ci0KLSAgICAgICAgZm9yICh2YXIgeD0wOyB4PGNvbENvdW50OyB4KyspCi0gICAgICAgIHsKLSAg
ICAgICAgICB2YXIgY29sX2RlZiA9IGNvbHNbeF07Ci0gICAgICAgICAgZm9yICh2YXIgYXR0ciBp
biBjb2xfZGVmKSB7Ci0gICAgICAgICAgICBjZWxsSW5mb1thdHRyXSA9IGNvbF9kZWZbYXR0cl07
Ci0gICAgICAgICAgfQotICAgICAgICAgIHZhciBjb2wgPSBjZWxsSW5mby5jb2w7Ci0KLSAgICAg
ICAgICAvLyBBQjogdXNlIHRoZSAiZ2V0VmFsdWUiIG1ldGhvZCBvZiB0aGUgdGFibGVNb2RlbCB0
byBnZXQgdGhlIGNlbGwncyB2YWx1ZQotICAgICAgICAgIC8vIHdvcmtpbmcgZGlyZWN0bHkgb24g
dGhlICJyb3dEYXRhIiBvYmplY3QgKC0+IGNlbGxJbmZvLnJvd0RhdGFbY29sXTspIGlzIG5vdCBh
IHNvbHV0aW9uCi0gICAgICAgICAgLy8gYmVjYXVzZSB5b3UgY2FuJ3Qgd29yayB3aXRoIHRoZSBj
b2x1bW5JbmRleCAtPiB5b3UgaGF2ZSB0byB1c2UgdGhlIGNvbHVtbklkIG9mIHRoZSBjb2x1bW5J
bmRleAotICAgICAgICAgIC8vIFRoaXMgaXMgZXhhY3RseSB3aGF0IHRoZSBtZXRob2QgImdldFZh
bHVlIiBkb2VzCi0gICAgICAgICAgY2VsbEluZm8udmFsdWUgPSB0YWJsZU1vZGVsLmdldFZhbHVl
KGNvbCwgcm93KTsKLSAgICAgICAgICB2YXIgY2VsbFJlbmRlcmVyID0gY29sdW1uTW9kZWwuZ2V0
RGF0YUNlbGxSZW5kZXJlcihjb2wpOwotICAgICAgICAgIGNlbGxSZW5kZXJlci5jcmVhdGVEYXRh
Q2VsbEh0bWwoY2VsbEluZm8sIHJvd0h0bWwpOwotICAgICAgICB9Ci0gICAgICAgIHJvd0h0bWwu
cHVzaCgnPC9kaXY+Jyk7Ci0KLSAgICAgICAgdmFyIHJvd1N0cmluZyA9IHJvd0h0bWwuam9pbigi
Iik7Ci0KLSAgICAgICAgdGhpcy5fX3Jvd0NhY2hlU2V0KHJvdywgcm93U3RyaW5nLCBzZWxlY3Rl
ZCwgZm9jdXNlZFJvdyk7Ci0gICAgICAgIHJvd3NBcnIucHVzaChyb3dTdHJpbmcpOwotICAgICAg
fQotICAgICAgcmV0dXJuIHJvd3NBcnIuam9pbigiIik7Ci0gICAgfSwKLQotCi0gICAgLyoqCi0g
ICAgICogU2Nyb2xscyB0aGUgcGFuZSdzIGNvbnRlbnRzIGJ5IHRoZSBnaXZlbiBvZmZzZXQuCi0g
ICAgICoKLSAgICAgKiBAcGFyYW0gcm93T2Zmc2V0IHtJbnRlZ2VyfSBOdW1iZXIgb2YgbGluZXMg
dG8gc2Nyb2xsLiBTY3JvbGxpbmcgdXAgaXMKLSAgICAgKiAgICAgcmVwcmVzZW50ZWQgYnkgYSBu
ZWdhdGl2ZSBvZmZzZXQuCi0gICAgICovCi0gICAgX3Njcm9sbENvbnRlbnQgOiBmdW5jdGlvbihy
b3dPZmZzZXQpCi0gICAgewotICAgICAgaWYgKCF0aGlzLmdldEVsZW1lbnQoKS5maXJzdENoaWxk
KSB7Ci0gICAgICAgIHRoaXMuX3VwZGF0ZUFsbFJvd3MoKTsKLSAgICAgICAgcmV0dXJuOwotICAg
ICAgfQotCi0gICAgICB2YXIgdGFibGVCb2R5ID0gdGhpcy5nZXRFbGVtZW50KCkuZmlyc3RDaGls
ZDsKLSAgICAgIHZhciB0YWJsZUNoaWxkTm9kZXMgPSB0YWJsZUJvZHkuY2hpbGROb2RlczsKLSAg
ICAgIHZhciByb3dDb3VudCA9IHRoaXMuZ2V0VmlzaWJsZVJvd0NvdW50KCk7Ci0gICAgICB2YXIg
Zmlyc3RSb3cgPSB0aGlzLmdldEZpcnN0VmlzaWJsZVJvdygpOwotCi0KLSAgICAgIHZhciBtb2Rl
bFJvd0NvdW50ID0gdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlTW9kZWwoKS5nZXRSb3dDb3VudCgp
OwotCi0gICAgICAvLyBkb24ndCBoYW5kbGUgdGhpcyBzcGVjaWFsIGNhc2UgaGVyZQotICAgICAg
aWYgKGZpcnN0Um93ICsgcm93Q291bnQgPiBtb2RlbFJvd0NvdW50KSB7Ci0gICAgICAgIHRoaXMu
X3VwZGF0ZUFsbFJvd3MoKTsKLSAgICAgICAgcmV0dXJuOwotICAgICAgfQotCi0gICAgICAvLyBy
ZW1vdmUgb2xkIGxpbmVzCi0gICAgICB2YXIgcmVtb3ZlUm93QmFzZSA9IHJvd09mZnNldCA8IDAg
PyByb3dDb3VudCArIHJvd09mZnNldCA6IDA7Ci0gICAgICB2YXIgYWRkUm93QmFzZSA9IHJvd09m
ZnNldCA8IDAgPyAwOiByb3dDb3VudCAtIHJvd09mZnNldDsKLQotICAgICAgZm9yIChpPU1hdGgu
YWJzKHJvd09mZnNldCktMTsgaT49MDsgaS0tKQotICAgICAgewotICAgICAgICB2YXIgcm93RWxl
bSA9IHRhYmxlQ2hpbGROb2Rlc1tyZW1vdmVSb3dCYXNlXTsKLSAgICAgICAgdHJ5IHsKLSAgICAg
ICAgICB0YWJsZUJvZHkucmVtb3ZlQ2hpbGQocm93RWxlbSk7Ci0gICAgICAgIH0gY2F0Y2goZSkg
ewotICAgICAgICAgIGJyZWFrOwotICAgICAgICB9Ci0gICAgICB9Ci0KLSAgICAgIC8vIHJlbmRl
ciBuZXcgbGluZXMKLSAgICAgIGlmICghdGhpcy5fdGFibGVDb250YWluZXIpIHsKLSAgICAgICAg
dGhpcy5fdGFibGVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKLSAg
ICAgIH0KLSAgICAgIHZhciB0YWJsZUR1bW15ID0gJzxkaXY+JzsKLSAgICAgIHRhYmxlRHVtbXkg
Kz0gdGhpcy5fZ2V0Um93c0h0bWwoZmlyc3RSb3cgKyBhZGRSb3dCYXNlLCBNYXRoLmFicyhyb3dP
ZmZzZXQpKTsKLSAgICAgIHRhYmxlRHVtbXkgKz0gJzwvZGl2Pic7Ci0gICAgICB0aGlzLl90YWJs
ZUNvbnRhaW5lci5pbm5lckhUTUwgPSB0YWJsZUR1bW15OwotICAgICAgdmFyIG5ld1RhYmxlUm93
cyA9IHRoaXMuX3RhYmxlQ29udGFpbmVyLmZpcnN0Q2hpbGQuY2hpbGROb2RlczsKLQotICAgICAg
Ly8gYXBwZW5kIG5ldyBsaW5lcwotICAgICAgaWYgKHJvd09mZnNldCA+IDApCi0gICAgICB7Ci0g
ICAgICAgIGZvciAodmFyIGk9bmV3VGFibGVSb3dzLmxlbmd0aC0xOyBpPj0wOyBpLS0pCi0gICAg
ICAgIHsKLSAgICAgICAgICB2YXIgcm93RWxlbSA9IG5ld1RhYmxlUm93c1swXTsKLSAgICAgICAg
ICB0YWJsZUJvZHkuYXBwZW5kQ2hpbGQocm93RWxlbSk7Ci0gICAgICAgIH0KLSAgICAgIH0KLSAg
ICAgIGVsc2UKLSAgICAgIHsKLSAgICAgICAgZm9yICh2YXIgaT1uZXdUYWJsZVJvd3MubGVuZ3Ro
LTE7IGk+PTA7IGktLSkKLSAgICAgICAgewotICAgICAgICAgIHZhciByb3dFbGVtID0gbmV3VGFi
bGVSb3dzW25ld1RhYmxlUm93cy5sZW5ndGgtMV07Ci0gICAgICAgICAgdGFibGVCb2R5Lmluc2Vy
dEJlZm9yZShyb3dFbGVtLCB0YWJsZUJvZHkuZmlyc3RDaGlsZCk7Ci0gICAgICAgIH0KLSAgICAg
IH0KLQotICAgICAgLy8gdXBkYXRlIGZvY3VzIGluZGljYXRvcgotICAgICAgdGhpcy5fdXBkYXRl
Um93U3R5bGVzKHRoaXMuX2ZvY3VzZWRSb3cgLSByb3dPZmZzZXQpOwotICAgICAgdGhpcy5fdXBk
YXRlUm93U3R5bGVzKHRoaXMuX2ZvY3VzZWRSb3cpOwotCi0gICAgICAvLyBmb3JjZSBpbW1lZGlh
dGUgbGF5b3V0aW5nCi0gICAgICAvLyB0aGlzIHByZXZlbnRzIEZpcmVmb3ggZnJvbSBmbGlja2Vy
aW5nCi0gICAgICBpZiAocXguY29yZS5WYXJpYW50LmlzU2V0KCJxeC5jbGllbnQiLCAiZ2Vja28i
KSkgewotICAgICAgICByb3dFbGVtLm9mZnNldEhlaWdodDsKLSAgICAgIH0KLSAgICB9LAotCi0K
LSAgICAvKioKLSAgICAgKiBVcGRhdGVzIHRoZSBjb250ZW50IG9mIHRoZSBwYW5lIChpbXBsZW1l
bnRlZCB1c2luZyBhcnJheSBqb2lucykuCi0gICAgICovCi0gICAgX3VwZGF0ZUFsbFJvd3MgOiBm
dW5jdGlvbigpCi0gICAgewotICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOwotCi0g
ICAgICB2YXIgdGFibGVNb2RlbCA9IHRhYmxlLmdldFRhYmxlTW9kZWwoKTsKLSAgICAgIHZhciBw
YW5lTW9kZWwgPSB0aGlzLmdldFBhbmVTY3JvbGxlcigpLmdldFRhYmxlUGFuZU1vZGVsKCk7Ci0K
LSAgICAgIHZhciBjb2xDb3VudCA9IHBhbmVNb2RlbC5nZXRDb2x1bW5Db3VudCgpOwotICAgICAg
dmFyIHJvd0hlaWdodCA9IHRhYmxlLmdldFJvd0hlaWdodCgpOwotICAgICAgdmFyIGZpcnN0Um93
ID0gdGhpcy5nZXRGaXJzdFZpc2libGVSb3coKTsKLQotICAgICAgdmFyIHJvd0NvdW50ID0gdGhp
cy5nZXRWaXNpYmxlUm93Q291bnQoKTsKLSAgICAgIHZhciBtb2RlbFJvd0NvdW50ID0gdGFibGVN
b2RlbC5nZXRSb3dDb3VudCgpOwotCi0gICAgICBpZiAoZmlyc3RSb3cgKyByb3dDb3VudCA+IG1v
ZGVsUm93Q291bnQpIHsKLSAgICAgICAgcm93Q291bnQgPSBNYXRoLm1heCgwLCBtb2RlbFJvd0Nv
dW50IC0gZmlyc3RSb3cpOwotICAgICAgfQotCi0gICAgICB2YXIgcm93V2lkdGggPSBwYW5lTW9k
ZWwuZ2V0VG90YWxXaWR0aCgpOwotCi0gICAgICB2YXIgaHRtbEFyciA9IFsKLSAgICAgICAgIjxk
aXYgc3R5bGU9JyIsCi0gICAgICAgICJ3aWR0aDogIiwgcm93V2lkdGgsICJweDsiLAotICAgICAg
ICAibGluZS1oZWlnaHQ6ICIsIHJvd0hlaWdodCwgInB4OyIsCi0gICAgICAgICJvdmVyZmxvdzog
aGlkZGVuOyIsCi0gICAgICAgICJmb250LXNpemU6IDExcHg7IiwKLSAgICAgICAgImZvbnQtZmFt
aWx5OiAnU2Vnb2UgVUknLCBDb3JiZWwsIENhbGlicmksIFRhaG9tYSwgJ0x1Y2lkYSBTYW5zIFVu
aWNvZGUnLCBzYW5zLXNlcmlmOyIsCi0gICAgICAgICInPiIsCi0gICAgICAgIHRoaXMuX2dldFJv
d3NIdG1sKGZpcnN0Um93LCByb3dDb3VudCksCi0gICAgICAgICI8L2Rpdj4iCi0gICAgICBdOwot
Ci0gICAgICB2YXIgZWxlbSA9IHRoaXMuZ2V0RWxlbWVudCgpOwotICAgICAgdmFyIGRhdGEgPSBo
dG1sQXJyLmpvaW4oIiIpOwotCi0gICAgICAvL3RoaXMuZGVidWcoIj4+PiIgKyBkYXRhICsgIjw8
PCIpCi0KLSAgICAgIHZhciBzZWxmID0gdGhpczsKLSAgICAgIHRoaXMuX2xheW91dFBlbmRpbmcg
PSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpCi0gICAgICB7Ci0gICAgICAgIGVsZW0uaW5u
ZXJIVE1MID0gZGF0YTsKLQotICAgICAgICAvLyBmb3JjZSBpbW1lZGlhdGUgbGF5b3V0aW5nCi0g
ICAgICAgIC8vIHRoaXMgcHJldmVudHMgRmlyZWZveCBmcm9tIGZsaWNrZXJpbmcKLSAgICAgICAg
aWYgKHF4LmNvcmUuVmFyaWFudC5pc1NldCgicXguY2xpZW50IiwgImdlY2tvIikpIHsKLSAgICAg
ICAgICBlbGVtLmNoaWxkTm9kZXNbMF0ub2Zmc2V0SGVpZ2h0OwotICAgICAgICB9Ci0gICAgICAg
IHNlbGYuX2xheW91dFBlbmRpbmcgPSBudWxsOwotICAgICAgfSwgMTApOwotCi0gICAgICAvKgot
ICAgICAgZWxlbS5pbm5lckhUTUwgPSBkYXRhOwotCi0gICAgICAvLyBmb3JjZSBpbW1lZGlhdGUg
bGF5b3V0aW5nCi0gICAgICAvLyB0aGlzIHByZXZlbnRzIEZpcmVmb3ggZnJvbSBmbGlja2VyaW5n
Ci0gICAgICBpZiAocXguY29yZS5WYXJpYW50LmlzU2V0KCJxeC5jbGllbnQiLCAiZ2Vja28iKSkg
ewotICAgICAgICBlbGVtLmNoaWxkTm9kZXNbMF0ub2Zmc2V0SGVpZ2h0OwotICAgICAgfQotICAg
ICAgKi8KLQotICAgICAgdGhpcy5zZXRIZWlnaHQocm93Q291bnQgKiByb3dIZWlnaHQpOwotCi0g
ICAgICB0aGlzLl9sYXN0Q29sQ291bnQgPSBjb2xDb3VudDsKLSAgICAgIHRoaXMuX2xhc3RSb3dD
b3VudCA9IHJvd0NvdW50OwotICAgIH0KLQotICB9LAotCi0KLQotCi0gIC8qCi0gICoqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqCi0gICAgIERFU1RSVUNUT1IKLSAgKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLSAg
Ki8KLQotICBkZXN0cnVjdCA6IGZ1bmN0aW9uKCkgewotICAgIHRoaXMuX2Rpc3Bvc2VPYmplY3Rz
KCJfcGFuZVNjcm9sbGVyIik7Ci0gIH0KLX0pOworLyogKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQorDQorICAg
cW9veGRvbyAtIHRoZSBuZXcgZXJhIG9mIHdlYiBkZXZlbG9wbWVudA0KKw0KKyAgIGh0dHA6Ly9x
b294ZG9vLm9yZw0KKw0KKyAgIENvcHlyaWdodDoNCisgICAgIDIwMDYgU1RaLUlEQSwgR2VybWFu
eSwgaHR0cDovL3d3dy5zdHotaWRhLmRlDQorDQorICAgTGljZW5zZToNCisgICAgIExHUEw6IGh0
dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWwNCisgICAgIEVQTDogaHR0cDovL3d3
dy5lY2xpcHNlLm9yZy9vcmcvZG9jdW1lbnRzL2VwbC12MTAucGhwDQorICAgICBTZWUgdGhlIExJ
Q0VOU0UgZmlsZSBpbiB0aGUgcHJvamVjdCdzIHRvcC1sZXZlbCBkaXJlY3RvcnkgZm9yIGRldGFp
bHMuDQorDQorICAgQXV0aG9yczoNCisgICAgICogVGlsIFNjaG5laWRlciAodGlsMTMyKQ0KKyAg
ICAgKiBGYWJpYW4gSmFrb2JzIChmamFrb2JzKQ0KKw0KKyoqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KKw0K
Ky8qICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKg0KKw0KKyNtb2R1bGUodWlfdGFibGUpDQorDQorKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqICovDQorDQorLyoqDQorICogVGhlIHRhYmxlIHBhbmUgdGhhdCBzaG93cyBhIGNlcnRh
aW4gc2VjdGlvbiBmcm9tIGEgdGFibGUuIFRoaXMgY2xhc3MgaGFuZGxlcw0KKyAqIHRoZSBkaXNw
bGF5IG9mIHRoZSBkYXRhIHBhcnQgb2YgYSB0YWJsZSBhbmQgaXMgdGhlcmVmb3JlIHRoZSBiYXNl
IGZvciB2aXJ0dWFsDQorICogc2Nyb2xsaW5nLg0KKyAqLw0KK3F4LkNsYXNzLmRlZmluZSgicXgu
dWkudGFibGUucGFuZS5QYW5lIiwNCit7DQorICBleHRlbmQgOiBxeC51aS5iYXNpYy5UZXJtaW5h
dG9yLA0KKw0KKw0KKw0KKw0KKyAgLyoNCisgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQorICAgICBD
T05TVFJVQ1RPUg0KKyAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCisgICovDQorDQorICAvKioNCisg
ICAqIEBwYXJhbSBwYW5lU2Nyb2xsZXIge3F4LnVpLnRhYmxlLnBhbmUuU2Nyb2xsZXJ9IHRoZSBU
YWJsZVBhbmVTY3JvbGxlciB0aGUgaGVhZGVyIGJlbG9uZ3MgdG8uDQorICAgKi8NCisgIGNvbnN0
cnVjdCA6IGZ1bmN0aW9uKHBhbmVTY3JvbGxlcikNCisgIHsNCisgICAgdGhpcy5iYXNlKGFyZ3Vt
ZW50cyk7DQorDQorICAgIHRoaXMuX3BhbmVTY3JvbGxlciA9IHBhbmVTY3JvbGxlcjsNCisNCisg
ICAgdGhpcy5fbGFzdENvbENvdW50ID0gMDsNCisgICAgdGhpcy5fbGFzdFJvd0NvdW50ID0gMDsN
CisgIH0sDQorDQorDQorDQorDQorICAvKg0KKyAgKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCisgICAg
IFBST1BFUlRJRVMNCisgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQorICAqLw0KKw0KKyAgcHJvcGVy
dGllcyA6DQorICB7DQorICAgIGFwcGVhcmFuY2UgOg0KKyAgICB7DQorICAgICAgcmVmaW5lIDog
dHJ1ZSwNCisgICAgICBpbml0IDogInRhYmxlLXBhbmUiDQorICAgIH0sDQorDQorICAgIC8qKiBU
aGUgaW5kZXggb2YgdGhlIGZpcnN0IHJvdyB0byBzaG93LiAqLw0KKyAgICBmaXJzdFZpc2libGVS
b3cgOg0KKyAgICB7DQorICAgICAgY2hlY2sgOiAiTnVtYmVyIiwNCisgICAgICBpbml0IDogMCwN
CisgICAgICBhcHBseSA6ICJfYXBwbHlGaXJzdFZpc2libGVSb3ciDQorICAgIH0sDQorDQorICAg
IC8qKiBUaGUgbnVtYmVyIG9mIHJvd3MgdG8gc2hvdy4gKi8NCisgICAgdmlzaWJsZVJvd0NvdW50
IDoNCisgICAgew0KKyAgICAgIGNoZWNrIDogIk51bWJlciIsDQorICAgICAgaW5pdCA6IDAsDQor
ICAgICAgYXBwbHkgOiAiX2FwcGx5VmlzaWJsZVJvd0NvdW50Ig0KKyAgICB9LA0KKw0KKw0KKyAg
ICAvKioNCisgICAgICogTWF4aW11bSBudW1iZXIgb2YgY2FjaGVkIHJvd3MuIElmIHRoZSB2YWx1
ZSBpcyA8Y29kZT4tMTwvY29kZT4gdGhlIGNhY2hlDQorICAgICAqIHNpemUgaXMgdW5saW1pdGVk
DQorICAgICAqLw0KKyAgICBtYXhDYWNoZUxpbmVzIDoNCisgICAgew0KKyAgICAgIGNoZWNrIDog
Ik51bWJlciIsDQorICAgICAgaW5pdCA6IDEwMDAsDQorICAgICAgYXBwbHkgOiAiX2FwcGx5TWF4
Q2FjaGVMaW5lcyINCisgICAgfQ0KKw0KKyAgfSwNCisNCisNCisNCisNCisgIC8qDQorICAqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKg0KKyAgICAgTUVNQkVSUw0KKyAgKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioN
CisgICovDQorDQorICBtZW1iZXJzIDoNCisgIHsNCisgICAgLy8gcHJvcGVydHkgbW9kaWZpZXIN
CisgICAgX2FwcGx5Rmlyc3RWaXNpYmxlUm93IDogZnVuY3Rpb24odmFsdWUsIG9sZCkgew0KKyAg
ICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnQoZmFsc2UsIHZhbHVlLW9sZCk7DQorICAgIH0sDQorDQor
ICAgIC8vIHByb3BlcnR5IG1vZGlmaWVyDQorICAgIF9hcHBseVZpc2libGVSb3dDb3VudCA6IGZ1
bmN0aW9uKHZhbHVlLCBvbGQpIHsNCisgICAgICB0aGlzLl91cGRhdGVDb250ZW50KCk7DQorICAg
IH0sDQorDQorDQorICAgIC8vIG92ZXJyaWRkZW4NCisgICAgX2FmdGVyQXBwZWFyIDogZnVuY3Rp
b24oKQ0KKyAgICB7DQorICAgICAgdGhpcy5iYXNlKGFyZ3VtZW50cyk7DQorDQorICAgICAgaWYg
KHRoaXMuX3VwZGF0ZVdhbnRlZFdoaWxlTm90Q3JlYXRlZCkNCisgICAgICB7DQorICAgICAgICAv
LyBXZSBhcmUgY3JlYXRlZCBub3cgYW5kIGFuIHVwZGF0ZSB3YXMgd2FudGVkIGJlZm9yZSB3ZSB3
ZXJlIGNyZWF0ZWQNCisgICAgICAgIC8vIC0+IERvIHRoZSB1cGRhdGUgbm93DQorICAgICAgICB0
aGlzLl91cGRhdGVDb250ZW50KCk7DQorICAgICAgICB0aGlzLl91cGRhdGVXYW50ZWRXaGlsZU5v
dENyZWF0ZWQgPSBmYWxzZTsNCisgICAgICB9DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAg
ICAgKiBSZXR1cm5zIHRoZSBUYWJsZVBhbmVTY3JvbGxlciB0aGlzIHBhbmUgYmVsb25ncyB0by4N
CisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEByZXR1cm4ge3F4LnVpLnRh
YmxlLnBhbmUuU2Nyb2xsZXJ9IHRoZSBUYWJsZVBhbmVTY3JvbGxlci4NCisgICAgICovDQorICAg
IGdldFBhbmVTY3JvbGxlciA6IGZ1bmN0aW9uKCkgew0KKyAgICAgIHJldHVybiB0aGlzLl9wYW5l
U2Nyb2xsZXI7DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBSZXR1cm5zIHRoZSB0
YWJsZSB0aGlzIHBhbmUgYmVsb25ncyB0by4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVy
DQorICAgICAqIEByZXR1cm4ge3F4LnVpLnRhYmxlLlRhYmxlfSB0aGUgdGFibGUuDQorICAgICAq
Lw0KKyAgICBnZXRUYWJsZSA6IGZ1bmN0aW9uKCkgew0KKyAgICAgIHJldHVybiB0aGlzLl9wYW5l
U2Nyb2xsZXIuZ2V0VGFibGUoKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFNl
dHMgdGhlIGN1cnJlbnRseSBmb2N1c2VkIGNlbGwuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1l
bWJlcg0KKyAgICAgKiBAcGFyYW0gY29sIHtJbnRlZ2VyfSB0aGUgbW9kZWwgaW5kZXggb2YgdGhl
IGZvY3VzZWQgY2VsbCdzIGNvbHVtbi4NCisgICAgICogQHBhcmFtIHJvdyB7SW50ZWdlcn0gdGhl
IG1vZGVsIGluZGV4IG9mIHRoZSBmb2N1c2VkIGNlbGwncyByb3cuDQorICAgICAqIEBwYXJhbSBt
YXNzVXBkYXRlIHtCb29sZWFuID8gZmFsc2V9IFdoZXRoZXIgb3RoZXIgdXBkYXRlcyBhcmUgcGxh
bm5lZCBhcyB3ZWxsLg0KKyAgICAgKiAgICAgICAgICBJZiB0cnVlLCBubyByZXBhaW50IHdpbGwg
YmUgZG9uZS4NCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIHNldEZvY3Vz
ZWRDZWxsIDogZnVuY3Rpb24oY29sLCByb3csIG1hc3NVcGRhdGUpDQorICAgIHsNCisgICAgICBp
ZiAoY29sICE9IHRoaXMuX2ZvY3VzZWRDb2wgfHwgcm93ICE9IHRoaXMuX2ZvY3VzZWRSb3cpDQor
ICAgICAgew0KKyAgICAgICAgdmFyIG9sZFJvdyA9IHRoaXMuX2ZvY3VzZWRSb3c7DQorICAgICAg
ICB0aGlzLl9mb2N1c2VkQ29sID0gY29sOw0KKyAgICAgICAgdGhpcy5fZm9jdXNlZFJvdyA9IHJv
dzsNCisNCisgICAgICAgIC8vIFVwZGF0ZSB0aGUgZm9jdXNlZCByb3cgYmFja2dyb3VuZA0KKyAg
ICAgICAgaWYgKHJvdyAhPSBvbGRSb3cgJiYgIW1hc3NVcGRhdGUpDQorICAgICAgICB7DQorICAg
ICAgICAgIC8vIE5PVEU6IE9ubHkgdGhlIG9sZCBhbmQgdGhlIG5ldyByb3cgbmVlZCB1cGRhdGUN
CisgICAgICAgICAgdGhpcy5fdXBkYXRlQ29udGVudChmYWxzZSwgbnVsbCwgb2xkUm93LCB0cnVl
KTsNCisgICAgICAgICAgdGhpcy5fdXBkYXRlQ29udGVudChmYWxzZSwgbnVsbCwgcm93LCB0cnVl
KTsNCisgICAgICAgIH0NCisgICAgICB9DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAg
KiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgc2VsZWN0aW9uIGhhcyBjaGFuZ2VkLg0K
KyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICogQHBhcmFtIGV2dCB7TWFwfSB0
aGUgZXZlbnQuDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0KKyAgICBfb25TZWxl
Y3Rpb25DaGFuZ2VkIDogZnVuY3Rpb24oZXZ0KSB7DQorICAgICAgdGhpcy5fdXBkYXRlQ29udGVu
dChmYWxzZSwgbnVsbCwgbnVsbCwgdHJ1ZSk7DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAg
ICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgZ2V0cyBvciBsb29zZXMg
dGhlIGZvY3VzLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICogQHBhcmFt
IGV2dCB7TWFwfSB0aGUgZXZlbnQuDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0K
KyAgICBfb25Gb2N1c0NoYW5nZWQgOiBmdW5jdGlvbihldnQpIHsNCisgICAgICB0aGlzLl91cGRh
dGVDb250ZW50KGZhbHNlLCBudWxsLCBudWxsLCB0cnVlKTsNCisgICAgfSwNCisNCisNCisgICAg
LyoqDQorICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB3aWR0aCBvZiBhIGNv
bHVtbiBoYXMgY2hhbmdlZC4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAq
IEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50Lg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAg
ICAgKi8NCisgICAgX29uQ29sV2lkdGhDaGFuZ2VkIDogZnVuY3Rpb24oZXZ0KSB7DQorICAgICAg
dGhpcy5fdXBkYXRlQ29udGVudCh0cnVlKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAg
ICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB0aGUgY29sdW1uIG9yZGVyIGhhcyBjaGFuZ2VkLg0K
KyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICogQHBhcmFtIGV2dCB7TWFwfSB0
aGUgZXZlbnQuDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0KKyAgICBfb25Db2xP
cmRlckNoYW5nZWQgOiBmdW5jdGlvbihldnQpIHsNCisgICAgICB0aGlzLl91cGRhdGVDb250ZW50
KHRydWUpOw0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogRXZlbnQgaGFuZGxlci4g
Q2FsbGVkIHdoZW4gdGhlIHBhbmUgbW9kZWwgaGFzIGNoYW5nZWQuDQorICAgICAqDQorICAgICAq
IEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisgICAg
ICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9vblBhbmVNb2RlbENoYW5nZWQgOiBm
dW5jdGlvbihldnQpIHsNCisgICAgICB0aGlzLl91cGRhdGVDb250ZW50KHRydWUpOw0KKyAgICB9
LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhl
IHRhYmxlIG1vZGVsIGRhdGEgaGFzIGNoYW5nZWQuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1l
bWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisgICAgICogQHJldHVy
biB7dm9pZH0NCisgICAgICovDQorICAgIF9vblRhYmxlTW9kZWxEYXRhQ2hhbmdlZCA6IGZ1bmN0
aW9uKGV2dCkNCisgICAgew0KKyAgICAgIHZhciBkYXRhID0gZXZ0LmdldERhdGEgPyBldnQuZ2V0
RGF0YSgpIDogbnVsbDsNCisgICAgICB0aGlzLl9fcm93Q2FjaGVDbGVhcigpOw0KKw0KKyAgICAg
IHZhciBmaXJzdFJvdyA9IHRoaXMuZ2V0Rmlyc3RWaXNpYmxlUm93KCk7DQorICAgICAgdmFyIHJv
d0NvdW50ID0gdGhpcy5nZXRWaXNpYmxlUm93Q291bnQoKTsNCisNCisgICAgICBpZiAoZGF0YSA9
PSBudWxsIHx8IGRhdGEubGFzdFJvdyA9PSAtMSB8fCBkYXRhLmxhc3RSb3cgPj0gZmlyc3RSb3cg
JiYgZGF0YS5maXJzdFJvdyA8IGZpcnN0Um93ICsgcm93Q291bnQpDQorICAgICAgew0KKyAgICAg
ICAgLy8gVGhlIGNoYW5nZSBpbnRlcnNlY3RzIHRoaXMgcGFuZQ0KKyAgICAgICAgdGhpcy5fdXBk
YXRlQ29udGVudCgpOw0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAq
IEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB0YWJsZSBtb2RlbCBtZXRhIGRhdGEgaGFz
IGNoYW5nZWQuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0g
ZXZ0IHtNYXB9IHRoZSBldmVudC4NCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQor
ICAgIF9vblRhYmxlTW9kZWxNZXRhRGF0YUNoYW5nZWQgOiBmdW5jdGlvbihldnQpIHsNCisgICAg
ICB0aGlzLl91cGRhdGVDb250ZW50KHRydWUpOw0KKyAgICB9LA0KKw0KKw0KKyAgICAvLyBzcGFy
c2UgYXJyYXkgdG8gY2FjaGUgcmVuZGVyZWQgcm93cw0KKyAgICBfX3Jvd0NhY2hlIDogW10sDQor
ICAgIF9fcm93Q2FjaGVDb3VudCA6IDAsDQorDQorDQorICAgIC8vIHByb3BlcnR5IGFwcGx5IG1l
dGhvZA0KKyAgICBfYXBwbHlNYXhDYWNoZUxpbmVzIDogZnVuY3Rpb24odmFsdWUsIG9sZCkNCisg
ICAgew0KKyAgICAgIGlmICh0aGlzLl9fcm93Q2FjaGVDb3VudCA+PSB2YWx1ZSAmJiB2YWx1ZSAh
PT0gLTEpIHsNCisgICAgICAgIHRoaXMuX19yb3dDYWNoZUNsZWFyKCk7DQorICAgICAgfQ0KKyAg
ICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogQ2xlYXIgdGhlIHJvdyBjYWNoZQ0KKyAgICAg
Ki8NCisgICAgX19yb3dDYWNoZUNsZWFyIDogZnVuY3Rpb24oKSB7DQorICAgICAgdGhpcy5fX3Jv
d0NhY2hlID0gW107DQorICAgICAgdGhpcy5fX3Jvd0NhY2hlQ291bnQgPSAwOw0KKyAgICB9LA0K
Kw0KKw0KKyAgICAvKioNCisgICAgICogR2V0IGEgbGluZSBmcm9tIHRoZSByb3cgY2FjaGUuDQor
ICAgICAqDQorICAgICAqIEBwYXJhbSByb3cge0ludGVnZXJ9IFJvdyBpbmRleCB0byBnZXQNCisg
ICAgICogQHBhcmFtIHNlbGVjdGVkIHtCb29sZWFufSBXaGV0aGVyIHRoZSByb3cgaXMgY3VycmVu
dGx5IHNlbGVjdGVkDQorICAgICAqIEBwYXJhbSBmb2N1c2VkIHtCb29sZWFufSBXaGV0aGVyIHRo
ZSByb3cgaXMgY3VycmVudGx5IGZvY3VzZWQNCisgICAgICogQHJldHVybiB7U3RyaW5nfG51bGx9
IFRoZSBjYWNoZWQgcm93IG9yIG51bGwgaWYgYSByb3cgd2l0aCB0aGUgZ2l2ZW4NCisgICAgICog
ICAgIGluZGV4IGlzIG5vdCBjYWNoZWQuDQorICAgICAqLw0KKyAgICBfX3Jvd0NhY2hlR2V0IDog
ZnVuY3Rpb24ocm93LCBzZWxlY3RlZCwgZm9jdXNlZCkNCisgICAgew0KKyAgICAgIGlmICghc2Vs
ZWN0ZWQgJiYgIWZvY3VzZWQgJiYgdGhpcy5fX3Jvd0NhY2hlW3Jvd10pIHsNCisgICAgICAgIHJl
dHVybiB0aGlzLl9fcm93Q2FjaGVbcm93XTsNCisgICAgICB9IGVsc2Ugew0KKyAgICAgICAgcmV0
dXJuIG51bGw7DQorICAgICAgfQ0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogQWRk
IGEgbGluZSB0byB0aGUgcm93IGNhY2hlLg0KKyAgICAgKg0KKyAgICAgKiBAcGFyYW0gcm93IHtJ
bnRlZ2VyfSBSb3cgaW5kZXggdG8gc2V0DQorICAgICAqIEBwYXJhbSByb3dTdHJpbmcge1N0cmlu
Z30gY29tcHV0ZWQgcm93IHN0cmluZyB0byBjYWNoZQ0KKyAgICAgKiBAcGFyYW0gc2VsZWN0ZWQg
e0Jvb2xlYW59IFdoZXRoZXIgdGhlIHJvdyBpcyBjdXJyZW50bHkgc2VsZWN0ZWQNCisgICAgICog
QHBhcmFtIGZvY3VzZWQge0Jvb2xlYW59IFdoZXRoZXIgdGhlIHJvdyBpcyBjdXJyZW50bHkgZm9j
dXNlZA0KKyAgICAgKi8NCisgICAgX19yb3dDYWNoZVNldCA6IGZ1bmN0aW9uKHJvdywgcm93U3Ry
aW5nLCBzZWxlY3RlZCwgZm9jdXNlZCkNCisgICAgew0KKyAgICAgIGlmICghc2VsZWN0ZWQgJiYg
IWZvY3VzZWQgJiYgIXRoaXMuX19yb3dDYWNoZVtyb3ddKSB7DQorICAgICAgICB0aGlzLl9hcHBs
eU1heENhY2hlTGluZXModGhpcy5nZXRNYXhDYWNoZUxpbmVzKCkpOw0KKyAgICAgICAgdGhpcy5f
X3Jvd0NhY2hlW3Jvd10gPSByb3dTdHJpbmc7DQorICAgICAgICB0aGlzLl9fcm93Q2FjaGVDb3Vu
dCArPSAxOw0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFVwZGF0
ZXMgdGhlIGNvbnRlbnQgb2YgdGhlIHBhbmUuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJl
cg0KKyAgICAgKiBAcGFyYW0gY29tcGxldGVVcGRhdGUge0Jvb2xlYW4gPyBmYWxzZX0gaWYgdHJ1
ZSBhIGNvbXBsZXRlIHVwZGF0ZSBpcyBwZXJmb3JtZWQuDQorICAgICAqICAgICAgT24gYSBjb21w
bGV0ZSB1cGRhdGUgYWxsIGNlbGwgd2lkZ2V0cyBhcmUgcmVjcmVhdGVkLg0KKyAgICAgKiBAcGFy
YW0gc2Nyb2xsT2Zmc2V0IHtJbnRlZ2VyID8gbnVsbH0gSWYgc2V0IHNwZWNpZmllcyBob3cgbWFu
eSByb3dzIHRvIHNjcm9sbC4NCisgICAgICogQHBhcmFtIG9ubHlSb3cge0ludGVnZXIgPyBudWxs
fSBpZiBzZXQgb25seSB0aGUgc3BlY2lmaWVkIHJvdyB3aWxsIGJlIHVwZGF0ZWQuDQorICAgICAq
IEBwYXJhbSBvbmx5U2VsZWN0aW9uT3JGb2N1c0NoYW5nZWQge0Jvb2xlYW4gPyBmYWxzZX0gaWYg
dHJ1ZSwgY2VsbCB2YWx1ZXMgd29uJ3QNCisgICAgICogICAgICAgICAgYmUgdXBkYXRlZC4gT25s
eSB0aGUgcm93IGJhY2tncm91bmQgd2lsbC4NCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAg
ICovDQorICAgIF91cGRhdGVDb250ZW50IDogZnVuY3Rpb24oY29tcGxldGVVcGRhdGUsIHNjcm9s
bE9mZnNldCwgb25seVJvdywgb25seVNlbGVjdGlvbk9yRm9jdXNDaGFuZ2VkKQ0KKyAgICB7DQor
ICAgICAgaWYgKGNvbXBsZXRlVXBkYXRlKSB7DQorICAgICAgICB0aGlzLl9fcm93Q2FjaGVDbGVh
cigpOw0KKyAgICAgIH0NCisNCisgICAgICBpZiAoIXRoaXMuaXNDcmVhdGVkKCkpDQorICAgICAg
ew0KKyAgICAgICAgdGhpcy5fdXBkYXRlV2FudGVkV2hpbGVOb3RDcmVhdGVkID0gdHJ1ZTsNCisg
ICAgICAgIHJldHVybjsNCisgICAgICB9DQorDQorICAgICAgaWYgKHRoaXMuX2xheW91dFBlbmRp
bmcpDQorICAgICAgew0KKyAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLl9sYXlvdXRQ
ZW5kaW5nKTsNCisgICAgICAgIHRoaXMuX3VwZGF0ZUFsbFJvd3MoKTsNCisgICAgICAgIHJldHVy
bjsNCisgICAgICB9DQorDQorICAgICAgLy92YXIgc3RhcnQgPSBuZXcgRGF0ZSgpOw0KKw0KKyAg
ICAgIGlmIChzY3JvbGxPZmZzZXQgJiYgTWF0aC5hYnMoc2Nyb2xsT2Zmc2V0KSA8PSBNYXRoLm1p
bigxMCwgdGhpcy5nZXRWaXNpYmxlUm93Q291bnQoKSkpDQorICAgICAgew0KKyAgICAgICAgLy90
aGlzLmRlYnVnKCJzY3JvbGwiLCBzY3JvbGxPZmZzZXQpOw0KKyAgICAgICAgdGhpcy5fc2Nyb2xs
Q29udGVudChzY3JvbGxPZmZzZXQpOw0KKyAgICAgIH0NCisgICAgICBlbHNlIGlmIChvbmx5U2Vs
ZWN0aW9uT3JGb2N1c0NoYW5nZWQgJiYgIXRoaXMuZ2V0VGFibGUoKS5nZXRBbHdheXNVcGRhdGVD
ZWxscygpKQ0KKyAgICAgIHsNCisgICAgICAgIC8vdGhpcy5kZWJ1ZygidXBkYXRlIHJvdyBzdHls
ZXMiKTsNCisgICAgICAgIHRoaXMuX3VwZGF0ZVJvd1N0eWxlcyhvbmx5Um93KTsNCisgICAgICB9
DQorICAgICAgZWxzZQ0KKyAgICAgIHsNCisgICAgICAgIC8vdGhpcy5kZWJ1ZygiZnVsbCB1cGRh
dGUiKTsNCisgICAgICAgIHRoaXMuX3VwZGF0ZUFsbFJvd3MoKTsNCisgICAgICB9DQorDQorICAg
ICAgLy90aGlzLmRlYnVnKCJyZW5kZXIgdGltZTogIiArIChuZXcgRGF0ZSgpIC0gc3RhcnQpICsg
Im1zIik7DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBJZiBvbmx5IGZvY3VzIG9y
IHNlbGVjdGlvbiBjaGFuZ2VzIGl0IGlzIHN1ZmZpY2llbnQgdG8gb25seSB1cGRhdGUgdGhlDQor
ICAgICAqIHJvdyBzdHlsZXMuIFRoaXMgbWV0aG9kIHVwZGF0ZXMgdGhlIHJvdyBzdHlsZXMgb2Yg
YWxsIHZpc2libGUgcm93cyBvcg0KKyAgICAgKiBvZiBqdXN0IG9uZSByb3cuDQorICAgICAqDQor
ICAgICAqIEBwYXJhbSBvbmx5Um93IHtJbnRlZ2VyfG51bGwgPyBudWxsfSBJZiB0aGlzIHBhcmFt
ZXRlciBpcyBzZXQgb25seSB0aGUgcm93DQorICAgICAqICAgICB3aXRoIHRoaXMgaW5kZXggaXMg
dXBkYXRlZC4NCisgICAgICovDQorICAgIF91cGRhdGVSb3dTdHlsZXMgOiBmdW5jdGlvbihvbmx5
Um93KQ0KKyAgICB7DQorICAgICAgdmFyIGVsZW0gPSB0aGlzLmdldEVsZW1lbnQoKTsNCisgICAg
ICBpZiAoIWVsZW0uZmlyc3RDaGlsZCkgew0KKyAgICAgICAgdGhpcy5fdXBkYXRlQWxsUm93cygp
Ow0KKyAgICAgICAgcmV0dXJuOw0KKyAgICAgIH0NCisNCisgICAgICB2YXIgdGFibGUgPSB0aGlz
LmdldFRhYmxlKCk7DQorICAgICAgdmFyIHNlbGVjdGlvbk1vZGVsID0gdGFibGUuZ2V0U2VsZWN0
aW9uTW9kZWwoKTsNCisgICAgICB2YXIgdGFibGVNb2RlbCA9IHRhYmxlLmdldFRhYmxlTW9kZWwo
KTsNCisgICAgICB2YXIgcm93UmVuZGVyZXIgPSB0YWJsZS5nZXREYXRhUm93UmVuZGVyZXIoKTsN
CisgICAgICB2YXIgcm93Tm9kZXMgPSBlbGVtLmZpcnN0Q2hpbGQuY2hpbGROb2RlczsNCisgICAg
ICB2YXIgY2VsbEluZm8gPSB7IHRhYmxlIDogdGFibGUgfTsNCisNCisgICAgICAvLyBXZSBkb24n
dCB3YW50IHRvIGV4ZWN1dGUgdGhlIHJvdyBsb29wIGJlbG93IG1vcmUgdGhhbiBuZWNlc3Nhcnku
IElmDQorICAgICAgLy8gb25seXJvdyBpcyBub3QgbnVsbCwgd2Ugd2FudCB0byBkbyB0aGUgbG9v
cCBvbmx5IGZvciB0aGF0IHJvdy4NCisgICAgICAvLyBJbiB0aGF0IGNhc2UsIHdhcyBzdGFydCBh
dCAoc2V0IHRoZSAicm93IiB2YXJpYWJsZSB0bykgdGhhdCByb3csIGFuZA0KKyAgICAgIC8vIHN0
b3AgYXQgKHNldCB0aGUgImVuZCIgdmFyaWFibGUgdG8gdGhlIG9mZnNldCBvZikgdGhlIG5leHQg
cm93OyAuDQorICAgICAgdmFyIHJvdyA9IHRoaXMuZ2V0Rmlyc3RWaXNpYmxlUm93KCk7DQorICAg
ICAgdmFyIHkgPSAwOw0KKw0KKyAgICAgIC8vIEhvdyBtYW55IHJvd3MgZG8gd2UgbmVlZCB0byB1
cGRhdGU/DQorICAgICAgdmFyIGVuZCA9IHJvd05vZGVzLmxlbmd0aDsNCisNCisgICAgICBpZiAo
b25seVJvdyAhPSBudWxsKQ0KKyAgICAgIHsNCisgICAgICAgIC8vIEhvdyBtYW55IHJvd3MgYXJl
IHdlIHNraXBwaW5nPw0KKyAgICAgICAgdmFyIG9mZnNldCA9IG9ubHlSb3cgLSByb3c7DQorICAg
ICAgICBpZiAob2Zmc2V0ID49IDAgJiYgb2Zmc2V0IDwgZW5kKQ0KKyAgICAgICAgew0KKyAgICAg
ICAgICByb3cgPSBvbmx5Um93Ow0KKyAgICAgICAgICB5ID0gb2Zmc2V0Ow0KKyAgICAgICAgICBl
bmQgPSBvZmZzZXQgKyAxOw0KKyAgICAgICAgfQ0KKyAgICAgICAgZWxzZQ0KKyAgICAgICAgICBy
ZXR1cm47DQorICAgICAgfQ0KKw0KKyAgICAgIGZvciAoOyB5PGVuZDsgeSsrLCByb3crKykNCisg
ICAgICB7DQorICAgICAgICBjZWxsSW5mby5yb3cgPSByb3c7DQorICAgICAgICBjZWxsSW5mby5z
ZWxlY3RlZCA9IHNlbGVjdGlvbk1vZGVsLmlzU2VsZWN0ZWRJbmRleChyb3cpOw0KKyAgICAgICAg
Y2VsbEluZm8uZm9jdXNlZFJvdyA9ICh0aGlzLl9mb2N1c2VkUm93ID09IHJvdyk7DQorICAgICAg
ICBjZWxsSW5mby5yb3dEYXRhID0gdGFibGVNb2RlbC5nZXRSb3dEYXRhKHJvdyk7DQorDQorICAg
ICAgICByb3dSZW5kZXJlci51cGRhdGVEYXRhUm93RWxlbWVudChjZWxsSW5mbywgcm93Tm9kZXNb
eV0pOw0KKyAgICAgIH07DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBHZXQgdGhl
IEhUTUwgdGFibGUgZnJhZ21lbnQgZm9yIHRoZSBnaXZlbiByb3cgcmFuZ2UuDQorICAgICAqDQor
ICAgICAqIEBwYXJhbSBmaXJzdFJvdyB7SW50ZWdlcn0gSW5kZXggb2YgdGhlIGZpcnN0IHJvdw0K
KyAgICAgKiBAcGFyYW0gcm93Q291bnQge0ludGVnZXJ9IE51bWJlciBvZiByb3dzDQorICAgICAq
IEByZXR1cm4ge1N0cmluZ30gVGhlIEhUTUwgdGFibGUgZnJhZ21lbnQgZm9yIHRoZSBnaXZlbiBy
b3cgcmFuZ2UuDQorICAgICAqLw0KKyAgICBfZ2V0Um93c0h0bWwgOiBmdW5jdGlvbihmaXJzdFJv
dywgcm93Q291bnQpDQorICAgIHsNCisgICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7
DQorDQorICAgICAgdmFyIHNlbGVjdGlvbk1vZGVsID0gdGFibGUuZ2V0U2VsZWN0aW9uTW9kZWwo
KTsNCisgICAgICB2YXIgdGFibGVNb2RlbCA9IHRhYmxlLmdldFRhYmxlTW9kZWwoKTsNCisgICAg
ICB2YXIgY29sdW1uTW9kZWwgPSB0YWJsZS5nZXRUYWJsZUNvbHVtbk1vZGVsKCk7DQorICAgICAg
dmFyIHBhbmVNb2RlbCA9IHRoaXMuZ2V0UGFuZVNjcm9sbGVyKCkuZ2V0VGFibGVQYW5lTW9kZWwo
KTsNCisgICAgICB2YXIgcm93UmVuZGVyZXIgPSB0YWJsZS5nZXREYXRhUm93UmVuZGVyZXIoKTsN
CisNCisgICAgICB0YWJsZU1vZGVsLnByZWZldGNoUm93cyhmaXJzdFJvdywgZmlyc3RSb3cgKyBy
b3dDb3VudCAtIDEpOw0KKw0KKyAgICAgIHZhciByb3dIZWlnaHQgPSB0YWJsZS5nZXRSb3dIZWln
aHQoKTsNCisgICAgICB2YXIgY29sQ291bnQgPSBwYW5lTW9kZWwuZ2V0Q29sdW1uQ291bnQoKTsN
CisgICAgICB2YXIgbGVmdCA9IDA7DQorICAgICAgdmFyIGNvbHMgPSBbXTsNCisNCisgICAgICAv
LyBwcmVjb21wdXRlIGNvbHVtbiBwcm9wZXJ0aWVzDQorICAgICAgZm9yICh2YXIgeD0wOyB4PGNv
bENvdW50OyB4KyspDQorICAgICAgew0KKyAgICAgICAgdmFyIGNvbCA9IHBhbmVNb2RlbC5nZXRD
b2x1bW5BdFgoeCk7DQorICAgICAgICB2YXIgY2VsbFdpZHRoID0gY29sdW1uTW9kZWwuZ2V0Q29s
dW1uV2lkdGgoY29sKTsNCisgICAgICAgIGNvbHMucHVzaCh7DQorICAgICAgICAgIGNvbDogY29s
LA0KKyAgICAgICAgICB4UG9zOiB4LA0KKyAgICAgICAgICBlZGl0YWJsZTogdGFibGVNb2RlbC5p
c0NvbHVtbkVkaXRhYmxlKGNvbCksDQorICAgICAgICAgIGZvY3VzZWRDb2w6IHRoaXMuX2ZvY3Vz
ZWRDb2wgPT0gY29sLA0KKyAgICAgICAgICBzdHlsZUxlZnQ6IGxlZnQsDQorICAgICAgICAgIHN0
eWxlV2lkdGg6IGNlbGxXaWR0aA0KKyAgICAgICAgfSk7DQorDQorICAgICAgICBsZWZ0ICs9IGNl
bGxXaWR0aDsNCisgICAgICB9DQorDQorICAgICAgdmFyIHJvd3NBcnIgPSBbXTsNCisgICAgICBm
b3IgKHZhciByb3c9Zmlyc3RSb3c7IHJvdyA8IGZpcnN0Um93ICsgcm93Q291bnQ7IHJvdysrKQ0K
KyAgICAgIHsNCisgICAgICAgIHZhciBzZWxlY3RlZCA9IHNlbGVjdGlvbk1vZGVsLmlzU2VsZWN0
ZWRJbmRleChyb3cpOw0KKyAgICAgICAgdmFyIGZvY3VzZWRSb3cgPSAodGhpcy5fZm9jdXNlZFJv
dyA9PSByb3cpOw0KKw0KKyAgICAgICAgdmFyIGNhY2hlZFJvdyA9IHRoaXMuX19yb3dDYWNoZUdl
dChyb3csIHNlbGVjdGVkLCBmb2N1c2VkUm93KTsNCisgICAgICAgIGlmIChjYWNoZWRSb3cpIHsN
CisgICAgICAgICAgcm93c0Fyci5wdXNoKGNhY2hlZFJvdyk7DQorICAgICAgICAgIGNvbnRpbnVl
Ow0KKyAgICAgICAgfQ0KKw0KKyAgICAgICAgdmFyIHJvd0h0bWwgPSBbXTsNCisNCisgICAgICAg
IHZhciBjZWxsSW5mbyA9IHsgdGFibGUgOiB0YWJsZSB9Ow0KKyAgICAgICAgY2VsbEluZm8uc3R5
bGVIZWlnaHQgPSByb3dIZWlnaHQ7DQorDQorICAgICAgICBjZWxsSW5mby5yb3cgPSByb3c7DQor
ICAgICAgICBjZWxsSW5mby5zZWxlY3RlZCA9IHNlbGVjdGVkOw0KKyAgICAgICAgY2VsbEluZm8u
Zm9jdXNlZFJvdyA9IGZvY3VzZWRSb3c7DQorICAgICAgICBjZWxsSW5mby5yb3dEYXRhID0gdGFi
bGVNb2RlbC5nZXRSb3dEYXRhKHJvdyk7DQorDQorICAgICAgICByb3dIdG1sLnB1c2goJzxkaXYg
Jyk7DQorDQorICAgICAgICB2YXIgcm93Q2xhc3MgPSByb3dSZW5kZXJlci5nZXRSb3dDbGFzcyhj
ZWxsSW5mbyk7DQorICAgICAgICBpZiAocm93Q2xhc3MpIHsNCisgICAgICAgICAgcm93SHRtbC5w
dXNoKCdjbGFzcz0iJywgcm93Q2xhc3MsICciICcpOw0KKyAgICAgICAgfQ0KKw0KKyAgICAgICAg
dmFyIHJvd1N0eWxlID0gcm93UmVuZGVyZXIuY3JlYXRlUm93U3R5bGUoY2VsbEluZm8pOw0KKyAg
ICAgICAgcm93U3R5bGUgKz0gIjtwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6IiArIHJvd0hlaWdo
dCArICJweDsgd2lkdGg6IiArIHBhbmVNb2RlbC5nZXRUb3RhbFdpZHRoKCkgKyAicHg7IjsNCisg
ICAgICAgIGlmIChyb3dTdHlsZSkgew0KKyAgICAgICAgICByb3dIdG1sLnB1c2goJ3N0eWxlPSIn
LCByb3dTdHlsZSwgJyIgJyk7DQorICAgICAgICB9DQorICAgICAgICByb3dIdG1sLnB1c2goJz4n
KTsNCisNCisgICAgICAgIGZvciAodmFyIHg9MDsgeDxjb2xDb3VudDsgeCsrKQ0KKyAgICAgICAg
ew0KKyAgICAgICAgICB2YXIgY29sX2RlZiA9IGNvbHNbeF07DQorICAgICAgICAgIGZvciAodmFy
IGF0dHIgaW4gY29sX2RlZikgew0KKyAgICAgICAgICAgIGNlbGxJbmZvW2F0dHJdID0gY29sX2Rl
ZlthdHRyXTsNCisgICAgICAgICAgfQ0KKyAgICAgICAgICB2YXIgY29sID0gY2VsbEluZm8uY29s
Ow0KKw0KKyAgICAgICAgICAvLyBBQjogdXNlIHRoZSAiZ2V0VmFsdWUiIG1ldGhvZCBvZiB0aGUg
dGFibGVNb2RlbCB0byBnZXQgdGhlIGNlbGwncyB2YWx1ZQ0KKyAgICAgICAgICAvLyB3b3JraW5n
IGRpcmVjdGx5IG9uIHRoZSAicm93RGF0YSIgb2JqZWN0ICgtPiBjZWxsSW5mby5yb3dEYXRhW2Nv
bF07KSBpcyBub3QgYSBzb2x1dGlvbg0KKyAgICAgICAgICAvLyBiZWNhdXNlIHlvdSBjYW4ndCB3
b3JrIHdpdGggdGhlIGNvbHVtbkluZGV4IC0+IHlvdSBoYXZlIHRvIHVzZSB0aGUgY29sdW1uSWQg
b2YgdGhlIGNvbHVtbkluZGV4DQorICAgICAgICAgIC8vIFRoaXMgaXMgZXhhY3RseSB3aGF0IHRo
ZSBtZXRob2QgImdldFZhbHVlIiBkb2VzDQorICAgICAgICAgIGNlbGxJbmZvLnZhbHVlID0gdGFi
bGVNb2RlbC5nZXRWYWx1ZShjb2wsIHJvdyk7DQorICAgICAgICAgIHZhciBjZWxsUmVuZGVyZXIg
PSBjb2x1bW5Nb2RlbC5nZXREYXRhQ2VsbFJlbmRlcmVyKGNvbCk7DQorICAgICAgICAgIGNlbGxS
ZW5kZXJlci5jcmVhdGVEYXRhQ2VsbEh0bWwoY2VsbEluZm8sIHJvd0h0bWwpOw0KKyAgICAgICAg
fQ0KKyAgICAgICAgcm93SHRtbC5wdXNoKCc8L2Rpdj4nKTsNCisNCisgICAgICAgIHZhciByb3dT
dHJpbmcgPSByb3dIdG1sLmpvaW4oIiIpOw0KKw0KKyAgICAgICAgdGhpcy5fX3Jvd0NhY2hlU2V0
KHJvdywgcm93U3RyaW5nLCBzZWxlY3RlZCwgZm9jdXNlZFJvdyk7DQorICAgICAgICByb3dzQXJy
LnB1c2gocm93U3RyaW5nKTsNCisgICAgICB9DQorICAgICAgcmV0dXJuIHJvd3NBcnIuam9pbigi
Iik7DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBTY3JvbGxzIHRoZSBwYW5lJ3Mg
Y29udGVudHMgYnkgdGhlIGdpdmVuIG9mZnNldC4NCisgICAgICoNCisgICAgICogQHBhcmFtIHJv
d09mZnNldCB7SW50ZWdlcn0gTnVtYmVyIG9mIGxpbmVzIHRvIHNjcm9sbC4gU2Nyb2xsaW5nIHVw
IGlzDQorICAgICAqICAgICByZXByZXNlbnRlZCBieSBhIG5lZ2F0aXZlIG9mZnNldC4NCisgICAg
ICovDQorICAgIF9zY3JvbGxDb250ZW50IDogZnVuY3Rpb24ocm93T2Zmc2V0KQ0KKyAgICB7DQor
ICAgICAgaWYgKCF0aGlzLmdldEVsZW1lbnQoKS5maXJzdENoaWxkKSB7DQorICAgICAgICB0aGlz
Ll91cGRhdGVBbGxSb3dzKCk7DQorICAgICAgICByZXR1cm47DQorICAgICAgfQ0KKw0KKyAgICAg
IHZhciB0YWJsZUJvZHkgPSB0aGlzLmdldEVsZW1lbnQoKS5maXJzdENoaWxkOw0KKyAgICAgIHZh
ciB0YWJsZUNoaWxkTm9kZXMgPSB0YWJsZUJvZHkuY2hpbGROb2RlczsNCisgICAgICB2YXIgcm93
Q291bnQgPSB0aGlzLmdldFZpc2libGVSb3dDb3VudCgpOw0KKyAgICAgIHZhciBmaXJzdFJvdyA9
IHRoaXMuZ2V0Rmlyc3RWaXNpYmxlUm93KCk7DQorDQorDQorICAgICAgdmFyIG1vZGVsUm93Q291
bnQgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVNb2RlbCgpLmdldFJvd0NvdW50KCk7DQorDQor
ICAgICAgLy8gZG9uJ3QgaGFuZGxlIHRoaXMgc3BlY2lhbCBjYXNlIGhlcmUNCisgICAgICBpZiAo
Zmlyc3RSb3cgKyByb3dDb3VudCA+IG1vZGVsUm93Q291bnQpIHsNCisgICAgICAgIHRoaXMuX3Vw
ZGF0ZUFsbFJvd3MoKTsNCisgICAgICAgIHJldHVybjsNCisgICAgICB9DQorDQorICAgICAgLy8g
cmVtb3ZlIG9sZCBsaW5lcw0KKyAgICAgIHZhciByZW1vdmVSb3dCYXNlID0gcm93T2Zmc2V0IDwg
MCA/IHJvd0NvdW50ICsgcm93T2Zmc2V0IDogMDsNCisgICAgICB2YXIgYWRkUm93QmFzZSA9IHJv
d09mZnNldCA8IDAgPyAwOiByb3dDb3VudCAtIHJvd09mZnNldDsNCisNCisgICAgICBmb3IgKGk9
TWF0aC5hYnMocm93T2Zmc2V0KS0xOyBpPj0wOyBpLS0pDQorICAgICAgew0KKyAgICAgICAgdmFy
IHJvd0VsZW0gPSB0YWJsZUNoaWxkTm9kZXNbcmVtb3ZlUm93QmFzZV07DQorICAgICAgICB0cnkg
ew0KKyAgICAgICAgICB0YWJsZUJvZHkucmVtb3ZlQ2hpbGQocm93RWxlbSk7DQorICAgICAgICB9
IGNhdGNoKGUpIHsNCisgICAgICAgICAgYnJlYWs7DQorICAgICAgICB9DQorICAgICAgfQ0KKw0K
KyAgICAgIC8vIHJlbmRlciBuZXcgbGluZXMNCisgICAgICBpZiAoIXRoaXMuX3RhYmxlQ29udGFp
bmVyKSB7DQorICAgICAgICB0aGlzLl90YWJsZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVs
ZW1lbnQoImRpdiIpOw0KKyAgICAgIH0NCisgICAgICB2YXIgdGFibGVEdW1teSA9ICc8ZGl2Pic7
DQorICAgICAgdGFibGVEdW1teSArPSB0aGlzLl9nZXRSb3dzSHRtbChmaXJzdFJvdyArIGFkZFJv
d0Jhc2UsIE1hdGguYWJzKHJvd09mZnNldCkpOw0KKyAgICAgIHRhYmxlRHVtbXkgKz0gJzwvZGl2
Pic7DQorICAgICAgdGhpcy5fdGFibGVDb250YWluZXIuaW5uZXJIVE1MID0gdGFibGVEdW1teTsN
CisgICAgICB2YXIgbmV3VGFibGVSb3dzID0gdGhpcy5fdGFibGVDb250YWluZXIuZmlyc3RDaGls
ZC5jaGlsZE5vZGVzOw0KKw0KKyAgICAgIC8vIGFwcGVuZCBuZXcgbGluZXMNCisgICAgICBpZiAo
cm93T2Zmc2V0ID4gMCkNCisgICAgICB7DQorICAgICAgICBmb3IgKHZhciBpPW5ld1RhYmxlUm93
cy5sZW5ndGgtMTsgaT49MDsgaS0tKQ0KKyAgICAgICAgew0KKyAgICAgICAgICB2YXIgcm93RWxl
bSA9IG5ld1RhYmxlUm93c1swXTsNCisgICAgICAgICAgdGFibGVCb2R5LmFwcGVuZENoaWxkKHJv
d0VsZW0pOw0KKyAgICAgICAgfQ0KKyAgICAgIH0NCisgICAgICBlbHNlDQorICAgICAgew0KKyAg
ICAgICAgZm9yICh2YXIgaT1uZXdUYWJsZVJvd3MubGVuZ3RoLTE7IGk+PTA7IGktLSkNCisgICAg
ICAgIHsNCisgICAgICAgICAgdmFyIHJvd0VsZW0gPSBuZXdUYWJsZVJvd3NbbmV3VGFibGVSb3dz
Lmxlbmd0aC0xXTsNCisgICAgICAgICAgdGFibGVCb2R5Lmluc2VydEJlZm9yZShyb3dFbGVtLCB0
YWJsZUJvZHkuZmlyc3RDaGlsZCk7DQorICAgICAgICB9DQorICAgICAgfQ0KKw0KKyAgICAgIC8v
IHVwZGF0ZSBmb2N1cyBpbmRpY2F0b3INCisgICAgICB0aGlzLl91cGRhdGVSb3dTdHlsZXModGhp
cy5fZm9jdXNlZFJvdyAtIHJvd09mZnNldCk7DQorICAgICAgdGhpcy5fdXBkYXRlUm93U3R5bGVz
KHRoaXMuX2ZvY3VzZWRSb3cpOw0KKw0KKyAgICAgIC8vIGZvcmNlIGltbWVkaWF0ZSBsYXlvdXRp
bmcNCisgICAgICAvLyB0aGlzIHByZXZlbnRzIEZpcmVmb3ggZnJvbSBmbGlja2VyaW5nDQorICAg
ICAgaWYgKHF4LmNvcmUuVmFyaWFudC5pc1NldCgicXguY2xpZW50IiwgImdlY2tvIikpIHsNCisg
ICAgICAgIHJvd0VsZW0ub2Zmc2V0SGVpZ2h0Ow0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisg
ICAgLyoqDQorICAgICAqIFVwZGF0ZXMgdGhlIGNvbnRlbnQgb2YgdGhlIHBhbmUgKGltcGxlbWVu
dGVkIHVzaW5nIGFycmF5IGpvaW5zKS4NCisgICAgICovDQorICAgIF91cGRhdGVBbGxSb3dzIDog
ZnVuY3Rpb24oKQ0KKyAgICB7DQorICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOw0K
Kw0KKyAgICAgIHZhciB0YWJsZU1vZGVsID0gdGFibGUuZ2V0VGFibGVNb2RlbCgpOw0KKyAgICAg
IHZhciBwYW5lTW9kZWwgPSB0aGlzLmdldFBhbmVTY3JvbGxlcigpLmdldFRhYmxlUGFuZU1vZGVs
KCk7DQorDQorICAgICAgdmFyIGNvbENvdW50ID0gcGFuZU1vZGVsLmdldENvbHVtbkNvdW50KCk7
DQorICAgICAgdmFyIHJvd0hlaWdodCA9IHRhYmxlLmdldFJvd0hlaWdodCgpOw0KKyAgICAgIHZh
ciBmaXJzdFJvdyA9IHRoaXMuZ2V0Rmlyc3RWaXNpYmxlUm93KCk7DQorDQorICAgICAgdmFyIHJv
d0NvdW50ID0gdGhpcy5nZXRWaXNpYmxlUm93Q291bnQoKTsNCisgICAgICB2YXIgbW9kZWxSb3dD
b3VudCA9IHRhYmxlTW9kZWwuZ2V0Um93Q291bnQoKTsNCisNCisgICAgICBpZiAoZmlyc3RSb3cg
KyByb3dDb3VudCA+IG1vZGVsUm93Q291bnQpIHsNCisgICAgICAgIHJvd0NvdW50ID0gTWF0aC5t
YXgoMCwgbW9kZWxSb3dDb3VudCAtIGZpcnN0Um93KTsNCisgICAgICB9DQorDQorICAgICAgdmFy
IHJvd1dpZHRoID0gcGFuZU1vZGVsLmdldFRvdGFsV2lkdGgoKTsNCisNCisgICAgICB2YXIgaHRt
bEFyciA9IFsNCisgICAgICAgICI8ZGl2IHN0eWxlPSciLA0KKyAgICAgICAgIndpZHRoOiAiLCBy
b3dXaWR0aCwgInB4OyIsDQorICAgICAgICAibGluZS1oZWlnaHQ6ICIsIHJvd0hlaWdodCwgInB4
OyIsDQorICAgICAgICAib3ZlcmZsb3c6IGhpZGRlbjsiLA0KKyAgICAgICAgImZvbnQtc2l6ZTog
MTFweDsiLA0KKyAgICAgICAgImZvbnQtZmFtaWx5OiBcIlNlZ29lIFVJXCIsIENvcmJlbCwgQ2Fs
aWJyaSwgVGFob21hLCBcIkx1Y2lkYSBTYW5zIFVuaWNvZGVcIiwgc2Fucy1zZXJpZjsiLA0KKyAg
ICAgICAgIic+IiwNCisgICAgICAgIHRoaXMuX2dldFJvd3NIdG1sKGZpcnN0Um93LCByb3dDb3Vu
dCksDQorICAgICAgICAiPC9kaXY+Ig0KKyAgICAgIF07DQorDQorICAgICAgdmFyIGVsZW0gPSB0
aGlzLmdldEVsZW1lbnQoKTsNCisgICAgICB2YXIgZGF0YSA9IGh0bWxBcnIuam9pbigiIik7DQor
DQorICAgICAgLy90aGlzLmRlYnVnKCI+Pj4iICsgZGF0YSArICI8PDwiKQ0KKw0KKyAgICAgIHZh
ciBzZWxmID0gdGhpczsNCisgICAgICB0aGlzLl9sYXlvdXRQZW5kaW5nID0gd2luZG93LnNldFRp
bWVvdXQoZnVuY3Rpb24oKQ0KKyAgICAgIHsNCisgICAgICAgIGVsZW0uaW5uZXJIVE1MID0gZGF0
YTsNCisNCisgICAgICAgIC8vIGZvcmNlIGltbWVkaWF0ZSBsYXlvdXRpbmcNCisgICAgICAgIC8v
IHRoaXMgcHJldmVudHMgRmlyZWZveCBmcm9tIGZsaWNrZXJpbmcNCisgICAgICAgIGlmIChxeC5j
b3JlLlZhcmlhbnQuaXNTZXQoInF4LmNsaWVudCIsICJnZWNrbyIpKSB7DQorICAgICAgICAgIGVs
ZW0uY2hpbGROb2Rlc1swXS5vZmZzZXRIZWlnaHQ7DQorICAgICAgICB9DQorICAgICAgICBzZWxm
Ll9sYXlvdXRQZW5kaW5nID0gbnVsbDsNCisgICAgICB9LCAwKTsNCisNCisgICAgICAvKg0KKyAg
ICAgIGVsZW0uaW5uZXJIVE1MID0gZGF0YTsNCisNCisgICAgICAvLyBmb3JjZSBpbW1lZGlhdGUg
bGF5b3V0aW5nDQorICAgICAgLy8gdGhpcyBwcmV2ZW50cyBGaXJlZm94IGZyb20gZmxpY2tlcmlu
Zw0KKyAgICAgIGlmIChxeC5jb3JlLlZhcmlhbnQuaXNTZXQoInF4LmNsaWVudCIsICJnZWNrbyIp
KSB7DQorICAgICAgICBlbGVtLmNoaWxkTm9kZXNbMF0ub2Zmc2V0SGVpZ2h0Ow0KKyAgICAgIH0N
CisgICAgICAqLw0KKw0KKyAgICAgIHRoaXMuc2V0SGVpZ2h0KHJvd0NvdW50ICogcm93SGVpZ2h0
KTsNCisNCisgICAgICB0aGlzLl9sYXN0Q29sQ291bnQgPSBjb2xDb3VudDsNCisgICAgICB0aGlz
Ll9sYXN0Um93Q291bnQgPSByb3dDb3VudDsNCisgICAgfQ0KKw0KKyAgfSwNCisNCisNCisNCisN
CisgIC8qDQorICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KKyAgICAgREVTVFJVQ1RPUg0KKyAgKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioNCisgICovDQorDQorICBkZXN0cnVjdCA6IGZ1bmN0aW9uKCkgew0K
KyAgICB0aGlzLl9kaXNwb3NlT2JqZWN0cygiX3BhbmVTY3JvbGxlciIpOw0KKyAgfQ0KK30pOw0K
</data>

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0" isurl="0">
            <attachid>284</attachid>
            <date>2008-01-24 17:07:00 +0100</date>
            <delta_ts>2008-01-24 17:07:21 +0100</delta_ts>
            <desc>New patch without changes to line endings</desc>
            <filename>qxBug770_2.patch</filename>
            <type>text/plain</type>
            <size>1487</size>
            <attacher>hgibson</attacher>
            
              <data encoding="base64">SW5kZXg6IHFvb3hkb28vZnJvbnRlbmQvZnJhbWV3b3JrL3NvdXJjZS9jbGFzcy9xeC91aS90YWJs
ZS9wYW5lL1BhbmUuanMNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBxb294ZG9vL2Zyb250ZW5kL2ZyYW1ld29y
ay9zb3VyY2UvY2xhc3MvcXgvdWkvdGFibGUvcGFuZS9QYW5lLmpzCShyZXZpc2lvbiAxMTMzOSkN
CisrKyBxb294ZG9vL2Zyb250ZW5kL2ZyYW1ld29yay9zb3VyY2UvY2xhc3MvcXgvdWkvdGFibGUv
cGFuZS9QYW5lLmpzCSh3b3JraW5nIGNvcHkpDQpAQCAtMTI5LDEyICsxMjksMTIgQEANCiAgICAg
ewogICAgICAgdGhpcy5iYXNlKGFyZ3VtZW50cyk7CiAKLSAgICAgIGlmICh0aGlzLl91cGRhdGVX
YW50ZWRXaGlsZUludmlzaWJsZSkKKyAgICAgIGlmICh0aGlzLl91cGRhdGVXYW50ZWRXaGlsZU5v
dENyZWF0ZWQpCiAgICAgICB7Ci0gICAgICAgIC8vIFdlIGFyZSB2aXNpYmxlIG5vdyBhbmQgYW4g
dXBkYXRlIHdhcyB3YW50ZWQgd2hpbGUgd2Ugd2VyZSBpbnZpc2libGUKKyAgICAgICAgLy8gV2Ug
YXJlIGNyZWF0ZWQgbm93IGFuZCBhbiB1cGRhdGUgd2FzIHdhbnRlZCBiZWZvcmUgd2Ugd2VyZSBj
cmVhdGVkCiAgICAgICAgIC8vIC0+IERvIHRoZSB1cGRhdGUgbm93CiAgICAgICAgIHRoaXMuX3Vw
ZGF0ZUNvbnRlbnQoKTsKLSAgICAgICAgdGhpcy5fdXBkYXRlV2FudGVkV2hpbGVJbnZpc2libGUg
PSBmYWxzZTsKKyAgICAgICAgdGhpcy5fdXBkYXRlV2FudGVkV2hpbGVOb3RDcmVhdGVkID0gZmFs
c2U7CiAgICAgICB9CiAgICAgfSwKIApAQCAtMzYzLDkgKzM2Myw5IEBADQogICAgICAgICB0aGlz
Ll9fcm93Q2FjaGVDbGVhcigpOwogICAgICAgfQogCi0gICAgICBpZiAoIXRoaXMuaXNTZWVhYmxl
KCkpCisgICAgICBpZiAoIXRoaXMuaXNDcmVhdGVkKCkpCiAgICAgICB7Ci0gICAgICAgIHRoaXMu
X3VwZGF0ZVdhbnRlZFdoaWxlSW52aXNpYmxlID0gdHJ1ZTsKKyAgICAgICAgdGhpcy5fdXBkYXRl
V2FudGVkV2hpbGVOb3RDcmVhdGVkID0gdHJ1ZTsKICAgICAgICAgcmV0dXJuOwogICAgICAgfQog
CkBAIC02NzEsNyArNjcxLDcgQEANCiAgICAgICAgICJsaW5lLWhlaWdodDogIiwgcm93SGVpZ2h0
LCAicHg7IiwKICAgICAgICAgIm92ZXJmbG93OiBoaWRkZW47IiwKICAgICAgICAgImZvbnQtc2l6
ZTogMTFweDsiLAotICAgICAgICAiZm9udC1mYW1pbHk6ICdTZWdvZSBVSScsIENvcmJlbCwgQ2Fs
aWJyaSwgVGFob21hLCAnTHVjaWRhIFNhbnMgVW5pY29kZScsIHNhbnMtc2VyaWY7IiwKKyAgICAg
ICAgImZvbnQtZmFtaWx5OiBcIlNlZ29lIFVJXCIsIENvcmJlbCwgQ2FsaWJyaSwgVGFob21hLCBc
Ikx1Y2lkYSBTYW5zIFVuaWNvZGVcIiwgc2Fucy1zZXJpZjsiLAogICAgICAgICAiJz4iLAogICAg
ICAgICB0aGlzLl9nZXRSb3dzSHRtbChmaXJzdFJvdywgcm93Q291bnQpLAogICAgICAgICAiPC9k
aXY+Igo=
</data>

          </attachment>
      

    </bug>