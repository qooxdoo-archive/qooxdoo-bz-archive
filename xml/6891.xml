<bug>
          <bug_id>6891</bug_id>
          
          <creation_ts>2012-10-11 17:41:00 +0200</creation_ts>
          <short_desc>Input event handler should cache the old values per target</short_desc>
          <delta_ts>2014-03-03 08:46:10 +0100</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>framework</product>
          <component>core.event</component>
          <version>master</version>
          <rep_platform>All</rep_platform>
          <op_sys>Windows</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>LATER</resolution>
          
          
          
          
          
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>unspecified</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Wayne">w.si</reporter>
          <assigned_to name="Christian Hagendorn">christian.hagendorn</assigned_to>
          
          <qa_contact name="Christian Hagendorn">christian.hagendorn</qa_contact>
          <cf_browser>---</cf_browser>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>30930</commentid>
            <who name="Wayne">w.si</who>
            <bug_when>2012-10-11 17:41:16 +0200</bug_when>
            <thetext>As browser-specific code for IE, the qx.event.handler.Input caches the previous key input and key value within the instance as this.__oldValue and this.__oldInputValue.

Then in the _onKeyPress and _inputFix, the instance compares the target.value to the cached old values to decide whether to fire event on that target.

Considering the instance is global to a certain window and thus the old values can be from some other elements completely irrelevant to the incoming target, it&#39;s logically very wrong to use these old values to decide whether to fire events on the target. Wouldn&#39;t it make more sense to cache the old values per target and compare the target.value with its own old values?</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>30931</commentid>
              <attachid>1194</attachid>
            <who name="Wayne">w.si</who>
            <bug_when>2012-10-11 17:42:03 +0200</bug_when>
            <thetext>Created attachment 1194
My version of caching old values on the target</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>30941</commentid>
            <who name="Martin Wittemann">martin.wittemann</who>
            <bug_when>2012-10-12 13:09:12 +0200</bug_when>
            <thetext>Sounds reasonable, thanks.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>35435</commentid>
            <who name="Martin Wittemann">martin.wittemann</who>
            <bug_when>2014-03-03 08:46:10 +0100</bug_when>
            <thetext>Move open issues to RESOLVED â€“ LATER, whose last comment is older than a year.</thetext>
          </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0" isurl="0">
            <attachid>1194</attachid>
            <date>2012-10-11 17:42:00 +0200</date>
            <delta_ts>2012-10-11 17:42:03 +0200</delta_ts>
            <desc>My version of caching old values on the target</desc>
            <filename>Input.js</filename>
            <type>application/x-javascript</type>
            <size>20146</size>
            <attacher>w.si</attacher>
            
              <data encoding="base64">LyogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqCgogICBxb294ZG9vIC0gdGhlIG5ldyBlcmEgb2Ygd2ViIGRldmVs
b3BtZW50CgogICBodHRwOi8vcW9veGRvby5vcmcKCiAgIENvcHlyaWdodDoKICAgICAyMDA0LTIw
MDggMSYxIEludGVybmV0IEFHLCBHZXJtYW55LCBodHRwOi8vd3d3LjF1bmQxLmRlCgogICBMaWNl
bnNlOgogICAgIExHUEw6IGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWwKICAg
ICBFUEw6IGh0dHA6Ly93d3cuZWNsaXBzZS5vcmcvb3JnL2RvY3VtZW50cy9lcGwtdjEwLnBocAog
ICAgIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0J3MgdG9wLWxldmVsIGRpcmVj
dG9yeSBmb3IgZGV0YWlscy4KCiAgIEF1dGhvcnM6CiAgICAgKiBTZWJhc3RpYW4gV2VybmVyICh3
cGJhc3RpKQogICAgICogRmFiaWFuIEpha29icyAoZmpha29icykKICAgICAqIENocmlzdGlhbiBI
YWdlbmRvcm4gKGNocmlzX3NjaG1pZHQpCgoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8KCi8vIE9yaWdpbmFs
IGJlaGF2aW9yOgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09Ci8vIE5vcm1hbGx5IGEgImNoYW5nZSIgZXZlbnQgc2hvdWxk
IG9jY291ciBvbiBibHVyIG9mIHRoZSBlbGVtZW50Ci8vIChodHRwOi8vd3d3LnczLm9yZy9UUi9E
T00tTGV2ZWwtMi1FdmVudHMvZXZlbnRzLmh0bWwpCgovLyBIb3dldmVyIHRoaXMgaXMgbm90IHRy
dWUgZm9yICJmaWxlIiB1cGxvYWQgZmllbGRzCgovLyBBbmQgdGhpcyBpcyBhbHNvIG5vdCB0cnVl
IGZvciBjaGVja2JveGVzIGFuZCByYWRpb2ZpZWxkcyAoYWxsIG5vbiBtc2h0bWwpCi8vIEFuZCB0
aGlzIGlzIGFsc28gbm90IHRydWUgZm9yIHNlbGVjdCBib3hlcyB3aGVyZSB0aGUgc2VsZWN0aW9u
cwovLyBoYXBwZW5zIGluIHRoZSBvcGVuZWQgcG9wdXAgKEdlY2tvICsgV2Via2l0KQoKLy8gTm9y
bWFsaXplZCBiZWhhdmlvcjoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDaGFuZ2Ugb24gYmx1ciBmb3IgdGV4dGZp
ZWxkcywgdGV4dGFyZWFzIGFuZCBmaWxlCi8vIEluc3RhbnQgY2hhbmdlIGV2ZW50IG9uIGNoZWNr
Ym94ZXMsIHJhZGlvYnV0dG9ucwoKLy8gU2VsZWN0IGZpZWxkIGZpcmVzIG9uIHNlbGVjdCAod2hl
biB1c2luZyBwb3B1cCBvciBzaXplPjEpCi8vIGJ1dCBkaWZmZXJzIHdoZW4gdXNpbmcga2V5Ym9h
cmQ6Ci8vIG1zaHRtbCtvcGVyYT1rZXlwcmVzczsgbW96aWxsYStzYWZhcmk9Ymx1cgoKLy8gSW5w
dXQgZXZlbnQgZm9yIHRleHRhcmVhcyBkb2VzIG5vdCB3b3JrIGluIFNhZmFyaSAzIGJldGEgKFdJ
TikKLy8gU2FmYXJpIDMgYmV0YSAoV0lOKSByZXBlYXRzIGNoYW5nZSBldmVudCBmb3Igc2VsZWN0
IGJveCBvbiBibHVyIHdoZW4gc2VsZWN0ZWQgdXNpbmcgcG9wdXAKCi8vIE9wZXJhIGZpcmVzICJj
aGFuZ2UiIG9uIHJhZGlvIGJ1dHRvbnMgdHdvIHRpbWVzIGZvciBlYWNoIGNoYW5nZQoKLyoqCiAq
IFRoaXMgaGFuZGxlciBwcm92aWRlcyBhbiAiY2hhbmdlIiBldmVudCBmb3IgYWxsIGZvcm0gZmll
bGRzIGFuZCBhbgogKiAiaW5wdXQiIGV2ZW50IGZvciBmb3JtIGZpZWxkcyBvZiB0eXBlICJ0ZXh0
IiBhbmQgInRleHRhcmVhIi4KICoKICogVG8gbGV0IHRoZXNlIGV2ZW50cyB3b3JrIGl0IGlzIG5l
ZWRlZCB0byBjcmVhdGUgdGhlIGVsZW1lbnRzIHVzaW5nCiAqIHtAbGluayBxeC5ib20uSW5wdXR9
CiAqLwpxeC5DbGFzcy5kZWZpbmUoInF4LmV2ZW50LmhhbmRsZXIuSW5wdXQiLAp7CiAgZXh0ZW5k
IDogcXguY29yZS5PYmplY3QsCiAgaW1wbGVtZW50IDogcXguZXZlbnQuSUV2ZW50SGFuZGxlciwK
CgoKCiAgLyoKICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgIENPTlNUUlVDVE9SCiAgKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioKICAqLwoKICBjb25zdHJ1Y3QgOiBmdW5jdGlvbigpCiAgewogICAgdGhp
cy5iYXNlKGFyZ3VtZW50cyk7CgogICAgdGhpcy5fb25DaGFuZ2VDaGVja2VkV3JhcHBlciA9IHF4
LmxhbmcuRnVuY3Rpb24ubGlzdGVuZXIodGhpcy5fb25DaGFuZ2VDaGVja2VkLCB0aGlzKTsKICAg
IHRoaXMuX29uQ2hhbmdlVmFsdWVXcmFwcGVyID0gcXgubGFuZy5GdW5jdGlvbi5saXN0ZW5lcih0
aGlzLl9vbkNoYW5nZVZhbHVlLCB0aGlzKTsKICAgIHRoaXMuX29uSW5wdXRXcmFwcGVyID0gcXgu
bGFuZy5GdW5jdGlvbi5saXN0ZW5lcih0aGlzLl9vbklucHV0LCB0aGlzKTsKICAgIHRoaXMuX29u
UHJvcGVydHlXcmFwcGVyID0gcXgubGFuZy5GdW5jdGlvbi5saXN0ZW5lcih0aGlzLl9vblByb3Bl
cnR5LCB0aGlzKTsKCiAgICAvLyBzcGVjaWFsIGV2ZW50IGhhbmRsZXIgZm9yIG9wZXJhCiAgICBp
ZiAoKHF4LmNvcmUuRW52aXJvbm1lbnQuZ2V0KCJlbmdpbmUubmFtZSIpID09ICJvcGVyYSIpKSB7
CiAgICAgIHRoaXMuX29uS2V5RG93bldyYXBwZXIgPSBxeC5sYW5nLkZ1bmN0aW9uLmxpc3RlbmVy
KHRoaXMuX29uS2V5RG93biwgdGhpcyk7CiAgICAgIHRoaXMuX29uS2V5VXBXcmFwcGVyID0gcXgu
bGFuZy5GdW5jdGlvbi5saXN0ZW5lcih0aGlzLl9vbktleVVwLCB0aGlzKTsKICAgICAgdGhpcy5f
b25CbHVyV3JhcHBlciA9IHF4LmxhbmcuRnVuY3Rpb24ubGlzdGVuZXIodGhpcy5fb25CbHVyLCB0
aGlzKTsKICAgIH0KICB9LAoKCgoKCgogIC8qCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICBT
VEFUSUNTCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAqLwoKICBzdGF0aWNzIDoKICB7CiAgICAv
Kioge0ludGVnZXJ9IFByaW9yaXR5IG9mIHRoaXMgaGFuZGxlciAqLwogICAgUFJJT1JJVFkgOiBx
eC5ldmVudC5SZWdpc3RyYXRpb24uUFJJT1JJVFlfTk9STUFMLAoKICAgIC8qKiB7TWFwfSBTdXBw
b3J0ZWQgZXZlbnQgdHlwZXMgKi8KICAgIFNVUFBPUlRFRF9UWVBFUyA6CiAgICB7CiAgICAgIGlu
cHV0IDogMSwKICAgICAgY2hhbmdlIDogMQogICAgfSwKCiAgICAvKioge0ludGVnZXJ9IFdoaWNo
IHRhcmdldCBjaGVjayB0byB1c2UgKi8KICAgIFRBUkdFVF9DSEVDSyA6IHF4LmV2ZW50LklFdmVu
dEhhbmRsZXIuVEFSR0VUX0RPTU5PREUsCgogICAgLyoqIHtJbnRlZ2VyfSBXaGV0aGVyIHRoZSBt
ZXRob2QgImNhbkhhbmRsZUV2ZW50IiBtdXN0IGJlIGNhbGxlZCAqLwogICAgSUdOT1JFX0NBTl9I
QU5ETEUgOiBmYWxzZQogIH0sCgoKCgoKICAvKgogICoqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAg
TUVNQkVSUwogICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgKi8KCiAgbWVtYmVycyA6CiAgewogICAg
Ly8gc3BlY2lhbCBoYW5kbGluZyBmb3Igb3BlcmEKICAgIF9fZW50ZXIgOiBmYWxzZSwKICAgIF9f
b25JbnB1dFRpbWVvdXRJZCA6IG51bGwsCgogICAgLy8gc3RvcmVzIHRoZSBmb3JtZXIgc2V0IHZh
bHVlIGZvciBvcGVyYSBhbmQgSUUKLy8gICAgX19vbGRWYWx1ZSA6IG51bGwsIC8vIFdTIG5lZWQg
dG8gYmUgcGVyIHRhcmdldAoKICAgIC8vIHN0b3JlcyB0aGUgZm9ybWVyIHNldCB2YWx1ZSBmb3Ig
SUUKLy8gICAgX19vbGRJbnB1dFZhbHVlIDogbnVsbCwgLy8gV1MgbmVlZCB0byBiZSBwZXIgdGFy
Z2V0CgogICAgLyoKICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBFVkVOVCBIQU5ETEVSIElO
VEVSRkFDRQogICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAqLwoKICAgIC8vIGludGVyZmFjZSBp
bXBsZW1lbnRhdGlvbgogICAgY2FuSGFuZGxlRXZlbnQgOiBmdW5jdGlvbih0YXJnZXQsIHR5cGUp
CiAgICB7CiAgICAgIHZhciBsb3dlciA9IHRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7Cgog
ICAgICBpZiAodHlwZSA9PT0gImlucHV0IiAmJiAobG93ZXIgPT09ICJpbnB1dCIgfHwgbG93ZXIg
PT09ICJ0ZXh0YXJlYSIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlm
ICh0eXBlID09PSAiY2hhbmdlIiAmJiAobG93ZXIgPT09ICJpbnB1dCIgfHwgbG93ZXIgPT09ICJ0
ZXh0YXJlYSIgfHwgbG93ZXIgPT09ICJzZWxlY3QiKSkgewogICAgICAgIHJldHVybiB0cnVlOwog
ICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKCiAgICAvLyBpbnRlcmZhY2UgaW1w
bGVtZW50YXRpb24KICAgIHJlZ2lzdGVyRXZlbnQgOiBmdW5jdGlvbih0YXJnZXQsIHR5cGUsIGNh
cHR1cmUpCiAgICB7CiAgICAgIGlmICgKICAgICAgICBxeC5jb3JlLkVudmlyb25tZW50LmdldCgi
ZW5naW5lLm5hbWUiKSA9PSAibXNodG1sIiAmJgogICAgICAgIChxeC5jb3JlLkVudmlyb25tZW50
LmdldCgiZW5naW5lLnZlcnNpb24iKSA8IDkgfHwKICAgICAgICAocXguY29yZS5FbnZpcm9ubWVu
dC5nZXQoImVuZ2luZS52ZXJzaW9uIikgPj0gOSAmJiBxeC5jb3JlLkVudmlyb25tZW50LmdldCgi
YnJvd3Nlci5kb2N1bWVudG1vZGUiKSA8IDkpKQogICAgICApCiAgICAgIHsKICAgICAgICBpZiAo
IXRhcmdldC5fX2lucHV0SGFuZGxlckF0dGFjaGVkKQogICAgICAgIHsKICAgICAgICAgIHZhciB0
YWcgPSB0YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgdmFyIGVsZW1lbnRU
eXBlID0gdGFyZ2V0LnR5cGU7CgogICAgICAgICAgaWYgKGVsZW1lbnRUeXBlID09PSAidGV4dCIg
fHwgZWxlbWVudFR5cGUgPT09ICJwYXNzd29yZCIgfHwgdGFnID09PSAidGV4dGFyZWEiIHx8IGVs
ZW1lbnRUeXBlID09PSAiY2hlY2tib3giIHx8IGVsZW1lbnRUeXBlID09PSAicmFkaW8iKSB7CiAg
ICAgICAgICAgIHF4LmJvbS5FdmVudC5hZGROYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJwcm9wZXJ0
eWNoYW5nZSIsIHRoaXMuX29uUHJvcGVydHlXcmFwcGVyKTsKICAgICAgICAgIH0KCiAgICAgICAg
ICBpZiAoZWxlbWVudFR5cGUgIT09ICJjaGVja2JveCIgJiYgZWxlbWVudFR5cGUgIT09ICJyYWRp
byIpIHsKICAgICAgICAgICAgcXguYm9tLkV2ZW50LmFkZE5hdGl2ZUxpc3RlbmVyKHRhcmdldCwg
ImNoYW5nZSIsIHRoaXMuX29uQ2hhbmdlVmFsdWVXcmFwcGVyKTsKICAgICAgICAgIH0KCiAgICAg
ICAgICBpZiAoZWxlbWVudFR5cGUgPT09ICJ0ZXh0IiB8fCBlbGVtZW50VHlwZSA9PT0gInBhc3N3
b3JkIikgewogICAgICAgICAgICB0aGlzLl9vbktleVByZXNzV3JhcHBlZCA9IHF4LmxhbmcuRnVu
Y3Rpb24ubGlzdGVuZXIodGhpcy5fb25LZXlQcmVzcywgdGhpcywgdGFyZ2V0KTsKICAgICAgICAg
ICAgcXguYm9tLkV2ZW50LmFkZE5hdGl2ZUxpc3RlbmVyKHRhcmdldCwgImtleXByZXNzIiwgdGhp
cy5fb25LZXlQcmVzc1dyYXBwZWQpOwogICAgICAgICAgfQoKICAgICAgICAgIHRhcmdldC5fX2lu
cHV0SGFuZGxlckF0dGFjaGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZQog
ICAgICB7CiAgICAgICAgaWYgKHR5cGUgPT09ICJpbnB1dCIpCiAgICAgICAgewogICAgICAgICAg
dGhpcy5fX3JlZ2lzdGVySW5wdXRMaXN0ZW5lcih0YXJnZXQpOwogICAgICAgIH0KICAgICAgICBl
bHNlIGlmICh0eXBlID09PSAiY2hhbmdlIikKICAgICAgICB7CiAgICAgICAgICBpZiAodGFyZ2V0
LnR5cGUgPT09ICJyYWRpbyIgfHwgdGFyZ2V0LnR5cGUgPT09ICJjaGVja2JveCIpIHsKICAgICAg
ICAgICAgcXguYm9tLkV2ZW50LmFkZE5hdGl2ZUxpc3RlbmVyKHRhcmdldCwgImNoYW5nZSIsIHRo
aXMuX29uQ2hhbmdlQ2hlY2tlZFdyYXBwZXIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg
ICAgcXguYm9tLkV2ZW50LmFkZE5hdGl2ZUxpc3RlbmVyKHRhcmdldCwgImNoYW5nZSIsIHRoaXMu
X29uQ2hhbmdlVmFsdWVXcmFwcGVyKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBzcGVjaWFs
IGVudGVyIGJ1Z2ZpeCBmb3Igb3BlcmEKICAgICAgICAgIGlmICgocXguY29yZS5FbnZpcm9ubWVu
dC5nZXQoImVuZ2luZS5uYW1lIikgPT0gIm9wZXJhIikgfHwgKHF4LmNvcmUuRW52aXJvbm1lbnQu
Z2V0KCJlbmdpbmUubmFtZSIpID09ICJtc2h0bWwiKSkgewogICAgICAgICAgICBpZiAodGFyZ2V0
LnR5cGUgPT09ICJ0ZXh0IiB8fCB0YXJnZXQudHlwZSA9PT0gInBhc3N3b3JkIikgewogICAgICAg
ICAgICAgIHRoaXMuX29uS2V5UHJlc3NXcmFwcGVkID0gcXgubGFuZy5GdW5jdGlvbi5saXN0ZW5l
cih0aGlzLl9vbktleVByZXNzLCB0aGlzLCB0YXJnZXQpOwogICAgICAgICAgICAgIHF4LmJvbS5F
dmVudC5hZGROYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJrZXlwcmVzcyIsIHRoaXMuX29uS2V5UHJl
c3NXcmFwcGVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQog
ICAgfSwKCgogICAgX19yZWdpc3RlcklucHV0TGlzdGVuZXIgOiBxeC5jb3JlLkVudmlyb25tZW50
LnNlbGVjdCgiZW5naW5lLm5hbWUiLAogICAgewogICAgICAibXNodG1sIiA6IGZ1bmN0aW9uKHRh
cmdldCkKICAgICAgewogICAgICAgIGlmICgKICAgICAgICAgIHF4LmNvcmUuRW52aXJvbm1lbnQu
Z2V0KCJlbmdpbmUudmVyc2lvbiIpID49IDkgJiYKICAgICAgICAgIHF4LmNvcmUuRW52aXJvbm1l
bnQuZ2V0KCJicm93c2VyLmRvY3VtZW50bW9kZSIpID49IDkKICAgICAgICApIHsKICAgICAgICAg
IHF4LmJvbS5FdmVudC5hZGROYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJpbnB1dCIsIHRoaXMuX29u
SW5wdXRXcmFwcGVyKTsKCiAgICAgICAgICBpZiAodGFyZ2V0LnR5cGUgPT09ICJ0ZXh0IiB8fCB0
YXJnZXQudHlwZSA9PT0gInBhc3N3b3JkIiB8fCB0YXJnZXQudHlwZSA9PT0gInRleHRhcmVhIikK
ICAgICAgICAgIHsKICAgICAgICAgICAgLy8gRml4ZWQgaW5wdXQgZm9yIGRlbGV0ZSBhbmQgYmFj
a3NwYWNlIGtleQogICAgICAgICAgICB0aGlzLl9pbnB1dEZpeFdyYXBwZXIgPSBxeC5sYW5nLkZ1
bmN0aW9uLmxpc3RlbmVyKHRoaXMuX2lucHV0Rml4LCB0aGlzLCB0YXJnZXQpOwogICAgICAgICAg
ICBxeC5ib20uRXZlbnQuYWRkTmF0aXZlTGlzdGVuZXIodGFyZ2V0LCAia2V5dXAiLCB0aGlzLl9p
bnB1dEZpeFdyYXBwZXIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKCiAgICAgICJ3
ZWJraXQiIDogZnVuY3Rpb24odGFyZ2V0KQogICAgICB7CiAgICAgICAgLy8gVE9ETzogcmVtb3Zl
IGxpc3RlbmVyCiAgICAgICAgdmFyIHRhZyA9IHRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7
CgogICAgICAgIC8vIHRoZSBjaGFuZ2UgZXZlbnQgaXMgbm90IGZpcmVkIHdoaWxlIHR5cGluZwog
ICAgICAgIC8vIHRoaXMgaGFzIGJlZW4gZml4ZWQgaW4gdGhlIGxhdGVzdCBuaWdodGxpZXMKICAg
ICAgICBpZiAocGFyc2VGbG9hdChxeC5jb3JlLkVudmlyb25tZW50LmdldCgiZW5naW5lLnZlcnNp
b24iKSkgPCA1MzIgJiYgdGFnID09ICJ0ZXh0YXJlYSIpIHsKICAgICAgICAgIHF4LmJvbS5FdmVu
dC5hZGROYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJrZXlwcmVzcyIsIHRoaXMuX29uSW5wdXRXcmFw
cGVyKTsKICAgICAgICB9CiAgICAgICAgcXguYm9tLkV2ZW50LmFkZE5hdGl2ZUxpc3RlbmVyKHRh
cmdldCwgImlucHV0IiwgdGhpcy5fb25JbnB1dFdyYXBwZXIpOwogICAgICB9LAoKICAgICAgIm9w
ZXJhIiA6IGZ1bmN0aW9uKHRhcmdldCkgewogICAgICAgIC8vIHJlZ2lzdGVyIGtleSBldmVudHMg
Zm9yIGZpbHRlcmluZyAiZW50ZXIiIG9uIGlucHV0IGV2ZW50cwogICAgICAgIHF4LmJvbS5FdmVu
dC5hZGROYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJrZXl1cCIsIHRoaXMuX29uS2V5VXBXcmFwcGVy
KTsKICAgICAgICBxeC5ib20uRXZlbnQuYWRkTmF0aXZlTGlzdGVuZXIodGFyZ2V0LCAia2V5ZG93
biIsIHRoaXMuX29uS2V5RG93bldyYXBwZXIpOwogICAgICAgIC8vIHJlZ2lzdGVyIGFuIGJsdXIg
ZXZlbnQgZm9yIHByZXZlbnRpbmcgdGhlIGlucHV0IGV2ZW50IG9uIGJsdXIKICAgICAgICBxeC5i
b20uRXZlbnQuYWRkTmF0aXZlTGlzdGVuZXIodGFyZ2V0LCAiYmx1ciIsIHRoaXMuX29uQmx1cldy
YXBwZXIpOwoKICAgICAgICBxeC5ib20uRXZlbnQuYWRkTmF0aXZlTGlzdGVuZXIodGFyZ2V0LCAi
aW5wdXQiLCB0aGlzLl9vbklucHV0V3JhcHBlcik7CiAgICAgIH0sCgogICAgICAiZGVmYXVsdCIg
OiBmdW5jdGlvbih0YXJnZXQpIHsKICAgICAgICBxeC5ib20uRXZlbnQuYWRkTmF0aXZlTGlzdGVu
ZXIodGFyZ2V0LCAiaW5wdXQiLCB0aGlzLl9vbklucHV0V3JhcHBlcik7CiAgICAgIH0KICAgIH0p
LAoKCiAgICAvLyBpbnRlcmZhY2UgaW1wbGVtZW50YXRpb24KICAgIHVucmVnaXN0ZXJFdmVudCA6
IGZ1bmN0aW9uKHRhcmdldCwgdHlwZSkKICAgIHsKICAgICAgaWYgKAogICAgICAgIHF4LmNvcmUu
RW52aXJvbm1lbnQuZ2V0KCJlbmdpbmUubmFtZSIpID09ICJtc2h0bWwiICYmCiAgICAgICAgcXgu
Y29yZS5FbnZpcm9ubWVudC5nZXQoImVuZ2luZS52ZXJzaW9uIikgPCA5ICYmCiAgICAgICAgcXgu
Y29yZS5FbnZpcm9ubWVudC5nZXQoImJyb3dzZXIuZG9jdW1lbnRtb2RlIikgPCA5CiAgICAgICkK
ICAgICAgewogICAgICAgIGlmICh0YXJnZXQuX19pbnB1dEhhbmRsZXJBdHRhY2hlZCkKICAgICAg
ICB7CiAgICAgICAgICB2YXIgdGFnID0gdGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTsKICAg
ICAgICAgIHZhciBlbGVtZW50VHlwZSA9IHRhcmdldC50eXBlOwoKICAgICAgICAgIGlmIChlbGVt
ZW50VHlwZSA9PT0gInRleHQiIHx8IGVsZW1lbnRUeXBlID09PSAicGFzc3dvcmQiIHx8IHRhZyA9
PT0gInRleHRhcmVhIiB8fCBlbGVtZW50VHlwZSA9PT0gImNoZWNrYm94IiB8fCBlbGVtZW50VHlw
ZSA9PT0gInJhZGlvIikgewogICAgICAgICAgICBxeC5ib20uRXZlbnQucmVtb3ZlTmF0aXZlTGlz
dGVuZXIodGFyZ2V0LCAicHJvcGVydHljaGFuZ2UiLCB0aGlzLl9vblByb3BlcnR5V3JhcHBlcik7
CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGVsZW1lbnRUeXBlICE9PSAiY2hlY2tib3giICYm
IGVsZW1lbnRUeXBlICE9PSAicmFkaW8iKSB7CiAgICAgICAgICAgIHF4LmJvbS5FdmVudC5yZW1v
dmVOYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJjaGFuZ2UiLCB0aGlzLl9vbkNoYW5nZVZhbHVlV3Jh
cHBlcik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGVsZW1lbnRUeXBlID09PSAidGV4dCIg
fHwgZWxlbWVudFR5cGUgPT09ICJwYXNzd29yZCIpIHsKICAgICAgICAgICAgcXguYm9tLkV2ZW50
LnJlbW92ZU5hdGl2ZUxpc3RlbmVyKHRhcmdldCwgImtleXByZXNzIiwgdGhpcy5fb25LZXlQcmVz
c1dyYXBwZWQpOwogICAgICAgICAgfQoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRlbGV0
ZSB0YXJnZXQuX19pbnB1dEhhbmRsZXJBdHRhY2hlZDsKICAgICAgICAgIH0gY2F0Y2goZXgpIHsK
ICAgICAgICAgICAgdGFyZ2V0Ll9faW5wdXRIYW5kbGVyQXR0YWNoZWQgPSBudWxsOwogICAgICAg
ICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBpZiAodHlw
ZSA9PT0gImlucHV0IikKICAgICAgICB7CiAgICAgICAgICB0aGlzLl9fdW5yZWdpc3RlcklucHV0
TGlzdGVuZXIodGFyZ2V0KTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gImNo
YW5nZSIpCiAgICAgICAgewogICAgICAgICAgaWYgKHRhcmdldC50eXBlID09PSAicmFkaW8iIHx8
IHRhcmdldC50eXBlID09PSAiY2hlY2tib3giKQogICAgICAgICAgewogICAgICAgICAgICBxeC5i
b20uRXZlbnQucmVtb3ZlTmF0aXZlTGlzdGVuZXIodGFyZ2V0LCAiY2hhbmdlIiwgdGhpcy5fb25D
aGFuZ2VDaGVja2VkV3JhcHBlcik7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlCiAgICAgICAg
ICB7CiAgICAgICAgICAgIHF4LmJvbS5FdmVudC5yZW1vdmVOYXRpdmVMaXN0ZW5lcih0YXJnZXQs
ICJjaGFuZ2UiLCB0aGlzLl9vbkNoYW5nZVZhbHVlV3JhcHBlcik7CiAgICAgICAgICB9CiAgICAg
ICAgfQoKICAgICAgICBpZiAoKHF4LmNvcmUuRW52aXJvbm1lbnQuZ2V0KCJlbmdpbmUubmFtZSIp
ID09ICJvcGVyYSIpIHx8IChxeC5jb3JlLkVudmlyb25tZW50LmdldCgiZW5naW5lLm5hbWUiKSA9
PSAibXNodG1sIikpIHsKICAgICAgICAgIGlmICh0YXJnZXQudHlwZSA9PT0gInRleHQiIHx8IHRh
cmdldC50eXBlID09PSAicGFzc3dvcmQiKSB7CiAgICAgICAgICAgIHF4LmJvbS5FdmVudC5yZW1v
dmVOYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJrZXlwcmVzcyIsIHRoaXMuX29uS2V5UHJlc3NXcmFw
cGVkKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCgoKICAgIF9fdW5yZWdp
c3RlcklucHV0TGlzdGVuZXIgOiBxeC5jb3JlLkVudmlyb25tZW50LnNlbGVjdCgiZW5naW5lLm5h
bWUiLAogICAgewogICAgICAibXNodG1sIiA6IGZ1bmN0aW9uKHRhcmdldCkKICAgICAgewogICAg
ICAgIGlmICgKICAgICAgICAgIHF4LmNvcmUuRW52aXJvbm1lbnQuZ2V0KCJlbmdpbmUudmVyc2lv
biIpID49IDkgJiYKICAgICAgICAgIHF4LmNvcmUuRW52aXJvbm1lbnQuZ2V0KCJicm93c2VyLmRv
Y3VtZW50bW9kZSIpID49IDkKICAgICAgICApIHsKICAgICAgICAgIHF4LmJvbS5FdmVudC5yZW1v
dmVOYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJpbnB1dCIsIHRoaXMuX29uSW5wdXRXcmFwcGVyKTsK
CiAgICAgICAgICBpZiAodGFyZ2V0LnR5cGUgPT09ICJ0ZXh0IiB8fCB0YXJnZXQudHlwZSA9PT0g
InBhc3N3b3JkIiB8fCB0YXJnZXQudHlwZSA9PT0gInRleHRhcmVhIikgewogICAgICAgICAgICAv
LyBGaXhlZCBpbnB1dCBmb3IgZGVsZXRlIGFuZCBiYWNrc3BhY2Uga2V5CiAgICAgICAgICAgIHF4
LmJvbS5FdmVudC5yZW1vdmVOYXRpdmVMaXN0ZW5lcih0YXJnZXQsICJrZXl1cCIsIHRoaXMuX2lu
cHV0Rml4V3JhcHBlcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKICAgICAgIndl
YmtpdCIgOiBmdW5jdGlvbih0YXJnZXQpCiAgICAgIHsKICAgICAgICAvLyBUT0RPOiByZW1vdmUg
bGlzdGVuZXIKICAgICAgICB2YXIgdGFnID0gdGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTsK
CiAgICAgICAgLy8gdGhlIGNoYW5nZSBldmVudCBpcyBub3QgZmlyZWQgd2hpbGUgdHlwaW5nCiAg
ICAgICAgLy8gdGhpcyBoYXMgYmVlbiBmaXhlZCBpbiB0aGUgbGF0ZXN0IG5pZ2h0bGllcwogICAg
ICAgIGlmIChwYXJzZUZsb2F0KHF4LmNvcmUuRW52aXJvbm1lbnQuZ2V0KCJlbmdpbmUudmVyc2lv
biIpKSA8IDUzMiAmJiB0YWcgPT0gInRleHRhcmVhIikgewogICAgICAgICAgcXguYm9tLkV2ZW50
LnJlbW92ZU5hdGl2ZUxpc3RlbmVyKHRhcmdldCwgImtleXByZXNzIiwgdGhpcy5fb25JbnB1dFdy
YXBwZXIpOwogICAgICAgIH0KICAgICAgICBxeC5ib20uRXZlbnQucmVtb3ZlTmF0aXZlTGlzdGVu
ZXIodGFyZ2V0LCAiaW5wdXQiLCB0aGlzLl9vbklucHV0V3JhcHBlcik7CiAgICAgIH0sCgogICAg
ICAib3BlcmEiIDogZnVuY3Rpb24odGFyZ2V0KSB7CiAgICAgICAgLy8gdW5yZWdpc3RlciBrZXkg
ZXZlbnRzIGZvciBmaWx0ZXJpbmcgImVudGVyIiBvbiBpbnB1dCBldmVudHMKICAgICAgICBxeC5i
b20uRXZlbnQucmVtb3ZlTmF0aXZlTGlzdGVuZXIodGFyZ2V0LCAia2V5dXAiLCB0aGlzLl9vbktl
eVVwV3JhcHBlcik7CiAgICAgICAgcXguYm9tLkV2ZW50LnJlbW92ZU5hdGl2ZUxpc3RlbmVyKHRh
cmdldCwgImtleWRvd24iLCB0aGlzLl9vbktleURvd25XcmFwcGVyKTsKICAgICAgICAvLyB1bnJl
Z2lzdGVyIHRoZSBibHVyIGV2ZW50IChuZWVkZWQgZm9yIHByZXZlbnRpbmcgaW5wdXQgZXZlbnQg
b24gYmx1cikKICAgICAgICBxeC5ib20uRXZlbnQucmVtb3ZlTmF0aXZlTGlzdGVuZXIodGFyZ2V0
LCAiYmx1ciIsIHRoaXMuX29uQmx1cldyYXBwZXIpOwoKCiAgICAgICAgcXguYm9tLkV2ZW50LnJl
bW92ZU5hdGl2ZUxpc3RlbmVyKHRhcmdldCwgImlucHV0IiwgdGhpcy5fb25JbnB1dFdyYXBwZXIp
OwogICAgICB9LAoKICAgICAgImRlZmF1bHQiIDogZnVuY3Rpb24odGFyZ2V0KSB7CiAgICAgICAg
cXguYm9tLkV2ZW50LnJlbW92ZU5hdGl2ZUxpc3RlbmVyKHRhcmdldCwgImlucHV0IiwgdGhpcy5f
b25JbnB1dFdyYXBwZXIpOwogICAgICB9CiAgICB9KSwKCgogICAgLyoKICAgIC0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLQogICAgICBGT1IgT1BFUkEgQU5EIElFIChLRVlQUkVTUyBUTyBTSU1VTEFURSBDSEFO
R0UgRVZFTlQpCiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICovCiAgICAvKioKICAgICAqIEhh
bmRsZXIgZm9yIGZpeGluZyB0aGUgZGlmZmVyZW50IGJlaGF2aW9yIHdoZW4gcHJlc3NpbmcgdGhl
IGVudGVyIGtleS4KICAgICAqCiAgICAgKiBGRiBhbmQgU2FmYXJpIGZpcmUgYSAiY2hhbmdlIiBl
dmVudCBpZiB0aGUgdXNlciBwcmVzc2VzIHRoZSBlbnRlciBrZXkuCiAgICAgKiBJRSBhbmQgT3Bl
cmEgZmlyZSB0aGUgZXZlbnQgb25seSBpZiB0aGUgZm9jdXMgaXMgY2hhbmdlZC4KICAgICAqCiAg
ICAgKiBAc2lnbmF0dXJlIGZ1bmN0aW9uKGUsIHRhcmdldCkKICAgICAqIEBwYXJhbSBlIHtFdmVu
dH0gRE9NIGV2ZW50IG9iamVjdAogICAgICogQHBhcmFtIHRhcmdldCB7RWxlbWVudH0gVGhlIGV2
ZW50IHRhcmdldAogICAgICovCiAgICBfb25LZXlQcmVzcyA6IHF4LmNvcmUuRW52aXJvbm1lbnQu
c2VsZWN0KCJlbmdpbmUubmFtZSIsCiAgICB7CiAgICAgICJtc2h0bWx8b3BlcmEiIDogZnVuY3Rp
b24oZSwgdGFyZ2V0KQogICAgICB7CiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHsKICAg
ICAgICAgIGlmICh0YXJnZXQudmFsdWUgIT09IHRhcmdldC4kJG9sZFZhbHVlKSB7CiAgICAgICAg
ICAgIHRhcmdldC4kJG9sZFZhbHVlID0gdGFyZ2V0LnZhbHVlOwogICAgICAgICAgICBxeC5ldmVu
dC5SZWdpc3RyYXRpb24uZmlyZUV2ZW50KHRhcmdldCwgImNoYW5nZSIsIHF4LmV2ZW50LnR5cGUu
RGF0YSwgW3RhcmdldC52YWx1ZV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKCiAg
ICAgICJkZWZhdWx0IiA6IG51bGwKICAgIH0pLAoKCiAgICAvKgogICAgLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tCiAgICAgIEZPUiBJRSAoS0VZVVAgVE8gU0lNVUxBVEUgSU5QVVQgRVZFTlQpCiAgICAtLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0KICAgICovCiAgICAvKioKICAgICAqIEhhbmRsZXIgZm9yIGZpeGluZyB0
aGUgZGlmZmVyZW50IGJlaGF2aW9yIHdoZW4gcHJlc3NpbmcgdGhlIGJhY2tzcGFjZSBvcgogICAg
ICogZGVsZXRlIGtleS4KICAgICAqCiAgICAgKiBUaGUgb3RoZXIgYnJvd3NlcnMgZmlyZSBhICJp
bnB1dCIgZXZlbnQgaWYgdGhlIHVzZXIgcHJlc3NlcyB0aGUgYmFja3NwYWNlCiAgICAgKiBvciBk
ZWxldGUga2V5LgogICAgICogSUUgZmlyZSB0aGUgZXZlbnQgb25seSBmb3Igb3RoZXIga2V5cy4K
ICAgICAqCiAgICAgKiBAc2lnbmF0dXJlIGZ1bmN0aW9uKGUsIHRhcmdldCkKICAgICAqIEBwYXJh
bSBlIHtFdmVudH0gRE9NIGV2ZW50IG9iamVjdAogICAgICogQHBhcmFtIHRhcmdldCB7RWxlbWVu
dH0gVGhlIGV2ZW50IHRhcmdldAogICAgICovCiAgICBfaW5wdXRGaXggOiBxeC5jb3JlLkVudmly
b25tZW50LnNlbGVjdCgiZW5naW5lLm5hbWUiLAogICAgewogICAgICAibXNodG1sIiA6IGZ1bmN0
aW9uKGUsIHRhcmdldCkKICAgICAgewogICAgICAgIGlmIChlLmtleUNvZGUgPT09IDQ2IHx8IGUu
a2V5Q29kZSA9PT0gOCkKICAgICAgICB7CiAgICAgICAgICBpZiAodGFyZ2V0LnZhbHVlICE9PSB0
YXJnZXQuJCRvbGRJbnB1dFZhbHVlKQogICAgICAgICAgewogICAgICAgICAgICB0YXJnZXQuJCRv
bGRJbnB1dFZhbHVlID0gdGFyZ2V0LnZhbHVlOwogICAgICAgICAgICBxeC5ldmVudC5SZWdpc3Ry
YXRpb24uZmlyZUV2ZW50KHRhcmdldCwgImlucHV0IiwgcXguZXZlbnQudHlwZS5EYXRhLCBbdGFy
Z2V0LnZhbHVlXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKICAgICAgImRlZmF1
bHQiIDogbnVsbAogICAgfSksCgoKICAgIC8qCiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAg
Rk9SIE9QRVJBIE9OTFkgTElTVEVORVIgKEtFWSBBTkQgQkxVUikKICAgIC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQogICAgKi8KICAgIC8qKgogICAgICogS2V5IGV2ZW50IGxpc3RlbmVyIGZvciBvcGVyYSB3
aGljaCByZWNvZ25pemVzIGlmIHRoZSBlbnRlciBrZXkgaGFzIGJlZW4KICAgICAqIHByZXNzZWQu
CiAgICAgKgogICAgICogQHNpZ25hdHVyZSBmdW5jdGlvbihlKQogICAgICogQHBhcmFtIGUge0V2
ZW50fSBET00gZXZlbnQgb2JqZWN0CiAgICAgKi8KICAgIF9vbktleURvd24gOiBxeC5jb3JlLkVu
dmlyb25tZW50LnNlbGVjdCgiZW5naW5lLm5hbWUiLAogICAgewogICAgICAib3BlcmEiIDogZnVu
Y3Rpb24oZSkKICAgICAgewogICAgICAgIC8vIGVudGVyIGlzIHByZXNzZWQKICAgICAgICBpZiAo
ZS5rZXlDb2RlID09PSAxMykgewogICAgICAgICAgdGhpcy5fX2VudGVyID0gdHJ1ZTsKICAgICAg
ICB9CiAgICAgIH0sCgogICAgICAiZGVmYXVsdCIgOiBudWxsCiAgICB9KSwKCgogICAgLyoqCiAg
ICAgKiBLZXkgZXZlbnQgbGlzdGVuZXIgZm9yIG9wZXJhIHdoaWNoIHJlY29nbml6ZXMgaWYgdGhl
IGVudGVyIGtleSBoYXMgYmVlbgogICAgICogcHJlc3NlZC4KICAgICAqCiAgICAgKiBAc2lnbmF0
dXJlIGZ1bmN0aW9uKGUpCiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9IERPTSBldmVudCBvYmplY3QK
ICAgICAqLwogICAgX29uS2V5VXAgOiBxeC5jb3JlLkVudmlyb25tZW50LnNlbGVjdCgiZW5naW5l
Lm5hbWUiLAogICAgewogICAgICAib3BlcmEiIDogZnVuY3Rpb24oZSkKICAgICAgewogICAgICAg
IC8vIGVudGVyIGlzIHByZXNzZWQKICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAxMykgewogICAg
ICAgICAgdGhpcy5fX2VudGVyID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgImRl
ZmF1bHQiIDogbnVsbAogICAgfSksCgoKICAgIC8qKgogICAgICogQmx1ciBldmVudCBsaXN0ZW5l
ciBmb3Igb3BlcmEgY2FuY2VscyB0aGUgdGltZW91dCBvZiB0aGUgaW5wdXQgZXZlbnQuCiAgICAg
KgogICAgICogQHNpZ25hdHVyZSBmdW5jdGlvbihlKQogICAgICogQHBhcmFtIGUge0V2ZW50fSBE
T00gZXZlbnQgb2JqZWN0CiAgICAgKi8KICAgIF9vbkJsdXIgOiBxeC5jb3JlLkVudmlyb25tZW50
LnNlbGVjdCgiZW5naW5lLm5hbWUiLAogICAgewogICAgICAib3BlcmEiIDogZnVuY3Rpb24oZSkK
ICAgICAgewogICAgICAgIGlmICh0aGlzLl9fb25JbnB1dFRpbWVvdXRJZCAmJiBxeC5jb3JlLkVu
dmlyb25tZW50LmdldCgiYnJvd3Nlci52ZXJzaW9uIikgPCAxMC42KSB7CiAgICAgICAgICB3aW5k
b3cuY2xlYXJUaW1lb3V0KHRoaXMuX19vbklucHV0VGltZW91dElkKTsKICAgICAgICB9CiAgICAg
IH0sCgogICAgICAiZGVmYXVsdCIgOiBudWxsCiAgICB9KSwKCgogICAgLyoKICAgIC0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLQogICAgICBOQVRJVkUgRVZFTlQgSEFORExFUlMKICAgIC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQogICAgKi8KCiAgICAvKioKICAgICAqIEludGVybmFsIGZ1bmN0aW9uIGNhbGxlZCBieSBp
bnB1dCBlbGVtZW50cyBjcmVhdGVkIHVzaW5nIHtAbGluayBxeC5ib20uSW5wdXR9LgogICAgICoK
ICAgICAqIEBzaWduYXR1cmUgZnVuY3Rpb24oZSkKICAgICAqIEBwYXJhbSBlIHtFdmVudH0gTmF0
aXZlIERPTSBldmVudAogICAgICovCiAgICBfb25JbnB1dCA6IHF4LmV2ZW50Lkdsb2JhbEVycm9y
Lm9ic2VydmVNZXRob2QoZnVuY3Rpb24oZSkKICAgIHsKICAgICAgdmFyIHRhcmdldCA9IHF4LmJv
bS5FdmVudC5nZXRUYXJnZXQoZSk7CiAgICAgIHZhciB0YWcgPSB0YXJnZXQudGFnTmFtZS50b0xv
d2VyQ2FzZSgpOwogICAgICAvLyBpZ25vcmUgbmF0aXZlIGlucHV0IGV2ZW50IHdoZW4gdHJpZ2dl
cmVkIGJ5IHJldHVybiBpbiBpbnB1dCBlbGVtZW50CiAgICAgIGlmICghdGhpcy5fX2VudGVyIHx8
IHRhZyAhPT0gImlucHV0IikgewogICAgICAgIC8vIG9wZXJhIGxvd2VyIDEwLjYgbmVlZHMgYSBz
cGVjaWFsIHRyZWF0bWVudCBmb3IgaW5wdXQgZXZlbnRzIGJlY2F1c2UKICAgICAgICAvLyB0aGV5
IGFyZSBhbHNvIGZpcmVkIG9uIGJsdXIKICAgICAgICBpZiAoKHF4LmNvcmUuRW52aXJvbm1lbnQu
Z2V0KCJlbmdpbmUubmFtZSIpID09ICJvcGVyYSIpICYmCiAgICAgICAgICAgIHF4LmNvcmUuRW52
aXJvbm1lbnQuZ2V0KCJicm93c2VyLnZlcnNpb24iKSA8IDEwLjYpIHsKICAgICAgICAgIHRoaXMu
X19vbklucHV0VGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAg
ICAgICAgIHF4LmV2ZW50LlJlZ2lzdHJhdGlvbi5maXJlRXZlbnQodGFyZ2V0LCAiaW5wdXQiLCBx
eC5ldmVudC50eXBlLkRhdGEsIFt0YXJnZXQudmFsdWVdKTsKICAgICAgICAgIH0sIDApOwogICAg
ICAgIH0gZWxzZSB7CiAgICAgICAgICBxeC5ldmVudC5SZWdpc3RyYXRpb24uZmlyZUV2ZW50KHRh
cmdldCwgImlucHV0IiwgcXguZXZlbnQudHlwZS5EYXRhLCBbdGFyZ2V0LnZhbHVlXSk7CiAgICAg
ICAgfQogICAgICB9CiAgICB9KSwKCgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbiBj
YWxsZWQgYnkgaW5wdXQgZWxlbWVudHMgY3JlYXRlZCB1c2luZyB7QGxpbmsgcXguYm9tLklucHV0
fS4KICAgICAqCiAgICAgKiBAc2lnbmF0dXJlIGZ1bmN0aW9uKGUpCiAgICAgKiBAcGFyYW0gZSB7
RXZlbnR9IE5hdGl2ZSBET00gZXZlbnQKICAgICAqLwogICAgX29uQ2hhbmdlVmFsdWUgOiBxeC5l
dmVudC5HbG9iYWxFcnJvci5vYnNlcnZlTWV0aG9kKGZ1bmN0aW9uKGUpCiAgICB7CiAgICAgIHZh
ciB0YXJnZXQgPSBxeC5ib20uRXZlbnQuZ2V0VGFyZ2V0KGUpOwogICAgICB2YXIgZGF0YSA9IHRh
cmdldC52YWx1ZTsKCiAgICAgIGlmICh0YXJnZXQudHlwZSA9PT0gInNlbGVjdC1tdWx0aXBsZSIp
CiAgICAgIHsKICAgICAgICB2YXIgZGF0YSA9IFtdOwogICAgICAgIGZvciAodmFyIGk9MCwgbz10
YXJnZXQub3B0aW9ucywgbD1vLmxlbmd0aDsgaTxsOyBpKyspCiAgICAgICAgewogICAgICAgICAg
aWYgKG9baV0uc2VsZWN0ZWQpIHsKICAgICAgICAgICAgZGF0YS5wdXNoKG9baV0udmFsdWUpOwog
ICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcXguZXZlbnQuUmVnaXN0cmF0aW9u
LmZpcmVFdmVudCh0YXJnZXQsICJjaGFuZ2UiLCBxeC5ldmVudC50eXBlLkRhdGEsIFtkYXRhXSk7
CiAgICB9KSwKCgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbiBjYWxsZWQgYnkgaW5w
dXQgZWxlbWVudHMgY3JlYXRlZCB1c2luZyB7QGxpbmsgcXguYm9tLklucHV0fS4KICAgICAqCiAg
ICAgKiBAc2lnbmF0dXJlIGZ1bmN0aW9uKGUpCiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9IE5hdGl2
ZSBET00gZXZlbnQKICAgICAqLwogICAgX29uQ2hhbmdlQ2hlY2tlZCA6IHF4LmV2ZW50Lkdsb2Jh
bEVycm9yLm9ic2VydmVNZXRob2QoZnVuY3Rpb24oZSkKICAgIHsKICAgICAgdmFyIHRhcmdldCA9
IHF4LmJvbS5FdmVudC5nZXRUYXJnZXQoZSk7CgogICAgICBpZiAodGFyZ2V0LnR5cGUgPT09ICJy
YWRpbyIpCiAgICAgIHsKICAgICAgICBpZiAodGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHF4
LmV2ZW50LlJlZ2lzdHJhdGlvbi5maXJlRXZlbnQodGFyZ2V0LCAiY2hhbmdlIiwgcXguZXZlbnQu
dHlwZS5EYXRhLCBbdGFyZ2V0LnZhbHVlXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UK
ICAgICAgewogICAgICAgIHF4LmV2ZW50LlJlZ2lzdHJhdGlvbi5maXJlRXZlbnQodGFyZ2V0LCAi
Y2hhbmdlIiwgcXguZXZlbnQudHlwZS5EYXRhLCBbdGFyZ2V0LmNoZWNrZWRdKTsKICAgICAgfQog
ICAgfSksCgoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZnVuY3Rpb24gY2FsbGVkIGJ5IGlucHV0
IGVsZW1lbnRzIGNyZWF0ZWQgdXNpbmcge0BsaW5rIHF4LmJvbS5JbnB1dH0uCiAgICAgKgogICAg
ICogQHNpZ25hdHVyZSBmdW5jdGlvbihlKQogICAgICogQHBhcmFtIGUge0V2ZW50fSBOYXRpdmUg
RE9NIGV2ZW50CiAgICAgKi8KICAgIF9vblByb3BlcnR5IDogcXguY29yZS5FbnZpcm9ubWVudC5z
ZWxlY3QoImVuZ2luZS5uYW1lIiwKICAgIHsKICAgICAgIm1zaHRtbCIgOiBxeC5ldmVudC5HbG9i
YWxFcnJvci5vYnNlcnZlTWV0aG9kKGZ1bmN0aW9uKGUpCiAgICAgIHsKICAgICAgICB2YXIgdGFy
Z2V0ID0gcXguYm9tLkV2ZW50LmdldFRhcmdldChlKTsKICAgICAgICB2YXIgcHJvcCA9IGUucHJv
cGVydHlOYW1lOwoKICAgICAgICBpZiAocHJvcCA9PT0gInZhbHVlIiAmJiAodGFyZ2V0LnR5cGUg
PT09ICJ0ZXh0IiB8fCB0YXJnZXQudHlwZSA9PT0gInBhc3N3b3JkIiB8fCB0YXJnZXQudGFnTmFt
ZS50b0xvd2VyQ2FzZSgpID09PSAidGV4dGFyZWEiKSkKICAgICAgICB7CiAgICAgICAgICBpZiAo
IXRhcmdldC4kJGluVmFsdWVTZXQpIHsKICAgICAgICAgICAgcXguZXZlbnQuUmVnaXN0cmF0aW9u
LmZpcmVFdmVudCh0YXJnZXQsICJpbnB1dCIsIHF4LmV2ZW50LnR5cGUuRGF0YSwgW3RhcmdldC52
YWx1ZV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChwcm9wID09PSAi
Y2hlY2tlZCIpCiAgICAgICAgewogICAgICAgICAgaWYgKHRhcmdldC50eXBlID09PSAiY2hlY2ti
b3giKSB7CiAgICAgICAgICAgIHF4LmV2ZW50LlJlZ2lzdHJhdGlvbi5maXJlRXZlbnQodGFyZ2V0
LCAiY2hhbmdlIiwgcXguZXZlbnQudHlwZS5EYXRhLCBbdGFyZ2V0LmNoZWNrZWRdKTsKICAgICAg
ICAgIH0gZWxzZSBpZiAodGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgICAgcXguZXZlbnQuUmVn
aXN0cmF0aW9uLmZpcmVFdmVudCh0YXJnZXQsICJjaGFuZ2UiLCBxeC5ldmVudC50eXBlLkRhdGEs
IFt0YXJnZXQudmFsdWVdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLAoKICAgICAg
ImRlZmF1bHQiIDogZnVuY3Rpb24oKSB7fQogICAgfSkKICB9LAoKCgoKCiAgLyoKICAqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKgogICAgIERFRkVSCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAqLwoKICBk
ZWZlciA6IGZ1bmN0aW9uKHN0YXRpY3MpIHsKICAgIHF4LmV2ZW50LlJlZ2lzdHJhdGlvbi5hZGRI
YW5kbGVyKHN0YXRpY3MpOwogIH0KfSk7Cg==
</data>

          </attachment>
      

    </bug>