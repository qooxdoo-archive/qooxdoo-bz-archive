<bug>
          <bug_id>731</bug_id>
          
          <creation_ts>2007-11-28 17:05:00 +0100</creation_ts>
          <short_desc>table.pane.Scroller scroll timeout problems</short_desc>
          <delta_ts>2014-03-03 15:18:59 +0100</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>framework</product>
          <component>desktop.table</component>
          <version>0.7.2</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          
          <priority>P4</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>0.7.3</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hugh Gibson">hgibson</reporter>
          <assigned_to name="Unassigned">none</assigned_to>
          
          <qa_contact name="qooxdoo bugs mailing list">qooxdoo-bugs</qa_contact>
          <cf_browser>---</cf_browser>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>2566</commentid>
            <who name="Hugh Gibson">hgibson</who>
            <bug_when>2007-11-28 17:05:31 +0100</bug_when>
            <thetext>table.pane.Scroller has a property scrollTimeout which sets the interval for the scroller to check whether updates are necessary. It sets up a timer to call _oninterval regularly.

The implementation of _applyScrollTimeout simply toggles between enabling and disabling the timer. Therefore if setScrollTimeout is called with a second value it will kill the timer, and setScrollTimeout has to be called with a third value to enable it again. Ideally setting the scrollTimeout to 0 should kill the timer.

I just hit another issue with this, when my app was disposing a table and starting a new one - the Scroller object was disposed but Scroller._oninterval was being called every 100ms. this._tablePane was null so an error was thrown. I got a few thousand errors...

Therefore _oninterval should check if the object is disposed or not (see for example ui.table.Table.postponedUpdateContent which sets up a timer, which checks for object disposal first). Also the timer should be disposed of when the Scroller object is disposed.

Hugh</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>2567</commentid>
              <attachid>269</attachid>
            <who name="Hugh Gibson">hgibson</who>
            <bug_when>2007-11-29 11:08:05 +0100</bug_when>
            <thetext>Created attachment 269
Fixes scrollTimeout application

I see that checkin 10711 dated 30 Oct 2007 in legacy_0_7_x added code in the destructor to clear the timeout interval. 

This still leaves the incorrect set up of scrollTimeout, requiring an odd number of calls to enable it and an even number of calls to disable it.

I&#39;ve attached a patch to fix this in legacy_0_7_x. Note that the documentation for it is updated too.

Hugh</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>2678</commentid>
            <who name="Sebastian Werner">info</who>
            <bug_when>2008-01-11 11:18:45 +0100</bug_when>
            <thetext>Til is not actively working on qooxdoo anymore.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>2689</commentid>
            <who name="Fabian Jakobs">fabian.jakobs</who>
            <bug_when>2008-01-11 11:47:52 +0100</bug_when>
            <thetext>Thanks for the patch. It&#39;s fixed in legacy and trunk now.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>36297</commentid>
            <who name="Martin Wittemann">martin.wittemann</who>
            <bug_when>2014-03-03 15:18:59 +0100</bug_when>
            <thetext>Closed all bugs already shipped with a release.</thetext>
          </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0" isurl="0">
            <attachid>269</attachid>
            <date>2007-11-29 11:08:00 +0100</date>
            <delta_ts>2007-11-29 11:08:05 +0100</delta_ts>
            <desc>Fixes scrollTimeout application</desc>
            <filename>qxbug731.patch</filename>
            <type>text/plain</type>
            <size>123612</size>
            <attacher>hgibson</attacher>
            
              <data encoding="base64">SW5kZXg6IFNjcm9sbGVyLmpzDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gU2Nyb2xsZXIuanMJKHJldmlzaW9u
IDEwODM0KQ0KKysrIFNjcm9sbGVyLmpzCSh3b3JraW5nIGNvcHkpDQpAQCAtMSwyMTI2ICsxLDIx
MjkgQEANCi0vKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioKLQotICAgcW9veGRvbyAtIHRoZSBuZXcgZXJhIG9m
IHdlYiBkZXZlbG9wbWVudAotCi0gICBodHRwOi8vcW9veGRvby5vcmcKLQotICAgQ29weXJpZ2h0
OgotICAgICAyMDA2IFNUWi1JREEsIEdlcm1hbnksIGh0dHA6Ly93d3cuc3R6LWlkYS5kZQotCi0g
ICBMaWNlbnNlOgotICAgICBMR1BMOiBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvbGdwbC5o
dG1sCi0gICAgIEVQTDogaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9vcmcvZG9jdW1lbnRzL2VwbC12
MTAucGhwCi0gICAgIFNlZSB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSBwcm9qZWN0J3MgdG9wLWxl
dmVsIGRpcmVjdG9yeSBmb3IgZGV0YWlscy4KLQotICAgQXV0aG9yczoKLSAgICAgKiBUaWwgU2No
bmVpZGVyICh0aWwxMzIpCi0KLSoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwotCi0vKiAqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioKLQotI21vZHVsZSh1aV90YWJsZSkKLQotKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovCi0KLS8qKgotICog
U2hvd3MgYSB3aG9sZSBtZXRhIGNvbHVtbi4gVGhpcyBpbmNsdWRlcyBhIHtAbGluayBUYWJsZVBh
bmVIZWFkZXJ9LAotICogYSB7QGxpbmsgVGFibGVQYW5lfSBhbmQgdGhlIG5lZWRlZCBzY3JvbGwg
YmFycy4gVGhpcyBjbGFzcyBoYW5kbGVzIHRoZQotICogdmlydHVhbCBzY3JvbGxpbmcgYW5kIGRv
ZXMgYWxsIHRoZSBtb3VzZSBldmVudCBoYW5kbGluZy4KLSAqCi0gKiBAYXBwZWFyYW5jZSB0YWJs
ZS1mb2N1cy1pbmRpY2F0b3Ige3F4LnVpLmxheW91dC5Ib3Jpem9udGFsQm94TGF5b3V0fQotICov
Ci1xeC5DbGFzcy5kZWZpbmUoInF4LnVpLnRhYmxlLnBhbmUuU2Nyb2xsZXIiLAotewotICBleHRl
bmQgOiBxeC51aS5sYXlvdXQuVmVydGljYWxCb3hMYXlvdXQsCi0KLQotCi0KLSAgLyoKLSAgKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioKLSAgICAgQ09OU1RSVUNUT1IKLSAgKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioKLSAgKi8KLQotICAvKioKLSAgICogQHBhcmFtIHRhYmxlIHtxeC51aS50YWJsZS5UYWJsZX0g
dGhlIHRhYmxlIHRoZSBzY3JvbGxlciBiZWxvbmdzIHRvLgotICAgKi8KLSAgY29uc3RydWN0IDog
ZnVuY3Rpb24odGFibGUpCi0gIHsKLSAgICB0aGlzLmJhc2UoYXJndW1lbnRzKTsKLQotICAgIHRo
aXMuX3RhYmxlID0gdGFibGU7Ci0KLSAgICAvLyBpbml0IHNjcm9sbGJhcnMKLSAgICB0aGlzLl92
ZXJTY3JvbGxCYXIgPSBuZXcgcXgudWkuYmFzaWMuU2Nyb2xsQmFyKGZhbHNlKTsKLSAgICB0aGlz
Ll9ob3JTY3JvbGxCYXIgPSBuZXcgcXgudWkuYmFzaWMuU2Nyb2xsQmFyKHRydWUpOwotCi0gICAg
dmFyIHNjcm9sbEJhcldpZHRoID0gdGhpcy5fdmVyU2Nyb2xsQmFyLmdldFByZWZlcnJlZEJveFdp
ZHRoKCk7Ci0KLSAgICB0aGlzLl92ZXJTY3JvbGxCYXIuc2V0V2lkdGgoImF1dG8iKTsKLSAgICB0
aGlzLl9ob3JTY3JvbGxCYXIuc2V0SGVpZ2h0KCJhdXRvIik7Ci0gICAgdGhpcy5faG9yU2Nyb2xs
QmFyLnNldFBhZGRpbmdSaWdodChzY3JvbGxCYXJXaWR0aCk7Ci0gICAgdGhpcy5faG9yU2Nyb2xs
QmFyLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZVZhbHVlIiwgdGhpcy5fb25TY3JvbGxYLCB0aGlz
KTsKLSAgICB0aGlzLl92ZXJTY3JvbGxCYXIuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlVmFsdWUi
LCB0aGlzLl9vblNjcm9sbFksIHRoaXMpOwotCi0gICAgLy8gaW5pdCBoZWFkZXIKLSAgICB0aGlz
Ll9oZWFkZXIgPSB0aGlzLmdldFRhYmxlKCkuZ2V0TmV3VGFibGVQYW5lSGVhZGVyKCkodGhpcyk7
Ci0KLSAgICB0aGlzLl9oZWFkZXIuc2V0KAotICAgIHsKLSAgICAgIHdpZHRoICA6ICJhdXRvIiwK
LSAgICAgIGhlaWdodCA6ICJhdXRvIgotICAgIH0pOwotCi0gICAgdGhpcy5faGVhZGVyQ2xpcHBl
ciA9IG5ldyBxeC51aS5sYXlvdXQuQ2FudmFzTGF5b3V0OwotICAgIHRoaXMuX2hlYWRlckNsaXBw
ZXIuc2V0RGltZW5zaW9uKCIxKiIsICJhdXRvIik7Ci0gICAgdGhpcy5faGVhZGVyQ2xpcHBlci5z
ZXRPdmVyZmxvdygiaGlkZGVuIik7Ci0gICAgdGhpcy5faGVhZGVyQ2xpcHBlci5hZGQodGhpcy5f
aGVhZGVyKTsKLQotICAgIHRoaXMuX3NwYWNlciA9IG5ldyBxeC51aS5iYXNpYy5UZXJtaW5hdG9y
OwotICAgIHRoaXMuX3NwYWNlci5zZXRXaWR0aChzY3JvbGxCYXJXaWR0aCk7Ci0KLSAgICB0aGlz
Ll90b3AgPSBuZXcgcXgudWkubGF5b3V0Lkhvcml6b250YWxCb3hMYXlvdXQ7Ci0gICAgdGhpcy5f
dG9wLnNldEhlaWdodCgiYXV0byIpOwotICAgIHRoaXMuX3RvcC5hZGQodGhpcy5faGVhZGVyQ2xp
cHBlciwgdGhpcy5fc3BhY2VyKTsKLQotICAgIC8vIGluaXQgcGFuZQotICAgIHRoaXMuX3RhYmxl
UGFuZSA9IHRoaXMuZ2V0VGFibGUoKS5nZXROZXdUYWJsZVBhbmUoKSh0aGlzKTsKLQotICAgIHRo
aXMuX3RhYmxlUGFuZS5zZXQoCi0gICAgewotICAgICAgd2lkdGggIDogImF1dG8iLAotICAgICAg
aGVpZ2h0IDogImF1dG8iCi0gICAgfSk7Ci0KLSAgICB0aGlzLl9zaG93Q2VsbEZvY3VzSW5kaWNh
dG9yID0gdGhpcy5nZXRTaG93Q2VsbEZvY3VzSW5kaWNhdG9yKCk7Ci0KLSAgICB0aGlzLl9mb2N1
c0luZGljYXRvciA9IG5ldyBxeC51aS5sYXlvdXQuSG9yaXpvbnRhbEJveExheW91dDsKLSAgICB0
aGlzLl9mb2N1c0luZGljYXRvci5zZXRBcHBlYXJhbmNlKCJ0YWJsZS1mb2N1cy1pbmRpY2F0b3Ii
KTsKLSAgICB0aGlzLl9mb2N1c0luZGljYXRvci5zZXRTdHlsZVByb3BlcnR5KCJmb250U2l6ZSIs
ICIwcHgiKTsKLSAgICB0aGlzLl9mb2N1c0luZGljYXRvci5zZXRTdHlsZVByb3BlcnR5KCJsaW5l
SGVpZ2h0IiwgIjBweCIpOwotICAgIHRoaXMuX2ZvY3VzSW5kaWNhdG9yLmhpZGUoKTsKLQotICAg
IHRoaXMuX3BhbmVDbGlwcGVyID0gbmV3IHF4LnVpLmxheW91dC5DYW52YXNMYXlvdXQ7Ci0gICAg
dGhpcy5fcGFuZUNsaXBwZXIuc2V0V2lkdGgoIjEqIik7Ci0gICAgdGhpcy5fcGFuZUNsaXBwZXIu
c2V0T3ZlcmZsb3coImhpZGRlbiIpOwotICAgIHRoaXMuX3BhbmVDbGlwcGVyLmFkZCh0aGlzLl90
YWJsZVBhbmUsIHRoaXMuX2ZvY3VzSW5kaWNhdG9yKTsKLSAgICB0aGlzLl9wYW5lQ2xpcHBlci5h
ZGRFdmVudExpc3RlbmVyKCJtb3VzZXdoZWVsIiwgdGhpcy5fb25tb3VzZXdoZWVsLCB0aGlzKTsK
LQotICAgIC8vIGFkZCBhbGwgY2hpbGQgd2lkZ2V0cwotICAgIHZhciBzY3JvbGxlckJvZHkgPSBu
ZXcgcXgudWkubGF5b3V0Lkhvcml6b250YWxCb3hMYXlvdXQ7Ci0gICAgc2Nyb2xsZXJCb2R5LnNl
dEhlaWdodCgiMSoiKTsKLSAgICBzY3JvbGxlckJvZHkuYWRkKHRoaXMuX3BhbmVDbGlwcGVyLCB0
aGlzLl92ZXJTY3JvbGxCYXIpOwotCi0gICAgdGhpcy5hZGQodGhpcy5fdG9wLCBzY3JvbGxlckJv
ZHksIHRoaXMuX2hvclNjcm9sbEJhcik7Ci0KLSAgICAvLyBpbml0IGV2ZW50IGhhbmRsZXJzCi0g
ICAgdGhpcy5faGVhZGVyQ2xpcHBlci5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2VDYXB0dXJlIiwg
dGhpcy5fb25DaGFuZ2VDYXB0dXJlSGVhZGVyLCB0aGlzKTsKLQotICAgIHRoaXMuX2hlYWRlckNs
aXBwZXIuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgdGhpcy5fb25tb3VzZW1vdmVIZWFk
ZXIsIHRoaXMpOwotICAgIHRoaXMuX3BhbmVDbGlwcGVyLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNl
bW92ZSIsIHRoaXMuX29ubW91c2Vtb3ZlUGFuZSwgdGhpcyk7Ci0KLSAgICB0aGlzLl9oZWFkZXJD
bGlwcGVyLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIHRoaXMuX29ubW91c2Vkb3duSGVh
ZGVyLCB0aGlzKTsKLSAgICB0aGlzLl9wYW5lQ2xpcHBlci5hZGRFdmVudExpc3RlbmVyKCJtb3Vz
ZWRvd24iLCB0aGlzLl9vbm1vdXNlZG93blBhbmUsIHRoaXMpOwotCi0gICAgdGhpcy5faGVhZGVy
Q2xpcHBlci5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgdGhpcy5fb25tb3VzZXVwSGVhZGVy
LCB0aGlzKTsKLSAgICB0aGlzLl9wYW5lQ2xpcHBlci5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVw
IiwgdGhpcy5fb25tb3VzZXVwUGFuZSwgdGhpcyk7Ci0KLSAgICB0aGlzLl9oZWFkZXJDbGlwcGVy
LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy5fb25jbGlja0hlYWRlciwgdGhpcyk7Ci0g
ICAgdGhpcy5fcGFuZUNsaXBwZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLl9vbmNs
aWNrUGFuZSwgdGhpcyk7Ci0gICAgdGhpcy5fcGFuZUNsaXBwZXIuYWRkRXZlbnRMaXN0ZW5lcigi
Y29udGV4dG1lbnUiLCB0aGlzLl9vbkNvbnRleHRNZW51LCB0aGlzKTsKLSAgICB0aGlzLl9wYW5l
Q2xpcHBlci5hZGRFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIHRoaXMuX29uZGJsY2xpY2tQYW5l
LCB0aGlzKTsKLQotICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdXQiLCB0aGlzLl9v
bm1vdXNlb3V0LCB0aGlzKTsKLQotICAgIHRoaXMuaW5pdFNjcm9sbFRpbWVvdXQoKTsKLSAgfSwK
LQotCi0KLQotICAvKgotICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgotICAgICBTVEFUSUNTCi0gICoq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqCi0gICovCi0KLSAgc3RhdGljcyA6Ci0gIHsKLQotICAgIC8qKiB7
aW50fSBUaGUgbWluaW11bSB3aWR0aCBhIGNvbHVtIGNvdWxkIGdldCBpbiBwaXhlbHMuICovCi0g
ICAgTUlOX0NPTFVNTl9XSURUSCAgICAgICAgIDogMTAsCi0KLSAgICAvKioge2ludH0gVGhlIHJh
ZGl1cyBvZiB0aGUgcmVzaXplIHJlZ2lvbiBpbiBwaXhlbHMuICovCi0gICAgUkVTSVpFX1JFR0lP
Tl9SQURJVVMgICAgIDogNSwKLQotCi0gICAgLyoqCi0gICAgICogKGludCkgVGhlIG51bWJlciBv
ZiBwaXhlbHMgdGhlIG1vdXNlIG1heSBtb3ZlIGJldHdlZW4gbW91c2UgZG93biBhbmQgbW91c2Ug
dXAKLSAgICAgKiBpbiBvcmRlciB0byBjb3VudCBhcyBhIGNsaWNrLgotICAgICAqLwotICAgIENM
SUNLX1RPTEVSQU5DRSAgICAgICAgICA6IDUsCi0KLQotICAgIC8qKgotICAgICAqIChpbnQpIFRo
ZSBtYXNrIGZvciB0aGUgaG9yaXpvbnRhbCBzY3JvbGwgYmFyLgotICAgICAqIE1heSBiZSBjb21i
aW5lZCB3aXRoIHtAbGluayAjVkVSVElDQUxfU0NST0xMQkFSfS4KLSAgICAgKgotICAgICAqIEBz
ZWUgI2dldE5lZWRlZFNjcm9sbEJhcnMKLSAgICAgKi8KLSAgICBIT1JJWk9OVEFMX1NDUk9MTEJB
UiAgICAgOiAxLAotCi0KLSAgICAvKioKLSAgICAgKiAoaW50KSBUaGUgbWFzayBmb3IgdGhlIHZl
cnRpY2FsIHNjcm9sbCBiYXIuCi0gICAgICogTWF5IGJlIGNvbWJpbmVkIHdpdGgge0BsaW5rICNI
T1JJWk9OVEFMX1NDUk9MTEJBUn0uCi0gICAgICoKLSAgICAgKiBAc2VlICNnZXROZWVkZWRTY3Jv
bGxCYXJzCi0gICAgICovCi0gICAgVkVSVElDQUxfU0NST0xMQkFSICAgICAgIDogMiwKLQotCi0g
ICAgLyoqCi0gICAgICogKHN0cmluZykgVGhlIGNvcnJlY3QgdmFsdWUgZm9yIHRoZSBDU1Mgc3R5
bGUgYXR0cmlidXRlICJjdXJzb3IiIGZvciB0aGUKLSAgICAgKiBob3Jpem9udGFsIHJlc2l6ZSBj
dXJzb3IuCi0gICAgICovCi0gICAgQ1VSU09SX1JFU0laRV9IT1JJWk9OVEFMIDogKHF4LmNvcmUu
Q2xpZW50LmdldEluc3RhbmNlKCkuaXNHZWNrbygpICYmIChxeC5jb3JlLkNsaWVudC5nZXRJbnN0
YW5jZSgpLmdldE1ham9yKCkgPiAxIHx8IHF4LmNvcmUuQ2xpZW50LmdldEluc3RhbmNlKCkuZ2V0
TWlub3IoKSA+PSA4KSkgPyAiZXctcmVzaXplIiA6ICJlLXJlc2l6ZSIKLSAgfSwKLQotCi0KLQot
ICAvKgotICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKgotICAgICBQUk9QRVJUSUVTCi0gICoqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqCi0gICovCi0KLSAgZXZlbnRzIDoKLSAgewotICAgIC8qKiBEaXNwYXRjaGVk
IGlmIHRoZSBwYW5lIGlzIHNjb2xsZWQgaG9yaXpvbnRhbGx5ICovCi0gICAgImNoYW5nZVNjcm9s
bFkiIDogInF4LmV2ZW50LnR5cGUuQ2hhbmdlRXZlbnQiLAotCi0gICAgLyoqIERpc3BhdGNoZWQg
aWYgdGhlIHBhbmUgaXMgc2Nyb2xsZWQgdmVydGljYWxseSAqLwotICAgICJjaGFuZ2VTY3JvbGxY
IiA6ICJxeC5ldmVudC50eXBlLkNoYW5nZUV2ZW50IiwKLQotICAgIC8qKlNlZSB7QGxpbmsgcXgu
dWkudGFibGUuVGFibGUjY2VsbENsaWNrfS4qLwotICAgICJjZWxsQ2xpY2siIDogInF4LnVpLnRh
YmxlLnBhbmUuQ2VsbEV2ZW50IiwKLQotICAgIC8qKiogU2VlIHtAbGluayBxeC51aS50YWJsZS5U
YWJsZSNjZWxsRGJsY2xpY2t9LiovCi0gICAgImNlbGxEYmxjbGljayIgOiAicXgudWkudGFibGUu
cGFuZS5DZWxsRXZlbnQiLAotCi0gICAgLyoqU2VlIHtAbGluayBxeC51aS50YWJsZS5UYWJsZSNj
ZWxsQ29udGV4dG1lbnV9LiovCi0gICAgImNlbGxDb250ZXh0bWVudSIgOiAicXgudWkudGFibGUu
cGFuZS5DZWxsRXZlbnQiCi0gIH0sCi0KLQotCi0KLQotICAvKgotICAqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKgotICAgICBQUk9QRVJUSUVTCi0gICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi0gICovCi0KLSAg
cHJvcGVydGllcyA6Ci0gIHsKLQotICAgIC8qKiBXaGV0aGVyIHRvIHNob3cgdGhlIGhvcml6b250
YWwgc2Nyb2xsIGJhciAqLwotICAgIGhvcml6b250YWxTY3JvbGxCYXJWaXNpYmxlIDoKLSAgICB7
Ci0gICAgICBjaGVjayA6ICJCb29sZWFuIiwKLSAgICAgIGluaXQgOiB0cnVlLAotICAgICAgYXBw
bHkgOiAiX2FwcGx5SG9yaXpvbnRhbFNjcm9sbEJhclZpc2libGUiLAotICAgICAgZXZlbnQgOiAi
Y2hhbmdlSG9yaXpvbnRhbFNjcm9sbEJhclZpc2libGUiCi0gICAgfSwKLQotICAgIC8qKiBXaGV0
aGVyIHRvIHNob3cgdGhlIHZlcnRpY2FsIHNjcm9sbCBiYXIgKi8KLSAgICB2ZXJ0aWNhbFNjcm9s
bEJhclZpc2libGUgOgotICAgIHsKLSAgICAgIGNoZWNrIDogIkJvb2xlYW4iLAotICAgICAgaW5p
dCA6IHRydWUsCi0gICAgICBhcHBseSA6ICJfYXBwbHlWZXJ0aWNhbFNjcm9sbEJhclZpc2libGUi
LAotICAgICAgZXZlbnQgOiAiY2hhbmdlVmVydGljYWxTY3JvbGxCYXJWaXNpYmxlIgotICAgIH0s
Ci0KLSAgICAvKiogVGhlIHRhYmxlIHBhbmUgbW9kZWwuICovCi0gICAgdGFibGVQYW5lTW9kZWwg
OgotICAgIHsKLSAgICAgIGNoZWNrIDogInF4LnVpLnRhYmxlLnBhbmUuTW9kZWwiLAotICAgICAg
YXBwbHkgOiAiX2FwcGx5VGFibGVQYW5lTW9kZWwiLAotICAgICAgZXZlbnQgOiAiY2hhbmdlVGFi
bGVQYW5lTW9kZWwiCi0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogV2hldGhlciBjb2x1bW4g
cmVzaXplIHNob3VsZCBiZSBsaXZlLiBJZiBmYWxzZSwgZHVyaW5nIHJlc2l6ZSBvbmx5IGEgbGlu
ZSBpcwotICAgICAqIHNob3duIGFuZCB0aGUgcmVhbCByZXNpemUgaGFwcGVucyB3aGVuIHRoZSB1
c2VyIHJlbGVhc2VzIHRoZSBtb3VzZSBidXR0b24uCi0gICAgICovCi0gICAgbGl2ZVJlc2l6ZSA6
Ci0gICAgewotICAgICAgY2hlY2sgOiAiQm9vbGVhbiIsCi0gICAgICBpbml0IDogZmFsc2UKLSAg
ICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBXaGV0aGVyIHRoZSBmb2N1cyBzaG91bGQgbW92ZWQg
d2hlbiB0aGUgbW91c2UgaXMgbW92ZWQgb3ZlciBhIGNlbGwuIElmIGZhbHNlCi0gICAgICogdGhl
IGZvY3VzIGlzIG9ubHkgbW92ZWQgb24gbW91c2UgY2xpY2tzLgotICAgICAqLwotICAgIGZvY3Vz
Q2VsbE9uTW91c2VNb3ZlIDoKLSAgICB7Ci0gICAgICBjaGVjayA6ICJCb29sZWFuIiwKLSAgICAg
IGluaXQgOiBmYWxzZQotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIFdoZXRoZXIgdG8gaGFu
ZGxlIHNlbGVjdGlvbnMgdmlhIHRoZSBzZWxlY3Rpb24gbWFuYWdlciBiZWZvcmUgc2V0dGluZyB0
aGUKLSAgICAgKiBmb2N1cy4gIFRoZSB0cmFkaXRpb25hbCBiZWhhdmlvciBpcyB0byBoYW5kbGUg
c2VsZWN0aW9ucyBhZnRlciBzZXR0aW5nIHRoZQotICAgICAqIGZvY3VzLCBidXQgc2V0dGluZyB0
aGUgZm9jdXMgbWVhbnMgcmVkcmF3aW5nIHBvcnRpb25zIG9mIHRoZSB0YWJsZSwgYW5kCi0gICAg
ICogc29tZSBzdWJjbGFzc2VzIG1heSB3YW50IHRvIG1vZGlmeSB0aGUgZGF0YSB0byBiZSBkaXNw
bGF5ZWQgYmFzZWQgb24gdGhlCi0gICAgICogc2VsZWN0aW9uLgotICAgICAqLwotICAgIHNlbGVj
dEJlZm9yZUZvY3VzIDoKLSAgICB7Ci0gICAgICBjaGVjayA6ICJCb29sZWFuIiwKLSAgICAgIGlu
aXQgOiBmYWxzZQotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIFdoZXRoZXIgdGhlIGNlbGwg
Zm9jdXMgaW5kaWNhdG9yIHNob3VsZCBiZSBzaG93bgotICAgICAqLwotICAgIHNob3dDZWxsRm9j
dXNJbmRpY2F0b3IgOgotICAgIHsKLSAgICAgIGNoZWNrIDogIkJvb2xlYW4iLAotICAgICAgaW5p
dCA6IHRydWUsCi0gICAgICBhcHBseSA6ICJfYXBwbHlTaG93Q2VsbEZvY3VzSW5kaWNhdG9yIgot
ICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEludGVydmFsIHRpbWUgKGluIG1pbGxpc2Vjb25k
cykgZm9yIHRoZSB0YWJsZSB1cGRhdGUgdGltZXIuCi0gICAgICovCi0gICAgc2Nyb2xsVGltZW91
dCA6Ci0gICAgewotICAgICAgY2hlY2sgOiAiSW50ZWdlciIsCi0gICAgICBpbml0IDogMTAwLAot
ICAgICAgYXBwbHkgOiAiX2FwcGx5U2Nyb2xsVGltZW91dCIKLSAgICB9Ci0KLSAgfSwKLQotCi0K
LQotICAvKgotICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgotICAgICBNRU1CRVJTCi0gICoqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqCi0gICovCi0KLSAgbWVtYmVycyA6Ci0gIHsKLSAgICAvLyBwcm9wZXJ0eSBt
b2RpZmllcgotICAgIF9hcHBseUhvcml6b250YWxTY3JvbGxCYXJWaXNpYmxlIDogZnVuY3Rpb24o
dmFsdWUsIG9sZCkKLSAgICB7Ci0gICAgICAvLyBXb3JrYXJvdW5kOiBXZSBjYW4ndCB1c2Ugc2V0
RGlzcGxheSwgYmVjYXVzZSB0aGUgc2Nyb2xsIGJhciBuZWVkcyBpdHMKLSAgICAgIC8vICAgICAg
IGNvcnJlY3QgaGVpZ2h0IGluIG9yZGVyIHRvIGNoZWNrIGl0cyB2YWx1ZS4gV2hlbiB1c2luZwot
ICAgICAgLy8gICAgICAgc2V0RGlzcGxheShmYWxzZSkgdGhlIGhlaWdodCBpc24ndCByZWxheW91
dGVkIGFueSBtb3JlCi0gICAgICBpZiAodmFsdWUpIHsKLSAgICAgICAgdGhpcy5faG9yU2Nyb2xs
QmFyLnNldEhlaWdodCgiYXV0byIpOwotICAgICAgfSBlbHNlIHsKLSAgICAgICAgdGhpcy5faG9y
U2Nyb2xsQmFyLnNldEhlaWdodCgwKTsKLSAgICAgIH0KLQotICAgICAgdGhpcy5faG9yU2Nyb2xs
QmFyLnNldFZpc2liaWxpdHkodmFsdWUpOwotICAgICAgdGhpcy5fdXBkYXRlQ29udGVudCgpOwot
ICAgIH0sCi0KLQotICAgIC8vIHByb3BlcnR5IG1vZGlmaWVyCi0gICAgX2FwcGx5VmVydGljYWxT
Y3JvbGxCYXJWaXNpYmxlIDogZnVuY3Rpb24odmFsdWUsIG9sZCkKLSAgICB7Ci0gICAgICAvLyBX
b3JrYXJvdW5kOiBTZWUgX2FwcGx5SG9yaXpvbnRhbFNjcm9sbEJhclZpc2libGUKLSAgICAgIGlm
ICh2YWx1ZSkgewotICAgICAgICB0aGlzLl92ZXJTY3JvbGxCYXIuc2V0V2lkdGgoImF1dG8iKTsK
LSAgICAgIH0gZWxzZSB7Ci0gICAgICAgIHRoaXMuX3ZlclNjcm9sbEJhci5zZXRXaWR0aCgwKTsK
LSAgICAgIH0KLQotICAgICAgdGhpcy5fdmVyU2Nyb2xsQmFyLnNldFZpc2liaWxpdHkodmFsdWUp
OwotCi0gICAgICB2YXIgc2Nyb2xsQmFyV2lkdGggPSB2YWx1ZSA/IHRoaXMuX3ZlclNjcm9sbEJh
ci5nZXRQcmVmZXJyZWRCb3hXaWR0aCgpIDogMDsKLSAgICAgIHRoaXMuX2hvclNjcm9sbEJhci5z
ZXRQYWRkaW5nUmlnaHQoc2Nyb2xsQmFyV2lkdGgpOwotICAgICAgdGhpcy5fc3BhY2VyLnNldFdp
ZHRoKHNjcm9sbEJhcldpZHRoKTsKLSAgICB9LAotCi0KLSAgICAvLyBwcm9wZXJ0eSBtb2RpZmll
cgotICAgIF9hcHBseVRhYmxlUGFuZU1vZGVsIDogZnVuY3Rpb24odmFsdWUsIG9sZCkKLSAgICB7
Ci0gICAgICBpZiAob2xkICE9IG51bGwpIHsKLSAgICAgICAgb2xkLnJlbW92ZUV2ZW50TGlzdGVu
ZXIoIm1vZGVsQ2hhbmdlZCIsIHRoaXMuX29uUGFuZU1vZGVsQ2hhbmdlZCwgdGhpcyk7Ci0gICAg
ICB9Ci0KLSAgICAgIHZhbHVlLmFkZEV2ZW50TGlzdGVuZXIoIm1vZGVsQ2hhbmdlZCIsIHRoaXMu
X29uUGFuZU1vZGVsQ2hhbmdlZCwgdGhpcyk7Ci0gICAgfSwKLQotCi0gICAgLy8gcHJvcGVydHkg
bW9kaWZpZXIKLSAgICBfYXBwbHlTaG93Q2VsbEZvY3VzSW5kaWNhdG9yIDogZnVuY3Rpb24odmFs
dWUsIG9sZCkgewotICAgICAgdGhpcy5fc2hvd0NlbGxGb2N1c0luZGljYXRvciA9IHZhbHVlOwot
Ci0gICAgICBpZih2YWx1ZSkgewotICAgICAgICB0aGlzLl91cGRhdGVGb2N1c0luZGljYXRvcigp
OwotICAgICAgfQotICAgICAgZWxzZSB7Ci0gICAgICAgIGlmKHRoaXMuX2ZvY3VzSW5kaWNhdG9y
KSB7Ci0gICAgICAgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3IuaGlkZSgpOwotICAgICAgICB9Ci0g
ICAgICB9Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogR2V0IHRoZSBjdXJyZW50IHBvc2l0
aW9uIG9mIHRoZSB2ZXJ0aWNhbCBzY3JvbGwgYmFyLgotICAgICAqCi0gICAgICogQHJldHVybiB7
SW50ZWdlcn0gVGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uLgotICAgICAqLwotICAgIGdldFNj
cm9sbFkgOiBmdW5jdGlvbigpIHsKLSAgICAgIHJldHVybiB0aGlzLl92ZXJTY3JvbGxCYXIuZ2V0
VmFsdWUoKTsKLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBTZXQgdGhlIGN1cnJlbnQgcG9z
aXRpb24gb2YgdGhlIHZlcnRpY2FsIHNjcm9sbCBiYXIuCi0gICAgICoKLSAgICAgKiBAcGFyYW0g
c2Nyb2xsWSB7SW50ZWdlcn0gVGhlIG5ldyBzY3JvbGwgcG9zaXRpb24uCi0gICAgICogQHBhcmFt
IHJlbmRlclN5bmMge0Jvb2xlYW4/ZmFsc2V9IFdoZXRoZXIgdGhlIHRhYmxlIHVwZGF0ZSBzaG91
bGQgYmUKLSAgICAgKiAgICAgcGVyZm9ybWVkIHN5bmNob25vdXNseS4KLSAgICAgKi8KLSAgICBz
ZXRTY3JvbGxZIDogZnVuY3Rpb24oc2Nyb2xsWSwgcmVuZGVyU3luYykKLSAgICB7Ci0gICAgICB0
aGlzLl9pZ25vcmVTY3JvbGxZRXZlbnQgPSByZW5kZXJTeW5jOwotICAgICAgdGhpcy5fdmVyU2Ny
b2xsQmFyLnNldFZhbHVlKHNjcm9sbFkpOwotICAgICAgaWYgKHJlbmRlclN5bmMpIHsKLSAgICAg
ICAgdGhpcy5fdXBkYXRlQ29udGVudCgpCi0gICAgICB9Ci0gICAgICB0aGlzLl9pZ25vcmVTY3Jv
bGxZRXZlbnQgPSBmYWxzZTsKLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBHZXQgdGhlIGN1
cnJlbnQgcG9zaXRpb24gb2YgdGhlIHZlcnRpY2FsIHNjcm9sbCBiYXIuCi0gICAgICoKLSAgICAg
KiBAcmV0dXJuIHtJbnRlZ2VyfSBUaGUgY3VycmVudCBzY3JvbGwgcG9zaXRpb24uCi0gICAgICov
Ci0gICAgZ2V0U2Nyb2xsWCA6IGZ1bmN0aW9uKCkgewotICAgICAgcmV0dXJuIHRoaXMuX2hvclNj
cm9sbEJhci5nZXRWYWx1ZSgpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIFNldCB0aGUg
Y3VycmVudCBwb3NpdGlvbiBvZiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhci4KLSAgICAgKgotICAg
ICAqIEBwYXJhbSBzY3JvbGxYIHtJbnRlZ2VyfSBUaGUgbmV3IHNjcm9sbCBwb3NpdGlvbi4KLSAg
ICAgKi8KLSAgICBzZXRTY3JvbGxYIDogZnVuY3Rpb24oc2Nyb2xsWCkKLSAgICB7Ci0gICAgICB0
aGlzLl9ob3JTY3JvbGxCYXIuc2V0VmFsdWUoc2Nyb2xsWCk7Ci0gICAgfSwKLQotCi0gICAgLyoq
Ci0gICAgICogUmV0dXJucyB0aGUgdGFibGUgdGhpcyBzY3JvbGxlciBiZWxvbmdzIHRvLgotICAg
ICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHJldHVybiB7cXgudWkudGFibGUuVGFi
bGV9IHRoZSB0YWJsZS4KLSAgICAgKi8KLSAgICBnZXRUYWJsZSA6IGZ1bmN0aW9uKCkgewotICAg
ICAgcmV0dXJuIHRoaXMuX3RhYmxlOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEV2ZW50
IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB2aXNpYmlsaXR5IG9mIGEgY29sdW1uIGhhcyBjaGFu
Z2VkLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHBhcmFtIGV2dCB7TWFw
fSB0aGUgZXZlbnQuCi0gICAgICogQHJldHVybiB7dm9pZH0KLSAgICAgKi8KLSAgICBfb25Db2xW
aXNpYmlsaXR5Q2hhbmdlZCA6IGZ1bmN0aW9uKGV2dCkKLSAgICB7Ci0gICAgICB0aGlzLl91cGRh
dGVIb3JTY3JvbGxCYXJNYXhpbXVtKCk7Ci0gICAgICB0aGlzLl91cGRhdGVGb2N1c0luZGljYXRv
cigpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3
aGVuIHRoZSB3aWR0aCBvZiBhIGNvbHVtbiBoYXMgY2hhbmdlZC4KLSAgICAgKgotICAgICAqIEB0
eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50LgotICAgICAqIEBy
ZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX29uQ29sV2lkdGhDaGFuZ2VkIDogZnVuY3Rpb24o
ZXZ0KQotICAgIHsKLSAgICAgIHRoaXMuX2hlYWRlci5fb25Db2xXaWR0aENoYW5nZWQoZXZ0KTsK
LSAgICAgIHRoaXMuX3RhYmxlUGFuZS5fb25Db2xXaWR0aENoYW5nZWQoZXZ0KTsKLQotICAgICAg
dmFyIGRhdGEgPSBldnQuZ2V0RGF0YSgpOwotICAgICAgdmFyIHBhbmVNb2RlbCA9IHRoaXMuZ2V0
VGFibGVQYW5lTW9kZWwoKTsKLSAgICAgIHZhciB4ID0gcGFuZU1vZGVsLmdldFgoZGF0YS5jb2wp
OwotCi0gICAgICBpZiAoeCAhPSAtMSkKLSAgICAgIHsKLSAgICAgICAgLy8gVGhlIGNoYW5nZSB3
YXMgaW4gdGhpcyBzY3JvbGxlcgotICAgICAgICB0aGlzLl91cGRhdGVIb3JTY3JvbGxCYXJNYXhp
bXVtKCk7Ci0gICAgICAgIHRoaXMuX3VwZGF0ZUZvY3VzSW5kaWNhdG9yKCk7Ci0gICAgICB9Ci0g
ICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhl
IGNvbHVtbiBvcmRlciBoYXMgY2hhbmdlZC4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgot
ICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50LgotICAgICAqIEByZXR1cm4ge3ZvaWR9
Ci0gICAgICovCi0gICAgX29uQ29sT3JkZXJDaGFuZ2VkIDogZnVuY3Rpb24oZXZ0KQotICAgIHsK
LSAgICAgIHRoaXMuX2hlYWRlci5fb25Db2xPcmRlckNoYW5nZWQoZXZ0KTsKLSAgICAgIHRoaXMu
X3RhYmxlUGFuZS5fb25Db2xPcmRlckNoYW5nZWQoZXZ0KTsKLQotICAgICAgdGhpcy5fdXBkYXRl
SG9yU2Nyb2xsQmFyTWF4aW11bSgpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEV2ZW50
IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB0YWJsZSBtb2RlbCBoYXMgY2hhbmdlZC4KLSAgICAg
KgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50
LgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX29uVGFibGVNb2RlbERhdGFD
aGFuZ2VkIDogZnVuY3Rpb24oZXZ0KQotICAgIHsKLSAgICAgIHRoaXMuX3RhYmxlUGFuZS5fb25U
YWJsZU1vZGVsRGF0YUNoYW5nZWQoZXZ0KTsKLQotICAgICAgdmFyIHJvd0NvdW50ID0gdGhpcy5n
ZXRUYWJsZSgpLmdldFRhYmxlTW9kZWwoKS5nZXRSb3dDb3VudCgpOwotCi0gICAgICBpZiAocm93
Q291bnQgIT0gdGhpcy5fbGFzdFJvd0NvdW50KQotICAgICAgewotICAgICAgICB0aGlzLl9sYXN0
Um93Q291bnQgPSByb3dDb3VudDsKLQotICAgICAgICB0aGlzLl91cGRhdGVWZXJTY3JvbGxCYXJN
YXhpbXVtKCk7Ci0KLSAgICAgICAgaWYgKHRoaXMuZ2V0Rm9jdXNlZFJvdygpID49IHJvd0NvdW50
KQotICAgICAgICB7Ci0gICAgICAgICAgaWYgKHJvd0NvdW50ID09IDApIHsKLSAgICAgICAgICAg
IHRoaXMuc2V0Rm9jdXNlZENlbGwobnVsbCwgbnVsbCk7Ci0gICAgICAgICAgfSBlbHNlIHsKLSAg
ICAgICAgICAgIHRoaXMuc2V0Rm9jdXNlZENlbGwodGhpcy5nZXRGb2N1c2VkQ29sdW1uKCksIHJv
d0NvdW50IC0gMSk7Ci0gICAgICAgICAgfQotICAgICAgICB9Ci0gICAgICB9Ci0gICAgfSwKLQot
Ci0gICAgLyoqCi0gICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHNlbGVjdGlv
biBoYXMgY2hhbmdlZC4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJh
bSBldnQge01hcH0gdGhlIGV2ZW50LgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0g
ICAgX29uU2VsZWN0aW9uQ2hhbmdlZCA6IGZ1bmN0aW9uKGV2dCkgewotICAgICAgdGhpcy5fdGFi
bGVQYW5lLl9vblNlbGVjdGlvbkNoYW5nZWQoZXZ0KTsKLSAgICB9LAotCi0KLSAgICAvKioKLSAg
ICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgZ2V0cyBvciBsb29zZXMg
dGhlIGZvY3VzLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHBhcmFtIGV2
dCB7TWFwfSB0aGUgZXZlbnQuCi0gICAgICogQHJldHVybiB7dm9pZH0KLSAgICAgKi8KLSAgICBf
b25Gb2N1c0NoYW5nZWQgOiBmdW5jdGlvbihldnQpCi0gICAgewotICAgICAgdGhpcy5fdGFibGVQ
YW5lLl9vbkZvY3VzQ2hhbmdlZChldnQpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEV2
ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB0YWJsZSBtb2RlbCBtZXRhIGRhdGEgaGFzIGNo
YW5nZWQuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcGFyYW0gZXZ0IHtN
YXB9IHRoZSBldmVudC4KLSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAgICAqLwotICAgIF9vblRh
YmxlTW9kZWxNZXRhRGF0YUNoYW5nZWQgOiBmdW5jdGlvbihldnQpCi0gICAgewotICAgICAgdGhp
cy5faGVhZGVyLl9vblRhYmxlTW9kZWxNZXRhRGF0YUNoYW5nZWQoZXZ0KTsKLSAgICAgIHRoaXMu
X3RhYmxlUGFuZS5fb25UYWJsZU1vZGVsTWV0YURhdGFDaGFuZ2VkKGV2dCk7Ci0gICAgfSwKLQot
Ci0gICAgLyoqCi0gICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHBhbmUgbW9k
ZWwgaGFzIGNoYW5nZWQuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcGFy
YW0gZXZ0IHtNYXB9IHRoZSBldmVudC4KLSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAgICAqLwot
ICAgIF9vblBhbmVNb2RlbENoYW5nZWQgOiBmdW5jdGlvbihldnQpCi0gICAgewotICAgICAgdGhp
cy5faGVhZGVyLl9vblBhbmVNb2RlbENoYW5nZWQoZXZ0KTsKLSAgICAgIHRoaXMuX3RhYmxlUGFu
ZS5fb25QYW5lTW9kZWxDaGFuZ2VkKGV2dCk7Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICog
VXBkYXRlcyB0aGUgbWF4aW11bSBvZiB0aGUgaG9yaXpvbnRhbCBzY3JvbGwgYmFyLCBzbyBpdCBj
b3JyZXNwb25kcyB0byB0aGUKLSAgICAgKiB0b3RhbCB3aWR0aCBvZiB0aGUgY29sdW1ucyBpbiB0
aGUgdGFibGUgcGFuZS4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEByZXR1
cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX3VwZGF0ZUhvclNjcm9sbEJhck1heGltdW0gOiBmdW5j
dGlvbigpIHsKLSAgICAgIHRoaXMuX2hvclNjcm9sbEJhci5zZXRNYXhpbXVtKHRoaXMuZ2V0VGFi
bGVQYW5lTW9kZWwoKS5nZXRUb3RhbFdpZHRoKCkpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAg
ICAqIFVwZGF0ZXMgdGhlIG1heGltdW0gb2YgdGhlIHZlcnRpY2FsIHNjcm9sbCBiYXIsIHNvIGl0
IGNvcnJlc3BvbmRzIHRvIHRoZQotICAgICAqIG51bWJlciBvZiByb3dzIGluIHRoZSB0YWJsZS4K
LSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAg
ICovCi0gICAgX3VwZGF0ZVZlclNjcm9sbEJhck1heGltdW0gOiBmdW5jdGlvbigpCi0gICAgewot
ICAgICAgdmFyIHJvd0NvdW50ID0gdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlTW9kZWwoKS5nZXRS
b3dDb3VudCgpOwotICAgICAgdmFyIHJvd0hlaWdodCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRSb3dI
ZWlnaHQoKTsKLQotICAgICAgaWYgKHRoaXMuZ2V0VGFibGUoKS5nZXRLZWVwRmlyc3RWaXNpYmxl
Um93Q29tcGxldGUoKSkgewotICAgICAgICB0aGlzLl92ZXJTY3JvbGxCYXIuc2V0TWF4aW11bSgo
cm93Q291bnQgKyAxKSAqIHJvd0hlaWdodCk7Ci0gICAgICB9IGVsc2UgewotICAgICAgICB0aGlz
Ll92ZXJTY3JvbGxCYXIuc2V0TWF4aW11bShyb3dDb3VudCAqIHJvd0hlaWdodCk7Ci0gICAgICB9
Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4g
dGhlIHRhYmxlIHByb3BlcnR5ICJrZWVwRmlyc3RWaXNpYmxlUm93Q29tcGxldGUiCi0gICAgICog
Y2hhbmdlZC4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEByZXR1cm4ge3Zv
aWR9Ci0gICAgICovCi0gICAgX29uS2VlcEZpcnN0VmlzaWJsZVJvd0NvbXBsZXRlQ2hhbmdlZCA6
IGZ1bmN0aW9uKCkKLSAgICB7Ci0gICAgICB0aGlzLl91cGRhdGVWZXJTY3JvbGxCYXJNYXhpbXVt
KCk7Ci0gICAgICB0aGlzLl91cGRhdGVDb250ZW50KCk7Ci0gICAgfSwKLQotCi0gICAgLy8gb3Zl
cnJpZGRlbgotICAgIF9jaGFuZ2VJbm5lckhlaWdodCA6IGZ1bmN0aW9uKHZOZXcsIHZPbGQpCi0g
ICAgewotICAgICAgLy8gVGhlIGhlaWdodCBoYXMgY2hhbmdlZCAtPiBVcGRhdGUgY29udGVudAot
ICAgICAgdGhpcy5fcG9zdHBvbmVkVXBkYXRlQ29udGVudCgpOwotCi0gICAgICByZXR1cm4gdGhp
cy5iYXNlKGFyZ3VtZW50cywgdk5ldywgdk9sZCk7Ci0gICAgfSwKLQotCi0gICAgLy8gb3ZlcnJp
ZGRlbgotICAgIF9hZnRlckFwcGVhciA6IGZ1bmN0aW9uKCkKLSAgICB7Ci0gICAgICB0aGlzLmJh
c2UoYXJndW1lbnRzKTsKLQotICAgICAgdGhpcy5nZXRFbGVtZW50KCkub25zZWxlY3RzdGFydCA9
IHF4LmxhbmcuRnVuY3Rpb24ucmV0dXJuRmFsc2U7Ci0KLSAgICAgIHRoaXMuX3VwZGF0ZUNvbnRl
bnQoKTsKLSAgICAgIHRoaXMuX2hlYWRlci5fdXBkYXRlQ29udGVudCgpOwotICAgICAgdGhpcy5f
dXBkYXRlSG9yU2Nyb2xsQmFyTWF4aW11bSgpOwotICAgICAgdGhpcy5fdXBkYXRlVmVyU2Nyb2xs
QmFyTWF4aW11bSgpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEV2ZW50IGhhbmRsZXIu
IENhbGxlZCB3aGVuIHRoZSBob3Jpem9udGFsIHNjcm9sbCBiYXIgbW92ZWQuCi0gICAgICoKLSAg
ICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4KLSAg
ICAgKiBAcmV0dXJuIHt2b2lkfQotICAgICAqLwotICAgIF9vblNjcm9sbFggOiBmdW5jdGlvbihl
dnQpCi0gICAgewotICAgICAgdGhpcy5jcmVhdGVEaXNwYXRjaENoYW5nZUV2ZW50KCJjaGFuZ2VT
Y3JvbGxYIiwgZXZ0LmdldFZhbHVlKCksIGV2dC5nZXRPbGRWYWx1ZSgpKTsKLSAgICAgIHZhciBz
Y3JvbGxMZWZ0ID0gZXZ0LmdldFZhbHVlKCk7Ci0KLSAgICAgIC8vIFdvcmthcm91bmQ6IFNlZSBf
dXBkYXRlQ29udGVudAotICAgICAgdGhpcy5faGVhZGVyLnNldExlZnQoLXNjcm9sbExlZnQpOwot
Ci0gICAgICAvLyBDYWNoZSB0aGUgc2Nyb2xsTGVmdCB2YWx1ZSBvZiB0aGUgcGFuZUNsaXBwZXIK
LSAgICAgIC8vCi0gICAgICB0aGlzLl9wYW5lQ2xpcHBlci5fX3Njcm9sbExlZnQgPSBzY3JvbGxM
ZWZ0OwotICAgICAgdGhpcy5fcGFuZUNsaXBwZXIuc2V0U2Nyb2xsTGVmdChzY3JvbGxMZWZ0KTsK
LSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0
aGUgdmVydGljYWwgc2Nyb2xsIGJhciBtb3ZlZC4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJl
cgotICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50LgotICAgICAqIEByZXR1cm4ge3Zv
aWR9Ci0gICAgICovCi0gICAgX29uU2Nyb2xsWSA6IGZ1bmN0aW9uKGV2dCkKLSAgICB7Ci0gICAg
ICB0aGlzLmNyZWF0ZURpc3BhdGNoQ2hhbmdlRXZlbnQoImNoYW5nZVNjcm9sbFkiLCBldnQuZ2V0
VmFsdWUoKSwgZXZ0LmdldE9sZFZhbHVlKCkpOwotICAgICAgdGhpcy5fcG9zdHBvbmVkVXBkYXRl
Q29udGVudCgpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEV2ZW50IGhhbmRsZXIuIENh
bGxlZCB3aGVuIHRoZSB1c2VyIG1vdmVkIHRoZSBtb3VzZSB3aGVlbC4KLSAgICAgKgotICAgICAq
IEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50LgotICAgICAq
IEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX29ubW91c2V3aGVlbCA6IGZ1bmN0aW9uKGV2
dCkKLSAgICB7Ci0gICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7Ci0KLSAgICAgIGlm
ICghdGFibGUuZ2V0RW5hYmxlZCgpKSB7Ci0gICAgICAgIHJldHVybjsKLSAgICAgIH0KLQotICAg
ICAgdGhpcy5fdmVyU2Nyb2xsQmFyLnNldFZhbHVlKHRoaXMuX3ZlclNjcm9sbEJhci5nZXRWYWx1
ZSgpIC0gKGV2dC5nZXRXaGVlbERlbHRhKCkgKiAzKSAqIHRhYmxlLmdldFJvd0hlaWdodCgpKTsK
LQotICAgICAgLy8gVXBkYXRlIHRoZSBmb2N1cwotICAgICAgaWYgKHRoaXMuX2xhc3RNb3VzZVBh
Z2VYICYmIHRoaXMuZ2V0Rm9jdXNDZWxsT25Nb3VzZU1vdmUoKSkgewotICAgICAgICB0aGlzLl9m
b2N1c0NlbGxBdFBhZ2VQb3ModGhpcy5fbGFzdE1vdXNlUGFnZVgsIHRoaXMuX2xhc3RNb3VzZVBh
Z2VZKTsKLSAgICAgIH0KLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBDb21tb24gY29sdW1u
IHJlc2l6ZSBsb2dpYy4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJh
bSBwYWdlWCB7SW50ZWdlcn0gdGhlIGN1cnJlbnQgbW91c2UgeCBwb3NpdGlvbi4KLSAgICAgKiBA
cmV0dXJuIHt2b2lkfQotICAgICAqLwotICAgIF9faGFuZGxlUmVzaXplQ29sdW1uIDogZnVuY3Rp
b24ocGFnZVgpCi0gICAgewotICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOwotICAg
ICAgLy8gV2UgYXJlIGN1cnJlbnRseSByZXNpemluZyAtPiBVcGRhdGUgdGhlIHBvc2l0aW9uCi0g
ICAgICB2YXIgbWluQ29sdW1uV2lkdGggPSBxeC51aS50YWJsZS5wYW5lLlNjcm9sbGVyLk1JTl9D
T0xVTU5fV0lEVEg7Ci0gICAgICB2YXIgbmV3V2lkdGggPSBNYXRoLm1heChtaW5Db2x1bW5XaWR0
aCwgdGhpcy5fbGFzdFJlc2l6ZVdpZHRoICsgcGFnZVggLSB0aGlzLl9sYXN0UmVzaXplTW91c2VQ
YWdlWCk7Ci0KLSAgICAgIGlmICh0aGlzLmdldExpdmVSZXNpemUoKSkgewotICAgICAgICB2YXIg
Y29sdW1uTW9kZWwgPSB0YWJsZS5nZXRUYWJsZUNvbHVtbk1vZGVsKCk7Ci0gICAgICAgIGNvbHVt
bk1vZGVsLnNldENvbHVtbldpZHRoKHRoaXMuX3Jlc2l6ZUNvbHVtbiwgbmV3V2lkdGgpOwotICAg
ICAgfSBlbHNlIHsKLSAgICAgICAgdGhpcy5faGVhZGVyLnNldENvbHVtbldpZHRoKHRoaXMuX3Jl
c2l6ZUNvbHVtbiwgbmV3V2lkdGgpOwotCi0gICAgICAgIHZhciBwYW5lTW9kZWwgPSB0aGlzLmdl
dFRhYmxlUGFuZU1vZGVsKCk7Ci0gICAgICAgIHRoaXMuX3Nob3dSZXNpemVMaW5lKHBhbmVNb2Rl
bC5nZXRDb2x1bW5MZWZ0KHRoaXMuX3Jlc2l6ZUNvbHVtbikgKyBuZXdXaWR0aCk7Ci0gICAgICB9
Ci0KLSAgICAgIHRoaXMuX2xhc3RSZXNpemVNb3VzZVBhZ2VYICs9IG5ld1dpZHRoIC0gdGhpcy5f
bGFzdFJlc2l6ZVdpZHRoOwotICAgICAgdGhpcy5fbGFzdFJlc2l6ZVdpZHRoID0gbmV3V2lkdGg7
Ci0gICAgfSwKLQotICAgIC8qKgotICAgICAqIENvbW1vbiBjb2x1bW4gbW92ZSBsb2dpYy4KLSAg
ICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBwYWdlWCB7SW50ZWdlcn0g
dGhlIGN1cnJlbnQgbW91c2UgeCBwb3NpdGlvbi4KLSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAg
ICAqCi0gICAgICovCi0gICAgX19oYW5kbGVNb3ZlQ29sdW1uIDogZnVuY3Rpb24ocGFnZVgpCi0g
ICAgewotICAgICAgLy8gV2UgYXJlIG1vdmluZyBhIGNvbHVtbgotCi0gICAgICAvLyBDaGVjayB3
aGV0aGVyIHdlIG1vdmVkIG91dHNpZGUgdGhlIGNsaWNrIHRvbGVyYW5jZSBzbyB3ZSBjYW4gc3Rh
cnQKLSAgICAgIC8vIHNob3dpbmcgdGhlIGNvbHVtbiBtb3ZlIGZlZWRiYWNrCi0gICAgICAvLyAo
c2hvd2luZyB0aGUgY29sdW1uIG1vdmUgZmVlZGJhY2sgcHJldmVudHMgdGhlIG9uY2xpY2sgZXZl
bnQpCi0gICAgICB2YXIgY2xpY2tUb2xlcmFuY2UgPSBxeC51aS50YWJsZS5wYW5lLlNjcm9sbGVy
LkNMSUNLX1RPTEVSQU5DRTsKLSAgICAgIGlmICh0aGlzLl9oZWFkZXIuaXNTaG93aW5nQ29sdW1u
TW92ZUZlZWRiYWNrKCkKLSAgICAgICAgfHwgcGFnZVggPiB0aGlzLl9sYXN0TW92ZU1vdXNlUGFn
ZVggKyBjbGlja1RvbGVyYW5jZQotICAgICAgICB8fCBwYWdlWCA8IHRoaXMuX2xhc3RNb3ZlTW91
c2VQYWdlWCAtIGNsaWNrVG9sZXJhbmNlKQotICAgICAgewotICAgICAgICB0aGlzLl9sYXN0TW92
ZUNvbFBvcyArPSBwYWdlWCAtIHRoaXMuX2xhc3RNb3ZlTW91c2VQYWdlWDsKLQotICAgICAgICB0
aGlzLl9oZWFkZXIuc2hvd0NvbHVtbk1vdmVGZWVkYmFjayh0aGlzLl9tb3ZlQ29sdW1uLCB0aGlz
Ll9sYXN0TW92ZUNvbFBvcyk7Ci0KLSAgICAgICAgLy8gR2V0IHRoZSByZXNwb25zaWJsZSBzY3Jv
bGxlcgotICAgICAgICB2YXIgdGFyZ2V0U2Nyb2xsZXIgPSB0aGlzLl90YWJsZS5nZXRUYWJsZVBh
bmVTY3JvbGxlckF0UGFnZVgocGFnZVgpOwotICAgICAgICBpZiAodGhpcy5fbGFzdE1vdmVUYXJn
ZXRTY3JvbGxlciAmJiB0aGlzLl9sYXN0TW92ZVRhcmdldFNjcm9sbGVyICE9IHRhcmdldFNjcm9s
bGVyKSB7Ci0gICAgICAgICAgdGhpcy5fbGFzdE1vdmVUYXJnZXRTY3JvbGxlci5oaWRlQ29sdW1u
TW92ZUZlZWRiYWNrKCk7Ci0gICAgICAgIH0KLSAgICAgICAgaWYgKHRhcmdldFNjcm9sbGVyICE9
IG51bGwpIHsKLSAgICAgICAgICB0aGlzLl9sYXN0TW92ZVRhcmdldFggPSB0YXJnZXRTY3JvbGxl
ci5zaG93Q29sdW1uTW92ZUZlZWRiYWNrKHBhZ2VYKTsKLSAgICAgICAgfSBlbHNlIHsKLSAgICAg
ICAgICB0aGlzLl9sYXN0TW92ZVRhcmdldFggPSBudWxsOwotICAgICAgICB9Ci0KLSAgICAgICAg
dGhpcy5fbGFzdE1vdmVUYXJnZXRTY3JvbGxlciA9IHRhcmdldFNjcm9sbGVyOwotICAgICAgICB0
aGlzLl9sYXN0TW92ZU1vdXNlUGFnZVggPSBwYWdlWDsKLSAgICAgIH0KLSAgICB9LAotCi0KLSAg
ICAvKioKLSAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdXNlciBtb3ZlZCB0
aGUgbW91c2Ugb3ZlciB0aGUgaGVhZGVyLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0g
ICAgICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuCi0gICAgICogQHJldHVybiB7dm9pZH0K
LSAgICAgKi8KLSAgICBfb25tb3VzZW1vdmVIZWFkZXIgOiBmdW5jdGlvbihldnQpCi0gICAgewot
ICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOwotCi0gICAgICBpZiAoISB0YWJsZS5n
ZXRFbmFibGVkKCkpIHsKLSAgICAgICAgcmV0dXJuOwotICAgICAgfQotCi0gICAgICB2YXIgdXNl
UmVzaXplQ3Vyc29yID0gZmFsc2U7Ci0gICAgICB2YXIgbW91c2VPdmVyQ29sdW1uID0gbnVsbDsK
LQotICAgICAgdmFyIHBhZ2VYID0gZXZ0LmdldFBhZ2VYKCk7Ci0gICAgICB2YXIgcGFnZVkgPSBl
dnQuZ2V0UGFnZVkoKTsKLQotICAgICAgLy8gV29ya2Fyb3VuZDogSW4gb25tb3VzZXdoZWVsIHRo
ZSBldmVudCBoYXMgd3JvbmcgY29vcmRpbmF0ZXMgZm9yIHBhZ2VYCi0gICAgICAvLyAgICAgICBh
bmQgcGFnZVkuIFNvIHdlIHJlbWVtYmVyIHRoZSBsYXN0IG1vdmUgZXZlbnQuCi0gICAgICB0aGlz
Ll9sYXN0TW91c2VQYWdlWCA9IHBhZ2VYOwotICAgICAgdGhpcy5fbGFzdE1vdXNlUGFnZVkgPSBw
YWdlWTsKLQotICAgICAgaWYgKHRoaXMuX3Jlc2l6ZUNvbHVtbiAhPSBudWxsKSB7Ci0gICAgICAg
IC8vIFdlIGFyZSBjdXJyZW50bHkgcmVzaXppbmcgLT4gVXBkYXRlIHRoZSBwb3NpdGlvbgotICAg
ICAgICB0aGlzLl9faGFuZGxlUmVzaXplQ29sdW1uKHBhZ2VYKTsKLSAgICAgICAgdXNlUmVzaXpl
Q3Vyc29yID0gdHJ1ZTsKLSAgICAgIH0gZWxzZSBpZiAodGhpcy5fbW92ZUNvbHVtbiAhPSBudWxs
KSB7Ci0gICAgICAgIC8vIFdlIGFyZSBtb3ZpbmcgYSBjb2x1bW4KLSAgICAgICAgdGhpcy5fX2hh
bmRsZU1vdmVDb2x1bW4ocGFnZVgpOwotICAgICAgfSBlbHNlIHsKLSAgICAgICAgdmFyIHJlc2l6
ZUNvbCA9IHRoaXMuX2dldFJlc2l6ZUNvbHVtbkZvclBhZ2VYKHBhZ2VYKTsKLSAgICAgICAgaWYg
KHJlc2l6ZUNvbCAhPSAtMSkgewotICAgICAgICAgIC8vIFRoZSBtb3VzZSBpcyBvdmVyIGEgcmVz
aXplIHJlZ2lvbiAtPiBTaG93IHRoZSByaWdodCBjdXJzb3IKLSAgICAgICAgICB1c2VSZXNpemVD
dXJzb3IgPSB0cnVlOwotICAgICAgICB9IGVsc2UgewotICAgICAgICAgIHZhciB0YWJsZU1vZGVs
ID0gdGFibGUuZ2V0VGFibGVNb2RlbCgpOwotICAgICAgICAgIHZhciBjb2wgPSB0aGlzLl9nZXRD
b2x1bW5Gb3JQYWdlWChwYWdlWCk7Ci0gICAgICAgICAgaWYgKGNvbCAhPSBudWxsICYmIHRhYmxl
TW9kZWwuaXNDb2x1bW5Tb3J0YWJsZShjb2wpKSB7Ci0gICAgICAgICAgICBtb3VzZU92ZXJDb2x1
bW4gPSBjb2w7Ci0gICAgICAgICAgfQotICAgICAgICB9Ci0gICAgICB9Ci0KLSAgICAgIC8vIFdv
cmthcm91bmQ6IFNldHRpbmcgdGhlIGN1cnNvciB0byB0aGUgcmlnaHQgd2lkZ2V0IGRvZXNuJ3Qg
d29yawotICAgICAgLy90aGlzLl9oZWFkZXIuc2V0Q3Vyc29yKHVzZVJlc2l6ZUN1cnNvciA/ICJl
LXJlc2l6ZSIgOiBudWxsKTsKLSAgICAgIHRoaXMuZ2V0VG9wTGV2ZWxXaWRnZXQoKS5zZXRHbG9i
YWxDdXJzb3IodXNlUmVzaXplQ3Vyc29yID8gcXgudWkudGFibGUucGFuZS5TY3JvbGxlci5DVVJT
T1JfUkVTSVpFX0hPUklaT05UQUwgOiBudWxsKTsKLQotICAgICAgdGhpcy5faGVhZGVyLnNldE1v
dXNlT3ZlckNvbHVtbihtb3VzZU92ZXJDb2x1bW4pOwotICAgIH0sCi0KLQotICAgIC8qKgotICAg
ICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIG1vdmVkIHRoZSBtb3VzZSBv
dmVyIHRoZSBwYW5lLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHBhcmFt
IGV2dCB7TWFwfSB0aGUgZXZlbnQuCi0gICAgICogQHJldHVybiB7dm9pZH0KLSAgICAgKi8KLSAg
ICBfb25tb3VzZW1vdmVQYW5lIDogZnVuY3Rpb24oZXZ0KQotICAgIHsKLSAgICAgIHZhciB0YWJs
ZSA9IHRoaXMuZ2V0VGFibGUoKTsKLQotICAgICAgaWYgKCEgdGFibGUuZ2V0RW5hYmxlZCgpKSB7
Ci0gICAgICAgIHJldHVybjsKLSAgICAgIH0KLQotICAgICAgdmFyIHVzZVJlc2l6ZUN1cnNvciA9
IGZhbHNlOwotCi0gICAgICB2YXIgcGFnZVggPSBldnQuZ2V0UGFnZVgoKTsKLSAgICAgIHZhciBw
YWdlWSA9IGV2dC5nZXRQYWdlWSgpOwotCi0gICAgICAvLyBXb3JrYXJvdW5kOiBJbiBvbm1vdXNl
d2hlZWwgdGhlIGV2ZW50IGhhcyB3cm9uZyBjb29yZGluYXRlcyBmb3IgcGFnZVgKLSAgICAgIC8v
ICAgICAgIGFuZCBwYWdlWS4gU28gd2UgcmVtZW1iZXIgdGhlIGxhc3QgbW92ZSBldmVudC4KLSAg
ICAgIHRoaXMuX2xhc3RNb3VzZVBhZ2VYID0gcGFnZVg7Ci0gICAgICB0aGlzLl9sYXN0TW91c2VQ
YWdlWSA9IHBhZ2VZOwotCi0gICAgICBpZiAodGhpcy5fcmVzaXplQ29sdW1uICE9IG51bGwpIHsK
LSAgICAgICAgLy8gV2UgYXJlIGN1cnJlbnRseSByZXNpemluZyAtPiBVcGRhdGUgdGhlIHBvc2l0
aW9uCi0gICAgICAgIHRoaXMuX19oYW5kbGVSZXNpemVDb2x1bW4ocGFnZVgpOwotICAgICAgICB1
c2VSZXNpemVDdXJzb3IgPSB0cnVlOwotICAgICAgfSBlbHNlIGlmICh0aGlzLl9tb3ZlQ29sdW1u
ICE9IG51bGwpIHsKLSAgICAgICAgLy8gV2UgYXJlIG1vdmluZyBhIGNvbHVtbgotICAgICAgICB0
aGlzLl9faGFuZGxlTW92ZUNvbHVtbihwYWdlWCk7Ci0gICAgICB9IGVsc2UgewotICAgICAgICAv
LyBUaGlzIGlzIGEgbm9ybWFsIG1vdXNlIG1vdmUKLSAgICAgICAgdmFyIHJvdyA9IHRoaXMuX2dl
dFJvd0ZvclBhZ2VQb3MocGFnZVgsIHBhZ2VZKTsKLSAgICAgICAgaWYgKHJvdyAhPSBudWxsICYm
IHRoaXMuX2dldENvbHVtbkZvclBhZ2VYKHBhZ2VYKSAhPSBudWxsKSB7Ci0gICAgICAgICAgLy8g
VGhlIG1vdXNlIGlzIG92ZXIgdGhlIGRhdGEgLT4gdXBkYXRlIHRoZSBmb2N1cwotICAgICAgICAg
IGlmICh0aGlzLmdldEZvY3VzQ2VsbE9uTW91c2VNb3ZlKCkpIHsKLSAgICAgICAgICAgIHRoaXMu
X2ZvY3VzQ2VsbEF0UGFnZVBvcyhwYWdlWCwgcGFnZVkpOwotICAgICAgICAgIH0KLSAgICAgICAg
fQotICAgICAgfQotCi0gICAgICAvLyBXb3JrYXJvdW5kOiBTZXR0aW5nIHRoZSBjdXJzb3IgdG8g
dGhlIHJpZ2h0IHdpZGdldCBkb2Vzbid0IHdvcmsKLSAgICAgIC8vdGhpcy5faGVhZGVyLnNldEN1
cnNvcih1c2VSZXNpemVDdXJzb3IgPyAiZS1yZXNpemUiIDogbnVsbCk7Ci0gICAgICB0aGlzLmdl
dFRvcExldmVsV2lkZ2V0KCkuc2V0R2xvYmFsQ3Vyc29yKHVzZVJlc2l6ZUN1cnNvciA/IHF4LnVp
LnRhYmxlLnBhbmUuU2Nyb2xsZXIuQ1VSU09SX1JFU0laRV9IT1JJWk9OVEFMIDogbnVsbCk7Ci0K
LSAgICAgIHRoaXMuX2hlYWRlci5zZXRNb3VzZU92ZXJDb2x1bW4obnVsbCk7Ci0gICAgfSwKLQot
Ci0gICAgLyoqCi0gICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHVzZXIgcHJl
c3NlZCBhIG1vdXNlIGJ1dHRvbiBvdmVyIHRoZSBoZWFkZXIuCi0gICAgICoKLSAgICAgKiBAdHlw
ZSBtZW1iZXIKLSAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4KLSAgICAgKiBAcmV0
dXJuIHt2b2lkfQotICAgICAqLwotICAgIF9vbm1vdXNlZG93bkhlYWRlciA6IGZ1bmN0aW9uKGV2
dCkKLSAgICB7Ci0gICAgICBpZiAoISB0aGlzLmdldFRhYmxlKCkuZ2V0RW5hYmxlZCgpKSB7Ci0g
ICAgICAgIHJldHVybjsKLSAgICAgIH0KLQotICAgICAgdmFyIHBhZ2VYID0gZXZ0LmdldFBhZ2VY
KCk7Ci0KLSAgICAgIC8vIG1vdXNlIGlzIGluIGhlYWRlcgotICAgICAgdmFyIHJlc2l6ZUNvbCA9
IHRoaXMuX2dldFJlc2l6ZUNvbHVtbkZvclBhZ2VYKHBhZ2VYKTsKLSAgICAgIGlmIChyZXNpemVD
b2wgIT0gLTEpIHsKLSAgICAgICAgLy8gVGhlIG1vdXNlIGlzIG92ZXIgYSByZXNpemUgcmVnaW9u
IC0+IFN0YXJ0IHJlc2l6aW5nCi0gICAgICAgIHRoaXMuX3N0YXJ0UmVzaXplSGVhZGVyKHJlc2l6
ZUNvbCwgcGFnZVgpOwotICAgICAgfSBlbHNlIHsKLSAgICAgICAgLy8gVGhlIG1vdXNlIGlzIG5v
dCBpbiBhIHJlc2l6ZSByZWdpb24KLSAgICAgICAgdmFyIG1vdmVDb2wgPSB0aGlzLl9nZXRDb2x1
bW5Gb3JQYWdlWChwYWdlWCk7Ci0gICAgICAgIGlmIChtb3ZlQ29sICE9IG51bGwpIHsKLSAgICAg
ICAgICB0aGlzLl9zdGFydE1vdmVIZWFkZXIobW92ZUNvbCwgcGFnZVgpOwotICAgICAgICB9Ci0g
ICAgICB9Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogU3RhcnQgYSByZXNpemUgc2Vzc2lv
biBvZiB0aGUgaGVhZGVyLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHBh
cmFtIHJlc2l6ZUNvbCB7SW50ZWdlcn0gdGhlIGNvbHVtbiBpbmRleAotICAgICAqIEBwYXJhbSBw
YWdlWCB7SW50ZWdlcn0geCBjb29yZGluYXRlIG9mIHRoZSBtb3VzZSBldmVudAotICAgICAqIEBy
ZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX3N0YXJ0UmVzaXplSGVhZGVyIDogZnVuY3Rpb24o
cmVzaXplQ29sLCBwYWdlWCkKLSAgICB7Ci0gICAgICB2YXIgY29sdW1uTW9kZWwgPSB0aGlzLmdl
dFRhYmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwotCi0gICAgICAvLyBUaGUgbW91c2UgaXMg
b3ZlciBhIHJlc2l6ZSByZWdpb24gLT4gU3RhcnQgcmVzaXppbmcKLSAgICAgIHRoaXMuX3Jlc2l6
ZUNvbHVtbiA9IHJlc2l6ZUNvbDsKLSAgICAgIHRoaXMuX2xhc3RSZXNpemVNb3VzZVBhZ2VYID0g
cGFnZVg7Ci0gICAgICB0aGlzLl9sYXN0UmVzaXplV2lkdGggPSBjb2x1bW5Nb2RlbC5nZXRDb2x1
bW5XaWR0aCh0aGlzLl9yZXNpemVDb2x1bW4pOwotICAgICAgdGhpcy5faGVhZGVyQ2xpcHBlci5z
ZXRDYXB0dXJlKHRydWUpOwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIFN0YXJ0IGEgbW92
ZSBzZXNzaW9uIG9mIHRoZSBoZWFkZXIuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAg
ICAgKiBAcGFyYW0gbW92ZUNvbCB7SW50ZWdlcn0gdGhlIGNvbHVtbiBpbmRleAotICAgICAqIEBw
YXJhbSBwYWdlWCB7SW50ZWdlcn0geCBjb29yZGluYXRlIG9mIHRoZSBtb3VzZSBldmVudAotICAg
ICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX3N0YXJ0TW92ZUhlYWRlciA6IGZ1bmN0
aW9uKG1vdmVDb2wsIHBhZ2VYKQotICAgIHsKLSAgICAgIC8vIFByZXBhcmUgY29sdW1uIG1vdmlu
ZwotICAgICAgdGhpcy5fbW92ZUNvbHVtbiA9IG1vdmVDb2w7Ci0gICAgICB0aGlzLl9sYXN0TW92
ZU1vdXNlUGFnZVggPSBwYWdlWDsKLSAgICAgIHRoaXMuX2xhc3RNb3ZlQ29sUG9zID0gdGhpcy5n
ZXRUYWJsZVBhbmVNb2RlbCgpLmdldENvbHVtbkxlZnQobW92ZUNvbCk7Ci0gICAgICB0aGlzLl9o
ZWFkZXJDbGlwcGVyLnNldENhcHR1cmUodHJ1ZSk7Ci0gICAgfSwKLQotCi0KLSAgICAvKioKLSAg
ICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdXNlciBwcmVzc2VkIGEgbW91c2Ug
YnV0dG9uIG92ZXIgdGhlIHBhbmUuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAg
KiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4KLSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAg
ICAqLwotICAgIF9vbm1vdXNlZG93blBhbmUgOiBmdW5jdGlvbihldnQpCi0gICAgewotICAgICAg
dmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOwotCi0gICAgICBpZiAoISB0YWJsZS5nZXRFbmFi
bGVkKCkpIHsKLSAgICAgICAgcmV0dXJuOwotICAgICAgfQotCi0gICAgICBpZiAodGhpcy5pc0Vk
aXRpbmcoKSkgewotICAgICAgICB0aGlzLnN0b3BFZGl0aW5nKCk7Ci0gICAgICB9Ci0KLSAgICAg
IHZhciBwYWdlWCA9IGV2dC5nZXRQYWdlWCgpOwotICAgICAgdmFyIHBhZ2VZID0gZXZ0LmdldFBh
Z2VZKCk7Ci0gICAgICB2YXIgcm93ID0gdGhpcy5fZ2V0Um93Rm9yUGFnZVBvcyhwYWdlWCwgcGFn
ZVkpOwotCi0gICAgICBpZiAocm93ICE9IG51bGwgJiYgdGhpcy5fZ2V0Q29sdW1uRm9yUGFnZVgo
cGFnZVgpICE9IG51bGwpIHsKLSAgICAgICAgdmFyIHNlbGVjdEJlZm9yZUZvY3VzID0gdGhpcy5n
ZXRTZWxlY3RCZWZvcmVGb2N1cygpOwotCi0gICAgICAgIGlmIChzZWxlY3RCZWZvcmVGb2N1cykg
ewotICAgICAgICAgIHRhYmxlLl9nZXRTZWxlY3Rpb25NYW5hZ2VyKCkuaGFuZGxlTW91c2VEb3du
KHJvdywgZXZ0KTsKLSAgICAgICAgfQotCi0gICAgICAgIC8vIFRoZSBtb3VzZSBpcyBvdmVyIHRo
ZSBkYXRhIC0+IHVwZGF0ZSB0aGUgZm9jdXMKLSAgICAgICAgaWYgKCEgdGhpcy5nZXRGb2N1c0Nl
bGxPbk1vdXNlTW92ZSgpKSB7Ci0gICAgICAgICAgdGhpcy5fZm9jdXNDZWxsQXRQYWdlUG9zKHBh
Z2VYLCBwYWdlWSk7Ci0gICAgICAgIH0KLQotICAgICAgICBpZiAoISBzZWxlY3RCZWZvcmVGb2N1
cykgewotICAgICAgICAgIHRhYmxlLl9nZXRTZWxlY3Rpb25NYW5hZ2VyKCkuaGFuZGxlTW91c2VE
b3duKHJvdywgZXZ0KTsKLSAgICAgICAgfQotICAgICAgfQotICAgIH0sCi0KLQotICAgIC8qKgot
ICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIHJlbGVhc2VkIGEgbW91
c2UgYnV0dG9uIG92ZXIgdGhlIGhlYWRlci4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgot
ICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50LgotICAgICAqIEByZXR1cm4ge3ZvaWR9
Ci0gICAgICovCi0gICAgX29ubW91c2V1cEhlYWRlciA6IGZ1bmN0aW9uKGV2dCkKLSAgICB7Ci0g
ICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7Ci0KLSAgICAgIGlmICghIHRhYmxlLmdl
dEVuYWJsZWQoKSkgewotICAgICAgICByZXR1cm47Ci0gICAgICB9Ci0KLSAgICAgIGlmICh0aGlz
Ll9yZXNpemVDb2x1bW4gIT0gbnVsbCkgewotICAgICAgICB0aGlzLl9zdG9wUmVzaXplSGVhZGVy
KCk7Ci0gICAgICB9IGVsc2UgaWYgKHRoaXMuX21vdmVDb2x1bW4gIT0gbnVsbCkgewotICAgICAg
ICB0aGlzLl9zdG9wTW92ZUhlYWRlcigpOwotICAgICAgfQotICAgIH0sCi0KLQotICAgIC8qKgot
ICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSBldmVudCBjYXB0dXJpbmcgb2Yg
dGhlIGhlYWRlciBjaGFuZ2VkLgotICAgICAqIFN0b3BzL2ZpbmlzaGVzIGFuIGFjdGl2ZSBoZWFk
ZXIgcmVzaXplL21vdmUgc2Vzc2lvbiBpZiBpdCBsb3N0IGNhcHR1cmluZwotICAgICAqIGR1cmlu
ZyB0aGUgc2Vzc2lvbiB0byBzdGF5IGluIGEgc3RhYmxlIHN0YXRlLgotICAgICAqLwotICAgIF9v
bkNoYW5nZUNhcHR1cmVIZWFkZXIgOiBmdW5jdGlvbihlKQotICAgIHsKLSAgICAgIGlmICh0aGlz
Ll9yZXNpemVDb2x1bW4gIT0gbnVsbCAmJiBlLmdldFZhbHVlKCkgPT0gZmFsc2UpIHsKLSAgICAg
ICAgdGhpcy5fc3RvcFJlc2l6ZUhlYWRlcigpOwotICAgICAgfQotCi0gICAgICBpZiAodGhpcy5f
bW92ZUNvbHVtbiAhPSBudWxsICYmIGUuZ2V0VmFsdWUoKSA9PSBmYWxzZSkgewotICAgICAgICB0
aGlzLl9zdG9wTW92ZUhlYWRlcigpOwotICAgICAgfQotICAgIH0sCi0KLQotICAgIC8qKgotICAg
ICAqIFN0b3AgYSByZXNpemUgc2Vzc2lvbiBvZiB0aGUgaGVhZGVyLgotICAgICAqCi0gICAgICog
QHR5cGUgbWVtYmVyCi0gICAgICogQHJldHVybiB7dm9pZH0KLSAgICAgKi8KLSAgICBfc3RvcFJl
c2l6ZUhlYWRlciA6IGZ1bmN0aW9uKCkKLSAgICB7Ci0gICAgICB2YXIgY29sdW1uTW9kZWwgPSB0
aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwotCi0gICAgICAvLyBXZSBhcmUg
Y3VycmVudGx5IHJlc2l6aW5nIC0+IEZpbmlzaCByZXNpemluZwotICAgICAgaWYgKCEgdGhpcy5n
ZXRMaXZlUmVzaXplKCkpIHsKLSAgICAgICAgdGhpcy5faGlkZVJlc2l6ZUxpbmUoKTsKLSAgICAg
ICAgY29sdW1uTW9kZWwuc2V0Q29sdW1uV2lkdGgodGhpcy5fcmVzaXplQ29sdW1uLCB0aGlzLl9s
YXN0UmVzaXplV2lkdGgpOwotICAgICAgfQotCi0gICAgICB0aGlzLl9yZXNpemVDb2x1bW4gPSBu
dWxsOwotICAgICAgdGhpcy5faGVhZGVyQ2xpcHBlci5zZXRDYXB0dXJlKGZhbHNlKTsKLQotICAg
ICAgdGhpcy5nZXRUb3BMZXZlbFdpZGdldCgpLnNldEdsb2JhbEN1cnNvcihudWxsKTsKLSAgICB9
LAotCi0KLSAgICAvKioKLSAgICAgKiBTdG9wIGEgbW92ZSBzZXNzaW9uIG9mIHRoZSBoZWFkZXIu
Ci0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAg
ICAqLwotICAgIF9zdG9wTW92ZUhlYWRlciA6IGZ1bmN0aW9uKCkKLSAgICB7Ci0gICAgICB2YXIg
Y29sdW1uTW9kZWwgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwotICAg
ICAgdmFyIHBhbmVNb2RlbCA9IHRoaXMuZ2V0VGFibGVQYW5lTW9kZWwoKTsKLQotICAgICAgLy8g
V2UgYXJlIG1vdmluZyBhIGNvbHVtbiAtPiBEcm9wIHRoZSBjb2x1bW4KLSAgICAgIHRoaXMuX2hl
YWRlci5oaWRlQ29sdW1uTW92ZUZlZWRiYWNrKCk7Ci0gICAgICBpZiAodGhpcy5fbGFzdE1vdmVU
YXJnZXRTY3JvbGxlcikgewotICAgICAgICB0aGlzLl9sYXN0TW92ZVRhcmdldFNjcm9sbGVyLmhp
ZGVDb2x1bW5Nb3ZlRmVlZGJhY2soKTsKLSAgICAgIH0KLQotICAgICAgaWYgKHRoaXMuX2xhc3RN
b3ZlVGFyZ2V0WCAhPSBudWxsKSB7Ci0gICAgICAgIHZhciBmcm9tVmlzWFBvcyA9IHBhbmVNb2Rl
bC5nZXRGaXJzdENvbHVtblgoKSArIHBhbmVNb2RlbC5nZXRYKHRoaXMuX21vdmVDb2x1bW4pOwot
ICAgICAgICB2YXIgdG9WaXNYUG9zID0gdGhpcy5fbGFzdE1vdmVUYXJnZXRYOwotICAgICAgICBp
ZiAodG9WaXNYUG9zICE9IGZyb21WaXNYUG9zICYmIHRvVmlzWFBvcyAhPSBmcm9tVmlzWFBvcyAr
IDEpIHsKLSAgICAgICAgICAvLyBUaGUgY29sdW1uIHdhcyByZWFsbHkgbW92ZWQgdG8gYW5vdGhl
ciBwb3NpdGlvbgotICAgICAgICAgIC8vIChhbmQgbm90IG1vdmVkIGJlZm9yZSBvciBhZnRlciBp
dHNlbGYsIHdoaWNoIGlzIGEgbm9vcCkKLQotICAgICAgICAgIC8vIFRyYW5zbGF0ZSB2aXNpYmxl
IHBvc2l0aW9ucyB0byBvdmVyYWxsIHBvc2l0aW9ucwotICAgICAgICAgIHZhciBmcm9tQ29sID0g
Y29sdW1uTW9kZWwuZ2V0VmlzaWJsZUNvbHVtbkF0WChmcm9tVmlzWFBvcyk7Ci0gICAgICAgICAg
dmFyIHRvQ29sICAgPSBjb2x1bW5Nb2RlbC5nZXRWaXNpYmxlQ29sdW1uQXRYKHRvVmlzWFBvcyk7
Ci0gICAgICAgICAgdmFyIGZyb21PdmVyWFBvcyA9IGNvbHVtbk1vZGVsLmdldE92ZXJhbGxYKGZy
b21Db2wpOwotICAgICAgICAgIHZhciB0b092ZXJYUG9zID0gKHRvQ29sICE9IG51bGwpID8gY29s
dW1uTW9kZWwuZ2V0T3ZlcmFsbFgodG9Db2wpIDogY29sdW1uTW9kZWwuZ2V0T3ZlcmFsbENvbHVt
bkNvdW50KCk7Ci0KLSAgICAgICAgICBpZiAodG9PdmVyWFBvcyA+IGZyb21PdmVyWFBvcykgewot
ICAgICAgICAgICAgLy8gRG9uJ3QgY291bnQgdGhlIGNvbHVtbiBpdHNlbGYKLSAgICAgICAgICAg
IHRvT3ZlclhQb3MtLTsKLSAgICAgICAgICB9Ci0KLSAgICAgICAgICAvLyBNb3ZlIHRoZSBjb2x1
bW4KLSAgICAgICAgICBjb2x1bW5Nb2RlbC5tb3ZlQ29sdW1uKGZyb21PdmVyWFBvcywgdG9PdmVy
WFBvcyk7Ci0gICAgICAgIH0KLSAgICAgIH0KLQotICAgICAgdGhpcy5fbW92ZUNvbHVtbiA9IG51
bGw7Ci0gICAgICB0aGlzLl9sYXN0TW92ZVRhcmdldFggPSBudWxsOwotICAgICAgdGhpcy5faGVh
ZGVyQ2xpcHBlci5zZXRDYXB0dXJlKGZhbHNlKTsKLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAg
KiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdXNlciByZWxlYXNlZCBhIG1vdXNlIGJ1
dHRvbiBvdmVyIHRoZSBwYW5lLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICog
QHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuCi0gICAgICogQHJldHVybiB7dm9pZH0KLSAgICAg
Ki8KLSAgICBfb25tb3VzZXVwUGFuZSA6IGZ1bmN0aW9uKGV2dCkKLSAgICB7Ci0gICAgICB2YXIg
dGFibGUgPSB0aGlzLmdldFRhYmxlKCk7Ci0KLSAgICAgIGlmICghIHRhYmxlLmdldEVuYWJsZWQo
KSkgewotICAgICAgICByZXR1cm47Ci0gICAgICB9Ci0KLSAgICAgIHZhciByb3cgPSB0aGlzLl9n
ZXRSb3dGb3JQYWdlUG9zKGV2dC5nZXRQYWdlWCgpLCBldnQuZ2V0UGFnZVkoKSk7Ci0gICAgICBp
ZiAocm93ICE9IC0xICYmIHJvdyAhPSBudWxsICYmIHRoaXMuX2dldENvbHVtbkZvclBhZ2VYKGV2
dC5nZXRQYWdlWCgpKSAhPSBudWxsKSB7Ci0gICAgICAgIHRhYmxlLl9nZXRTZWxlY3Rpb25NYW5h
Z2VyKCkuaGFuZGxlTW91c2VVcChyb3csIGV2dCk7Ci0gICAgICB9Ci0gICAgfSwKLQotCi0gICAg
LyoqCi0gICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHVzZXIgY2xpY2tlZCBh
IG1vdXNlIGJ1dHRvbiBvdmVyIHRoZSBoZWFkZXIuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1i
ZXIKLSAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4KLSAgICAgKiBAcmV0dXJuIHt2
b2lkfQotICAgICAqLwotICAgIF9vbmNsaWNrSGVhZGVyIDogZnVuY3Rpb24oZXZ0KQotICAgIHsK
LSAgICAgIHZhciB0YWJsZSA9IHRoaXMuZ2V0VGFibGUoKTsKLQotICAgICAgaWYgKCF0YWJsZS5n
ZXRFbmFibGVkKCkpIHsKLSAgICAgICAgcmV0dXJuOwotICAgICAgfQotCi0gICAgICB2YXIgdGFi
bGVNb2RlbCA9IHRhYmxlLmdldFRhYmxlTW9kZWwoKTsKLQotICAgICAgdmFyIHBhZ2VYID0gZXZ0
LmdldFBhZ2VYKCk7Ci0KLSAgICAgIHZhciByZXNpemVDb2wgPSB0aGlzLl9nZXRSZXNpemVDb2x1
bW5Gb3JQYWdlWChwYWdlWCk7Ci0KLSAgICAgIGlmIChyZXNpemVDb2wgPT0gLTEpCi0gICAgICB7
Ci0gICAgICAgIC8vIG1vdXNlIGlzIG5vdCBpbiBhIHJlc2l6ZSByZWdpb24KLSAgICAgICAgdmFy
IGNvbCA9IHRoaXMuX2dldENvbHVtbkZvclBhZ2VYKHBhZ2VYKTsKLQotICAgICAgICBpZiAoY29s
ICE9IG51bGwgJiYgdGFibGVNb2RlbC5pc0NvbHVtblNvcnRhYmxlKGNvbCkpCi0gICAgICAgIHsK
LSAgICAgICAgICAvLyBTb3J0IHRoYXQgY29sdW1uCi0gICAgICAgICAgdmFyIHNvcnRDb2wgPSB0
YWJsZU1vZGVsLmdldFNvcnRDb2x1bW5JbmRleCgpOwotICAgICAgICAgIHZhciBhc2NlbmRpbmcg
PSAoY29sICE9IHNvcnRDb2wpID8gdHJ1ZSA6ICF0YWJsZU1vZGVsLmlzU29ydEFzY2VuZGluZygp
OwotCi0gICAgICAgICAgdGFibGVNb2RlbC5zb3J0QnlDb2x1bW4oY29sLCBhc2NlbmRpbmcpOwot
ICAgICAgICAgIHRhYmxlLmdldFNlbGVjdGlvbk1vZGVsKCkuY2xlYXJTZWxlY3Rpb24oKTsKLSAg
ICAgICAgfQotICAgICAgfQotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIEV2ZW50IGhhbmRs
ZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIGNsaWNrZWQgYSBtb3VzZSBidXR0b24gb3ZlciB0aGUg
cGFuZS4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBldnQge01h
cH0gdGhlIGV2ZW50LgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX29uY2xp
Y2tQYW5lIDogZnVuY3Rpb24oZXZ0KQotICAgIHsKLSAgICAgIHZhciB0YWJsZSA9IHRoaXMuZ2V0
VGFibGUoKTsKLQotICAgICAgaWYgKCF0YWJsZS5nZXRFbmFibGVkKCkpIHsKLSAgICAgICAgcmV0
dXJuOwotICAgICAgfQotCi0gICAgICB2YXIgcGFnZVggPSBldnQuZ2V0UGFnZVgoKTsKLSAgICAg
IHZhciBwYWdlWSA9IGV2dC5nZXRQYWdlWSgpOwotICAgICAgdmFyIHJvdyA9IHRoaXMuX2dldFJv
d0ZvclBhZ2VQb3MocGFnZVgsIHBhZ2VZKTsKLQotICAgICAgaWYgKHJvdyAhPSBudWxsICYmIHRo
aXMuX2dldENvbHVtbkZvclBhZ2VYKHBhZ2VYKSAhPSBudWxsKQotICAgICAgewotICAgICAgICB0
YWJsZS5fZ2V0U2VsZWN0aW9uTWFuYWdlcigpLmhhbmRsZUNsaWNrKHJvdywgZXZ0KTsKLSAgICAg
ICBpZiAodGhpcy5oYXNFdmVudExpc3RlbmVycygiY2VsbENsaWNrIikpCi0gICAgICAgewotICAg
ICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBxeC51aS50YWJsZS5wYW5lLkNlbGxFdmVudCh0
aGlzLCBldnQpLCB0cnVlKTsKLSAgICAgICB9Ci0gICAgICB9Ci0gICAgfSwKLQotICAgIC8qKgot
ICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIGEgY29udGV4dCBtZW51IGlzIGludm9r
ZWQgaW4gYSBjZWxsLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHBhcmFt
IGV2dCB7cXguZXZlbnQudHlwZS5Nb3VzZUV2ZW50fSB0aGUgZXZlbnQuCi0gICAgICogQHJldHVy
biB7dm9pZH0KLSAgICAgKi8KLSAgICBfb25Db250ZXh0TWVudSA6IGZ1bmN0aW9uKGV2dCkKLSAg
ICB7Ci0gICAgICAgaWYgKHRoaXMuaGFzRXZlbnRMaXN0ZW5lcnMoImNlbGxDb250ZXh0bWVudSIp
KQotICAgICAgIHsKLSAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgcXgudWkudGFibGUu
cGFuZS5DZWxsRXZlbnQodGhpcywgZXZ0KSwgdHJ1ZSk7Ci0gICAgICAgfQotICAgIH0sCi0KLSAg
ICAvKioKLSAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdXNlciBkb3VibGUg
Y2xpY2tlZCBhIG1vdXNlIGJ1dHRvbiBvdmVyIHRoZSBwYW5lLgotICAgICAqCi0gICAgICogQHR5
cGUgbWVtYmVyCi0gICAgICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuCi0gICAgICogQHJl
dHVybiB7dm9pZH0KLSAgICAgKi8KLSAgICBfb25kYmxjbGlja1BhbmUgOiBmdW5jdGlvbihldnQp
Ci0gICAgewotICAgICAgdmFyIHBhZ2VYID0gZXZ0LmdldFBhZ2VYKCk7Ci0gICAgICB2YXIgcGFn
ZVkgPSBldnQuZ2V0UGFnZVkoKTsKLQotCi0gICAgICB0aGlzLl9mb2N1c0NlbGxBdFBhZ2VQb3Mo
cGFnZVgsIHBhZ2VZKTsKLSAgICAgIHRoaXMuc3RhcnRFZGl0aW5nKCk7Ci0gICAgICBpZiAodGhp
cy5oYXNFdmVudExpc3RlbmVycygiY2VsbERibGNsaWNrIikpCi0gICAgICB7Ci0gICAgICAgIHZh
ciByb3cgPSB0aGlzLl9nZXRSb3dGb3JQYWdlUG9zKHBhZ2VYLCBwYWdlWSk7Ci0gICAgICAgIGlm
IChyb3cgIT0gLTEgJiYgcm93ICE9IG51bGwpCi0gICAgICAgIHsKLSAgICAgICAgICB0aGlzLmRp
c3BhdGNoRXZlbnQobmV3IHF4LnVpLnRhYmxlLnBhbmUuQ2VsbEV2ZW50KHRoaXMsIGV2dCksIHRy
dWUpOwotICAgICAgICB9Ci0gICAgICB9Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogRXZl
bnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIG1vdXNlIG1vdmVkIG91dC4KLSAgICAgKgotICAg
ICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50LgotICAg
ICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgX29ubW91c2VvdXQgOiBmdW5jdGlvbihl
dnQpCi0gICAgewotICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOwotCi0gICAgICBp
ZiAoIXRhYmxlLmdldEVuYWJsZWQoKSkgewotICAgICAgICByZXR1cm47Ci0gICAgICB9Ci0KLSAg
ICAgIC8vIFJlc2V0IHRoZSByZXNpemUgY3Vyc29yIHdoZW4gdGhlIG1vdXNlIGxlYXZlcyB0aGUg
aGVhZGVyCi0gICAgICAvLyBJZiBjdXJyZW50bHkgYSBjb2x1bW4gaXMgcmVzaXplZCB0aGVuIGRv
IG5vdGhpbmcKLSAgICAgIC8vICh0aGUgY3Vyc29yIHdpbGwgYmUgcmVzZXQgb24gbW91c2V1cCkK
LSAgICAgIGlmICh0aGlzLl9yZXNpemVDb2x1bW4gPT0gbnVsbCkgewotICAgICAgICB0aGlzLmdl
dFRvcExldmVsV2lkZ2V0KCkuc2V0R2xvYmFsQ3Vyc29yKG51bGwpOwotICAgICAgfQotCi0gICAg
ICB0aGlzLl9oZWFkZXIuc2V0TW91c2VPdmVyQ29sdW1uKG51bGwpOwotICAgIH0sCi0KLQotICAg
IC8qKgotICAgICAqIFNob3dzIHRoZSByZXNpemUgbGluZS4KLSAgICAgKgotICAgICAqIEB0eXBl
IG1lbWJlcgotICAgICAqIEBwYXJhbSB4IHtJbnRlZ2VyfSB0aGUgcG9zaXRpb24gd2hlcmUgdG8g
c2hvdyB0aGUgbGluZSAoaW4gcGl4ZWxzLCByZWxhdGl2ZSB0bwotICAgICAqICAgICAgdGhlIGxl
ZnQgc2lkZSBvZiB0aGUgcGFuZSkuCi0gICAgICogQHJldHVybiB7dm9pZH0KLSAgICAgKi8KLSAg
ICBfc2hvd1Jlc2l6ZUxpbmUgOiBmdW5jdGlvbih4KQotICAgIHsKLSAgICAgIHZhciByZXNpemVM
aW5lID0gdGhpcy5fcmVzaXplTGluZTsKLQotICAgICAgaWYgKHJlc2l6ZUxpbmUgPT0gbnVsbCkK
LSAgICAgIHsKLSAgICAgICAgcmVzaXplTGluZSA9IG5ldyBxeC51aS5iYXNpYy5UZXJtaW5hdG9y
OwotICAgICAgICByZXNpemVMaW5lLnNldEJhY2tncm91bmRDb2xvcigiI0Q2RDVEOSIpOwotICAg
ICAgICByZXNpemVMaW5lLnNldFdpZHRoKDMpOwotICAgICAgICB0aGlzLl9wYW5lQ2xpcHBlci5h
ZGQocmVzaXplTGluZSk7Ci0gICAgICAgIHF4LnVpLmNvcmUuV2lkZ2V0LmZsdXNoR2xvYmFsUXVl
dWVzKCk7Ci0KLSAgICAgICAgdGhpcy5fcmVzaXplTGluZSA9IHJlc2l6ZUxpbmU7Ci0gICAgICB9
Ci0KLSAgICAgIHJlc2l6ZUxpbmUuX3JlbmRlclJ1bnRpbWVMZWZ0KHggLSAyKTsgLy8gLTEgZm9y
IHRoZSB3aWR0aAotICAgICAgcmVzaXplTGluZS5fcmVuZGVyUnVudGltZUhlaWdodCh0aGlzLl9w
YW5lQ2xpcHBlci5nZXRCb3hIZWlnaHQoKSArIHRoaXMuX3BhbmVDbGlwcGVyLmdldFNjcm9sbFRv
cCgpKTsKLQotICAgICAgdGhpcy5fcmVzaXplTGluZS5yZW1vdmVTdHlsZVByb3BlcnR5KCJ2aXNp
YmlsaXR5Iik7Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogSGlkZXMgdGhlIHJlc2l6ZSBs
aW5lLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHJldHVybiB7dm9pZH0K
LSAgICAgKi8KLSAgICBfaGlkZVJlc2l6ZUxpbmUgOiBmdW5jdGlvbigpIHsKLSAgICAgIGlmKHRo
aXMuX3Jlc2l6ZUxpbmUpIHsKLSAgICAgICAgdGhpcy5fcmVzaXplTGluZS5zZXRTdHlsZVByb3Bl
cnR5KCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpOwotICAgICAgfQotICAgIH0sCi0KLQotICAgIC8q
KgotICAgICAqIFNob3dzIHRoZSBmZWVkYmFjayBzaG93biB3aGlsZSBhIGNvbHVtbiBpcyBtb3Zl
ZCBieSB0aGUgdXNlci4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEBwYXJh
bSBwYWdlWCB7SW50ZWdlcn0gdGhlIHggcG9zaXRpb24gb2YgdGhlIG1vdXNlIGluIHRoZSBwYWdl
IChpbiBwaXhlbHMpLgotICAgICAqIEByZXR1cm4ge0ludGVnZXJ9IHRoZSB2aXNpYmxlIHggcG9z
aXRpb24gb2YgdGhlIGNvbHVtbiBpbiB0aGUgd2hvbGUgdGFibGUuCi0gICAgICovCi0gICAgc2hv
d0NvbHVtbk1vdmVGZWVkYmFjayA6IGZ1bmN0aW9uKHBhZ2VYKQotICAgIHsKLSAgICAgIHZhciBw
YW5lTW9kZWwgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVsKCk7Ci0gICAgICB2YXIgY29sdW1uTW9k
ZWwgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwotICAgICAgdmFyIHBh
bmVMZWZ0WCA9IHF4LmJvbS5lbGVtZW50LkxvY2F0aW9uLmdldExlZnQodGhpcy5fdGFibGVQYW5l
LmdldEVsZW1lbnQoKSk7Ci0gICAgICB2YXIgY29sQ291bnQgPSBwYW5lTW9kZWwuZ2V0Q29sdW1u
Q291bnQoKTsKLQotICAgICAgdmFyIHRhcmdldFhQb3MgPSAwOwotICAgICAgdmFyIHRhcmdldFgg
PSAwOwotICAgICAgdmFyIGN1cnJYID0gcGFuZUxlZnRYOwotCi0gICAgICBmb3IgKHZhciB4UG9z
PTA7IHhQb3M8Y29sQ291bnQ7IHhQb3MrKykKLSAgICAgIHsKLSAgICAgICAgdmFyIGNvbCA9IHBh
bmVNb2RlbC5nZXRDb2x1bW5BdFgoeFBvcyk7Ci0gICAgICAgIHZhciBjb2xXaWR0aCA9IGNvbHVt
bk1vZGVsLmdldENvbHVtbldpZHRoKGNvbCk7Ci0KLSAgICAgICAgaWYgKHBhZ2VYIDwgY3Vyclgg
KyBjb2xXaWR0aCAvIDIpIHsKLSAgICAgICAgICBicmVhazsKLSAgICAgICAgfQotCi0gICAgICAg
IGN1cnJYICs9IGNvbFdpZHRoOwotICAgICAgICB0YXJnZXRYUG9zID0geFBvcyArIDE7Ci0gICAg
ICAgIHRhcmdldFggPSBjdXJyWCAtIHBhbmVMZWZ0WDsKLSAgICAgIH0KLQotICAgICAgLy8gRW5z
dXJlIHRhcmdldFggaXMgdmlzaWJsZQotICAgICAgdmFyIGNsaXBwZXJMZWZ0WCA9IHF4LmJvbS5l
bGVtZW50LkxvY2F0aW9uLmdldExlZnQodGhpcy5fcGFuZUNsaXBwZXIuZ2V0RWxlbWVudCgpKTsK
LSAgICAgIHZhciBjbGlwcGVyV2lkdGggPSB0aGlzLl9wYW5lQ2xpcHBlci5nZXRCb3hXaWR0aCgp
OwotICAgICAgdmFyIHNjcm9sbFggPSBjbGlwcGVyTGVmdFggLSBwYW5lTGVmdFg7Ci0KLSAgICAg
IC8vIE5PVEU6ICsyLy0xIGJlY2F1c2Ugb2YgZmVlZGJhY2sgd2lkdGgKLSAgICAgIHRhcmdldFgg
PSBxeC5sYW5nLk51bWJlci5saW1pdCh0YXJnZXRYLCBzY3JvbGxYICsgMiwgc2Nyb2xsWCArIGNs
aXBwZXJXaWR0aCAtIDEpOwotCi0gICAgICB0aGlzLl9zaG93UmVzaXplTGluZSh0YXJnZXRYKTsK
LQotICAgICAgLy8gUmV0dXJuIHRoZSBvdmVyYWxsIHRhcmdldCB4IHBvc2l0aW9uCi0gICAgICBy
ZXR1cm4gcGFuZU1vZGVsLmdldEZpcnN0Q29sdW1uWCgpICsgdGFyZ2V0WFBvczsKLSAgICB9LAot
Ci0KLSAgICAvKioKLSAgICAgKiBIaWRlcyB0aGUgZmVlZGJhY2sgc2hvd24gd2hpbGUgYSBjb2x1
bW4gaXMgbW92ZWQgYnkgdGhlIHVzZXIuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAg
ICAgKiBAcmV0dXJuIHt2b2lkfQotICAgICAqLwotICAgIGhpZGVDb2x1bW5Nb3ZlRmVlZGJhY2sg
OiBmdW5jdGlvbigpIHsKLSAgICAgIHRoaXMuX2hpZGVSZXNpemVMaW5lKCk7Ci0gICAgfSwKLQot
Ci0gICAgLyoqCi0gICAgICogU2V0cyB0aGUgZm9jdXMgdG8gdGhlIGNlbGwgdGhhdCdzIGxvY2F0
ZWQgYXQgdGhlIHBhZ2UgcG9zaXRpb24KLSAgICAgKiA8Y29kZT5wYWdlWDwvY29kZT4vPGNvZGU+
cGFnZVk8L2NvZGU+LiBJZiB0aGVyZSBpcyBubyBjZWxsIGF0IHRoYXQgcG9zaXRpb24sCi0gICAg
ICogbm90aGluZyBoYXBwZW5zLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICog
QHBhcmFtIHBhZ2VYIHtJbnRlZ2VyfSB0aGUgeCBwb3NpdGlvbiBpbiB0aGUgcGFnZSAoaW4gcGl4
ZWxzKS4KLSAgICAgKiBAcGFyYW0gcGFnZVkge0ludGVnZXJ9IHRoZSB5IHBvc2l0aW9uIGluIHRo
ZSBwYWdlIChpbiBwaXhlbHMpLgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAg
X2ZvY3VzQ2VsbEF0UGFnZVBvcyA6IGZ1bmN0aW9uKHBhZ2VYLCBwYWdlWSkKLSAgICB7Ci0gICAg
ICB2YXIgcm93ID0gdGhpcy5fZ2V0Um93Rm9yUGFnZVBvcyhwYWdlWCwgcGFnZVkpOwotCi0gICAg
ICBpZiAocm93ICE9IC0xICYmIHJvdyAhPSBudWxsKQotICAgICAgewotICAgICAgICAvLyBUaGUg
bW91c2UgaXMgb3ZlciB0aGUgZGF0YSAtPiB1cGRhdGUgdGhlIGZvY3VzCi0gICAgICAgIHZhciBj
b2wgPSB0aGlzLl9nZXRDb2x1bW5Gb3JQYWdlWChwYWdlWCk7Ci0KLSAgICAgICAgaWYgKGNvbCAh
PSBudWxsKSB7Ci0gICAgICAgICAgdGhpcy5fdGFibGUuc2V0Rm9jdXNlZENlbGwoY29sLCByb3cp
OwotICAgICAgICB9Ci0gICAgICB9Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogU2V0cyB0
aGUgY3VycmVudGx5IGZvY3VzZWQgY2VsbC4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgot
ICAgICAqIEBwYXJhbSBjb2wge0ludGVnZXJ9IHRoZSBtb2RlbCBpbmRleCBvZiB0aGUgZm9jdXNl
ZCBjZWxsJ3MgY29sdW1uLgotICAgICAqIEBwYXJhbSByb3cge0ludGVnZXJ9IHRoZSBtb2RlbCBp
bmRleCBvZiB0aGUgZm9jdXNlZCBjZWxsJ3Mgcm93LgotICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0g
ICAgICovCi0gICAgc2V0Rm9jdXNlZENlbGwgOiBmdW5jdGlvbihjb2wsIHJvdykKLSAgICB7Ci0g
ICAgICBpZiAoIXRoaXMuaXNFZGl0aW5nKCkpCi0gICAgICB7Ci0gICAgICAgIHRoaXMuX3RhYmxl
UGFuZS5zZXRGb2N1c2VkQ2VsbChjb2wsIHJvdywgdGhpcy5fdXBkYXRlQ29udGVudFBsYW5uZWQp
OwotCi0gICAgICAgIHRoaXMuX2ZvY3VzZWRDb2wgPSBjb2w7Ci0gICAgICAgIHRoaXMuX2ZvY3Vz
ZWRSb3cgPSByb3c7Ci0KLSAgICAgICAgLy8gTW92ZSB0aGUgZm9jdXMgaW5kaWNhdG9yCi0gICAg
ICAgIGlmICghdGhpcy5fdXBkYXRlQ29udGVudFBsYW5uZWQpIHsKLSAgICAgICAgICB0aGlzLl91
cGRhdGVGb2N1c0luZGljYXRvcigpOwotICAgICAgICB9Ci0gICAgICB9Ci0gICAgfSwKLQotCi0g
ICAgLyoqCi0gICAgICogUmV0dXJucyB0aGUgY29sdW1uIG9mIGN1cnJlbnRseSBmb2N1c2VkIGNl
bGwuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcmV0dXJuIHtJbnRlZ2Vy
fSB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGZvY3VzZWQgY2VsbCdzIGNvbHVtbi4KLSAgICAgKi8K
LSAgICBnZXRGb2N1c2VkQ29sdW1uIDogZnVuY3Rpb24oKSB7Ci0gICAgICByZXR1cm4gdGhpcy5f
Zm9jdXNlZENvbDsKLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBSZXR1cm5zIHRoZSByb3cg
b2YgY3VycmVudGx5IGZvY3VzZWQgY2VsbC4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgot
ICAgICAqIEByZXR1cm4ge0ludGVnZXJ9IHRoZSBtb2RlbCBpbmRleCBvZiB0aGUgZm9jdXNlZCBj
ZWxsJ3MgY29sdW1uLgotICAgICAqLwotICAgIGdldEZvY3VzZWRSb3cgOiBmdW5jdGlvbigpIHsK
LSAgICAgIHJldHVybiB0aGlzLl9mb2N1c2VkUm93OwotICAgIH0sCi0KLQotICAgIC8qKgotICAg
ICAqIFNjcm9sbHMgYSBjZWxsIHZpc2libGUuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIK
LSAgICAgKiBAcGFyYW0gY29sIHtJbnRlZ2VyfSB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGNvbHVt
biB0aGUgY2VsbCBiZWxvbmdzIHRvLgotICAgICAqIEBwYXJhbSByb3cge0ludGVnZXJ9IHRoZSBt
b2RlbCBpbmRleCBvZiB0aGUgcm93IHRoZSBjZWxsIGJlbG9uZ3MgdG8uCi0gICAgICogQHJldHVy
biB7dm9pZH0KLSAgICAgKi8KLSAgICBzY3JvbGxDZWxsVmlzaWJsZSA6IGZ1bmN0aW9uKGNvbCwg
cm93KQotICAgIHsKLSAgICAgIHZhciBwYW5lTW9kZWwgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVs
KCk7Ci0gICAgICB2YXIgeFBvcyA9IHBhbmVNb2RlbC5nZXRYKGNvbCk7Ci0KLSAgICAgIGlmICh4
UG9zICE9IC0xKQotICAgICAgewotICAgICAgICB2YXIgY29sdW1uTW9kZWwgPSB0aGlzLmdldFRh
YmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwotCi0gICAgICAgIHZhciBjb2xMZWZ0ID0gcGFu
ZU1vZGVsLmdldENvbHVtbkxlZnQoY29sKTsKLSAgICAgICAgdmFyIGNvbFdpZHRoID0gY29sdW1u
TW9kZWwuZ2V0Q29sdW1uV2lkdGgoY29sKTsKLSAgICAgICAgdmFyIHJvd0hlaWdodCA9IHRoaXMu
Z2V0VGFibGUoKS5nZXRSb3dIZWlnaHQoKTsKLSAgICAgICAgdmFyIHJvd1RvcCA9IHJvdyAqIHJv
d0hlaWdodDsKLQotICAgICAgICB2YXIgc2Nyb2xsWCA9IHRoaXMuZ2V0U2Nyb2xsWCgpOwotICAg
ICAgICB2YXIgc2Nyb2xsWSA9IHRoaXMuZ2V0U2Nyb2xsWSgpOwotICAgICAgICB2YXIgdmlld1dp
ZHRoID0gdGhpcy5fcGFuZUNsaXBwZXIuZ2V0Qm94V2lkdGgoKTsKLSAgICAgICAgdmFyIHZpZXdI
ZWlnaHQgPSB0aGlzLl9wYW5lQ2xpcHBlci5nZXRCb3hIZWlnaHQoKTsKLQotICAgICAgICAvLyBO
T1RFOiBXZSBkb24ndCB1c2UgcXgubGFuZy5OdW1iZXIubGltaXQsIGJlY2F1c2UgbWluIHNob3Vs
ZCB3aW4gaWYgbWF4IDwgbWluCi0gICAgICAgIHZhciBtaW5TY3JvbGxYID0gTWF0aC5taW4oY29s
TGVmdCwgY29sTGVmdCArIGNvbFdpZHRoIC0gdmlld1dpZHRoKTsKLSAgICAgICAgdmFyIG1heFNj
cm9sbFggPSBjb2xMZWZ0OwotICAgICAgICB0aGlzLnNldFNjcm9sbFgoTWF0aC5tYXgobWluU2Ny
b2xsWCwgTWF0aC5taW4obWF4U2Nyb2xsWCwgc2Nyb2xsWCkpKTsKLQotICAgICAgICB2YXIgbWlu
U2Nyb2xsWSA9IHJvd1RvcCArIHJvd0hlaWdodCAtIHZpZXdIZWlnaHQ7Ci0KLSAgICAgICAgaWYg
KHRoaXMuZ2V0VGFibGUoKS5nZXRLZWVwRmlyc3RWaXNpYmxlUm93Q29tcGxldGUoKSkgewotICAg
ICAgICAgIG1pblNjcm9sbFkgKz0gcm93SGVpZ2h0IC0gMTsKLSAgICAgICAgfQotCi0gICAgICAg
IHZhciBtYXhTY3JvbGxZID0gcm93VG9wOwotICAgICAgICB0aGlzLnNldFNjcm9sbFkoTWF0aC5t
YXgobWluU2Nyb2xsWSwgTWF0aC5taW4obWF4U2Nyb2xsWSwgc2Nyb2xsWSkpLCB0cnVlKTsKLSAg
ICAgIH0KLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBSZXR1cm5zIHdoZXRoZXIgY3VycmVu
dGx5IGEgY2VsbCBpcyBlZGl0aW5nLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAg
ICogQHJldHVybiB7dmFyfSB3aGV0aGVyIGN1cnJlbnRseSBhIGNlbGwgaXMgZWRpdGluZy4KLSAg
ICAgKi8KLSAgICBpc0VkaXRpbmcgOiBmdW5jdGlvbigpIHsKLSAgICAgIHJldHVybiB0aGlzLl9j
ZWxsRWRpdG9yICE9IG51bGw7Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICogU3RhcnRzIGVk
aXRpbmcgdGhlIGN1cnJlbnRseSBmb2N1c2VkIGNlbGwuIERvZXMgbm90aGluZyBpZiBhbHJlYWR5
Ci0gICAgICogZWRpdGluZywgaWYgdGhlIGNvbHVtbiBpcyBub3QgZWRpdGFibGUsIG9yIGlmIHRo
ZSBjZWxsIGVkaXRvciBmb3IgdGhlCi0gICAgICogY29sdW1uIGFzY2VydGFpbnMgdGhhdCB0aGUg
cGFydGljdWxhciBjZWxsIGlzIG5vdCBlZGl0YWJsZS4KLSAgICAgKgotICAgICAqIEB0eXBlIG1l
bWJlcgotICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHdoZXRoZXIgZWRpdGluZyB3YXMgc3RhcnRl
ZAotICAgICAqLwotICAgIHN0YXJ0RWRpdGluZyA6IGZ1bmN0aW9uKCkKLSAgICB7Ci0gICAgICB2
YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7Ci0gICAgICB2YXIgdGFibGVNb2RlbCA9IHRhYmxl
LmdldFRhYmxlTW9kZWwoKTsKLSAgICAgIHZhciBjb2wgPSB0aGlzLl9mb2N1c2VkQ29sOwotCi0g
ICAgICBpZiAoIXRoaXMuaXNFZGl0aW5nKCkgJiYKLSAgICAgICAgICAoY29sICE9IG51bGwpICYm
Ci0gICAgICAgICAgdGFibGVNb2RlbC5pc0NvbHVtbkVkaXRhYmxlKGNvbCkpCi0gICAgICB7Ci0g
ICAgICAgIHZhciByb3cgPSB0aGlzLl9mb2N1c2VkUm93OwotICAgICAgICB2YXIgeFBvcyA9IHRo
aXMuZ2V0VGFibGVQYW5lTW9kZWwoKS5nZXRYKGNvbCk7Ci0gICAgICAgIHZhciB2YWx1ZSA9IHRh
YmxlTW9kZWwuZ2V0VmFsdWUoY29sLCByb3cpOwotCi0gICAgICAgIHRoaXMuX2NlbGxFZGl0b3JG
YWN0b3J5ID0KLSAgICAgICAgICB0YWJsZS5nZXRUYWJsZUNvbHVtbk1vZGVsKCkuZ2V0Q2VsbEVk
aXRvckZhY3RvcnkoY29sKTsKLQotICAgICAgICB2YXIgY2VsbEluZm8gPQotICAgICAgICB7Ci0g
ICAgICAgICAgY29sICAgOiBjb2wsCi0gICAgICAgICAgcm93ICAgOiByb3csCi0gICAgICAgICAg
eFBvcyAgOiB4UG9zLAotICAgICAgICAgIHZhbHVlIDogdmFsdWUsCi0gICAgICAgICAgdGFibGUg
OiB0YWJsZQotICAgICAgICB9OwotCi0gICAgICAgIC8vIEdldCBhIGNlbGwgZWRpdG9yCi0gICAg
ICAgIHRoaXMuX2NlbGxFZGl0b3IgPQotICAgICAgICAgIHRoaXMuX2NlbGxFZGl0b3JGYWN0b3J5
LmNyZWF0ZUNlbGxFZGl0b3IoY2VsbEluZm8pOwotCi0gICAgICAgIC8vIFdlIGhhbmRsZSB0d28g
dHlwZXMgb2YgY2VsbCBlZGl0b3JzOiB0aGUgdHJhZGl0aW9uYWwgaW4tcGxhY2UKLSAgICAgICAg
Ly8gZWRpdG9yLCB3aGVyZSB0aGUgY2VsbCBlZGl0b3IgcmV0dXJuZWQgYnkgdGhlIGZhY3Rvcnkg
bXVzdCBmaXQgaW4KLSAgICAgICAgLy8gdGhlIHNwYWNlIG9mIHRoZSB0YWJsZSBjZWxsOyBhbmQg
YSBtb2RhbCB3aW5kb3cgaW4gd2hpY2ggdGhlCi0gICAgICAgIC8vIGVkaXRpbmcgdGFrZXMgcGxh
Y2UuICBBZGRpdGlvbmFsbHksIGlmIHRoZSBjZWxsIGVkaXRvciBkZXRlcm1pbmVzCi0gICAgICAg
IC8vIHRoYXQgaXQgZG9lcyBub3Qgd2FudCB0byBlZGl0IHRoZSBwYXJ0aWN1bGFyIGNlbGwgYmVp
bmcgcmVxdWVzdGVkLAotICAgICAgICAvLyBpdCBtYXkgcmV0dXJuIG51bGwgdG8gaW5kaWNhdGUg
dGhhdCB0aGF0IGNlbGwgaXMgbm90IGVkaXRhYmxlLgotICAgICAgICBpZiAodGhpcy5fY2VsbEVk
aXRvciA9PT0gbnVsbCkKLSAgICAgICAgewotICAgICAgICAgIC8vIFRoaXMgY2VsbCBpcyBub3Qg
ZWRpdGFibGUgZXZlbiB0aG91Z2ggaXRzIGNvbHVtbiBpcy4KLSAgICAgICAgICByZXR1cm4gZmFs
c2U7Ci0gICAgICAgIH0KLSAgICAgICAgZWxzZSBpZiAodGhpcy5fY2VsbEVkaXRvciBpbnN0YW5j
ZW9mIHF4LnVpLndpbmRvdy5XaW5kb3cpCi0gICAgICAgIHsKLSAgICAgICAgICAvLyBJdCdzIGEg
d2luZG93LiAgRW5zdXJlIHRoYXQgaXQncyBtb2RhbC4KLSAgICAgICAgICB0aGlzLl9jZWxsRWRp
dG9yLnNldE1vZGFsKHRydWUpOwotCi0gICAgICAgICAgLy8gQXQgbGVhc3QgZm9yIHRoZSB0aW1l
IGJlaW5nLCB3ZSBkaXNhbGxvdyB0aGUgY2xvc2UgYnV0dG9uLiAgSXQKLSAgICAgICAgICAvLyBh
Y3RzIGRpZmZlcmVudGx5IHRoYW4gYSBjZWxsRWRpdG9yLmNsb3NlKCksIGFuZCBpbnZva2VzIGEg
YnVnCi0gICAgICAgICAgLy8gc29tZXBsYWNlLiAgTW9kYWwgd2luZG93IGNlbGwgZWRpdG9ycyBz
aG91bGQgcHJvdmlkZSB0aGVpciBvd24KLSAgICAgICAgICAvLyBidXR0b25zIG9yIG1lYW5zIHRv
IGFjdGl2YXRlIGEgY2VsbEVkaXRvci5jbG9zZSgpIG9yIGVxdWl2YWxlbnRseQotICAgICAgICAg
IC8vIGNlbGxFZGl0b3IuaGlkZSgpLgotICAgICAgICAgIHRoaXMuX2NlbGxFZGl0b3Iuc2V0U2hv
d0Nsb3NlKGZhbHNlKTsKLQotICAgICAgICAgIC8vIEFkZCB0aGUgY2VsbCBlZGl0b3IgdG8gdGhl
IGRvY3VtZW50Ci0gICAgICAgICAgdGhpcy5fY2VsbEVkaXRvci5hZGRUb0RvY3VtZW50KCk7Ci0K
LSAgICAgICAgICAvLyBBcnJhbmdlIHRvIGJlIG5vdGlmaWVkIHdoZW4gaXQgaXMgY2xvc2VkLgot
ICAgICAgICAgIHRoaXMuX2NlbGxFZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcigKLSAgICAgICAgICAg
ICJkaXNhcHBlYXIiLAotICAgICAgICAgICAgdGhpcy5fb25DZWxsRWRpdG9yTW9kYWxXaW5kb3dD
bG9zZSwKLSAgICAgICAgICAgIHRoaXMKLSAgICAgICAgICApOwotCi0gICAgICAgICAgLy8gSWYg
dGhlcmUncyBhIHByZS1vcGVuIGZ1bmN0aW9uIGRlZmluZWQgZm9yIHRoZSB0YWJsZS4uLgotICAg
ICAgICAgIHZhciBmID0gdGFibGUuZ2V0TW9kYWxDZWxsRWRpdG9yUHJlT3BlbkZ1bmN0aW9uKCk7
Ci0gICAgICAgICAgaWYgKGYgIT0gbnVsbCkKLSAgICAgICAgICB7Ci0gICAgICAgICAgICBmKHRo
aXMuX2NlbGxFZGl0b3IsIGNlbGxJbmZvKTsKLSAgICAgICAgICB9Ci0KLSAgICAgICAgICAvLyBP
cGVuIGl0IG5vdy4KLSAgICAgICAgICB0aGlzLl9jZWxsRWRpdG9yLm9wZW4oKTsKLSAgICAgICAg
fQotICAgICAgICBlbHNlCi0gICAgICAgIHsKLSAgICAgICAgICAvLyBUaGUgY2VsbCBlZGl0b3Ig
aXMgYSB0cmFkaXRpb25hbCBpbi1wbGFjZSBlZGl0b3IuCi0gICAgICAgICAgdGhpcy5fY2VsbEVk
aXRvci5zZXQoCi0gICAgICAgICAgewotICAgICAgICAgICAgd2lkdGggIDogIjEwMCUiLAotICAg
ICAgICAgICAgaGVpZ2h0IDogIjEwMCUiCi0gICAgICAgICAgfSk7Ci0KLSAgICAgICAgICAvLyBw
cmV2ZW50IGNsaWNrIGV2ZW50IGZyb20gYnViYmxpbmcgdXAgdG8gdGhlIHRhYmxlCi0gICAgICAg
ICAgdGhpcy5fZm9jdXNJbmRpY2F0b3IuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZnVu
Y3Rpb24oZSkgewotICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKLSAgICAgICAgICB9
KTsKLQotICAgICAgICAgIHRoaXMuX2ZvY3VzSW5kaWNhdG9yLmFkZCh0aGlzLl9jZWxsRWRpdG9y
KTsKLSAgICAgICAgICB0aGlzLl9mb2N1c0luZGljYXRvci5hZGRTdGF0ZSgiZWRpdGluZyIpOwot
Ci0gICAgICAgICAgLy8gV29ya2Fyb3VuZDogQ2FsbGluZyBmb2N1cygpIGRpcmVjdGx5IGhhcyBu
byBlZmZlY3QKLSAgICAgICAgICBxeC5jbGllbnQuVGltZXIub25jZShmdW5jdGlvbigpCi0gICAg
ICAgICAgewotICAgICAgICAgICAgaWYgKHRoaXMuZ2V0RGlzcG9zZWQoKSkKLSAgICAgICAgICAg
IHsKLSAgICAgICAgICAgICAgcmV0dXJuOwotICAgICAgICAgICAgfQotCi0gICAgICAgICAgICB0
aGlzLl9jZWxsRWRpdG9yLmZvY3VzKCk7Ci0gICAgICAgICAgfSwgdGhpcywgMCk7Ci0gICAgICAg
IH0KLQotICAgICAgICByZXR1cm4gdHJ1ZTsKLSAgICAgIH0KLQotICAgICAgcmV0dXJuIGZhbHNl
OwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIFN0b3BzIGVkaXRpbmcgYW5kIHdyaXRlcyB0
aGUgZWRpdG9yJ3MgdmFsdWUgdG8gdGhlIG1vZGVsLgotICAgICAqCi0gICAgICogQHR5cGUgbWVt
YmVyCi0gICAgICogQHJldHVybiB7dm9pZH0KLSAgICAgKi8KLSAgICBzdG9wRWRpdGluZyA6IGZ1
bmN0aW9uKCkKLSAgICB7Ci0gICAgICB0aGlzLmZsdXNoRWRpdG9yKCk7Ci0gICAgICB0aGlzLmNh
bmNlbEVkaXRpbmcoKTsKLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBXcml0ZXMgdGhlIGVk
aXRvcidzIHZhbHVlIHRvIHRoZSBtb2RlbC4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgot
ICAgICAqIEByZXR1cm4ge3ZvaWR9Ci0gICAgICovCi0gICAgZmx1c2hFZGl0b3IgOiBmdW5jdGlv
bigpCi0gICAgewotICAgICAgaWYgKHRoaXMuaXNFZGl0aW5nKCkpCi0gICAgICB7Ci0gICAgICAg
IHZhciB2YWx1ZSA9IHRoaXMuX2NlbGxFZGl0b3JGYWN0b3J5LmdldENlbGxFZGl0b3JWYWx1ZSh0
aGlzLl9jZWxsRWRpdG9yKTsKLSAgICAgICAgdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlTW9kZWwo
KS5zZXRWYWx1ZSh0aGlzLl9mb2N1c2VkQ29sLCB0aGlzLl9mb2N1c2VkUm93LCB2YWx1ZSk7Ci0K
LSAgICAgICAgdGhpcy5fdGFibGUuZm9jdXMoKTsKLSAgICAgIH0KLSAgICB9LAotCi0KLSAgICAv
KioKLSAgICAgKiBTdG9wcyBlZGl0aW5nIHdpdGhvdXQgd3JpdGluZyB0aGUgZWRpdG9yJ3MgdmFs
dWUgdG8gdGhlIG1vZGVsLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHJl
dHVybiB7dm9pZH0KLSAgICAgKi8KLSAgICBjYW5jZWxFZGl0aW5nIDogZnVuY3Rpb24oKQotICAg
IHsKLSAgICAgIGlmICh0aGlzLmlzRWRpdGluZygpICYmICEgdGhpcy5fY2VsbEVkaXRvci5wZW5k
aW5nRGlzcG9zZSkKLSAgICAgIHsKLSAgICAgICAgaWYgKHRoaXMuX2NlbGxFZGl0b3JJc01vZGFs
V2luZG93KQotICAgICAgICB7Ci0gICAgICAgICAgLy8gRGVmZXIgdGhlIGFjdHVhbCBkaXNwb3Np
bmcgb2YgdGhlIGNlbGwgZWRpdG9yIGJyaWVmbHksIGFzIHRoZXJlCi0gICAgICAgICAgLy8gbWF5
IGJlIG1vcmUgYWNjZXNzZXMgdG8gaXQgZm9yIGEgc2hvcnQgd2hpbGUgYWZ0ZXIgd2UgbGVhdmUg
dGhpcwotICAgICAgICAgIC8vIGZ1bmN0aW9uLgotICAgICAgICAgIHF4LmNsaWVudC5UaW1lci5v
bmNlKGZ1bmN0aW9uKCkKLSAgICAgICAgICB7Ci0gICAgICAgICAgICB2YXIgZCA9IHF4LnVpLmNv
cmUuQ2xpZW50RG9jdW1lbnQuZ2V0SW5zdGFuY2UoKTsKLSAgICAgICAgICAgIGQucmVtb3ZlKHRo
aXMuX2NlbGxFZGl0b3IpOwotCi0gICAgICAgICAgICB0aGlzLl9jZWxsRWRpdG9yLnJlbW92ZUV2
ZW50TGlzdGVuZXIoCi0gICAgICAgICAgICAgICJkaXNhcHBlYXIiLAotICAgICAgICAgICAgICB0
aGlzLl9vbkNlbGxFZGl0b3JNb2RhbFdpbmRvd0Nsb3NlLAotICAgICAgICAgICAgICB0aGlzCi0g
ICAgICAgICAgICApOwotCi0gICAgICAgICAgICB0aGlzLl9jZWxsRWRpdG9yLmRpc3Bvc2UoKTsK
LSAgICAgICAgICAgIHRoaXMuX2NlbGxFZGl0b3IgPSBudWxsOwotICAgICAgICAgICAgdGhpcy5f
Y2VsbEVkaXRvckZhY3RvcnkgPSBudWxsOwotICAgICAgICAgIH0sIHRoaXMsIDApOwotCi0gICAg
ICAgICAgdGhpcy5fY2VsbEVkaXRvci5wZW5kaW5nRGlzcG9zZSA9IHRydWU7Ci0gICAgICAgIH0K
LSAgICAgICAgZWxzZQotICAgICAgICB7Ci0gICAgICAgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3Iu
cmVtb3ZlKHRoaXMuX2NlbGxFZGl0b3IpOwotICAgICAgICAgIHRoaXMuX2ZvY3VzSW5kaWNhdG9y
LnJlbW92ZVN0YXRlKCJlZGl0aW5nIik7Ci0gICAgICAgICAgdGhpcy5fY2VsbEVkaXRvci5kaXNw
b3NlKCk7Ci0gICAgICAgICAgdGhpcy5fY2VsbEVkaXRvciA9IG51bGw7Ci0gICAgICAgICAgdGhp
cy5fY2VsbEVkaXRvckZhY3RvcnkgPSBudWxsOwotICAgICAgICB9Ci0gICAgICB9Ci0gICAgfSwK
LQotCi0gICAgLyoqCi0gICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIG1vZGFs
IHdpbmRvdyBvZiB0aGUgY2VsbCBlZGl0b3IgY2xvc2VzLgotICAgICAqCi0gICAgICogQHR5cGUg
bWVtYmVyCi0gICAgICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuCi0gICAgICogQHJldHVy
biB7dm9pZH0KLSAgICAgKi8KLSAgICBfb25DZWxsRWRpdG9yTW9kYWxXaW5kb3dDbG9zZSA6IGZ1
bmN0aW9uKGV2dCkKLSAgICB7Ci0gICAgICB0aGlzLnN0b3BFZGl0aW5nKCk7Ci0gICAgfSwKLQot
Ci0gICAgLyoqCi0gICAgICogUmV0dXJucyB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGNvbHVtbiB0
aGUgbW91c2UgaXMgb3ZlciBvciBudWxsIGlmIHRoZSBtb3VzZQotICAgICAqIGlzIG5vdCBvdmVy
IGEgY29sdW1uLgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHBhcmFtIHBh
Z2VYIHtJbnRlZ2VyfSB0aGUgeCBwb3NpdGlvbiBvZiB0aGUgbW91c2UgaW4gdGhlIHBhZ2UgKGlu
IHBpeGVscykuCi0gICAgICogQHJldHVybiB7SW50ZWdlcn0gdGhlIG1vZGVsIGluZGV4IG9mIHRo
ZSBjb2x1bW4gdGhlIG1vdXNlIGlzIG92ZXIuCi0gICAgICovCi0gICAgX2dldENvbHVtbkZvclBh
Z2VYIDogZnVuY3Rpb24ocGFnZVgpCi0gICAgewotICAgICAgdmFyIGhlYWRlckxlZnRYID0gcXgu
Ym9tLmVsZW1lbnQuTG9jYXRpb24uZ2V0TGVmdCh0aGlzLl9oZWFkZXIuZ2V0RWxlbWVudCgpKTsK
LQotICAgICAgdmFyIGNvbHVtbk1vZGVsID0gdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlQ29sdW1u
TW9kZWwoKTsKLSAgICAgIHZhciBwYW5lTW9kZWwgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVsKCk7
Ci0gICAgICB2YXIgY29sQ291bnQgPSBwYW5lTW9kZWwuZ2V0Q29sdW1uQ291bnQoKTsKLSAgICAg
IHZhciBjdXJyWCA9IGhlYWRlckxlZnRYOwotCi0gICAgICBmb3IgKHZhciB4PTA7IHg8Y29sQ291
bnQ7IHgrKykKLSAgICAgIHsKLSAgICAgICAgdmFyIGNvbCA9IHBhbmVNb2RlbC5nZXRDb2x1bW5B
dFgoeCk7Ci0gICAgICAgIHZhciBjb2xXaWR0aCA9IGNvbHVtbk1vZGVsLmdldENvbHVtbldpZHRo
KGNvbCk7Ci0gICAgICAgIGN1cnJYICs9IGNvbFdpZHRoOwotCi0gICAgICAgIGlmIChwYWdlWCA8
IGN1cnJYKSB7Ci0gICAgICAgICAgcmV0dXJuIGNvbDsKLSAgICAgICAgfQotICAgICAgfQotCi0g
ICAgICByZXR1cm4gbnVsbDsKLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBSZXR1cm5zIHRo
ZSBtb2RlbCBpbmRleCBvZiB0aGUgY29sdW1uIHRoYXQgc2hvdWxkIGJlIHJlc2l6ZWQgd2hlbiBk
cmFnZ2luZwotICAgICAqIHN0YXJ0cyBoZXJlLiBSZXR1cm5zIC0xIGlmIHRoZSBtb3VzZSBpcyBp
biBubyByZXNpemUgcmVnaW9uIG9mIGFueSBjb2x1bW4uCi0gICAgICoKLSAgICAgKiBAdHlwZSBt
ZW1iZXIKLSAgICAgKiBAcGFyYW0gcGFnZVgge0ludGVnZXJ9IHRoZSB4IHBvc2l0aW9uIG9mIHRo
ZSBtb3VzZSBpbiB0aGUgcGFnZSAoaW4gcGl4ZWxzKS4KLSAgICAgKiBAcmV0dXJuIHtJbnRlZ2Vy
fSB0aGUgY29sdW1uIGluZGV4LgotICAgICAqLwotICAgIF9nZXRSZXNpemVDb2x1bW5Gb3JQYWdl
WCA6IGZ1bmN0aW9uKHBhZ2VYKQotICAgIHsKLSAgICAgIHZhciBoZWFkZXJMZWZ0WCA9IHF4LmJv
bS5lbGVtZW50LkxvY2F0aW9uLmdldExlZnQodGhpcy5faGVhZGVyLmdldEVsZW1lbnQoKSk7Ci0K
LSAgICAgIHZhciBjb2x1bW5Nb2RlbCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRUYWJsZUNvbHVtbk1v
ZGVsKCk7Ci0gICAgICB2YXIgcGFuZU1vZGVsID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpOwot
ICAgICAgdmFyIGNvbENvdW50ID0gcGFuZU1vZGVsLmdldENvbHVtbkNvdW50KCk7Ci0gICAgICB2
YXIgY3VyclggPSBoZWFkZXJMZWZ0WDsKLSAgICAgIHZhciByZWdpb25SYWRpdXMgPSBxeC51aS50
YWJsZS5wYW5lLlNjcm9sbGVyLlJFU0laRV9SRUdJT05fUkFESVVTOwotCi0gICAgICBmb3IgKHZh
ciB4PTA7IHg8Y29sQ291bnQ7IHgrKykKLSAgICAgIHsKLSAgICAgICAgdmFyIGNvbCA9IHBhbmVN
b2RlbC5nZXRDb2x1bW5BdFgoeCk7Ci0gICAgICAgIHZhciBjb2xXaWR0aCA9IGNvbHVtbk1vZGVs
LmdldENvbHVtbldpZHRoKGNvbCk7Ci0gICAgICAgIGN1cnJYICs9IGNvbFdpZHRoOwotCi0gICAg
ICAgIGlmIChwYWdlWCA+PSAoY3VyclggLSByZWdpb25SYWRpdXMpICYmIHBhZ2VYIDw9IChjdXJy
WCArIHJlZ2lvblJhZGl1cykpIHsKLSAgICAgICAgICByZXR1cm4gY29sOwotICAgICAgICB9Ci0g
ICAgICB9Ci0KLSAgICAgIHJldHVybiAtMTsKLSAgICB9LAotCi0KLSAgICAvKioKLSAgICAgKiBS
ZXR1cm5zIHRoZSBtb2RlbCBpbmRleCBvZiB0aGUgcm93IHRoZSBtb3VzZSBpcyBjdXJyZW50bHkg
b3Zlci4gUmV0dXJucyAtMSBpZgotICAgICAqIHRoZSBtb3VzZSBpcyBvdmVyIHRoZSBoZWFkZXIu
IFJldHVybnMgbnVsbCBpZiB0aGUgbW91c2UgaXMgbm90IG92ZXIgYW55Ci0gICAgICogY29sdW1u
LgotICAgICAqCi0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHBhcmFtIHBhZ2VYIHtJbnRl
Z2VyfSB0aGUgbW91c2UgeCBwb3NpdGlvbiBpbiB0aGUgcGFnZS4KLSAgICAgKiBAcGFyYW0gcGFn
ZVkge0ludGVnZXJ9IHRoZSBtb3VzZSB5IHBvc2l0aW9uIGluIHRoZSBwYWdlLgotICAgICAqIEBy
ZXR1cm4ge0ludGVnZXJ9IHRoZSBtb2RlbCBpbmRleCBvZiB0aGUgcm93IHRoZSBtb3VzZSBpcyBj
dXJyZW50bHkgb3Zlci4KLSAgICAgKi8KLSAgICBfZ2V0Um93Rm9yUGFnZVBvcyA6IGZ1bmN0aW9u
KHBhZ2VYLCBwYWdlWSkKLSAgICB7Ci0gICAgICB2YXIgcGFuZUNsaXBwZXJFbGVtID0gdGhpcy5f
cGFuZUNsaXBwZXIuZ2V0RWxlbWVudCgpOwotCi0gICAgICB2YXIgcGFuZUNsaXBwZXJQb3MgPSBx
eC5ib20uZWxlbWVudC5Mb2NhdGlvbi5nZXQocGFuZUNsaXBwZXJFbGVtKTsKLQotICAgICAgaWYg
KHBhZ2VYIDwgcGFuZUNsaXBwZXJQb3MubGVmdCB8fCBwYWdlWCA+IHBhbmVDbGlwcGVyUG9zLnJp
Z2h0KQotICAgICAgewotICAgICAgICAvLyBUaGVyZSB3YXMgbm8gY2VsbCBvciBoZWFkZXIgY2Vs
bCBoaXQKLSAgICAgICAgcmV0dXJuIG51bGw7Ci0gICAgICB9Ci0KLSAgICAgIGlmIChwYWdlWSA+
PSBwYW5lQ2xpcHBlclBvcy50b3AgJiYgcGFnZVkgPD0gcGFuZUNsaXBwZXJQb3MuYm90dG9tKQot
ICAgICAgewotICAgICAgICAvLyBUaGlzIGV2ZW50IGlzIGluIHRoZSBwYW5lIC0+IEdldCB0aGUg
cm93Ci0gICAgICAgIHZhciByb3dIZWlnaHQgPSB0aGlzLmdldFRhYmxlKCkuZ2V0Um93SGVpZ2h0
KCk7Ci0KLSAgICAgICAgdmFyIHNjcm9sbFkgPSB0aGlzLl92ZXJTY3JvbGxCYXIuZ2V0VmFsdWUo
KTsKLQotICAgICAgICBpZiAodGhpcy5nZXRUYWJsZSgpLmdldEtlZXBGaXJzdFZpc2libGVSb3dD
b21wbGV0ZSgpKSB7Ci0gICAgICAgICAgc2Nyb2xsWSA9IE1hdGguZmxvb3Ioc2Nyb2xsWSAvIHJv
d0hlaWdodCkgKiByb3dIZWlnaHQ7Ci0gICAgICAgIH0KLQotICAgICAgICB2YXIgdGFibGVZID0g
c2Nyb2xsWSArIHBhZ2VZIC0gcGFuZUNsaXBwZXJQb3MudG9wOwotICAgICAgICB2YXIgcm93ID0g
TWF0aC5mbG9vcih0YWJsZVkgLyByb3dIZWlnaHQpOwotCi0gICAgICAgIHZhciByb3dDb3VudCA9
IHRoaXMuZ2V0VGFibGUoKS5nZXRUYWJsZU1vZGVsKCkuZ2V0Um93Q291bnQoKTsKLSAgICAgICAg
cmV0dXJuIChyb3cgPCByb3dDb3VudCkgPyByb3cgOiBudWxsOwotICAgICAgfQotCi0gICAgICB2
YXIgaGVhZGVyUG9zID0gcXguYm9tLmVsZW1lbnQuTG9jYXRpb24uZ2V0KHRoaXMuX2hlYWRlckNs
aXBwZXIuZ2V0RWxlbWVudCgpKTsKLQotICAgICAgaWYgKAotICAgICAgICBwYWdlWSA+PSBoZWFk
ZXJQb3MudG9wICYmCi0gICAgICAgIHBhZ2VZIDw9IGhlYWRlclBvcy5ib3R0b20gJiYKLSAgICAg
ICAgcGFnZVggPD0gaGVhZGVyUG9zLnJpZ2h0KQotICAgICAgewotICAgICAgICAvLyBUaGlzIGV2
ZW50IGlzIGluIHRoZSBwYW5lIC0+IFJldHVybiAtMSBmb3IgdGhlIGhlYWRlcgotICAgICAgICBy
ZXR1cm4gLTE7Ci0gICAgICB9Ci0KLSAgICAgIHJldHVybiBudWxsOwotICAgIH0sCi0KLQotICAg
IC8qKgotICAgICAqIFNldHMgdGhlIHdpZGdldCB0aGF0IHNob3VsZCBiZSBzaG93biBpbiB0aGUg
dG9wIHJpZ2h0IGNvcm5lci4KLSAgICAgKgotICAgICAqIFRoZSB3aWRnZXQgd2lsbCBub3QgYmUg
ZGlzcG9zZWQsIHdoZW4gdGhpcyB0YWJsZSBzY3JvbGxlciBpcyBkaXNwb3NlZC4gU28gdGhlCi0g
ICAgICogY2FsbGVyIGhhcyB0byBkaXNwb3NlIGl0LgotICAgICAqCi0gICAgICogQHR5cGUgbWVt
YmVyCi0gICAgICogQHBhcmFtIHdpZGdldCB7cXgudWkuY29yZS5XaWRnZXR9IFRoZSB3aWRnZXQg
dG8gc2V0LiBNYXkgYmUgbnVsbC4KLSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAgICAqLwotICAg
IHNldFRvcFJpZ2h0V2lkZ2V0IDogZnVuY3Rpb24od2lkZ2V0KQotICAgIHsKLSAgICAgIHZhciBv
bGRXaWRnZXQgPSB0aGlzLl90b3BSaWdodFdpZGdldDsKLQotICAgICAgaWYgKG9sZFdpZGdldCAh
PSBudWxsKSB7Ci0gICAgICAgIHRoaXMuX3RvcC5yZW1vdmUob2xkV2lkZ2V0KTsKLSAgICAgIH0K
LQotICAgICAgaWYgKHdpZGdldCAhPSBudWxsKQotICAgICAgewotICAgICAgICB0aGlzLl90b3Au
cmVtb3ZlKHRoaXMuX3NwYWNlcik7Ci0gICAgICAgIHRoaXMuX3RvcC5hZGQod2lkZ2V0KTsKLSAg
ICAgIH0KLSAgICAgIGVsc2UgaWYgKG9sZFdpZGdldCAhPSBudWxsKQotICAgICAgewotICAgICAg
ICB0aGlzLl90b3AuYWRkKHRoaXMuX3NwYWNlcik7Ci0gICAgICB9Ci0KLSAgICAgIHRoaXMuX3Rv
cFJpZ2h0V2lkZ2V0ID0gd2lkZ2V0OwotICAgIH0sCi0KLQotICAgIC8qKgotICAgICAqIFJldHVy
bnMgdGhlIGhlYWRlci4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEByZXR1
cm4ge3F4LnVpLnRhYmxlLnBhbmUuSGVhZGVyfSB0aGUgaGVhZGVyLgotICAgICAqLwotICAgIGdl
dEhlYWRlciA6IGZ1bmN0aW9uKCkgewotICAgICAgcmV0dXJuIHRoaXMuX2hlYWRlcjsKLSAgICB9
LAotCi0KLSAgICAvKioKLSAgICAgKiBSZXR1cm5zIHRoZSB0YWJsZSBwYW5lLgotICAgICAqCi0g
ICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHJldHVybiB7cXgudWkudGFibGUucGFuZS5QYW5l
fSB0aGUgdGFibGUgcGFuZS4KLSAgICAgKi8KLSAgICBnZXRUYWJsZVBhbmUgOiBmdW5jdGlvbigp
IHsKLSAgICAgIHJldHVybiB0aGlzLl90YWJsZVBhbmU7Ci0gICAgfSwKLQotCi0gICAgLyoqCi0g
ICAgICogUmV0dXJucyB3aGljaCBzY3JvbGxiYXJzIGFyZSBuZWVkZWQuCi0gICAgICoKLSAgICAg
KiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcGFyYW0gZm9yY2VIb3Jpem9udGFsIHtCb29sZWFuID8g
ZmFsc2V9IFdoZXRoZXIgdG8gc2hvdyB0aGUgaG9yaXpvbnRhbAotICAgICAqICAgICAgc2Nyb2xs
YmFyIGFsd2F5cy4KLSAgICAgKiBAcGFyYW0gcHJldmVudFZlcnRpY2FsIHtCb29sZWFuID8gZmFs
c2V9IFdoZXRoZXIgdHAgc2hvdyB0aGUgdmVydGljYWwgc2Nyb2xsYmFyCi0gICAgICogICAgICBu
ZXZlci4KLSAgICAgKiBAcmV0dXJuIHtJbnRlZ2VyfSB3aGljaCBzY3JvbGxiYXJzIGFyZSBuZWVk
ZWQuIFRoaXMgbWF5IGJlIGFueSBjb21iaW5hdGlvbiBvZgotICAgICAqICAgICAge0BsaW5rICNI
T1JJWk9OVEFMX1NDUk9MTEJBUn0gb3Ige0BsaW5rICNWRVJUSUNBTF9TQ1JPTExCQVJ9Ci0gICAg
ICogICAgICAoY29tYmluZWQgYnkgT1IpLgotICAgICAqLwotICAgIGdldE5lZWRlZFNjcm9sbEJh
cnMgOiBmdW5jdGlvbihmb3JjZUhvcml6b250YWwsIHByZXZlbnRWZXJ0aWNhbCkKLSAgICB7Ci0g
ICAgICB2YXIgYmFyV2lkdGggPSB0aGlzLl92ZXJTY3JvbGxCYXIuZ2V0UHJlZmVycmVkQm94V2lk
dGgoKTsKLQotICAgICAgLy8gR2V0IHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSB2aWV3ICh3
aXRob3V0IHNjcm9sbCBiYXJzKQotICAgICAgdmFyIHZpZXdXaWR0aCA9IHRoaXMuX3BhbmVDbGlw
cGVyLmdldElubmVyV2lkdGgoKTsKLQotICAgICAgaWYgKHRoaXMuZ2V0VmVydGljYWxTY3JvbGxC
YXJWaXNpYmxlKCkpIHsKLSAgICAgICAgdmlld1dpZHRoICs9IGJhcldpZHRoOwotICAgICAgfQot
Ci0gICAgICB2YXIgdmlld0hlaWdodCA9IHRoaXMuX3BhbmVDbGlwcGVyLmdldElubmVySGVpZ2h0
KCk7Ci0KLSAgICAgIGlmICh0aGlzLmdldEhvcml6b250YWxTY3JvbGxCYXJWaXNpYmxlKCkpIHsK
LSAgICAgICAgdmlld0hlaWdodCArPSBiYXJXaWR0aDsKLSAgICAgIH0KLQotICAgICAgLy8gR2V0
IHRoZSAodmlydHVhbCkgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgcGFuZQotICAgICAgdmFyIHBh
bmVXaWR0aCA9IHRoaXMuZ2V0VGFibGVQYW5lTW9kZWwoKS5nZXRUb3RhbFdpZHRoKCk7Ci0gICAg
ICB2YXIgcGFuZUhlaWdodCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRSb3dIZWlnaHQoKSAqIHRoaXMu
Z2V0VGFibGUoKS5nZXRUYWJsZU1vZGVsKCkuZ2V0Um93Q291bnQoKTsKLQotICAgICAgLy8gQ2hl
Y2sgd2hpY2ggc2Nyb2xsYmFycyBhcmUgbmVlZGVkCi0gICAgICB2YXIgaG9yTmVlZGVkID0gZmFs
c2U7Ci0gICAgICB2YXIgdmVyTmVlZGVkID0gZmFsc2U7Ci0KLSAgICAgIGlmIChwYW5lV2lkdGgg
PiB2aWV3V2lkdGgpCi0gICAgICB7Ci0gICAgICAgIGhvck5lZWRlZCA9IHRydWU7Ci0KLSAgICAg
ICAgaWYgKHBhbmVIZWlnaHQgPiB2aWV3SGVpZ2h0IC0gYmFyV2lkdGgpIHsKLSAgICAgICAgICB2
ZXJOZWVkZWQgPSB0cnVlOwotICAgICAgICB9Ci0gICAgICB9Ci0gICAgICBlbHNlIGlmIChwYW5l
SGVpZ2h0ID4gdmlld0hlaWdodCkKLSAgICAgIHsKLSAgICAgICAgdmVyTmVlZGVkID0gdHJ1ZTsK
LQotICAgICAgICBpZiAoIXByZXZlbnRWZXJ0aWNhbCAmJiAocGFuZVdpZHRoID4gdmlld1dpZHRo
IC0gYmFyV2lkdGgpKSB7Ci0gICAgICAgICAgaG9yTmVlZGVkID0gdHJ1ZTsKLSAgICAgICAgfQot
ICAgICAgfQotCi0gICAgICAvLyBDcmVhdGUgdGhlIG1hc2sKLSAgICAgIHZhciBob3JCYXIgPSBx
eC51aS50YWJsZS5wYW5lLlNjcm9sbGVyLkhPUklaT05UQUxfU0NST0xMQkFSOwotICAgICAgdmFy
IHZlckJhciA9IHF4LnVpLnRhYmxlLnBhbmUuU2Nyb2xsZXIuVkVSVElDQUxfU0NST0xMQkFSOwot
ICAgICAgcmV0dXJuICgoZm9yY2VIb3Jpem9udGFsIHx8IGhvck5lZWRlZCkgPyBob3JCYXIgOiAw
KSB8ICgocHJldmVudFZlcnRpY2FsIHx8ICF2ZXJOZWVkZWQpID8gMCA6IHZlckJhcik7Ci0gICAg
fSwKLQotCi0gICAgLy8gcHJvcGVydHkgYXBwbHkgbWV0aG9kCi0gICAgX2FwcGx5U2Nyb2xsVGlt
ZW91dCA6IGZ1bmN0aW9uKHZhbHVlLCBvbGQpCi0gICAgewotICAgICAgaWYgKHRoaXMuX3VwZGF0
ZUludGVydmFsKQotICAgICAgewotICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLl91
cGRhdGVJbnRlcnZhbCk7Ci0gICAgICAgIHRoaXMuX3VwZGF0ZUludGVydmFsID0gbnVsbDsKLSAg
ICAgIH0KLSAgICAgIGVsc2UKLSAgICAgIHsKLSAgICAgICAgaWYgKCF0aGlzLl9vbmludGVydmFs
V3JhcHBlcikgewotICAgICAgICAgIHRoaXMuX29uaW50ZXJ2YWxXcmFwcGVyID0gcXgubGFuZy5G
dW5jdGlvbi5iaW5kKHRoaXMuX29uaW50ZXJ2YWwsIHRoaXMpOwotICAgICAgICB9Ci0gICAgICAg
IHRoaXMuX3VwZGF0ZUludGVydmFsID0gd2luZG93LnNldEludGVydmFsKHRoaXMuX29uaW50ZXJ2
YWxXcmFwcGVyLCB2YWx1ZSk7Ci0gICAgICB9Ci0gICAgfSwKLQotCi0gICAgLyoqCi0gICAgICog
RG9lcyBhIHBvc3Rwb25lZCB1cGRhdGUgb2YgdGhlIGNvbnRlbnQuCi0gICAgICoKLSAgICAgKiBA
dHlwZSBtZW1iZXIKLSAgICAgKiBAcmV0dXJuIHt2b2lkfQotICAgICAqIEBzZWUgI191cGRhdGVD
b250ZW50Ci0gICAgICovCi0gICAgX3Bvc3Rwb25lZFVwZGF0ZUNvbnRlbnQgOiBmdW5jdGlvbigp
Ci0gICAgewotICAgICAgdGhpcy5fdXBkYXRlQ29udGVudFBsYW5uZWQgPSB0cnVlOwotICAgIH0s
Ci0KLQotICAgIC8qKgotICAgICAqIFRpbWVyIGV2ZW50IGhhbmRsZXIuIFBlcmlvZGljYWxseSBj
aGVja3Mgd2hldGhlciBhIHRhYmUgdXBkYXRlIGlzCi0gICAgICogcmVxdWlyZWQuIFRoZSB1cGRh
dGUgaW50ZXJ2YWwgaXMgY29udHJvbGVkIGJ5IHRoZSB7QGxpbmsgI3Njcm9sbFRpbWVvdXR9Ci0g
ICAgICogcHJvcGVydHkuCi0gICAgICoKLSAgICAgKiBAdHlwZSBtZW1iZXIKLSAgICAgKiBAcmV0
dXJuIHt2b2lkfQotICAgICAqLwotICAgIF9vbmludGVydmFsIDogZnVuY3Rpb24oKQotICAgIHsK
LSAgICAgIGlmICh0aGlzLl91cGRhdGVDb250ZW50UGxhbm5lZCAmJiAhdGhpcy5fdGFibGVQYW5l
Ll9sYXlvdXRQZW5kaW5nKSB7Ci0gICAgICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnRQbGFubmVkID0g
ZmFsc2U7Ci0gICAgICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnQoKTsKLSAgICAgIH0KLSAgICB9LAot
Ci0KLSAgICAvKioKLSAgICAgKiBVcGRhdGVzIHRoZSBjb250ZW50LiBTZXRzIHRoZSByaWdodCBz
ZWN0aW9uIHRoZSB0YWJsZSBwYW5lIHNob3VsZCBzaG93IGFuZAotICAgICAqIGRvZXMgdGhlIHNj
cm9sbGluZy4KLSAgICAgKgotICAgICAqIEB0eXBlIG1lbWJlcgotICAgICAqIEByZXR1cm4ge3Zv
aWR9Ci0gICAgICovCi0gICAgX3VwZGF0ZUNvbnRlbnQgOiBmdW5jdGlvbigpCi0gICAgewotICAg
ICAgaWYgKCF0aGlzLmlzU2VlYWJsZSgpKSB7Ci0gICAgICAgIHJldHVybjsKLSAgICAgIH0KLQot
ICAgICAgdmFyIHBhbmVIZWlnaHQgPSB0aGlzLl9wYW5lQ2xpcHBlci5nZXRJbm5lckhlaWdodCgp
OwotICAgICAgdmFyIHNjcm9sbFggPSB0aGlzLl9ob3JTY3JvbGxCYXIuZ2V0VmFsdWUoKTsKLSAg
ICAgIHZhciBzY3JvbGxZID0gdGhpcy5fdmVyU2Nyb2xsQmFyLmdldFZhbHVlKCk7Ci0gICAgICB2
YXIgcm93SGVpZ2h0ID0gdGhpcy5nZXRUYWJsZSgpLmdldFJvd0hlaWdodCgpOwotCi0gICAgICB2
YXIgZmlyc3RSb3cgPSBNYXRoLmZsb29yKHNjcm9sbFkgLyByb3dIZWlnaHQpOwotICAgICAgdmFy
IG9sZEZpcnN0Um93ID0gdGhpcy5fdGFibGVQYW5lLmdldEZpcnN0VmlzaWJsZVJvdygpOwotICAg
ICAgdGhpcy5fdGFibGVQYW5lLnNldEZpcnN0VmlzaWJsZVJvdyhmaXJzdFJvdyk7Ci0KLSAgICAg
IHZhciByb3dDb3VudCA9IE1hdGguY2VpbChwYW5lSGVpZ2h0IC8gcm93SGVpZ2h0KTsKLSAgICAg
IHZhciBwYW5lT2Zmc2V0ID0gMDsKLSAgICAgIHZhciBmaXJzdFZpc2libGVSb3dDb21wbGV0ZSA9
IHRoaXMuZ2V0VGFibGUoKS5nZXRLZWVwRmlyc3RWaXNpYmxlUm93Q29tcGxldGUoKTsKLQotICAg
ICAgaWYgKCFmaXJzdFZpc2libGVSb3dDb21wbGV0ZSkKLSAgICAgIHsKLQotICAgICAgICAvLyBO
T1RFOiBXZSBkb24ndCBjb25zaWRlciBwYW5lT2Zmc2V0LCBiZWNhdXNlIHRoaXMgbWF5IGNhdXNl
IGFsdGVybmF0aW5nCi0gICAgICAgIC8vICAgICAgIGFkZGluZyBhbmQgZGVsZXRpbmcgb2Ygb25l
IHJvdyB3aGVuIHNjb2xsaW5nLiBJbnN0ZWFkIHdlIGFkZCBvbmUgcm93Ci0gICAgICAgIC8vICAg
ICAgIGluIGV2ZXJ5IGNhc2UuCi0gICAgICAgIHJvd0NvdW50Kys7Ci0KLSAgICAgICAgcGFuZU9m
ZnNldCA9IHNjcm9sbFkgJSByb3dIZWlnaHQ7Ci0gICAgICB9Ci0KLSAgICAgIHRoaXMuX3RhYmxl
UGFuZS5zZXRWaXNpYmxlUm93Q291bnQocm93Q291bnQpOwotCi0gICAgICBpZiAoZmlyc3RSb3cg
IT0gb2xkRmlyc3RSb3cpIHsKLSAgICAgICAgdGhpcy5fdXBkYXRlRm9jdXNJbmRpY2F0b3IoKTsK
LSAgICAgIH0KLQotICAgICAgLy8gV29ya2Fyb3VuZDogV2UgY2FuJ3QgdXNlIHNjcm9sbExlZnQg
Zm9yIHRoZSBoZWFkZXIgYmVjYXVzZSBJRQotICAgICAgLy8gICAgICAgYXV0b21hdGljYWxseSBz
Y3JvbGxzIHRoZSBoZWFkZXIgYmFjaywgd2hlbiBhIGNvbHVtbiBpcwotICAgICAgLy8gICAgICAg
cmVzaXplZC4KLSAgICAgIHRoaXMuX2hlYWRlci5zZXRMZWZ0KC1zY3JvbGxYKTsKLQotICAgICAg
Ly8gT25seSBzY3JvbGwgbGVmdCBpZiB0aGUgc2Nyb2xsTGVmdCB2YWx1ZSBoYXMKLSAgICAgIC8v
IGNoYW5nZWQKLSAgICAgIC8vCi0gICAgICBpZih0aGlzLl9wYW5lQ2xpcHBlci5fX3Njcm9sbExl
ZnQgIT0gc2Nyb2xsWCkgewotICAgICAgICB0aGlzLl9wYW5lQ2xpcHBlci5fX3Njcm9sbExlZnQg
PSBzY3JvbGxYOwotICAgICAgICB0aGlzLl9wYW5lQ2xpcHBlci5zZXRTY3JvbGxMZWZ0KHNjcm9s
bFgpOwotICAgICAgfQotCi0gICAgICAvLyBBdm9pZCBleHBlbnNpdmUgY2FsbHMgdG8gc2V0U2Ny
b2xsVG9wIGlmCi0gICAgICAvLyBzY3JvbGxpbmcgaXMgbm90IG5lZWRlZAotICAgICAgLy8KLSAg
ICAgIGlmICghIGZpcnN0VmlzaWJsZVJvd0NvbXBsZXRlICkgewotICAgICAgICB0aGlzLl9wYW5l
Q2xpcHBlci5zZXRTY3JvbGxUb3AocGFuZU9mZnNldCk7Ci0gICAgICB9Ci0KLSAgICAgIC8vIHRo
aXMuZGVidWcoInBhbmVIZWlnaHQ6IitwYW5lSGVpZ2h0KyIscm93SGVpZ2h0OiIrcm93SGVpZ2h0
KyIsZmlyc3RSb3c6IitmaXJzdFJvdysiLHJvd0NvdW50OiIrcm93Q291bnQrIixwYW5lT2Zmc2V0
OiIrcGFuZU9mZnNldCk7Ci0gICAgfSwKLQotICAgIC8qKgotICAgICAqIFVwZGF0ZXMgdGhlIGxv
Y2F0aW9uIGFuZCB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgZm9jdXMgaW5kaWNhdG9yLgotICAgICAq
Ci0gICAgICogQHR5cGUgbWVtYmVyCi0gICAgICogQHJldHVybiB7dm9pZH0KLSAgICAgKi8KLSAg
ICBfdXBkYXRlRm9jdXNJbmRpY2F0b3IgOiBmdW5jdGlvbigpCi0gICAgewotICAgICAgaWYoIXRo
aXMuX3Nob3dDZWxsRm9jdXNJbmRpY2F0b3IpIHsKLSAgICAgICAgcmV0dXJuOwotICAgICAgfQot
Ci0gICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7Ci0KLSAgICAgIGlmICghdGFibGUu
Z2V0RW5hYmxlZCgpKSB7Ci0gICAgICAgIHJldHVybjsKLSAgICAgIH0KLQotICAgICAgaWYgKHRo
aXMuX2ZvY3VzZWRDb2wgPT0gbnVsbCkgewotICAgICAgICB0aGlzLl9mb2N1c0luZGljYXRvci5o
aWRlKCk7Ci0gICAgICB9Ci0gICAgICBlbHNlCi0gICAgICB7Ci0gICAgICAgIHZhciB4UG9zID0g
dGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpLmdldFgodGhpcy5fZm9jdXNlZENvbCk7Ci0KLSAgICAg
ICAgaWYgKHhQb3MgPT0gLTEpIHsKLSAgICAgICAgICB0aGlzLl9mb2N1c0luZGljYXRvci5oaWRl
KCk7Ci0gICAgICAgIH0KLSAgICAgICAgZWxzZQotICAgICAgICB7Ci0gICAgICAgICAgdmFyIGNv
bHVtbk1vZGVsID0gdGFibGUuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOwotICAgICAgICAgIHZhciBw
YW5lTW9kZWwgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVsKCk7Ci0KLSAgICAgICAgICB2YXIgZmly
c3RSb3cgPSB0aGlzLl90YWJsZVBhbmUuZ2V0Rmlyc3RWaXNpYmxlUm93KCk7Ci0gICAgICAgICAg
dmFyIHJvd0hlaWdodCA9IHRhYmxlLmdldFJvd0hlaWdodCgpOwotCi0gICAgICAgICAgdGhpcy5f
Zm9jdXNJbmRpY2F0b3Iuc2V0SGVpZ2h0KHJvd0hlaWdodCArIDMpOwotICAgICAgICAgIHRoaXMu
X2ZvY3VzSW5kaWNhdG9yLnNldFdpZHRoKGNvbHVtbk1vZGVsLmdldENvbHVtbldpZHRoKHRoaXMu
X2ZvY3VzZWRDb2wpICsgMyk7Ci0gICAgICAgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3Iuc2V0VG9w
KCh0aGlzLl9mb2N1c2VkUm93IC0gZmlyc3RSb3cpICogcm93SGVpZ2h0IC0gMik7Ci0gICAgICAg
ICAgdGhpcy5fZm9jdXNJbmRpY2F0b3Iuc2V0TGVmdChwYW5lTW9kZWwuZ2V0Q29sdW1uTGVmdCh0
aGlzLl9mb2N1c2VkQ29sKSAtIDIpOwotCi0gICAgICAgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3Iu
c2hvdygpOwotICAgICAgICB9Ci0gICAgICB9Ci0gICAgfQotICB9LAotCi0KLQotCi0gIC8qCi0g
ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqCi0gICAgIERFU1RSVUNUT1IKLSAgKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioKLSAgKi8KLQotICBkZXN0cnVjdCA6IGZ1bmN0aW9uKCkKLSAgewotICAgIGlmICh0aGlz
LmdldEVsZW1lbnQoKSAhPSBudWxsKSB7Ci0gICAgICB0aGlzLmdldEVsZW1lbnQoKS5vbnNlbGVj
dHN0YXJ0ID0gbnVsbDsKLSAgICB9Ci0KLSAgICBpZiAodGhpcy5fdXBkYXRlSW50ZXJ2YWwpCi0g
ICAgewotICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5fdXBkYXRlSW50ZXJ2YWwpOwot
ICAgICAgdGhpcy5fdXBkYXRlSW50ZXJ2YWwgPSBudWxsOwotICAgIH0KLQotICAgIHRoaXMuX2Rp
c3Bvc2VPYmplY3RzKCJfdmVyU2Nyb2xsQmFyIiwgIl9ob3JTY3JvbGxCYXIiLCAiX2hlYWRlciIs
ICJfaGVhZGVyQ2xpcHBlciIsCi0gICAgICAiX3NwYWNlciIsICJfdG9wIiwgIl90YWJsZVBhbmUi
LCAiX3BhbmVDbGlwcGVyIiwgIl9yZXNpemVMaW5lIiwgIl90YWJsZSIsCi0gICAgICAiX2ZvY3Vz
SW5kaWNhdG9yIiwgIl90b3BSaWdodFdpZGdldCIpOwotICB9Ci19KTsKKy8qICoqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKg0KKw0KKyAgIHFvb3hkb28gLSB0aGUgbmV3IGVyYSBvZiB3ZWIgZGV2ZWxvcG1lbnQNCisN
CisgICBodHRwOi8vcW9veGRvby5vcmcNCisNCisgICBDb3B5cmlnaHQ6DQorICAgICAyMDA2IFNU
Wi1JREEsIEdlcm1hbnksIGh0dHA6Ly93d3cuc3R6LWlkYS5kZQ0KKw0KKyAgIExpY2Vuc2U6DQor
ICAgICBMR1BMOiBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvbGdwbC5odG1sDQorICAgICBF
UEw6IGh0dHA6Ly93d3cuZWNsaXBzZS5vcmcvb3JnL2RvY3VtZW50cy9lcGwtdjEwLnBocA0KKyAg
ICAgU2VlIHRoZSBMSUNFTlNFIGZpbGUgaW4gdGhlIHByb2plY3QncyB0b3AtbGV2ZWwgZGlyZWN0
b3J5IGZvciBkZXRhaWxzLg0KKw0KKyAgIEF1dGhvcnM6DQorICAgICAqIFRpbCBTY2huZWlkZXIg
KHRpbDEzMikNCisNCisqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8NCisNCisvKiAqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioN
CisNCisjbW9kdWxlKHVpX3RhYmxlKQ0KKw0KKyoqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KKw0KKy8qKg0K
KyAqIFNob3dzIGEgd2hvbGUgbWV0YSBjb2x1bW4uIFRoaXMgaW5jbHVkZXMgYSB7QGxpbmsgVGFi
bGVQYW5lSGVhZGVyfSwNCisgKiBhIHtAbGluayBUYWJsZVBhbmV9IGFuZCB0aGUgbmVlZGVkIHNj
cm9sbCBiYXJzLiBUaGlzIGNsYXNzIGhhbmRsZXMgdGhlDQorICogdmlydHVhbCBzY3JvbGxpbmcg
YW5kIGRvZXMgYWxsIHRoZSBtb3VzZSBldmVudCBoYW5kbGluZy4NCisgKg0KKyAqIEBhcHBlYXJh
bmNlIHRhYmxlLWZvY3VzLWluZGljYXRvciB7cXgudWkubGF5b3V0Lkhvcml6b250YWxCb3hMYXlv
dXR9DQorICovDQorcXguQ2xhc3MuZGVmaW5lKCJxeC51aS50YWJsZS5wYW5lLlNjcm9sbGVyIiwN
Cit7DQorICBleHRlbmQgOiBxeC51aS5sYXlvdXQuVmVydGljYWxCb3hMYXlvdXQsDQorDQorDQor
DQorDQorICAvKg0KKyAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCisgICAgIENPTlNUUlVDVE9SDQor
ICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKg0KKyAgKi8NCisNCisgIC8qKg0KKyAgICogQHBhcmFtIHRh
YmxlIHtxeC51aS50YWJsZS5UYWJsZX0gdGhlIHRhYmxlIHRoZSBzY3JvbGxlciBiZWxvbmdzIHRv
Lg0KKyAgICovDQorICBjb25zdHJ1Y3QgOiBmdW5jdGlvbih0YWJsZSkNCisgIHsNCisgICAgdGhp
cy5iYXNlKGFyZ3VtZW50cyk7DQorDQorICAgIHRoaXMuX3RhYmxlID0gdGFibGU7DQorDQorICAg
IC8vIGluaXQgc2Nyb2xsYmFycw0KKyAgICB0aGlzLl92ZXJTY3JvbGxCYXIgPSBuZXcgcXgudWku
YmFzaWMuU2Nyb2xsQmFyKGZhbHNlKTsNCisgICAgdGhpcy5faG9yU2Nyb2xsQmFyID0gbmV3IHF4
LnVpLmJhc2ljLlNjcm9sbEJhcih0cnVlKTsNCisNCisgICAgdmFyIHNjcm9sbEJhcldpZHRoID0g
dGhpcy5fdmVyU2Nyb2xsQmFyLmdldFByZWZlcnJlZEJveFdpZHRoKCk7DQorDQorICAgIHRoaXMu
X3ZlclNjcm9sbEJhci5zZXRXaWR0aCgiYXV0byIpOw0KKyAgICB0aGlzLl9ob3JTY3JvbGxCYXIu
c2V0SGVpZ2h0KCJhdXRvIik7DQorICAgIHRoaXMuX2hvclNjcm9sbEJhci5zZXRQYWRkaW5nUmln
aHQoc2Nyb2xsQmFyV2lkdGgpOw0KKyAgICB0aGlzLl9ob3JTY3JvbGxCYXIuYWRkRXZlbnRMaXN0
ZW5lcigiY2hhbmdlVmFsdWUiLCB0aGlzLl9vblNjcm9sbFgsIHRoaXMpOw0KKyAgICB0aGlzLl92
ZXJTY3JvbGxCYXIuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlVmFsdWUiLCB0aGlzLl9vblNjcm9s
bFksIHRoaXMpOw0KKw0KKyAgICAvLyBpbml0IGhlYWRlcg0KKyAgICB0aGlzLl9oZWFkZXIgPSB0
aGlzLmdldFRhYmxlKCkuZ2V0TmV3VGFibGVQYW5lSGVhZGVyKCkodGhpcyk7DQorDQorICAgIHRo
aXMuX2hlYWRlci5zZXQoDQorICAgIHsNCisgICAgICB3aWR0aCAgOiAiYXV0byIsDQorICAgICAg
aGVpZ2h0IDogImF1dG8iDQorICAgIH0pOw0KKw0KKyAgICB0aGlzLl9oZWFkZXJDbGlwcGVyID0g
bmV3IHF4LnVpLmxheW91dC5DYW52YXNMYXlvdXQ7DQorICAgIHRoaXMuX2hlYWRlckNsaXBwZXIu
c2V0RGltZW5zaW9uKCIxKiIsICJhdXRvIik7DQorICAgIHRoaXMuX2hlYWRlckNsaXBwZXIuc2V0
T3ZlcmZsb3coImhpZGRlbiIpOw0KKyAgICB0aGlzLl9oZWFkZXJDbGlwcGVyLmFkZCh0aGlzLl9o
ZWFkZXIpOw0KKw0KKyAgICB0aGlzLl9zcGFjZXIgPSBuZXcgcXgudWkuYmFzaWMuVGVybWluYXRv
cjsNCisgICAgdGhpcy5fc3BhY2VyLnNldFdpZHRoKHNjcm9sbEJhcldpZHRoKTsNCisNCisgICAg
dGhpcy5fdG9wID0gbmV3IHF4LnVpLmxheW91dC5Ib3Jpem9udGFsQm94TGF5b3V0Ow0KKyAgICB0
aGlzLl90b3Auc2V0SGVpZ2h0KCJhdXRvIik7DQorICAgIHRoaXMuX3RvcC5hZGQodGhpcy5faGVh
ZGVyQ2xpcHBlciwgdGhpcy5fc3BhY2VyKTsNCisNCisgICAgLy8gaW5pdCBwYW5lDQorICAgIHRo
aXMuX3RhYmxlUGFuZSA9IHRoaXMuZ2V0VGFibGUoKS5nZXROZXdUYWJsZVBhbmUoKSh0aGlzKTsN
CisNCisgICAgdGhpcy5fdGFibGVQYW5lLnNldCgNCisgICAgew0KKyAgICAgIHdpZHRoICA6ICJh
dXRvIiwNCisgICAgICBoZWlnaHQgOiAiYXV0byINCisgICAgfSk7DQorDQorICAgIHRoaXMuX3No
b3dDZWxsRm9jdXNJbmRpY2F0b3IgPSB0aGlzLmdldFNob3dDZWxsRm9jdXNJbmRpY2F0b3IoKTsN
CisNCisgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3IgPSBuZXcgcXgudWkubGF5b3V0Lkhvcml6b250
YWxCb3hMYXlvdXQ7DQorICAgIHRoaXMuX2ZvY3VzSW5kaWNhdG9yLnNldEFwcGVhcmFuY2UoInRh
YmxlLWZvY3VzLWluZGljYXRvciIpOw0KKyAgICB0aGlzLl9mb2N1c0luZGljYXRvci5zZXRTdHls
ZVByb3BlcnR5KCJmb250U2l6ZSIsICIwcHgiKTsNCisgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3Iu
c2V0U3R5bGVQcm9wZXJ0eSgibGluZUhlaWdodCIsICIwcHgiKTsNCisgICAgdGhpcy5fZm9jdXNJ
bmRpY2F0b3IuaGlkZSgpOw0KKw0KKyAgICB0aGlzLl9wYW5lQ2xpcHBlciA9IG5ldyBxeC51aS5s
YXlvdXQuQ2FudmFzTGF5b3V0Ow0KKyAgICB0aGlzLl9wYW5lQ2xpcHBlci5zZXRXaWR0aCgiMSoi
KTsNCisgICAgdGhpcy5fcGFuZUNsaXBwZXIuc2V0T3ZlcmZsb3coImhpZGRlbiIpOw0KKyAgICB0
aGlzLl9wYW5lQ2xpcHBlci5hZGQodGhpcy5fdGFibGVQYW5lLCB0aGlzLl9mb2N1c0luZGljYXRv
cik7DQorICAgIHRoaXMuX3BhbmVDbGlwcGVyLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNld2hlZWwi
LCB0aGlzLl9vbm1vdXNld2hlZWwsIHRoaXMpOw0KKw0KKyAgICAvLyBhZGQgYWxsIGNoaWxkIHdp
ZGdldHMNCisgICAgdmFyIHNjcm9sbGVyQm9keSA9IG5ldyBxeC51aS5sYXlvdXQuSG9yaXpvbnRh
bEJveExheW91dDsNCisgICAgc2Nyb2xsZXJCb2R5LnNldEhlaWdodCgiMSoiKTsNCisgICAgc2Ny
b2xsZXJCb2R5LmFkZCh0aGlzLl9wYW5lQ2xpcHBlciwgdGhpcy5fdmVyU2Nyb2xsQmFyKTsNCisN
CisgICAgdGhpcy5hZGQodGhpcy5fdG9wLCBzY3JvbGxlckJvZHksIHRoaXMuX2hvclNjcm9sbEJh
cik7DQorDQorICAgIC8vIGluaXQgZXZlbnQgaGFuZGxlcnMNCisgICAgdGhpcy5faGVhZGVyQ2xp
cHBlci5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2VDYXB0dXJlIiwgdGhpcy5fb25DaGFuZ2VDYXB0
dXJlSGVhZGVyLCB0aGlzKTsNCisNCisgICAgdGhpcy5faGVhZGVyQ2xpcHBlci5hZGRFdmVudExp
c3RlbmVyKCJtb3VzZW1vdmUiLCB0aGlzLl9vbm1vdXNlbW92ZUhlYWRlciwgdGhpcyk7DQorICAg
IHRoaXMuX3BhbmVDbGlwcGVyLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIHRoaXMuX29u
bW91c2Vtb3ZlUGFuZSwgdGhpcyk7DQorDQorICAgIHRoaXMuX2hlYWRlckNsaXBwZXIuYWRkRXZl
bnRMaXN0ZW5lcigibW91c2Vkb3duIiwgdGhpcy5fb25tb3VzZWRvd25IZWFkZXIsIHRoaXMpOw0K
KyAgICB0aGlzLl9wYW5lQ2xpcHBlci5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCB0aGlz
Ll9vbm1vdXNlZG93blBhbmUsIHRoaXMpOw0KKw0KKyAgICB0aGlzLl9oZWFkZXJDbGlwcGVyLmFk
ZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCB0aGlzLl9vbm1vdXNldXBIZWFkZXIsIHRoaXMpOw0K
KyAgICB0aGlzLl9wYW5lQ2xpcHBlci5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgdGhpcy5f
b25tb3VzZXVwUGFuZSwgdGhpcyk7DQorDQorICAgIHRoaXMuX2hlYWRlckNsaXBwZXIuYWRkRXZl
bnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLl9vbmNsaWNrSGVhZGVyLCB0aGlzKTsNCisgICAgdGhp
cy5fcGFuZUNsaXBwZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLl9vbmNsaWNrUGFu
ZSwgdGhpcyk7DQorICAgIHRoaXMuX3BhbmVDbGlwcGVyLmFkZEV2ZW50TGlzdGVuZXIoImNvbnRl
eHRtZW51IiwgdGhpcy5fb25Db250ZXh0TWVudSwgdGhpcyk7DQorICAgIHRoaXMuX3BhbmVDbGlw
cGVyLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgdGhpcy5fb25kYmxjbGlja1BhbmUsIHRo
aXMpOw0KKw0KKyAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0IiwgdGhpcy5fb25t
b3VzZW91dCwgdGhpcyk7DQorDQorICAgIHRoaXMuaW5pdFNjcm9sbFRpbWVvdXQoKTsNCisgIH0s
DQorDQorDQorDQorDQorICAvKg0KKyAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCisgICAgIFNUQVRJ
Q1MNCisgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqDQorICAqLw0KKw0KKyAgc3RhdGljcyA6DQorICB7
DQorDQorICAgIC8qKiB7aW50fSBUaGUgbWluaW11bSB3aWR0aCBhIGNvbHVtIGNvdWxkIGdldCBp
biBwaXhlbHMuICovDQorICAgIE1JTl9DT0xVTU5fV0lEVEggICAgICAgICA6IDEwLA0KKw0KKyAg
ICAvKioge2ludH0gVGhlIHJhZGl1cyBvZiB0aGUgcmVzaXplIHJlZ2lvbiBpbiBwaXhlbHMuICov
DQorICAgIFJFU0laRV9SRUdJT05fUkFESVVTICAgICA6IDUsDQorDQorDQorICAgIC8qKg0KKyAg
ICAgKiAoaW50KSBUaGUgbnVtYmVyIG9mIHBpeGVscyB0aGUgbW91c2UgbWF5IG1vdmUgYmV0d2Vl
biBtb3VzZSBkb3duIGFuZCBtb3VzZSB1cA0KKyAgICAgKiBpbiBvcmRlciB0byBjb3VudCBhcyBh
IGNsaWNrLg0KKyAgICAgKi8NCisgICAgQ0xJQ0tfVE9MRVJBTkNFICAgICAgICAgIDogNSwNCisN
CisNCisgICAgLyoqDQorICAgICAqIChpbnQpIFRoZSBtYXNrIGZvciB0aGUgaG9yaXpvbnRhbCBz
Y3JvbGwgYmFyLg0KKyAgICAgKiBNYXkgYmUgY29tYmluZWQgd2l0aCB7QGxpbmsgI1ZFUlRJQ0FM
X1NDUk9MTEJBUn0uDQorICAgICAqDQorICAgICAqIEBzZWUgI2dldE5lZWRlZFNjcm9sbEJhcnMN
CisgICAgICovDQorICAgIEhPUklaT05UQUxfU0NST0xMQkFSICAgICA6IDEsDQorDQorDQorICAg
IC8qKg0KKyAgICAgKiAoaW50KSBUaGUgbWFzayBmb3IgdGhlIHZlcnRpY2FsIHNjcm9sbCBiYXIu
DQorICAgICAqIE1heSBiZSBjb21iaW5lZCB3aXRoIHtAbGluayAjSE9SSVpPTlRBTF9TQ1JPTExC
QVJ9Lg0KKyAgICAgKg0KKyAgICAgKiBAc2VlICNnZXROZWVkZWRTY3JvbGxCYXJzDQorICAgICAq
Lw0KKyAgICBWRVJUSUNBTF9TQ1JPTExCQVIgICAgICAgOiAyLA0KKw0KKw0KKyAgICAvKioNCisg
ICAgICogKHN0cmluZykgVGhlIGNvcnJlY3QgdmFsdWUgZm9yIHRoZSBDU1Mgc3R5bGUgYXR0cmli
dXRlICJjdXJzb3IiIGZvciB0aGUNCisgICAgICogaG9yaXpvbnRhbCByZXNpemUgY3Vyc29yLg0K
KyAgICAgKi8NCisgICAgQ1VSU09SX1JFU0laRV9IT1JJWk9OVEFMIDogKHF4LmNvcmUuQ2xpZW50
LmdldEluc3RhbmNlKCkuaXNHZWNrbygpICYmIChxeC5jb3JlLkNsaWVudC5nZXRJbnN0YW5jZSgp
LmdldE1ham9yKCkgPiAxIHx8IHF4LmNvcmUuQ2xpZW50LmdldEluc3RhbmNlKCkuZ2V0TWlub3Io
KSA+PSA4KSkgPyAiZXctcmVzaXplIiA6ICJlLXJlc2l6ZSINCisgIH0sDQorDQorDQorDQorDQor
ICAvKg0KKyAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCisgICAgIFBST1BFUlRJRVMNCisgICoqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqDQorICAqLw0KKw0KKyAgZXZlbnRzIDoNCisgIHsNCisgICAgLyoqIERp
c3BhdGNoZWQgaWYgdGhlIHBhbmUgaXMgc2NvbGxlZCBob3Jpem9udGFsbHkgKi8NCisgICAgImNo
YW5nZVNjcm9sbFkiIDogInF4LmV2ZW50LnR5cGUuQ2hhbmdlRXZlbnQiLA0KKw0KKyAgICAvKiog
RGlzcGF0Y2hlZCBpZiB0aGUgcGFuZSBpcyBzY3JvbGxlZCB2ZXJ0aWNhbGx5ICovDQorICAgICJj
aGFuZ2VTY3JvbGxYIiA6ICJxeC5ldmVudC50eXBlLkNoYW5nZUV2ZW50IiwNCisNCisgICAgLyoq
U2VlIHtAbGluayBxeC51aS50YWJsZS5UYWJsZSNjZWxsQ2xpY2t9LiovDQorICAgICJjZWxsQ2xp
Y2siIDogInF4LnVpLnRhYmxlLnBhbmUuQ2VsbEV2ZW50IiwNCisNCisgICAgLyoqKiBTZWUge0Bs
aW5rIHF4LnVpLnRhYmxlLlRhYmxlI2NlbGxEYmxjbGlja30uKi8NCisgICAgImNlbGxEYmxjbGlj
ayIgOiAicXgudWkudGFibGUucGFuZS5DZWxsRXZlbnQiLA0KKw0KKyAgICAvKipTZWUge0BsaW5r
IHF4LnVpLnRhYmxlLlRhYmxlI2NlbGxDb250ZXh0bWVudX0uKi8NCisgICAgImNlbGxDb250ZXh0
bWVudSIgOiAicXgudWkudGFibGUucGFuZS5DZWxsRXZlbnQiDQorICB9LA0KKw0KKw0KKw0KKw0K
Kw0KKyAgLyoNCisgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQorICAgICBQUk9QRVJUSUVTDQorICAq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKg0KKyAgKi8NCisNCisgIHByb3BlcnRpZXMgOg0KKyAgew0KKw0K
KyAgICAvKiogV2hldGhlciB0byBzaG93IHRoZSBob3Jpem9udGFsIHNjcm9sbCBiYXIgKi8NCisg
ICAgaG9yaXpvbnRhbFNjcm9sbEJhclZpc2libGUgOg0KKyAgICB7DQorICAgICAgY2hlY2sgOiAi
Qm9vbGVhbiIsDQorICAgICAgaW5pdCA6IHRydWUsDQorICAgICAgYXBwbHkgOiAiX2FwcGx5SG9y
aXpvbnRhbFNjcm9sbEJhclZpc2libGUiLA0KKyAgICAgIGV2ZW50IDogImNoYW5nZUhvcml6b250
YWxTY3JvbGxCYXJWaXNpYmxlIg0KKyAgICB9LA0KKw0KKyAgICAvKiogV2hldGhlciB0byBzaG93
IHRoZSB2ZXJ0aWNhbCBzY3JvbGwgYmFyICovDQorICAgIHZlcnRpY2FsU2Nyb2xsQmFyVmlzaWJs
ZSA6DQorICAgIHsNCisgICAgICBjaGVjayA6ICJCb29sZWFuIiwNCisgICAgICBpbml0IDogdHJ1
ZSwNCisgICAgICBhcHBseSA6ICJfYXBwbHlWZXJ0aWNhbFNjcm9sbEJhclZpc2libGUiLA0KKyAg
ICAgIGV2ZW50IDogImNoYW5nZVZlcnRpY2FsU2Nyb2xsQmFyVmlzaWJsZSINCisgICAgfSwNCisN
CisgICAgLyoqIFRoZSB0YWJsZSBwYW5lIG1vZGVsLiAqLw0KKyAgICB0YWJsZVBhbmVNb2RlbCA6
DQorICAgIHsNCisgICAgICBjaGVjayA6ICJxeC51aS50YWJsZS5wYW5lLk1vZGVsIiwNCisgICAg
ICBhcHBseSA6ICJfYXBwbHlUYWJsZVBhbmVNb2RlbCIsDQorICAgICAgZXZlbnQgOiAiY2hhbmdl
VGFibGVQYW5lTW9kZWwiDQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBXaGV0aGVy
IGNvbHVtbiByZXNpemUgc2hvdWxkIGJlIGxpdmUuIElmIGZhbHNlLCBkdXJpbmcgcmVzaXplIG9u
bHkgYSBsaW5lIGlzDQorICAgICAqIHNob3duIGFuZCB0aGUgcmVhbCByZXNpemUgaGFwcGVucyB3
aGVuIHRoZSB1c2VyIHJlbGVhc2VzIHRoZSBtb3VzZSBidXR0b24uDQorICAgICAqLw0KKyAgICBs
aXZlUmVzaXplIDoNCisgICAgew0KKyAgICAgIGNoZWNrIDogIkJvb2xlYW4iLA0KKyAgICAgIGlu
aXQgOiBmYWxzZQ0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogV2hldGhlciB0aGUg
Zm9jdXMgc2hvdWxkIG1vdmVkIHdoZW4gdGhlIG1vdXNlIGlzIG1vdmVkIG92ZXIgYSBjZWxsLiBJ
ZiBmYWxzZQ0KKyAgICAgKiB0aGUgZm9jdXMgaXMgb25seSBtb3ZlZCBvbiBtb3VzZSBjbGlja3Mu
DQorICAgICAqLw0KKyAgICBmb2N1c0NlbGxPbk1vdXNlTW92ZSA6DQorICAgIHsNCisgICAgICBj
aGVjayA6ICJCb29sZWFuIiwNCisgICAgICBpbml0IDogZmFsc2UNCisgICAgfSwNCisNCisNCisg
ICAgLyoqDQorICAgICAqIFdoZXRoZXIgdG8gaGFuZGxlIHNlbGVjdGlvbnMgdmlhIHRoZSBzZWxl
Y3Rpb24gbWFuYWdlciBiZWZvcmUgc2V0dGluZyB0aGUNCisgICAgICogZm9jdXMuICBUaGUgdHJh
ZGl0aW9uYWwgYmVoYXZpb3IgaXMgdG8gaGFuZGxlIHNlbGVjdGlvbnMgYWZ0ZXIgc2V0dGluZyB0
aGUNCisgICAgICogZm9jdXMsIGJ1dCBzZXR0aW5nIHRoZSBmb2N1cyBtZWFucyByZWRyYXdpbmcg
cG9ydGlvbnMgb2YgdGhlIHRhYmxlLCBhbmQNCisgICAgICogc29tZSBzdWJjbGFzc2VzIG1heSB3
YW50IHRvIG1vZGlmeSB0aGUgZGF0YSB0byBiZSBkaXNwbGF5ZWQgYmFzZWQgb24gdGhlDQorICAg
ICAqIHNlbGVjdGlvbi4NCisgICAgICovDQorICAgIHNlbGVjdEJlZm9yZUZvY3VzIDoNCisgICAg
ew0KKyAgICAgIGNoZWNrIDogIkJvb2xlYW4iLA0KKyAgICAgIGluaXQgOiBmYWxzZQ0KKyAgICB9
LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogV2hldGhlciB0aGUgY2VsbCBmb2N1cyBpbmRpY2F0
b3Igc2hvdWxkIGJlIHNob3duDQorICAgICAqLw0KKyAgICBzaG93Q2VsbEZvY3VzSW5kaWNhdG9y
IDoNCisgICAgew0KKyAgICAgIGNoZWNrIDogIkJvb2xlYW4iLA0KKyAgICAgIGluaXQgOiB0cnVl
LA0KKyAgICAgIGFwcGx5IDogIl9hcHBseVNob3dDZWxsRm9jdXNJbmRpY2F0b3IiDQorICAgIH0s
DQorDQorDQorICAgIC8qKg0KKyAgICAgKiBJbnRlcnZhbCB0aW1lIChpbiBtaWxsaXNlY29uZHMp
IGZvciB0aGUgdGFibGUgdXBkYXRlIHRpbWVyLg0KKyAgICAgKiBTZXR0aW5nIHRoaXMgdG8gMCBj
bGVhcnMgdGhlIHRpbWVyLg0KKyAgICAgKi8NCisgICAgc2Nyb2xsVGltZW91dCA6DQorICAgIHsN
CisgICAgICBjaGVjayA6ICJJbnRlZ2VyIiwNCisgICAgICBpbml0IDogMTAwLA0KKyAgICAgIGFw
cGx5IDogIl9hcHBseVNjcm9sbFRpbWVvdXQiDQorICAgIH0NCisNCisgIH0sDQorDQorDQorDQor
DQorICAvKg0KKyAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCisgICAgIE1FTUJFUlMNCisgICoqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqDQorICAqLw0KKw0KKyAgbWVtYmVycyA6DQorICB7DQorICAgIC8vIHBy
b3BlcnR5IG1vZGlmaWVyDQorICAgIF9hcHBseUhvcml6b250YWxTY3JvbGxCYXJWaXNpYmxlIDog
ZnVuY3Rpb24odmFsdWUsIG9sZCkNCisgICAgew0KKyAgICAgIC8vIFdvcmthcm91bmQ6IFdlIGNh
bid0IHVzZSBzZXREaXNwbGF5LCBiZWNhdXNlIHRoZSBzY3JvbGwgYmFyIG5lZWRzIGl0cw0KKyAg
ICAgIC8vICAgICAgIGNvcnJlY3QgaGVpZ2h0IGluIG9yZGVyIHRvIGNoZWNrIGl0cyB2YWx1ZS4g
V2hlbiB1c2luZw0KKyAgICAgIC8vICAgICAgIHNldERpc3BsYXkoZmFsc2UpIHRoZSBoZWlnaHQg
aXNuJ3QgcmVsYXlvdXRlZCBhbnkgbW9yZQ0KKyAgICAgIGlmICh2YWx1ZSkgew0KKyAgICAgICAg
dGhpcy5faG9yU2Nyb2xsQmFyLnNldEhlaWdodCgiYXV0byIpOw0KKyAgICAgIH0gZWxzZSB7DQor
ICAgICAgICB0aGlzLl9ob3JTY3JvbGxCYXIuc2V0SGVpZ2h0KDApOw0KKyAgICAgIH0NCisNCisg
ICAgICB0aGlzLl9ob3JTY3JvbGxCYXIuc2V0VmlzaWJpbGl0eSh2YWx1ZSk7DQorICAgICAgdGhp
cy5fdXBkYXRlQ29udGVudCgpOw0KKyAgICB9LA0KKw0KKw0KKyAgICAvLyBwcm9wZXJ0eSBtb2Rp
Zmllcg0KKyAgICBfYXBwbHlWZXJ0aWNhbFNjcm9sbEJhclZpc2libGUgOiBmdW5jdGlvbih2YWx1
ZSwgb2xkKQ0KKyAgICB7DQorICAgICAgLy8gV29ya2Fyb3VuZDogU2VlIF9hcHBseUhvcml6b250
YWxTY3JvbGxCYXJWaXNpYmxlDQorICAgICAgaWYgKHZhbHVlKSB7DQorICAgICAgICB0aGlzLl92
ZXJTY3JvbGxCYXIuc2V0V2lkdGgoImF1dG8iKTsNCisgICAgICB9IGVsc2Ugew0KKyAgICAgICAg
dGhpcy5fdmVyU2Nyb2xsQmFyLnNldFdpZHRoKDApOw0KKyAgICAgIH0NCisNCisgICAgICB0aGlz
Ll92ZXJTY3JvbGxCYXIuc2V0VmlzaWJpbGl0eSh2YWx1ZSk7DQorDQorICAgICAgdmFyIHNjcm9s
bEJhcldpZHRoID0gdmFsdWUgPyB0aGlzLl92ZXJTY3JvbGxCYXIuZ2V0UHJlZmVycmVkQm94V2lk
dGgoKSA6IDA7DQorICAgICAgdGhpcy5faG9yU2Nyb2xsQmFyLnNldFBhZGRpbmdSaWdodChzY3Jv
bGxCYXJXaWR0aCk7DQorICAgICAgdGhpcy5fc3BhY2VyLnNldFdpZHRoKHNjcm9sbEJhcldpZHRo
KTsNCisgICAgfSwNCisNCisNCisgICAgLy8gcHJvcGVydHkgbW9kaWZpZXINCisgICAgX2FwcGx5
VGFibGVQYW5lTW9kZWwgOiBmdW5jdGlvbih2YWx1ZSwgb2xkKQ0KKyAgICB7DQorICAgICAgaWYg
KG9sZCAhPSBudWxsKSB7DQorICAgICAgICBvbGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW9kZWxD
aGFuZ2VkIiwgdGhpcy5fb25QYW5lTW9kZWxDaGFuZ2VkLCB0aGlzKTsNCisgICAgICB9DQorDQor
ICAgICAgdmFsdWUuYWRkRXZlbnRMaXN0ZW5lcigibW9kZWxDaGFuZ2VkIiwgdGhpcy5fb25QYW5l
TW9kZWxDaGFuZ2VkLCB0aGlzKTsNCisgICAgfSwNCisNCisNCisgICAgLy8gcHJvcGVydHkgbW9k
aWZpZXINCisgICAgX2FwcGx5U2hvd0NlbGxGb2N1c0luZGljYXRvciA6IGZ1bmN0aW9uKHZhbHVl
LCBvbGQpIHsNCisgICAgICB0aGlzLl9zaG93Q2VsbEZvY3VzSW5kaWNhdG9yID0gdmFsdWU7DQor
DQorICAgICAgaWYodmFsdWUpIHsNCisgICAgICAgIHRoaXMuX3VwZGF0ZUZvY3VzSW5kaWNhdG9y
KCk7DQorICAgICAgfQ0KKyAgICAgIGVsc2Ugew0KKyAgICAgICAgaWYodGhpcy5fZm9jdXNJbmRp
Y2F0b3IpIHsNCisgICAgICAgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3IuaGlkZSgpOw0KKyAgICAg
ICAgfQ0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIEdldCB0aGUg
Y3VycmVudCBwb3NpdGlvbiBvZiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhci4NCisgICAgICoNCisg
ICAgICogQHJldHVybiB7SW50ZWdlcn0gVGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uLg0KKyAg
ICAgKi8NCisgICAgZ2V0U2Nyb2xsWSA6IGZ1bmN0aW9uKCkgew0KKyAgICAgIHJldHVybiB0aGlz
Ll92ZXJTY3JvbGxCYXIuZ2V0VmFsdWUoKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAg
ICAqIFNldCB0aGUgY3VycmVudCBwb3NpdGlvbiBvZiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhci4N
CisgICAgICoNCisgICAgICogQHBhcmFtIHNjcm9sbFkge0ludGVnZXJ9IFRoZSBuZXcgc2Nyb2xs
IHBvc2l0aW9uLg0KKyAgICAgKiBAcGFyYW0gcmVuZGVyU3luYyB7Qm9vbGVhbj9mYWxzZX0gV2hl
dGhlciB0aGUgdGFibGUgdXBkYXRlIHNob3VsZCBiZQ0KKyAgICAgKiAgICAgcGVyZm9ybWVkIHN5
bmNob25vdXNseS4NCisgICAgICovDQorICAgIHNldFNjcm9sbFkgOiBmdW5jdGlvbihzY3JvbGxZ
LCByZW5kZXJTeW5jKQ0KKyAgICB7DQorICAgICAgdGhpcy5faWdub3JlU2Nyb2xsWUV2ZW50ID0g
cmVuZGVyU3luYzsNCisgICAgICB0aGlzLl92ZXJTY3JvbGxCYXIuc2V0VmFsdWUoc2Nyb2xsWSk7
DQorICAgICAgaWYgKHJlbmRlclN5bmMpIHsNCisgICAgICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnQo
KQ0KKyAgICAgIH0NCisgICAgICB0aGlzLl9pZ25vcmVTY3JvbGxZRXZlbnQgPSBmYWxzZTsNCisg
ICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIEdldCB0aGUgY3VycmVudCBwb3NpdGlvbiBv
ZiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhci4NCisgICAgICoNCisgICAgICogQHJldHVybiB7SW50
ZWdlcn0gVGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uLg0KKyAgICAgKi8NCisgICAgZ2V0U2Ny
b2xsWCA6IGZ1bmN0aW9uKCkgew0KKyAgICAgIHJldHVybiB0aGlzLl9ob3JTY3JvbGxCYXIuZ2V0
VmFsdWUoKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFNldCB0aGUgY3VycmVu
dCBwb3NpdGlvbiBvZiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhci4NCisgICAgICoNCisgICAgICog
QHBhcmFtIHNjcm9sbFgge0ludGVnZXJ9IFRoZSBuZXcgc2Nyb2xsIHBvc2l0aW9uLg0KKyAgICAg
Ki8NCisgICAgc2V0U2Nyb2xsWCA6IGZ1bmN0aW9uKHNjcm9sbFgpDQorICAgIHsNCisgICAgICB0
aGlzLl9ob3JTY3JvbGxCYXIuc2V0VmFsdWUoc2Nyb2xsWCk7DQorICAgIH0sDQorDQorDQorICAg
IC8qKg0KKyAgICAgKiBSZXR1cm5zIHRoZSB0YWJsZSB0aGlzIHNjcm9sbGVyIGJlbG9uZ3MgdG8u
DQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcmV0dXJuIHtxeC51aS50
YWJsZS5UYWJsZX0gdGhlIHRhYmxlLg0KKyAgICAgKi8NCisgICAgZ2V0VGFibGUgOiBmdW5jdGlv
bigpIHsNCisgICAgICByZXR1cm4gdGhpcy5fdGFibGU7DQorICAgIH0sDQorDQorDQorICAgIC8q
Kg0KKyAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdmlzaWJpbGl0eSBvZiBh
IGNvbHVtbiBoYXMgY2hhbmdlZC4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAg
ICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50Lg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0K
KyAgICAgKi8NCisgICAgX29uQ29sVmlzaWJpbGl0eUNoYW5nZWQgOiBmdW5jdGlvbihldnQpDQor
ICAgIHsNCisgICAgICB0aGlzLl91cGRhdGVIb3JTY3JvbGxCYXJNYXhpbXVtKCk7DQorICAgICAg
dGhpcy5fdXBkYXRlRm9jdXNJbmRpY2F0b3IoKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQor
ICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB3aWR0aCBvZiBhIGNvbHVtbiBo
YXMgY2hhbmdlZC4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEBwYXJh
bSBldnQge01hcH0gdGhlIGV2ZW50Lg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8N
CisgICAgX29uQ29sV2lkdGhDaGFuZ2VkIDogZnVuY3Rpb24oZXZ0KQ0KKyAgICB7DQorICAgICAg
dGhpcy5faGVhZGVyLl9vbkNvbFdpZHRoQ2hhbmdlZChldnQpOw0KKyAgICAgIHRoaXMuX3RhYmxl
UGFuZS5fb25Db2xXaWR0aENoYW5nZWQoZXZ0KTsNCisNCisgICAgICB2YXIgZGF0YSA9IGV2dC5n
ZXREYXRhKCk7DQorICAgICAgdmFyIHBhbmVNb2RlbCA9IHRoaXMuZ2V0VGFibGVQYW5lTW9kZWwo
KTsNCisgICAgICB2YXIgeCA9IHBhbmVNb2RlbC5nZXRYKGRhdGEuY29sKTsNCisNCisgICAgICBp
ZiAoeCAhPSAtMSkNCisgICAgICB7DQorICAgICAgICAvLyBUaGUgY2hhbmdlIHdhcyBpbiB0aGlz
IHNjcm9sbGVyDQorICAgICAgICB0aGlzLl91cGRhdGVIb3JTY3JvbGxCYXJNYXhpbXVtKCk7DQor
ICAgICAgICB0aGlzLl91cGRhdGVGb2N1c0luZGljYXRvcigpOw0KKyAgICAgIH0NCisgICAgfSwN
CisNCisNCisgICAgLyoqDQorICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSBj
b2x1bW4gb3JkZXIgaGFzIGNoYW5nZWQuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0K
KyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisgICAgICogQHJldHVybiB7dm9p
ZH0NCisgICAgICovDQorICAgIF9vbkNvbE9yZGVyQ2hhbmdlZCA6IGZ1bmN0aW9uKGV2dCkNCisg
ICAgew0KKyAgICAgIHRoaXMuX2hlYWRlci5fb25Db2xPcmRlckNoYW5nZWQoZXZ0KTsNCisgICAg
ICB0aGlzLl90YWJsZVBhbmUuX29uQ29sT3JkZXJDaGFuZ2VkKGV2dCk7DQorDQorICAgICAgdGhp
cy5fdXBkYXRlSG9yU2Nyb2xsQmFyTWF4aW11bSgpOw0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioN
CisgICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHRhYmxlIG1vZGVsIGhhcyBj
aGFuZ2VkLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICogQHBhcmFtIGV2
dCB7TWFwfSB0aGUgZXZlbnQuDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0KKyAg
ICBfb25UYWJsZU1vZGVsRGF0YUNoYW5nZWQgOiBmdW5jdGlvbihldnQpDQorICAgIHsNCisgICAg
ICB0aGlzLl90YWJsZVBhbmUuX29uVGFibGVNb2RlbERhdGFDaGFuZ2VkKGV2dCk7DQorDQorICAg
ICAgdmFyIHJvd0NvdW50ID0gdGhpcy5nZXRUYWJsZSgpLmdldFRhYmxlTW9kZWwoKS5nZXRSb3dD
b3VudCgpOw0KKw0KKyAgICAgIGlmIChyb3dDb3VudCAhPSB0aGlzLl9sYXN0Um93Q291bnQpDQor
ICAgICAgew0KKyAgICAgICAgdGhpcy5fbGFzdFJvd0NvdW50ID0gcm93Q291bnQ7DQorDQorICAg
ICAgICB0aGlzLl91cGRhdGVWZXJTY3JvbGxCYXJNYXhpbXVtKCk7DQorDQorICAgICAgICBpZiAo
dGhpcy5nZXRGb2N1c2VkUm93KCkgPj0gcm93Q291bnQpDQorICAgICAgICB7DQorICAgICAgICAg
IGlmIChyb3dDb3VudCA9PSAwKSB7DQorICAgICAgICAgICAgdGhpcy5zZXRGb2N1c2VkQ2VsbChu
dWxsLCBudWxsKTsNCisgICAgICAgICAgfSBlbHNlIHsNCisgICAgICAgICAgICB0aGlzLnNldEZv
Y3VzZWRDZWxsKHRoaXMuZ2V0Rm9jdXNlZENvbHVtbigpLCByb3dDb3VudCAtIDEpOw0KKyAgICAg
ICAgICB9DQorICAgICAgICB9DQorICAgICAgfQ0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisg
ICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHNlbGVjdGlvbiBoYXMgY2hhbmdl
ZC4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEBwYXJhbSBldnQge01h
cH0gdGhlIGV2ZW50Lg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8NCisgICAgX29u
U2VsZWN0aW9uQ2hhbmdlZCA6IGZ1bmN0aW9uKGV2dCkgew0KKyAgICAgIHRoaXMuX3RhYmxlUGFu
ZS5fb25TZWxlY3Rpb25DaGFuZ2VkKGV2dCk7DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAg
ICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgZ2V0cyBvciBsb29zZXMg
dGhlIGZvY3VzLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICogQHBhcmFt
IGV2dCB7TWFwfSB0aGUgZXZlbnQuDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0K
KyAgICBfb25Gb2N1c0NoYW5nZWQgOiBmdW5jdGlvbihldnQpDQorICAgIHsNCisgICAgICB0aGlz
Ll90YWJsZVBhbmUuX29uRm9jdXNDaGFuZ2VkKGV2dCk7DQorICAgIH0sDQorDQorDQorICAgIC8q
Kg0KKyAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgbW9kZWwgbWV0
YSBkYXRhIGhhcyBjaGFuZ2VkLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAg
ICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQor
ICAgICAqLw0KKyAgICBfb25UYWJsZU1vZGVsTWV0YURhdGFDaGFuZ2VkIDogZnVuY3Rpb24oZXZ0
KQ0KKyAgICB7DQorICAgICAgdGhpcy5faGVhZGVyLl9vblRhYmxlTW9kZWxNZXRhRGF0YUNoYW5n
ZWQoZXZ0KTsNCisgICAgICB0aGlzLl90YWJsZVBhbmUuX29uVGFibGVNb2RlbE1ldGFEYXRhQ2hh
bmdlZChldnQpOw0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogRXZlbnQgaGFuZGxl
ci4gQ2FsbGVkIHdoZW4gdGhlIHBhbmUgbW9kZWwgaGFzIGNoYW5nZWQuDQorICAgICAqDQorICAg
ICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisg
ICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9vblBhbmVNb2RlbENoYW5nZWQg
OiBmdW5jdGlvbihldnQpDQorICAgIHsNCisgICAgICB0aGlzLl9oZWFkZXIuX29uUGFuZU1vZGVs
Q2hhbmdlZChldnQpOw0KKyAgICAgIHRoaXMuX3RhYmxlUGFuZS5fb25QYW5lTW9kZWxDaGFuZ2Vk
KGV2dCk7DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBVcGRhdGVzIHRoZSBtYXhp
bXVtIG9mIHRoZSBob3Jpem9udGFsIHNjcm9sbCBiYXIsIHNvIGl0IGNvcnJlc3BvbmRzIHRvIHRo
ZQ0KKyAgICAgKiB0b3RhbCB3aWR0aCBvZiB0aGUgY29sdW1ucyBpbiB0aGUgdGFibGUgcGFuZS4N
CisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQor
ICAgICAqLw0KKyAgICBfdXBkYXRlSG9yU2Nyb2xsQmFyTWF4aW11bSA6IGZ1bmN0aW9uKCkgew0K
KyAgICAgIHRoaXMuX2hvclNjcm9sbEJhci5zZXRNYXhpbXVtKHRoaXMuZ2V0VGFibGVQYW5lTW9k
ZWwoKS5nZXRUb3RhbFdpZHRoKCkpOw0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICog
VXBkYXRlcyB0aGUgbWF4aW11bSBvZiB0aGUgdmVydGljYWwgc2Nyb2xsIGJhciwgc28gaXQgY29y
cmVzcG9uZHMgdG8gdGhlDQorICAgICAqIG51bWJlciBvZiByb3dzIGluIHRoZSB0YWJsZS4NCisg
ICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQorICAg
ICAqLw0KKyAgICBfdXBkYXRlVmVyU2Nyb2xsQmFyTWF4aW11bSA6IGZ1bmN0aW9uKCkNCisgICAg
ew0KKyAgICAgIHZhciByb3dDb3VudCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRUYWJsZU1vZGVsKCku
Z2V0Um93Q291bnQoKTsNCisgICAgICB2YXIgcm93SGVpZ2h0ID0gdGhpcy5nZXRUYWJsZSgpLmdl
dFJvd0hlaWdodCgpOw0KKw0KKyAgICAgIGlmICh0aGlzLmdldFRhYmxlKCkuZ2V0S2VlcEZpcnN0
VmlzaWJsZVJvd0NvbXBsZXRlKCkpIHsNCisgICAgICAgIHRoaXMuX3ZlclNjcm9sbEJhci5zZXRN
YXhpbXVtKChyb3dDb3VudCArIDEpICogcm93SGVpZ2h0KTsNCisgICAgICB9IGVsc2Ugew0KKyAg
ICAgICAgdGhpcy5fdmVyU2Nyb2xsQmFyLnNldE1heGltdW0ocm93Q291bnQgKiByb3dIZWlnaHQp
Ow0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIEV2ZW50IGhhbmRs
ZXIuIENhbGxlZCB3aGVuIHRoZSB0YWJsZSBwcm9wZXJ0eSAia2VlcEZpcnN0VmlzaWJsZVJvd0Nv
bXBsZXRlIg0KKyAgICAgKiBjaGFuZ2VkLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXIN
CisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9vbktlZXBGaXJzdFZpc2li
bGVSb3dDb21wbGV0ZUNoYW5nZWQgOiBmdW5jdGlvbigpDQorICAgIHsNCisgICAgICB0aGlzLl91
cGRhdGVWZXJTY3JvbGxCYXJNYXhpbXVtKCk7DQorICAgICAgdGhpcy5fdXBkYXRlQ29udGVudCgp
Ow0KKyAgICB9LA0KKw0KKw0KKyAgICAvLyBvdmVycmlkZGVuDQorICAgIF9jaGFuZ2VJbm5lckhl
aWdodCA6IGZ1bmN0aW9uKHZOZXcsIHZPbGQpDQorICAgIHsNCisgICAgICAvLyBUaGUgaGVpZ2h0
IGhhcyBjaGFuZ2VkIC0+IFVwZGF0ZSBjb250ZW50DQorICAgICAgdGhpcy5fcG9zdHBvbmVkVXBk
YXRlQ29udGVudCgpOw0KKw0KKyAgICAgIHJldHVybiB0aGlzLmJhc2UoYXJndW1lbnRzLCB2TmV3
LCB2T2xkKTsNCisgICAgfSwNCisNCisNCisgICAgLy8gb3ZlcnJpZGRlbg0KKyAgICBfYWZ0ZXJB
cHBlYXIgOiBmdW5jdGlvbigpDQorICAgIHsNCisgICAgICB0aGlzLmJhc2UoYXJndW1lbnRzKTsN
CisNCisgICAgICB0aGlzLmdldEVsZW1lbnQoKS5vbnNlbGVjdHN0YXJ0ID0gcXgubGFuZy5GdW5j
dGlvbi5yZXR1cm5GYWxzZTsNCisNCisgICAgICB0aGlzLl91cGRhdGVDb250ZW50KCk7DQorICAg
ICAgdGhpcy5faGVhZGVyLl91cGRhdGVDb250ZW50KCk7DQorICAgICAgdGhpcy5fdXBkYXRlSG9y
U2Nyb2xsQmFyTWF4aW11bSgpOw0KKyAgICAgIHRoaXMuX3VwZGF0ZVZlclNjcm9sbEJhck1heGlt
dW0oKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIEV2ZW50IGhhbmRsZXIuIENh
bGxlZCB3aGVuIHRoZSBob3Jpem9udGFsIHNjcm9sbCBiYXIgbW92ZWQuDQorICAgICAqDQorICAg
ICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisg
ICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9vblNjcm9sbFggOiBmdW5jdGlv
bihldnQpDQorICAgIHsNCisgICAgICB0aGlzLmNyZWF0ZURpc3BhdGNoQ2hhbmdlRXZlbnQoImNo
YW5nZVNjcm9sbFgiLCBldnQuZ2V0VmFsdWUoKSwgZXZ0LmdldE9sZFZhbHVlKCkpOw0KKyAgICAg
IHZhciBzY3JvbGxMZWZ0ID0gZXZ0LmdldFZhbHVlKCk7DQorDQorICAgICAgLy8gV29ya2Fyb3Vu
ZDogU2VlIF91cGRhdGVDb250ZW50DQorICAgICAgdGhpcy5faGVhZGVyLnNldExlZnQoLXNjcm9s
bExlZnQpOw0KKw0KKyAgICAgIC8vIENhY2hlIHRoZSBzY3JvbGxMZWZ0IHZhbHVlIG9mIHRoZSBw
YW5lQ2xpcHBlcg0KKyAgICAgIC8vDQorICAgICAgdGhpcy5fcGFuZUNsaXBwZXIuX19zY3JvbGxM
ZWZ0ID0gc2Nyb2xsTGVmdDsNCisgICAgICB0aGlzLl9wYW5lQ2xpcHBlci5zZXRTY3JvbGxMZWZ0
KHNjcm9sbExlZnQpOw0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogRXZlbnQgaGFu
ZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHZlcnRpY2FsIHNjcm9sbCBiYXIgbW92ZWQuDQorICAgICAq
DQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVu
dC4NCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9vblNjcm9sbFkgOiBm
dW5jdGlvbihldnQpDQorICAgIHsNCisgICAgICB0aGlzLmNyZWF0ZURpc3BhdGNoQ2hhbmdlRXZl
bnQoImNoYW5nZVNjcm9sbFkiLCBldnQuZ2V0VmFsdWUoKSwgZXZ0LmdldE9sZFZhbHVlKCkpOw0K
KyAgICAgIHRoaXMuX3Bvc3Rwb25lZFVwZGF0ZUNvbnRlbnQoKTsNCisgICAgfSwNCisNCisNCisg
ICAgLyoqDQorICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIG1vdmVk
IHRoZSBtb3VzZSB3aGVlbC4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAq
IEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50Lg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAg
ICAgKi8NCisgICAgX29ubW91c2V3aGVlbCA6IGZ1bmN0aW9uKGV2dCkNCisgICAgew0KKyAgICAg
IHZhciB0YWJsZSA9IHRoaXMuZ2V0VGFibGUoKTsNCisNCisgICAgICBpZiAoIXRhYmxlLmdldEVu
YWJsZWQoKSkgew0KKyAgICAgICAgcmV0dXJuOw0KKyAgICAgIH0NCisNCisgICAgICB0aGlzLl92
ZXJTY3JvbGxCYXIuc2V0VmFsdWUodGhpcy5fdmVyU2Nyb2xsQmFyLmdldFZhbHVlKCkgLSAoZXZ0
LmdldFdoZWVsRGVsdGEoKSAqIDMpICogdGFibGUuZ2V0Um93SGVpZ2h0KCkpOw0KKw0KKyAgICAg
IC8vIFVwZGF0ZSB0aGUgZm9jdXMNCisgICAgICBpZiAodGhpcy5fbGFzdE1vdXNlUGFnZVggJiYg
dGhpcy5nZXRGb2N1c0NlbGxPbk1vdXNlTW92ZSgpKSB7DQorICAgICAgICB0aGlzLl9mb2N1c0Nl
bGxBdFBhZ2VQb3ModGhpcy5fbGFzdE1vdXNlUGFnZVgsIHRoaXMuX2xhc3RNb3VzZVBhZ2VZKTsN
CisgICAgICB9DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBDb21tb24gY29sdW1u
IHJlc2l6ZSBsb2dpYy4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEBw
YXJhbSBwYWdlWCB7SW50ZWdlcn0gdGhlIGN1cnJlbnQgbW91c2UgeCBwb3NpdGlvbi4NCisgICAg
ICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9faGFuZGxlUmVzaXplQ29sdW1uIDog
ZnVuY3Rpb24ocGFnZVgpDQorICAgIHsNCisgICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxl
KCk7DQorICAgICAgLy8gV2UgYXJlIGN1cnJlbnRseSByZXNpemluZyAtPiBVcGRhdGUgdGhlIHBv
c2l0aW9uDQorICAgICAgdmFyIG1pbkNvbHVtbldpZHRoID0gcXgudWkudGFibGUucGFuZS5TY3Jv
bGxlci5NSU5fQ09MVU1OX1dJRFRIOw0KKyAgICAgIHZhciBuZXdXaWR0aCA9IE1hdGgubWF4KG1p
bkNvbHVtbldpZHRoLCB0aGlzLl9sYXN0UmVzaXplV2lkdGggKyBwYWdlWCAtIHRoaXMuX2xhc3RS
ZXNpemVNb3VzZVBhZ2VYKTsNCisNCisgICAgICBpZiAodGhpcy5nZXRMaXZlUmVzaXplKCkpIHsN
CisgICAgICAgIHZhciBjb2x1bW5Nb2RlbCA9IHRhYmxlLmdldFRhYmxlQ29sdW1uTW9kZWwoKTsN
CisgICAgICAgIGNvbHVtbk1vZGVsLnNldENvbHVtbldpZHRoKHRoaXMuX3Jlc2l6ZUNvbHVtbiwg
bmV3V2lkdGgpOw0KKyAgICAgIH0gZWxzZSB7DQorICAgICAgICB0aGlzLl9oZWFkZXIuc2V0Q29s
dW1uV2lkdGgodGhpcy5fcmVzaXplQ29sdW1uLCBuZXdXaWR0aCk7DQorDQorICAgICAgICB2YXIg
cGFuZU1vZGVsID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpOw0KKyAgICAgICAgdGhpcy5fc2hv
d1Jlc2l6ZUxpbmUocGFuZU1vZGVsLmdldENvbHVtbkxlZnQodGhpcy5fcmVzaXplQ29sdW1uKSAr
IG5ld1dpZHRoKTsNCisgICAgICB9DQorDQorICAgICAgdGhpcy5fbGFzdFJlc2l6ZU1vdXNlUGFn
ZVggKz0gbmV3V2lkdGggLSB0aGlzLl9sYXN0UmVzaXplV2lkdGg7DQorICAgICAgdGhpcy5fbGFz
dFJlc2l6ZVdpZHRoID0gbmV3V2lkdGg7DQorICAgIH0sDQorDQorICAgIC8qKg0KKyAgICAgKiBD
b21tb24gY29sdW1uIG1vdmUgbG9naWMuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0K
KyAgICAgKiBAcGFyYW0gcGFnZVgge0ludGVnZXJ9IHRoZSBjdXJyZW50IG1vdXNlIHggcG9zaXRp
b24uDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQorICAgICAqDQorICAgICAqLw0KKyAgICBfX2hh
bmRsZU1vdmVDb2x1bW4gOiBmdW5jdGlvbihwYWdlWCkNCisgICAgew0KKyAgICAgIC8vIFdlIGFy
ZSBtb3ZpbmcgYSBjb2x1bW4NCisNCisgICAgICAvLyBDaGVjayB3aGV0aGVyIHdlIG1vdmVkIG91
dHNpZGUgdGhlIGNsaWNrIHRvbGVyYW5jZSBzbyB3ZSBjYW4gc3RhcnQNCisgICAgICAvLyBzaG93
aW5nIHRoZSBjb2x1bW4gbW92ZSBmZWVkYmFjaw0KKyAgICAgIC8vIChzaG93aW5nIHRoZSBjb2x1
bW4gbW92ZSBmZWVkYmFjayBwcmV2ZW50cyB0aGUgb25jbGljayBldmVudCkNCisgICAgICB2YXIg
Y2xpY2tUb2xlcmFuY2UgPSBxeC51aS50YWJsZS5wYW5lLlNjcm9sbGVyLkNMSUNLX1RPTEVSQU5D
RTsNCisgICAgICBpZiAodGhpcy5faGVhZGVyLmlzU2hvd2luZ0NvbHVtbk1vdmVGZWVkYmFjaygp
DQorICAgICAgICB8fCBwYWdlWCA+IHRoaXMuX2xhc3RNb3ZlTW91c2VQYWdlWCArIGNsaWNrVG9s
ZXJhbmNlDQorICAgICAgICB8fCBwYWdlWCA8IHRoaXMuX2xhc3RNb3ZlTW91c2VQYWdlWCAtIGNs
aWNrVG9sZXJhbmNlKQ0KKyAgICAgIHsNCisgICAgICAgIHRoaXMuX2xhc3RNb3ZlQ29sUG9zICs9
IHBhZ2VYIC0gdGhpcy5fbGFzdE1vdmVNb3VzZVBhZ2VYOw0KKw0KKyAgICAgICAgdGhpcy5faGVh
ZGVyLnNob3dDb2x1bW5Nb3ZlRmVlZGJhY2sodGhpcy5fbW92ZUNvbHVtbiwgdGhpcy5fbGFzdE1v
dmVDb2xQb3MpOw0KKw0KKyAgICAgICAgLy8gR2V0IHRoZSByZXNwb25zaWJsZSBzY3JvbGxlcg0K
KyAgICAgICAgdmFyIHRhcmdldFNjcm9sbGVyID0gdGhpcy5fdGFibGUuZ2V0VGFibGVQYW5lU2Ny
b2xsZXJBdFBhZ2VYKHBhZ2VYKTsNCisgICAgICAgIGlmICh0aGlzLl9sYXN0TW92ZVRhcmdldFNj
cm9sbGVyICYmIHRoaXMuX2xhc3RNb3ZlVGFyZ2V0U2Nyb2xsZXIgIT0gdGFyZ2V0U2Nyb2xsZXIp
IHsNCisgICAgICAgICAgdGhpcy5fbGFzdE1vdmVUYXJnZXRTY3JvbGxlci5oaWRlQ29sdW1uTW92
ZUZlZWRiYWNrKCk7DQorICAgICAgICB9DQorICAgICAgICBpZiAodGFyZ2V0U2Nyb2xsZXIgIT0g
bnVsbCkgew0KKyAgICAgICAgICB0aGlzLl9sYXN0TW92ZVRhcmdldFggPSB0YXJnZXRTY3JvbGxl
ci5zaG93Q29sdW1uTW92ZUZlZWRiYWNrKHBhZ2VYKTsNCisgICAgICAgIH0gZWxzZSB7DQorICAg
ICAgICAgIHRoaXMuX2xhc3RNb3ZlVGFyZ2V0WCA9IG51bGw7DQorICAgICAgICB9DQorDQorICAg
ICAgICB0aGlzLl9sYXN0TW92ZVRhcmdldFNjcm9sbGVyID0gdGFyZ2V0U2Nyb2xsZXI7DQorICAg
ICAgICB0aGlzLl9sYXN0TW92ZU1vdXNlUGFnZVggPSBwYWdlWDsNCisgICAgICB9DQorICAgIH0s
DQorDQorDQorICAgIC8qKg0KKyAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUg
dXNlciBtb3ZlZCB0aGUgbW91c2Ugb3ZlciB0aGUgaGVhZGVyLg0KKyAgICAgKg0KKyAgICAgKiBA
dHlwZSBtZW1iZXINCisgICAgICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuDQorICAgICAq
IEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0KKyAgICBfb25tb3VzZW1vdmVIZWFkZXIgOiBmdW5j
dGlvbihldnQpDQorICAgIHsNCisgICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7DQor
DQorICAgICAgaWYgKCEgdGFibGUuZ2V0RW5hYmxlZCgpKSB7DQorICAgICAgICByZXR1cm47DQor
ICAgICAgfQ0KKw0KKyAgICAgIHZhciB1c2VSZXNpemVDdXJzb3IgPSBmYWxzZTsNCisgICAgICB2
YXIgbW91c2VPdmVyQ29sdW1uID0gbnVsbDsNCisNCisgICAgICB2YXIgcGFnZVggPSBldnQuZ2V0
UGFnZVgoKTsNCisgICAgICB2YXIgcGFnZVkgPSBldnQuZ2V0UGFnZVkoKTsNCisNCisgICAgICAv
LyBXb3JrYXJvdW5kOiBJbiBvbm1vdXNld2hlZWwgdGhlIGV2ZW50IGhhcyB3cm9uZyBjb29yZGlu
YXRlcyBmb3IgcGFnZVgNCisgICAgICAvLyAgICAgICBhbmQgcGFnZVkuIFNvIHdlIHJlbWVtYmVy
IHRoZSBsYXN0IG1vdmUgZXZlbnQuDQorICAgICAgdGhpcy5fbGFzdE1vdXNlUGFnZVggPSBwYWdl
WDsNCisgICAgICB0aGlzLl9sYXN0TW91c2VQYWdlWSA9IHBhZ2VZOw0KKw0KKyAgICAgIGlmICh0
aGlzLl9yZXNpemVDb2x1bW4gIT0gbnVsbCkgew0KKyAgICAgICAgLy8gV2UgYXJlIGN1cnJlbnRs
eSByZXNpemluZyAtPiBVcGRhdGUgdGhlIHBvc2l0aW9uDQorICAgICAgICB0aGlzLl9faGFuZGxl
UmVzaXplQ29sdW1uKHBhZ2VYKTsNCisgICAgICAgIHVzZVJlc2l6ZUN1cnNvciA9IHRydWU7DQor
ICAgICAgfSBlbHNlIGlmICh0aGlzLl9tb3ZlQ29sdW1uICE9IG51bGwpIHsNCisgICAgICAgIC8v
IFdlIGFyZSBtb3ZpbmcgYSBjb2x1bW4NCisgICAgICAgIHRoaXMuX19oYW5kbGVNb3ZlQ29sdW1u
KHBhZ2VYKTsNCisgICAgICB9IGVsc2Ugew0KKyAgICAgICAgdmFyIHJlc2l6ZUNvbCA9IHRoaXMu
X2dldFJlc2l6ZUNvbHVtbkZvclBhZ2VYKHBhZ2VYKTsNCisgICAgICAgIGlmIChyZXNpemVDb2wg
IT0gLTEpIHsNCisgICAgICAgICAgLy8gVGhlIG1vdXNlIGlzIG92ZXIgYSByZXNpemUgcmVnaW9u
IC0+IFNob3cgdGhlIHJpZ2h0IGN1cnNvcg0KKyAgICAgICAgICB1c2VSZXNpemVDdXJzb3IgPSB0
cnVlOw0KKyAgICAgICAgfSBlbHNlIHsNCisgICAgICAgICAgdmFyIHRhYmxlTW9kZWwgPSB0YWJs
ZS5nZXRUYWJsZU1vZGVsKCk7DQorICAgICAgICAgIHZhciBjb2wgPSB0aGlzLl9nZXRDb2x1bW5G
b3JQYWdlWChwYWdlWCk7DQorICAgICAgICAgIGlmIChjb2wgIT0gbnVsbCAmJiB0YWJsZU1vZGVs
LmlzQ29sdW1uU29ydGFibGUoY29sKSkgew0KKyAgICAgICAgICAgIG1vdXNlT3ZlckNvbHVtbiA9
IGNvbDsNCisgICAgICAgICAgfQ0KKyAgICAgICAgfQ0KKyAgICAgIH0NCisNCisgICAgICAvLyBX
b3JrYXJvdW5kOiBTZXR0aW5nIHRoZSBjdXJzb3IgdG8gdGhlIHJpZ2h0IHdpZGdldCBkb2Vzbid0
IHdvcmsNCisgICAgICAvL3RoaXMuX2hlYWRlci5zZXRDdXJzb3IodXNlUmVzaXplQ3Vyc29yID8g
ImUtcmVzaXplIiA6IG51bGwpOw0KKyAgICAgIHRoaXMuZ2V0VG9wTGV2ZWxXaWRnZXQoKS5zZXRH
bG9iYWxDdXJzb3IodXNlUmVzaXplQ3Vyc29yID8gcXgudWkudGFibGUucGFuZS5TY3JvbGxlci5D
VVJTT1JfUkVTSVpFX0hPUklaT05UQUwgOiBudWxsKTsNCisNCisgICAgICB0aGlzLl9oZWFkZXIu
c2V0TW91c2VPdmVyQ29sdW1uKG1vdXNlT3ZlckNvbHVtbik7DQorICAgIH0sDQorDQorDQorICAg
IC8qKg0KKyAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdXNlciBtb3ZlZCB0
aGUgbW91c2Ugb3ZlciB0aGUgcGFuZS4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQor
ICAgICAqIEBwYXJhbSBldnQge01hcH0gdGhlIGV2ZW50Lg0KKyAgICAgKiBAcmV0dXJuIHt2b2lk
fQ0KKyAgICAgKi8NCisgICAgX29ubW91c2Vtb3ZlUGFuZSA6IGZ1bmN0aW9uKGV2dCkNCisgICAg
ew0KKyAgICAgIHZhciB0YWJsZSA9IHRoaXMuZ2V0VGFibGUoKTsNCisNCisgICAgICBpZiAoISB0
YWJsZS5nZXRFbmFibGVkKCkpIHsNCisgICAgICAgIHJldHVybjsNCisgICAgICB9DQorDQorICAg
ICAgdmFyIHVzZVJlc2l6ZUN1cnNvciA9IGZhbHNlOw0KKw0KKyAgICAgIHZhciBwYWdlWCA9IGV2
dC5nZXRQYWdlWCgpOw0KKyAgICAgIHZhciBwYWdlWSA9IGV2dC5nZXRQYWdlWSgpOw0KKw0KKyAg
ICAgIC8vIFdvcmthcm91bmQ6IEluIG9ubW91c2V3aGVlbCB0aGUgZXZlbnQgaGFzIHdyb25nIGNv
b3JkaW5hdGVzIGZvciBwYWdlWA0KKyAgICAgIC8vICAgICAgIGFuZCBwYWdlWS4gU28gd2UgcmVt
ZW1iZXIgdGhlIGxhc3QgbW92ZSBldmVudC4NCisgICAgICB0aGlzLl9sYXN0TW91c2VQYWdlWCA9
IHBhZ2VYOw0KKyAgICAgIHRoaXMuX2xhc3RNb3VzZVBhZ2VZID0gcGFnZVk7DQorDQorICAgICAg
aWYgKHRoaXMuX3Jlc2l6ZUNvbHVtbiAhPSBudWxsKSB7DQorICAgICAgICAvLyBXZSBhcmUgY3Vy
cmVudGx5IHJlc2l6aW5nIC0+IFVwZGF0ZSB0aGUgcG9zaXRpb24NCisgICAgICAgIHRoaXMuX19o
YW5kbGVSZXNpemVDb2x1bW4ocGFnZVgpOw0KKyAgICAgICAgdXNlUmVzaXplQ3Vyc29yID0gdHJ1
ZTsNCisgICAgICB9IGVsc2UgaWYgKHRoaXMuX21vdmVDb2x1bW4gIT0gbnVsbCkgew0KKyAgICAg
ICAgLy8gV2UgYXJlIG1vdmluZyBhIGNvbHVtbg0KKyAgICAgICAgdGhpcy5fX2hhbmRsZU1vdmVD
b2x1bW4ocGFnZVgpOw0KKyAgICAgIH0gZWxzZSB7DQorICAgICAgICAvLyBUaGlzIGlzIGEgbm9y
bWFsIG1vdXNlIG1vdmUNCisgICAgICAgIHZhciByb3cgPSB0aGlzLl9nZXRSb3dGb3JQYWdlUG9z
KHBhZ2VYLCBwYWdlWSk7DQorICAgICAgICBpZiAocm93ICE9IG51bGwgJiYgdGhpcy5fZ2V0Q29s
dW1uRm9yUGFnZVgocGFnZVgpICE9IG51bGwpIHsNCisgICAgICAgICAgLy8gVGhlIG1vdXNlIGlz
IG92ZXIgdGhlIGRhdGEgLT4gdXBkYXRlIHRoZSBmb2N1cw0KKyAgICAgICAgICBpZiAodGhpcy5n
ZXRGb2N1c0NlbGxPbk1vdXNlTW92ZSgpKSB7DQorICAgICAgICAgICAgdGhpcy5fZm9jdXNDZWxs
QXRQYWdlUG9zKHBhZ2VYLCBwYWdlWSk7DQorICAgICAgICAgIH0NCisgICAgICAgIH0NCisgICAg
ICB9DQorDQorICAgICAgLy8gV29ya2Fyb3VuZDogU2V0dGluZyB0aGUgY3Vyc29yIHRvIHRoZSBy
aWdodCB3aWRnZXQgZG9lc24ndCB3b3JrDQorICAgICAgLy90aGlzLl9oZWFkZXIuc2V0Q3Vyc29y
KHVzZVJlc2l6ZUN1cnNvciA/ICJlLXJlc2l6ZSIgOiBudWxsKTsNCisgICAgICB0aGlzLmdldFRv
cExldmVsV2lkZ2V0KCkuc2V0R2xvYmFsQ3Vyc29yKHVzZVJlc2l6ZUN1cnNvciA/IHF4LnVpLnRh
YmxlLnBhbmUuU2Nyb2xsZXIuQ1VSU09SX1JFU0laRV9IT1JJWk9OVEFMIDogbnVsbCk7DQorDQor
ICAgICAgdGhpcy5faGVhZGVyLnNldE1vdXNlT3ZlckNvbHVtbihudWxsKTsNCisgICAgfSwNCisN
CisNCisgICAgLyoqDQorICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB1c2Vy
IHByZXNzZWQgYSBtb3VzZSBidXR0b24gb3ZlciB0aGUgaGVhZGVyLg0KKyAgICAgKg0KKyAgICAg
KiBAdHlwZSBtZW1iZXINCisgICAgICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuDQorICAg
ICAqIEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0KKyAgICBfb25tb3VzZWRvd25IZWFkZXIgOiBm
dW5jdGlvbihldnQpDQorICAgIHsNCisgICAgICBpZiAoISB0aGlzLmdldFRhYmxlKCkuZ2V0RW5h
YmxlZCgpKSB7DQorICAgICAgICByZXR1cm47DQorICAgICAgfQ0KKw0KKyAgICAgIHZhciBwYWdl
WCA9IGV2dC5nZXRQYWdlWCgpOw0KKw0KKyAgICAgIC8vIG1vdXNlIGlzIGluIGhlYWRlcg0KKyAg
ICAgIHZhciByZXNpemVDb2wgPSB0aGlzLl9nZXRSZXNpemVDb2x1bW5Gb3JQYWdlWChwYWdlWCk7
DQorICAgICAgaWYgKHJlc2l6ZUNvbCAhPSAtMSkgew0KKyAgICAgICAgLy8gVGhlIG1vdXNlIGlz
IG92ZXIgYSByZXNpemUgcmVnaW9uIC0+IFN0YXJ0IHJlc2l6aW5nDQorICAgICAgICB0aGlzLl9z
dGFydFJlc2l6ZUhlYWRlcihyZXNpemVDb2wsIHBhZ2VYKTsNCisgICAgICB9IGVsc2Ugew0KKyAg
ICAgICAgLy8gVGhlIG1vdXNlIGlzIG5vdCBpbiBhIHJlc2l6ZSByZWdpb24NCisgICAgICAgIHZh
ciBtb3ZlQ29sID0gdGhpcy5fZ2V0Q29sdW1uRm9yUGFnZVgocGFnZVgpOw0KKyAgICAgICAgaWYg
KG1vdmVDb2wgIT0gbnVsbCkgew0KKyAgICAgICAgICB0aGlzLl9zdGFydE1vdmVIZWFkZXIobW92
ZUNvbCwgcGFnZVgpOw0KKyAgICAgICAgfQ0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAg
LyoqDQorICAgICAqIFN0YXJ0IGEgcmVzaXplIHNlc3Npb24gb2YgdGhlIGhlYWRlci4NCisgICAg
ICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEBwYXJhbSByZXNpemVDb2wge0ludGVn
ZXJ9IHRoZSBjb2x1bW4gaW5kZXgNCisgICAgICogQHBhcmFtIHBhZ2VYIHtJbnRlZ2VyfSB4IGNv
b3JkaW5hdGUgb2YgdGhlIG1vdXNlIGV2ZW50DQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQorICAg
ICAqLw0KKyAgICBfc3RhcnRSZXNpemVIZWFkZXIgOiBmdW5jdGlvbihyZXNpemVDb2wsIHBhZ2VY
KQ0KKyAgICB7DQorICAgICAgdmFyIGNvbHVtbk1vZGVsID0gdGhpcy5nZXRUYWJsZSgpLmdldFRh
YmxlQ29sdW1uTW9kZWwoKTsNCisNCisgICAgICAvLyBUaGUgbW91c2UgaXMgb3ZlciBhIHJlc2l6
ZSByZWdpb24gLT4gU3RhcnQgcmVzaXppbmcNCisgICAgICB0aGlzLl9yZXNpemVDb2x1bW4gPSBy
ZXNpemVDb2w7DQorICAgICAgdGhpcy5fbGFzdFJlc2l6ZU1vdXNlUGFnZVggPSBwYWdlWDsNCisg
ICAgICB0aGlzLl9sYXN0UmVzaXplV2lkdGggPSBjb2x1bW5Nb2RlbC5nZXRDb2x1bW5XaWR0aCh0
aGlzLl9yZXNpemVDb2x1bW4pOw0KKyAgICAgIHRoaXMuX2hlYWRlckNsaXBwZXIuc2V0Q2FwdHVy
ZSh0cnVlKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFN0YXJ0IGEgbW92ZSBz
ZXNzaW9uIG9mIHRoZSBoZWFkZXIuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAg
ICAgKiBAcGFyYW0gbW92ZUNvbCB7SW50ZWdlcn0gdGhlIGNvbHVtbiBpbmRleA0KKyAgICAgKiBA
cGFyYW0gcGFnZVgge0ludGVnZXJ9IHggY29vcmRpbmF0ZSBvZiB0aGUgbW91c2UgZXZlbnQNCisg
ICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9zdGFydE1vdmVIZWFkZXIgOiBm
dW5jdGlvbihtb3ZlQ29sLCBwYWdlWCkNCisgICAgew0KKyAgICAgIC8vIFByZXBhcmUgY29sdW1u
IG1vdmluZw0KKyAgICAgIHRoaXMuX21vdmVDb2x1bW4gPSBtb3ZlQ29sOw0KKyAgICAgIHRoaXMu
X2xhc3RNb3ZlTW91c2VQYWdlWCA9IHBhZ2VYOw0KKyAgICAgIHRoaXMuX2xhc3RNb3ZlQ29sUG9z
ID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpLmdldENvbHVtbkxlZnQobW92ZUNvbCk7DQorICAg
ICAgdGhpcy5faGVhZGVyQ2xpcHBlci5zZXRDYXB0dXJlKHRydWUpOw0KKyAgICB9LA0KKw0KKw0K
Kw0KKyAgICAvKioNCisgICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4gdGhlIHVzZXIg
cHJlc3NlZCBhIG1vdXNlIGJ1dHRvbiBvdmVyIHRoZSBwYW5lLg0KKyAgICAgKg0KKyAgICAgKiBA
dHlwZSBtZW1iZXINCisgICAgICogQHBhcmFtIGV2dCB7TWFwfSB0aGUgZXZlbnQuDQorICAgICAq
IEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0KKyAgICBfb25tb3VzZWRvd25QYW5lIDogZnVuY3Rp
b24oZXZ0KQ0KKyAgICB7DQorICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOw0KKw0K
KyAgICAgIGlmICghIHRhYmxlLmdldEVuYWJsZWQoKSkgew0KKyAgICAgICAgcmV0dXJuOw0KKyAg
ICAgIH0NCisNCisgICAgICBpZiAodGhpcy5pc0VkaXRpbmcoKSkgew0KKyAgICAgICAgdGhpcy5z
dG9wRWRpdGluZygpOw0KKyAgICAgIH0NCisNCisgICAgICB2YXIgcGFnZVggPSBldnQuZ2V0UGFn
ZVgoKTsNCisgICAgICB2YXIgcGFnZVkgPSBldnQuZ2V0UGFnZVkoKTsNCisgICAgICB2YXIgcm93
ID0gdGhpcy5fZ2V0Um93Rm9yUGFnZVBvcyhwYWdlWCwgcGFnZVkpOw0KKw0KKyAgICAgIGlmIChy
b3cgIT0gbnVsbCAmJiB0aGlzLl9nZXRDb2x1bW5Gb3JQYWdlWChwYWdlWCkgIT0gbnVsbCkgew0K
KyAgICAgICAgdmFyIHNlbGVjdEJlZm9yZUZvY3VzID0gdGhpcy5nZXRTZWxlY3RCZWZvcmVGb2N1
cygpOw0KKw0KKyAgICAgICAgaWYgKHNlbGVjdEJlZm9yZUZvY3VzKSB7DQorICAgICAgICAgIHRh
YmxlLl9nZXRTZWxlY3Rpb25NYW5hZ2VyKCkuaGFuZGxlTW91c2VEb3duKHJvdywgZXZ0KTsNCisg
ICAgICAgIH0NCisNCisgICAgICAgIC8vIFRoZSBtb3VzZSBpcyBvdmVyIHRoZSBkYXRhIC0+IHVw
ZGF0ZSB0aGUgZm9jdXMNCisgICAgICAgIGlmICghIHRoaXMuZ2V0Rm9jdXNDZWxsT25Nb3VzZU1v
dmUoKSkgew0KKyAgICAgICAgICB0aGlzLl9mb2N1c0NlbGxBdFBhZ2VQb3MocGFnZVgsIHBhZ2VZ
KTsNCisgICAgICAgIH0NCisNCisgICAgICAgIGlmICghIHNlbGVjdEJlZm9yZUZvY3VzKSB7DQor
ICAgICAgICAgIHRhYmxlLl9nZXRTZWxlY3Rpb25NYW5hZ2VyKCkuaGFuZGxlTW91c2VEb3duKHJv
dywgZXZ0KTsNCisgICAgICAgIH0NCisgICAgICB9DQorICAgIH0sDQorDQorDQorICAgIC8qKg0K
KyAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUgdXNlciByZWxlYXNlZCBhIG1v
dXNlIGJ1dHRvbiBvdmVyIHRoZSBoZWFkZXIuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJl
cg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisgICAgICogQHJldHVybiB7
dm9pZH0NCisgICAgICovDQorICAgIF9vbm1vdXNldXBIZWFkZXIgOiBmdW5jdGlvbihldnQpDQor
ICAgIHsNCisgICAgICB2YXIgdGFibGUgPSB0aGlzLmdldFRhYmxlKCk7DQorDQorICAgICAgaWYg
KCEgdGFibGUuZ2V0RW5hYmxlZCgpKSB7DQorICAgICAgICByZXR1cm47DQorICAgICAgfQ0KKw0K
KyAgICAgIGlmICh0aGlzLl9yZXNpemVDb2x1bW4gIT0gbnVsbCkgew0KKyAgICAgICAgdGhpcy5f
c3RvcFJlc2l6ZUhlYWRlcigpOw0KKyAgICAgIH0gZWxzZSBpZiAodGhpcy5fbW92ZUNvbHVtbiAh
PSBudWxsKSB7DQorICAgICAgICB0aGlzLl9zdG9wTW92ZUhlYWRlcigpOw0KKyAgICAgIH0NCisg
ICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVu
IHRoZSBldmVudCBjYXB0dXJpbmcgb2YgdGhlIGhlYWRlciBjaGFuZ2VkLg0KKyAgICAgKiBTdG9w
cy9maW5pc2hlcyBhbiBhY3RpdmUgaGVhZGVyIHJlc2l6ZS9tb3ZlIHNlc3Npb24gaWYgaXQgbG9z
dCBjYXB0dXJpbmcNCisgICAgICogZHVyaW5nIHRoZSBzZXNzaW9uIHRvIHN0YXkgaW4gYSBzdGFi
bGUgc3RhdGUuDQorICAgICAqLw0KKyAgICBfb25DaGFuZ2VDYXB0dXJlSGVhZGVyIDogZnVuY3Rp
b24oZSkNCisgICAgew0KKyAgICAgIGlmICh0aGlzLl9yZXNpemVDb2x1bW4gIT0gbnVsbCAmJiBl
LmdldFZhbHVlKCkgPT0gZmFsc2UpIHsNCisgICAgICAgIHRoaXMuX3N0b3BSZXNpemVIZWFkZXIo
KTsNCisgICAgICB9DQorDQorICAgICAgaWYgKHRoaXMuX21vdmVDb2x1bW4gIT0gbnVsbCAmJiBl
LmdldFZhbHVlKCkgPT0gZmFsc2UpIHsNCisgICAgICAgIHRoaXMuX3N0b3BNb3ZlSGVhZGVyKCk7
DQorICAgICAgfQ0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogU3RvcCBhIHJlc2l6
ZSBzZXNzaW9uIG9mIHRoZSBoZWFkZXIuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0K
KyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8NCisgICAgX3N0b3BSZXNpemVIZWFkZXIg
OiBmdW5jdGlvbigpDQorICAgIHsNCisgICAgICB2YXIgY29sdW1uTW9kZWwgPSB0aGlzLmdldFRh
YmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOw0KKw0KKyAgICAgIC8vIFdlIGFyZSBjdXJyZW50
bHkgcmVzaXppbmcgLT4gRmluaXNoIHJlc2l6aW5nDQorICAgICAgaWYgKCEgdGhpcy5nZXRMaXZl
UmVzaXplKCkpIHsNCisgICAgICAgIHRoaXMuX2hpZGVSZXNpemVMaW5lKCk7DQorICAgICAgICBj
b2x1bW5Nb2RlbC5zZXRDb2x1bW5XaWR0aCh0aGlzLl9yZXNpemVDb2x1bW4sIHRoaXMuX2xhc3RS
ZXNpemVXaWR0aCk7DQorICAgICAgfQ0KKw0KKyAgICAgIHRoaXMuX3Jlc2l6ZUNvbHVtbiA9IG51
bGw7DQorICAgICAgdGhpcy5faGVhZGVyQ2xpcHBlci5zZXRDYXB0dXJlKGZhbHNlKTsNCisNCisg
ICAgICB0aGlzLmdldFRvcExldmVsV2lkZ2V0KCkuc2V0R2xvYmFsQ3Vyc29yKG51bGwpOw0KKyAg
ICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogU3RvcCBhIG1vdmUgc2Vzc2lvbiBvZiB0aGUg
aGVhZGVyLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICogQHJldHVybiB7
dm9pZH0NCisgICAgICovDQorICAgIF9zdG9wTW92ZUhlYWRlciA6IGZ1bmN0aW9uKCkNCisgICAg
ew0KKyAgICAgIHZhciBjb2x1bW5Nb2RlbCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRUYWJsZUNvbHVt
bk1vZGVsKCk7DQorICAgICAgdmFyIHBhbmVNb2RlbCA9IHRoaXMuZ2V0VGFibGVQYW5lTW9kZWwo
KTsNCisNCisgICAgICAvLyBXZSBhcmUgbW92aW5nIGEgY29sdW1uIC0+IERyb3AgdGhlIGNvbHVt
bg0KKyAgICAgIHRoaXMuX2hlYWRlci5oaWRlQ29sdW1uTW92ZUZlZWRiYWNrKCk7DQorICAgICAg
aWYgKHRoaXMuX2xhc3RNb3ZlVGFyZ2V0U2Nyb2xsZXIpIHsNCisgICAgICAgIHRoaXMuX2xhc3RN
b3ZlVGFyZ2V0U2Nyb2xsZXIuaGlkZUNvbHVtbk1vdmVGZWVkYmFjaygpOw0KKyAgICAgIH0NCisN
CisgICAgICBpZiAodGhpcy5fbGFzdE1vdmVUYXJnZXRYICE9IG51bGwpIHsNCisgICAgICAgIHZh
ciBmcm9tVmlzWFBvcyA9IHBhbmVNb2RlbC5nZXRGaXJzdENvbHVtblgoKSArIHBhbmVNb2RlbC5n
ZXRYKHRoaXMuX21vdmVDb2x1bW4pOw0KKyAgICAgICAgdmFyIHRvVmlzWFBvcyA9IHRoaXMuX2xh
c3RNb3ZlVGFyZ2V0WDsNCisgICAgICAgIGlmICh0b1Zpc1hQb3MgIT0gZnJvbVZpc1hQb3MgJiYg
dG9WaXNYUG9zICE9IGZyb21WaXNYUG9zICsgMSkgew0KKyAgICAgICAgICAvLyBUaGUgY29sdW1u
IHdhcyByZWFsbHkgbW92ZWQgdG8gYW5vdGhlciBwb3NpdGlvbg0KKyAgICAgICAgICAvLyAoYW5k
IG5vdCBtb3ZlZCBiZWZvcmUgb3IgYWZ0ZXIgaXRzZWxmLCB3aGljaCBpcyBhIG5vb3ApDQorDQor
ICAgICAgICAgIC8vIFRyYW5zbGF0ZSB2aXNpYmxlIHBvc2l0aW9ucyB0byBvdmVyYWxsIHBvc2l0
aW9ucw0KKyAgICAgICAgICB2YXIgZnJvbUNvbCA9IGNvbHVtbk1vZGVsLmdldFZpc2libGVDb2x1
bW5BdFgoZnJvbVZpc1hQb3MpOw0KKyAgICAgICAgICB2YXIgdG9Db2wgICA9IGNvbHVtbk1vZGVs
LmdldFZpc2libGVDb2x1bW5BdFgodG9WaXNYUG9zKTsNCisgICAgICAgICAgdmFyIGZyb21PdmVy
WFBvcyA9IGNvbHVtbk1vZGVsLmdldE92ZXJhbGxYKGZyb21Db2wpOw0KKyAgICAgICAgICB2YXIg
dG9PdmVyWFBvcyA9ICh0b0NvbCAhPSBudWxsKSA/IGNvbHVtbk1vZGVsLmdldE92ZXJhbGxYKHRv
Q29sKSA6IGNvbHVtbk1vZGVsLmdldE92ZXJhbGxDb2x1bW5Db3VudCgpOw0KKw0KKyAgICAgICAg
ICBpZiAodG9PdmVyWFBvcyA+IGZyb21PdmVyWFBvcykgew0KKyAgICAgICAgICAgIC8vIERvbid0
IGNvdW50IHRoZSBjb2x1bW4gaXRzZWxmDQorICAgICAgICAgICAgdG9PdmVyWFBvcy0tOw0KKyAg
ICAgICAgICB9DQorDQorICAgICAgICAgIC8vIE1vdmUgdGhlIGNvbHVtbg0KKyAgICAgICAgICBj
b2x1bW5Nb2RlbC5tb3ZlQ29sdW1uKGZyb21PdmVyWFBvcywgdG9PdmVyWFBvcyk7DQorICAgICAg
ICB9DQorICAgICAgfQ0KKw0KKyAgICAgIHRoaXMuX21vdmVDb2x1bW4gPSBudWxsOw0KKyAgICAg
IHRoaXMuX2xhc3RNb3ZlVGFyZ2V0WCA9IG51bGw7DQorICAgICAgdGhpcy5faGVhZGVyQ2xpcHBl
ci5zZXRDYXB0dXJlKGZhbHNlKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIEV2
ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIHJlbGVhc2VkIGEgbW91c2UgYnV0dG9u
IG92ZXIgdGhlIHBhbmUuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBA
cGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAg
ICovDQorICAgIF9vbm1vdXNldXBQYW5lIDogZnVuY3Rpb24oZXZ0KQ0KKyAgICB7DQorICAgICAg
dmFyIHRhYmxlID0gdGhpcy5nZXRUYWJsZSgpOw0KKw0KKyAgICAgIGlmICghIHRhYmxlLmdldEVu
YWJsZWQoKSkgew0KKyAgICAgICAgcmV0dXJuOw0KKyAgICAgIH0NCisNCisgICAgICB2YXIgcm93
ID0gdGhpcy5fZ2V0Um93Rm9yUGFnZVBvcyhldnQuZ2V0UGFnZVgoKSwgZXZ0LmdldFBhZ2VZKCkp
Ow0KKyAgICAgIGlmIChyb3cgIT0gLTEgJiYgcm93ICE9IG51bGwgJiYgdGhpcy5fZ2V0Q29sdW1u
Rm9yUGFnZVgoZXZ0LmdldFBhZ2VYKCkpICE9IG51bGwpIHsNCisgICAgICAgIHRhYmxlLl9nZXRT
ZWxlY3Rpb25NYW5hZ2VyKCkuaGFuZGxlTW91c2VVcChyb3csIGV2dCk7DQorICAgICAgfQ0KKyAg
ICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVkIHdoZW4g
dGhlIHVzZXIgY2xpY2tlZCBhIG1vdXNlIGJ1dHRvbiBvdmVyIHRoZSBoZWFkZXIuDQorICAgICAq
DQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVu
dC4NCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9vbmNsaWNrSGVhZGVy
IDogZnVuY3Rpb24oZXZ0KQ0KKyAgICB7DQorICAgICAgdmFyIHRhYmxlID0gdGhpcy5nZXRUYWJs
ZSgpOw0KKw0KKyAgICAgIGlmICghdGFibGUuZ2V0RW5hYmxlZCgpKSB7DQorICAgICAgICByZXR1
cm47DQorICAgICAgfQ0KKw0KKyAgICAgIHZhciB0YWJsZU1vZGVsID0gdGFibGUuZ2V0VGFibGVN
b2RlbCgpOw0KKw0KKyAgICAgIHZhciBwYWdlWCA9IGV2dC5nZXRQYWdlWCgpOw0KKw0KKyAgICAg
IHZhciByZXNpemVDb2wgPSB0aGlzLl9nZXRSZXNpemVDb2x1bW5Gb3JQYWdlWChwYWdlWCk7DQor
DQorICAgICAgaWYgKHJlc2l6ZUNvbCA9PSAtMSkNCisgICAgICB7DQorICAgICAgICAvLyBtb3Vz
ZSBpcyBub3QgaW4gYSByZXNpemUgcmVnaW9uDQorICAgICAgICB2YXIgY29sID0gdGhpcy5fZ2V0
Q29sdW1uRm9yUGFnZVgocGFnZVgpOw0KKw0KKyAgICAgICAgaWYgKGNvbCAhPSBudWxsICYmIHRh
YmxlTW9kZWwuaXNDb2x1bW5Tb3J0YWJsZShjb2wpKQ0KKyAgICAgICAgew0KKyAgICAgICAgICAv
LyBTb3J0IHRoYXQgY29sdW1uDQorICAgICAgICAgIHZhciBzb3J0Q29sID0gdGFibGVNb2RlbC5n
ZXRTb3J0Q29sdW1uSW5kZXgoKTsNCisgICAgICAgICAgdmFyIGFzY2VuZGluZyA9IChjb2wgIT0g
c29ydENvbCkgPyB0cnVlIDogIXRhYmxlTW9kZWwuaXNTb3J0QXNjZW5kaW5nKCk7DQorDQorICAg
ICAgICAgIHRhYmxlTW9kZWwuc29ydEJ5Q29sdW1uKGNvbCwgYXNjZW5kaW5nKTsNCisgICAgICAg
ICAgdGFibGUuZ2V0U2VsZWN0aW9uTW9kZWwoKS5jbGVhclNlbGVjdGlvbigpOw0KKyAgICAgICAg
fQ0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIEV2ZW50IGhhbmRs
ZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIGNsaWNrZWQgYSBtb3VzZSBidXR0b24gb3ZlciB0aGUg
cGFuZS4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEBwYXJhbSBldnQg
e01hcH0gdGhlIGV2ZW50Lg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8NCisgICAg
X29uY2xpY2tQYW5lIDogZnVuY3Rpb24oZXZ0KQ0KKyAgICB7DQorICAgICAgdmFyIHRhYmxlID0g
dGhpcy5nZXRUYWJsZSgpOw0KKw0KKyAgICAgIGlmICghdGFibGUuZ2V0RW5hYmxlZCgpKSB7DQor
ICAgICAgICByZXR1cm47DQorICAgICAgfQ0KKw0KKyAgICAgIHZhciBwYWdlWCA9IGV2dC5nZXRQ
YWdlWCgpOw0KKyAgICAgIHZhciBwYWdlWSA9IGV2dC5nZXRQYWdlWSgpOw0KKyAgICAgIHZhciBy
b3cgPSB0aGlzLl9nZXRSb3dGb3JQYWdlUG9zKHBhZ2VYLCBwYWdlWSk7DQorDQorICAgICAgaWYg
KHJvdyAhPSBudWxsICYmIHRoaXMuX2dldENvbHVtbkZvclBhZ2VYKHBhZ2VYKSAhPSBudWxsKQ0K
KyAgICAgIHsNCisgICAgICAgIHRhYmxlLl9nZXRTZWxlY3Rpb25NYW5hZ2VyKCkuaGFuZGxlQ2xp
Y2socm93LCBldnQpOw0KKyAgICAgICBpZiAodGhpcy5oYXNFdmVudExpc3RlbmVycygiY2VsbENs
aWNrIikpDQorICAgICAgIHsNCisgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQobmV3IHF4LnVp
LnRhYmxlLnBhbmUuQ2VsbEV2ZW50KHRoaXMsIGV2dCksIHRydWUpOw0KKyAgICAgICB9DQorICAg
ICAgfQ0KKyAgICB9LA0KKw0KKyAgICAvKioNCisgICAgICogRXZlbnQgaGFuZGxlci4gQ2FsbGVk
IHdoZW4gYSBjb250ZXh0IG1lbnUgaXMgaW52b2tlZCBpbiBhIGNlbGwuDQorICAgICAqDQorICAg
ICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtxeC5ldmVudC50eXBlLk1vdXNl
RXZlbnR9IHRoZSBldmVudC4NCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAg
IF9vbkNvbnRleHRNZW51IDogZnVuY3Rpb24oZXZ0KQ0KKyAgICB7DQorICAgICAgIGlmICh0aGlz
Lmhhc0V2ZW50TGlzdGVuZXJzKCJjZWxsQ29udGV4dG1lbnUiKSkNCisgICAgICAgew0KKyAgICAg
ICAgIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgcXgudWkudGFibGUucGFuZS5DZWxsRXZlbnQodGhp
cywgZXZ0KSwgdHJ1ZSk7DQorICAgICAgIH0NCisgICAgfSwNCisNCisgICAgLyoqDQorICAgICAq
IEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSB1c2VyIGRvdWJsZSBjbGlja2VkIGEgbW91
c2UgYnV0dG9uIG92ZXIgdGhlIHBhbmUuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0K
KyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisgICAgICogQHJldHVybiB7dm9p
ZH0NCisgICAgICovDQorICAgIF9vbmRibGNsaWNrUGFuZSA6IGZ1bmN0aW9uKGV2dCkNCisgICAg
ew0KKyAgICAgIHZhciBwYWdlWCA9IGV2dC5nZXRQYWdlWCgpOw0KKyAgICAgIHZhciBwYWdlWSA9
IGV2dC5nZXRQYWdlWSgpOw0KKw0KKw0KKyAgICAgIHRoaXMuX2ZvY3VzQ2VsbEF0UGFnZVBvcyhw
YWdlWCwgcGFnZVkpOw0KKyAgICAgIHRoaXMuc3RhcnRFZGl0aW5nKCk7DQorICAgICAgaWYgKHRo
aXMuaGFzRXZlbnRMaXN0ZW5lcnMoImNlbGxEYmxjbGljayIpKQ0KKyAgICAgIHsNCisgICAgICAg
IHZhciByb3cgPSB0aGlzLl9nZXRSb3dGb3JQYWdlUG9zKHBhZ2VYLCBwYWdlWSk7DQorICAgICAg
ICBpZiAocm93ICE9IC0xICYmIHJvdyAhPSBudWxsKQ0KKyAgICAgICAgew0KKyAgICAgICAgICB0
aGlzLmRpc3BhdGNoRXZlbnQobmV3IHF4LnVpLnRhYmxlLnBhbmUuQ2VsbEV2ZW50KHRoaXMsIGV2
dCksIHRydWUpOw0KKyAgICAgICAgfQ0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAgLyoq
DQorICAgICAqIEV2ZW50IGhhbmRsZXIuIENhbGxlZCB3aGVuIHRoZSBtb3VzZSBtb3ZlZCBvdXQu
DQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9
IHRoZSBldmVudC4NCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9vbm1v
dXNlb3V0IDogZnVuY3Rpb24oZXZ0KQ0KKyAgICB7DQorICAgICAgdmFyIHRhYmxlID0gdGhpcy5n
ZXRUYWJsZSgpOw0KKw0KKyAgICAgIGlmICghdGFibGUuZ2V0RW5hYmxlZCgpKSB7DQorICAgICAg
ICByZXR1cm47DQorICAgICAgfQ0KKw0KKyAgICAgIC8vIFJlc2V0IHRoZSByZXNpemUgY3Vyc29y
IHdoZW4gdGhlIG1vdXNlIGxlYXZlcyB0aGUgaGVhZGVyDQorICAgICAgLy8gSWYgY3VycmVudGx5
IGEgY29sdW1uIGlzIHJlc2l6ZWQgdGhlbiBkbyBub3RoaW5nDQorICAgICAgLy8gKHRoZSBjdXJz
b3Igd2lsbCBiZSByZXNldCBvbiBtb3VzZXVwKQ0KKyAgICAgIGlmICh0aGlzLl9yZXNpemVDb2x1
bW4gPT0gbnVsbCkgew0KKyAgICAgICAgdGhpcy5nZXRUb3BMZXZlbFdpZGdldCgpLnNldEdsb2Jh
bEN1cnNvcihudWxsKTsNCisgICAgICB9DQorDQorICAgICAgdGhpcy5faGVhZGVyLnNldE1vdXNl
T3ZlckNvbHVtbihudWxsKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFNob3dz
IHRoZSByZXNpemUgbGluZS4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAq
IEBwYXJhbSB4IHtJbnRlZ2VyfSB0aGUgcG9zaXRpb24gd2hlcmUgdG8gc2hvdyB0aGUgbGluZSAo
aW4gcGl4ZWxzLCByZWxhdGl2ZSB0bw0KKyAgICAgKiAgICAgIHRoZSBsZWZ0IHNpZGUgb2YgdGhl
IHBhbmUpLg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8NCisgICAgX3Nob3dSZXNp
emVMaW5lIDogZnVuY3Rpb24oeCkNCisgICAgew0KKyAgICAgIHZhciByZXNpemVMaW5lID0gdGhp
cy5fcmVzaXplTGluZTsNCisNCisgICAgICBpZiAocmVzaXplTGluZSA9PSBudWxsKQ0KKyAgICAg
IHsNCisgICAgICAgIHJlc2l6ZUxpbmUgPSBuZXcgcXgudWkuYmFzaWMuVGVybWluYXRvcjsNCisg
ICAgICAgIHJlc2l6ZUxpbmUuc2V0QmFja2dyb3VuZENvbG9yKCIjRDZENUQ5Iik7DQorICAgICAg
ICByZXNpemVMaW5lLnNldFdpZHRoKDMpOw0KKyAgICAgICAgdGhpcy5fcGFuZUNsaXBwZXIuYWRk
KHJlc2l6ZUxpbmUpOw0KKyAgICAgICAgcXgudWkuY29yZS5XaWRnZXQuZmx1c2hHbG9iYWxRdWV1
ZXMoKTsNCisNCisgICAgICAgIHRoaXMuX3Jlc2l6ZUxpbmUgPSByZXNpemVMaW5lOw0KKyAgICAg
IH0NCisNCisgICAgICByZXNpemVMaW5lLl9yZW5kZXJSdW50aW1lTGVmdCh4IC0gMik7IC8vIC0x
IGZvciB0aGUgd2lkdGgNCisgICAgICByZXNpemVMaW5lLl9yZW5kZXJSdW50aW1lSGVpZ2h0KHRo
aXMuX3BhbmVDbGlwcGVyLmdldEJveEhlaWdodCgpICsgdGhpcy5fcGFuZUNsaXBwZXIuZ2V0U2Ny
b2xsVG9wKCkpOw0KKw0KKyAgICAgIHRoaXMuX3Jlc2l6ZUxpbmUucmVtb3ZlU3R5bGVQcm9wZXJ0
eSgidmlzaWJpbGl0eSIpOw0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogSGlkZXMg
dGhlIHJlc2l6ZSBsaW5lLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICog
QHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9oaWRlUmVzaXplTGluZSA6IGZ1bmN0aW9u
KCkgew0KKyAgICAgIGlmKHRoaXMuX3Jlc2l6ZUxpbmUpIHsNCisgICAgICAgIHRoaXMuX3Jlc2l6
ZUxpbmUuc2V0U3R5bGVQcm9wZXJ0eSgidmlzaWJpbGl0eSIsICJoaWRkZW4iKTsNCisgICAgICB9
DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBTaG93cyB0aGUgZmVlZGJhY2sgc2hv
d24gd2hpbGUgYSBjb2x1bW4gaXMgbW92ZWQgYnkgdGhlIHVzZXIuDQorICAgICAqDQorICAgICAq
IEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gcGFnZVgge0ludGVnZXJ9IHRoZSB4IHBvc2l0
aW9uIG9mIHRoZSBtb3VzZSBpbiB0aGUgcGFnZSAoaW4gcGl4ZWxzKS4NCisgICAgICogQHJldHVy
biB7SW50ZWdlcn0gdGhlIHZpc2libGUgeCBwb3NpdGlvbiBvZiB0aGUgY29sdW1uIGluIHRoZSB3
aG9sZSB0YWJsZS4NCisgICAgICovDQorICAgIHNob3dDb2x1bW5Nb3ZlRmVlZGJhY2sgOiBmdW5j
dGlvbihwYWdlWCkNCisgICAgew0KKyAgICAgIHZhciBwYW5lTW9kZWwgPSB0aGlzLmdldFRhYmxl
UGFuZU1vZGVsKCk7DQorICAgICAgdmFyIGNvbHVtbk1vZGVsID0gdGhpcy5nZXRUYWJsZSgpLmdl
dFRhYmxlQ29sdW1uTW9kZWwoKTsNCisgICAgICB2YXIgcGFuZUxlZnRYID0gcXguYm9tLmVsZW1l
bnQuTG9jYXRpb24uZ2V0TGVmdCh0aGlzLl90YWJsZVBhbmUuZ2V0RWxlbWVudCgpKTsNCisgICAg
ICB2YXIgY29sQ291bnQgPSBwYW5lTW9kZWwuZ2V0Q29sdW1uQ291bnQoKTsNCisNCisgICAgICB2
YXIgdGFyZ2V0WFBvcyA9IDA7DQorICAgICAgdmFyIHRhcmdldFggPSAwOw0KKyAgICAgIHZhciBj
dXJyWCA9IHBhbmVMZWZ0WDsNCisNCisgICAgICBmb3IgKHZhciB4UG9zPTA7IHhQb3M8Y29sQ291
bnQ7IHhQb3MrKykNCisgICAgICB7DQorICAgICAgICB2YXIgY29sID0gcGFuZU1vZGVsLmdldENv
bHVtbkF0WCh4UG9zKTsNCisgICAgICAgIHZhciBjb2xXaWR0aCA9IGNvbHVtbk1vZGVsLmdldENv
bHVtbldpZHRoKGNvbCk7DQorDQorICAgICAgICBpZiAocGFnZVggPCBjdXJyWCArIGNvbFdpZHRo
IC8gMikgew0KKyAgICAgICAgICBicmVhazsNCisgICAgICAgIH0NCisNCisgICAgICAgIGN1cnJY
ICs9IGNvbFdpZHRoOw0KKyAgICAgICAgdGFyZ2V0WFBvcyA9IHhQb3MgKyAxOw0KKyAgICAgICAg
dGFyZ2V0WCA9IGN1cnJYIC0gcGFuZUxlZnRYOw0KKyAgICAgIH0NCisNCisgICAgICAvLyBFbnN1
cmUgdGFyZ2V0WCBpcyB2aXNpYmxlDQorICAgICAgdmFyIGNsaXBwZXJMZWZ0WCA9IHF4LmJvbS5l
bGVtZW50LkxvY2F0aW9uLmdldExlZnQodGhpcy5fcGFuZUNsaXBwZXIuZ2V0RWxlbWVudCgpKTsN
CisgICAgICB2YXIgY2xpcHBlcldpZHRoID0gdGhpcy5fcGFuZUNsaXBwZXIuZ2V0Qm94V2lkdGgo
KTsNCisgICAgICB2YXIgc2Nyb2xsWCA9IGNsaXBwZXJMZWZ0WCAtIHBhbmVMZWZ0WDsNCisNCisg
ICAgICAvLyBOT1RFOiArMi8tMSBiZWNhdXNlIG9mIGZlZWRiYWNrIHdpZHRoDQorICAgICAgdGFy
Z2V0WCA9IHF4LmxhbmcuTnVtYmVyLmxpbWl0KHRhcmdldFgsIHNjcm9sbFggKyAyLCBzY3JvbGxY
ICsgY2xpcHBlcldpZHRoIC0gMSk7DQorDQorICAgICAgdGhpcy5fc2hvd1Jlc2l6ZUxpbmUodGFy
Z2V0WCk7DQorDQorICAgICAgLy8gUmV0dXJuIHRoZSBvdmVyYWxsIHRhcmdldCB4IHBvc2l0aW9u
DQorICAgICAgcmV0dXJuIHBhbmVNb2RlbC5nZXRGaXJzdENvbHVtblgoKSArIHRhcmdldFhQb3M7
DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBIaWRlcyB0aGUgZmVlZGJhY2sgc2hv
d24gd2hpbGUgYSBjb2x1bW4gaXMgbW92ZWQgYnkgdGhlIHVzZXIuDQorICAgICAqDQorICAgICAq
IEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8NCisgICAgaGlk
ZUNvbHVtbk1vdmVGZWVkYmFjayA6IGZ1bmN0aW9uKCkgew0KKyAgICAgIHRoaXMuX2hpZGVSZXNp
emVMaW5lKCk7DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBTZXRzIHRoZSBmb2N1
cyB0byB0aGUgY2VsbCB0aGF0J3MgbG9jYXRlZCBhdCB0aGUgcGFnZSBwb3NpdGlvbg0KKyAgICAg
KiA8Y29kZT5wYWdlWDwvY29kZT4vPGNvZGU+cGFnZVk8L2NvZGU+LiBJZiB0aGVyZSBpcyBubyBj
ZWxsIGF0IHRoYXQgcG9zaXRpb24sDQorICAgICAqIG5vdGhpbmcgaGFwcGVucy4NCisgICAgICoN
CisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEBwYXJhbSBwYWdlWCB7SW50ZWdlcn0gdGhl
IHggcG9zaXRpb24gaW4gdGhlIHBhZ2UgKGluIHBpeGVscykuDQorICAgICAqIEBwYXJhbSBwYWdl
WSB7SW50ZWdlcn0gdGhlIHkgcG9zaXRpb24gaW4gdGhlIHBhZ2UgKGluIHBpeGVscykuDQorICAg
ICAqIEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0KKyAgICBfZm9jdXNDZWxsQXRQYWdlUG9zIDog
ZnVuY3Rpb24ocGFnZVgsIHBhZ2VZKQ0KKyAgICB7DQorICAgICAgdmFyIHJvdyA9IHRoaXMuX2dl
dFJvd0ZvclBhZ2VQb3MocGFnZVgsIHBhZ2VZKTsNCisNCisgICAgICBpZiAocm93ICE9IC0xICYm
IHJvdyAhPSBudWxsKQ0KKyAgICAgIHsNCisgICAgICAgIC8vIFRoZSBtb3VzZSBpcyBvdmVyIHRo
ZSBkYXRhIC0+IHVwZGF0ZSB0aGUgZm9jdXMNCisgICAgICAgIHZhciBjb2wgPSB0aGlzLl9nZXRD
b2x1bW5Gb3JQYWdlWChwYWdlWCk7DQorDQorICAgICAgICBpZiAoY29sICE9IG51bGwpIHsNCisg
ICAgICAgICAgdGhpcy5fdGFibGUuc2V0Rm9jdXNlZENlbGwoY29sLCByb3cpOw0KKyAgICAgICAg
fQ0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFNldHMgdGhlIGN1
cnJlbnRseSBmb2N1c2VkIGNlbGwuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAg
ICAgKiBAcGFyYW0gY29sIHtJbnRlZ2VyfSB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGZvY3VzZWQg
Y2VsbCdzIGNvbHVtbi4NCisgICAgICogQHBhcmFtIHJvdyB7SW50ZWdlcn0gdGhlIG1vZGVsIGlu
ZGV4IG9mIHRoZSBmb2N1c2VkIGNlbGwncyByb3cuDQorICAgICAqIEByZXR1cm4ge3ZvaWR9DQor
ICAgICAqLw0KKyAgICBzZXRGb2N1c2VkQ2VsbCA6IGZ1bmN0aW9uKGNvbCwgcm93KQ0KKyAgICB7
DQorICAgICAgaWYgKCF0aGlzLmlzRWRpdGluZygpKQ0KKyAgICAgIHsNCisgICAgICAgIHRoaXMu
X3RhYmxlUGFuZS5zZXRGb2N1c2VkQ2VsbChjb2wsIHJvdywgdGhpcy5fdXBkYXRlQ29udGVudFBs
YW5uZWQpOw0KKw0KKyAgICAgICAgdGhpcy5fZm9jdXNlZENvbCA9IGNvbDsNCisgICAgICAgIHRo
aXMuX2ZvY3VzZWRSb3cgPSByb3c7DQorDQorICAgICAgICAvLyBNb3ZlIHRoZSBmb2N1cyBpbmRp
Y2F0b3INCisgICAgICAgIGlmICghdGhpcy5fdXBkYXRlQ29udGVudFBsYW5uZWQpIHsNCisgICAg
ICAgICAgdGhpcy5fdXBkYXRlRm9jdXNJbmRpY2F0b3IoKTsNCisgICAgICAgIH0NCisgICAgICB9
DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBSZXR1cm5zIHRoZSBjb2x1bW4gb2Yg
Y3VycmVudGx5IGZvY3VzZWQgY2VsbC4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQor
ICAgICAqIEByZXR1cm4ge0ludGVnZXJ9IHRoZSBtb2RlbCBpbmRleCBvZiB0aGUgZm9jdXNlZCBj
ZWxsJ3MgY29sdW1uLg0KKyAgICAgKi8NCisgICAgZ2V0Rm9jdXNlZENvbHVtbiA6IGZ1bmN0aW9u
KCkgew0KKyAgICAgIHJldHVybiB0aGlzLl9mb2N1c2VkQ29sOw0KKyAgICB9LA0KKw0KKw0KKyAg
ICAvKioNCisgICAgICogUmV0dXJucyB0aGUgcm93IG9mIGN1cnJlbnRseSBmb2N1c2VkIGNlbGwu
DQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcmV0dXJuIHtJbnRlZ2Vy
fSB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGZvY3VzZWQgY2VsbCdzIGNvbHVtbi4NCisgICAgICov
DQorICAgIGdldEZvY3VzZWRSb3cgOiBmdW5jdGlvbigpIHsNCisgICAgICByZXR1cm4gdGhpcy5f
Zm9jdXNlZFJvdzsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFNjcm9sbHMgYSBj
ZWxsIHZpc2libGUuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFy
YW0gY29sIHtJbnRlZ2VyfSB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGNvbHVtbiB0aGUgY2VsbCBi
ZWxvbmdzIHRvLg0KKyAgICAgKiBAcGFyYW0gcm93IHtJbnRlZ2VyfSB0aGUgbW9kZWwgaW5kZXgg
b2YgdGhlIHJvdyB0aGUgY2VsbCBiZWxvbmdzIHRvLg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0K
KyAgICAgKi8NCisgICAgc2Nyb2xsQ2VsbFZpc2libGUgOiBmdW5jdGlvbihjb2wsIHJvdykNCisg
ICAgew0KKyAgICAgIHZhciBwYW5lTW9kZWwgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVsKCk7DQor
ICAgICAgdmFyIHhQb3MgPSBwYW5lTW9kZWwuZ2V0WChjb2wpOw0KKw0KKyAgICAgIGlmICh4UG9z
ICE9IC0xKQ0KKyAgICAgIHsNCisgICAgICAgIHZhciBjb2x1bW5Nb2RlbCA9IHRoaXMuZ2V0VGFi
bGUoKS5nZXRUYWJsZUNvbHVtbk1vZGVsKCk7DQorDQorICAgICAgICB2YXIgY29sTGVmdCA9IHBh
bmVNb2RlbC5nZXRDb2x1bW5MZWZ0KGNvbCk7DQorICAgICAgICB2YXIgY29sV2lkdGggPSBjb2x1
bW5Nb2RlbC5nZXRDb2x1bW5XaWR0aChjb2wpOw0KKyAgICAgICAgdmFyIHJvd0hlaWdodCA9IHRo
aXMuZ2V0VGFibGUoKS5nZXRSb3dIZWlnaHQoKTsNCisgICAgICAgIHZhciByb3dUb3AgPSByb3cg
KiByb3dIZWlnaHQ7DQorDQorICAgICAgICB2YXIgc2Nyb2xsWCA9IHRoaXMuZ2V0U2Nyb2xsWCgp
Ow0KKyAgICAgICAgdmFyIHNjcm9sbFkgPSB0aGlzLmdldFNjcm9sbFkoKTsNCisgICAgICAgIHZh
ciB2aWV3V2lkdGggPSB0aGlzLl9wYW5lQ2xpcHBlci5nZXRCb3hXaWR0aCgpOw0KKyAgICAgICAg
dmFyIHZpZXdIZWlnaHQgPSB0aGlzLl9wYW5lQ2xpcHBlci5nZXRCb3hIZWlnaHQoKTsNCisNCisg
ICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBxeC5sYW5nLk51bWJlci5saW1pdCwgYmVjYXVz
ZSBtaW4gc2hvdWxkIHdpbiBpZiBtYXggPCBtaW4NCisgICAgICAgIHZhciBtaW5TY3JvbGxYID0g
TWF0aC5taW4oY29sTGVmdCwgY29sTGVmdCArIGNvbFdpZHRoIC0gdmlld1dpZHRoKTsNCisgICAg
ICAgIHZhciBtYXhTY3JvbGxYID0gY29sTGVmdDsNCisgICAgICAgIHRoaXMuc2V0U2Nyb2xsWChN
YXRoLm1heChtaW5TY3JvbGxYLCBNYXRoLm1pbihtYXhTY3JvbGxYLCBzY3JvbGxYKSkpOw0KKw0K
KyAgICAgICAgdmFyIG1pblNjcm9sbFkgPSByb3dUb3AgKyByb3dIZWlnaHQgLSB2aWV3SGVpZ2h0
Ow0KKw0KKyAgICAgICAgaWYgKHRoaXMuZ2V0VGFibGUoKS5nZXRLZWVwRmlyc3RWaXNpYmxlUm93
Q29tcGxldGUoKSkgew0KKyAgICAgICAgICBtaW5TY3JvbGxZICs9IHJvd0hlaWdodCAtIDE7DQor
ICAgICAgICB9DQorDQorICAgICAgICB2YXIgbWF4U2Nyb2xsWSA9IHJvd1RvcDsNCisgICAgICAg
IHRoaXMuc2V0U2Nyb2xsWShNYXRoLm1heChtaW5TY3JvbGxZLCBNYXRoLm1pbihtYXhTY3JvbGxZ
LCBzY3JvbGxZKSksIHRydWUpOw0KKyAgICAgIH0NCisgICAgfSwNCisNCisNCisgICAgLyoqDQor
ICAgICAqIFJldHVybnMgd2hldGhlciBjdXJyZW50bHkgYSBjZWxsIGlzIGVkaXRpbmcuDQorICAg
ICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcmV0dXJuIHt2YXJ9IHdoZXRoZXIg
Y3VycmVudGx5IGEgY2VsbCBpcyBlZGl0aW5nLg0KKyAgICAgKi8NCisgICAgaXNFZGl0aW5nIDog
ZnVuY3Rpb24oKSB7DQorICAgICAgcmV0dXJuIHRoaXMuX2NlbGxFZGl0b3IgIT0gbnVsbDsNCisg
ICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFN0YXJ0cyBlZGl0aW5nIHRoZSBjdXJyZW50
bHkgZm9jdXNlZCBjZWxsLiBEb2VzIG5vdGhpbmcgaWYgYWxyZWFkeQ0KKyAgICAgKiBlZGl0aW5n
LCBpZiB0aGUgY29sdW1uIGlzIG5vdCBlZGl0YWJsZSwgb3IgaWYgdGhlIGNlbGwgZWRpdG9yIGZv
ciB0aGUNCisgICAgICogY29sdW1uIGFzY2VydGFpbnMgdGhhdCB0aGUgcGFydGljdWxhciBjZWxs
IGlzIG5vdCBlZGl0YWJsZS4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAq
IEByZXR1cm4ge0Jvb2xlYW59IHdoZXRoZXIgZWRpdGluZyB3YXMgc3RhcnRlZA0KKyAgICAgKi8N
CisgICAgc3RhcnRFZGl0aW5nIDogZnVuY3Rpb24oKQ0KKyAgICB7DQorICAgICAgdmFyIHRhYmxl
ID0gdGhpcy5nZXRUYWJsZSgpOw0KKyAgICAgIHZhciB0YWJsZU1vZGVsID0gdGFibGUuZ2V0VGFi
bGVNb2RlbCgpOw0KKyAgICAgIHZhciBjb2wgPSB0aGlzLl9mb2N1c2VkQ29sOw0KKw0KKyAgICAg
IGlmICghdGhpcy5pc0VkaXRpbmcoKSAmJg0KKyAgICAgICAgICAoY29sICE9IG51bGwpICYmDQor
ICAgICAgICAgIHRhYmxlTW9kZWwuaXNDb2x1bW5FZGl0YWJsZShjb2wpKQ0KKyAgICAgIHsNCisg
ICAgICAgIHZhciByb3cgPSB0aGlzLl9mb2N1c2VkUm93Ow0KKyAgICAgICAgdmFyIHhQb3MgPSB0
aGlzLmdldFRhYmxlUGFuZU1vZGVsKCkuZ2V0WChjb2wpOw0KKyAgICAgICAgdmFyIHZhbHVlID0g
dGFibGVNb2RlbC5nZXRWYWx1ZShjb2wsIHJvdyk7DQorDQorICAgICAgICB0aGlzLl9jZWxsRWRp
dG9yRmFjdG9yeSA9DQorICAgICAgICAgIHRhYmxlLmdldFRhYmxlQ29sdW1uTW9kZWwoKS5nZXRD
ZWxsRWRpdG9yRmFjdG9yeShjb2wpOw0KKw0KKyAgICAgICAgdmFyIGNlbGxJbmZvID0NCisgICAg
ICAgIHsNCisgICAgICAgICAgY29sICAgOiBjb2wsDQorICAgICAgICAgIHJvdyAgIDogcm93LA0K
KyAgICAgICAgICB4UG9zICA6IHhQb3MsDQorICAgICAgICAgIHZhbHVlIDogdmFsdWUsDQorICAg
ICAgICAgIHRhYmxlIDogdGFibGUNCisgICAgICAgIH07DQorDQorICAgICAgICAvLyBHZXQgYSBj
ZWxsIGVkaXRvcg0KKyAgICAgICAgdGhpcy5fY2VsbEVkaXRvciA9DQorICAgICAgICAgIHRoaXMu
X2NlbGxFZGl0b3JGYWN0b3J5LmNyZWF0ZUNlbGxFZGl0b3IoY2VsbEluZm8pOw0KKw0KKyAgICAg
ICAgLy8gV2UgaGFuZGxlIHR3byB0eXBlcyBvZiBjZWxsIGVkaXRvcnM6IHRoZSB0cmFkaXRpb25h
bCBpbi1wbGFjZQ0KKyAgICAgICAgLy8gZWRpdG9yLCB3aGVyZSB0aGUgY2VsbCBlZGl0b3IgcmV0
dXJuZWQgYnkgdGhlIGZhY3RvcnkgbXVzdCBmaXQgaW4NCisgICAgICAgIC8vIHRoZSBzcGFjZSBv
ZiB0aGUgdGFibGUgY2VsbDsgYW5kIGEgbW9kYWwgd2luZG93IGluIHdoaWNoIHRoZQ0KKyAgICAg
ICAgLy8gZWRpdGluZyB0YWtlcyBwbGFjZS4gIEFkZGl0aW9uYWxseSwgaWYgdGhlIGNlbGwgZWRp
dG9yIGRldGVybWluZXMNCisgICAgICAgIC8vIHRoYXQgaXQgZG9lcyBub3Qgd2FudCB0byBlZGl0
IHRoZSBwYXJ0aWN1bGFyIGNlbGwgYmVpbmcgcmVxdWVzdGVkLA0KKyAgICAgICAgLy8gaXQgbWF5
IHJldHVybiBudWxsIHRvIGluZGljYXRlIHRoYXQgdGhhdCBjZWxsIGlzIG5vdCBlZGl0YWJsZS4N
CisgICAgICAgIGlmICh0aGlzLl9jZWxsRWRpdG9yID09PSBudWxsKQ0KKyAgICAgICAgew0KKyAg
ICAgICAgICAvLyBUaGlzIGNlbGwgaXMgbm90IGVkaXRhYmxlIGV2ZW4gdGhvdWdoIGl0cyBjb2x1
bW4gaXMuDQorICAgICAgICAgIHJldHVybiBmYWxzZTsNCisgICAgICAgIH0NCisgICAgICAgIGVs
c2UgaWYgKHRoaXMuX2NlbGxFZGl0b3IgaW5zdGFuY2VvZiBxeC51aS53aW5kb3cuV2luZG93KQ0K
KyAgICAgICAgew0KKyAgICAgICAgICAvLyBJdCdzIGEgd2luZG93LiAgRW5zdXJlIHRoYXQgaXQn
cyBtb2RhbC4NCisgICAgICAgICAgdGhpcy5fY2VsbEVkaXRvci5zZXRNb2RhbCh0cnVlKTsNCisN
CisgICAgICAgICAgLy8gQXQgbGVhc3QgZm9yIHRoZSB0aW1lIGJlaW5nLCB3ZSBkaXNhbGxvdyB0
aGUgY2xvc2UgYnV0dG9uLiAgSXQNCisgICAgICAgICAgLy8gYWN0cyBkaWZmZXJlbnRseSB0aGFu
IGEgY2VsbEVkaXRvci5jbG9zZSgpLCBhbmQgaW52b2tlcyBhIGJ1Zw0KKyAgICAgICAgICAvLyBz
b21lcGxhY2UuICBNb2RhbCB3aW5kb3cgY2VsbCBlZGl0b3JzIHNob3VsZCBwcm92aWRlIHRoZWly
IG93bg0KKyAgICAgICAgICAvLyBidXR0b25zIG9yIG1lYW5zIHRvIGFjdGl2YXRlIGEgY2VsbEVk
aXRvci5jbG9zZSgpIG9yIGVxdWl2YWxlbnRseQ0KKyAgICAgICAgICAvLyBjZWxsRWRpdG9yLmhp
ZGUoKS4NCisgICAgICAgICAgdGhpcy5fY2VsbEVkaXRvci5zZXRTaG93Q2xvc2UoZmFsc2UpOw0K
Kw0KKyAgICAgICAgICAvLyBBZGQgdGhlIGNlbGwgZWRpdG9yIHRvIHRoZSBkb2N1bWVudA0KKyAg
ICAgICAgICB0aGlzLl9jZWxsRWRpdG9yLmFkZFRvRG9jdW1lbnQoKTsNCisNCisgICAgICAgICAg
Ly8gQXJyYW5nZSB0byBiZSBub3RpZmllZCB3aGVuIGl0IGlzIGNsb3NlZC4NCisgICAgICAgICAg
dGhpcy5fY2VsbEVkaXRvci5hZGRFdmVudExpc3RlbmVyKA0KKyAgICAgICAgICAgICJkaXNhcHBl
YXIiLA0KKyAgICAgICAgICAgIHRoaXMuX29uQ2VsbEVkaXRvck1vZGFsV2luZG93Q2xvc2UsDQor
ICAgICAgICAgICAgdGhpcw0KKyAgICAgICAgICApOw0KKw0KKyAgICAgICAgICAvLyBJZiB0aGVy
ZSdzIGEgcHJlLW9wZW4gZnVuY3Rpb24gZGVmaW5lZCBmb3IgdGhlIHRhYmxlLi4uDQorICAgICAg
ICAgIHZhciBmID0gdGFibGUuZ2V0TW9kYWxDZWxsRWRpdG9yUHJlT3BlbkZ1bmN0aW9uKCk7DQor
ICAgICAgICAgIGlmIChmICE9IG51bGwpDQorICAgICAgICAgIHsNCisgICAgICAgICAgICBmKHRo
aXMuX2NlbGxFZGl0b3IsIGNlbGxJbmZvKTsNCisgICAgICAgICAgfQ0KKw0KKyAgICAgICAgICAv
LyBPcGVuIGl0IG5vdy4NCisgICAgICAgICAgdGhpcy5fY2VsbEVkaXRvci5vcGVuKCk7DQorICAg
ICAgICB9DQorICAgICAgICBlbHNlDQorICAgICAgICB7DQorICAgICAgICAgIC8vIFRoZSBjZWxs
IGVkaXRvciBpcyBhIHRyYWRpdGlvbmFsIGluLXBsYWNlIGVkaXRvci4NCisgICAgICAgICAgdGhp
cy5fY2VsbEVkaXRvci5zZXQoDQorICAgICAgICAgIHsNCisgICAgICAgICAgICB3aWR0aCAgOiAi
MTAwJSIsDQorICAgICAgICAgICAgaGVpZ2h0IDogIjEwMCUiDQorICAgICAgICAgIH0pOw0KKw0K
KyAgICAgICAgICAvLyBwcmV2ZW50IGNsaWNrIGV2ZW50IGZyb20gYnViYmxpbmcgdXAgdG8gdGhl
IHRhYmxlDQorICAgICAgICAgIHRoaXMuX2ZvY3VzSW5kaWNhdG9yLmFkZEV2ZW50TGlzdGVuZXIo
Im1vdXNlZG93biIsIGZ1bmN0aW9uKGUpIHsNCisgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlv
bigpOw0KKyAgICAgICAgICB9KTsNCisNCisgICAgICAgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3Iu
YWRkKHRoaXMuX2NlbGxFZGl0b3IpOw0KKyAgICAgICAgICB0aGlzLl9mb2N1c0luZGljYXRvci5h
ZGRTdGF0ZSgiZWRpdGluZyIpOw0KKw0KKyAgICAgICAgICAvLyBXb3JrYXJvdW5kOiBDYWxsaW5n
IGZvY3VzKCkgZGlyZWN0bHkgaGFzIG5vIGVmZmVjdA0KKyAgICAgICAgICBxeC5jbGllbnQuVGlt
ZXIub25jZShmdW5jdGlvbigpDQorICAgICAgICAgIHsNCisgICAgICAgICAgICBpZiAodGhpcy5n
ZXREaXNwb3NlZCgpKQ0KKyAgICAgICAgICAgIHsNCisgICAgICAgICAgICAgIHJldHVybjsNCisg
ICAgICAgICAgICB9DQorDQorICAgICAgICAgICAgdGhpcy5fY2VsbEVkaXRvci5mb2N1cygpOw0K
KyAgICAgICAgICB9LCB0aGlzLCAwKTsNCisgICAgICAgIH0NCisNCisgICAgICAgIHJldHVybiB0
cnVlOw0KKyAgICAgIH0NCisNCisgICAgICByZXR1cm4gZmFsc2U7DQorICAgIH0sDQorDQorDQor
ICAgIC8qKg0KKyAgICAgKiBTdG9wcyBlZGl0aW5nIGFuZCB3cml0ZXMgdGhlIGVkaXRvcidzIHZh
bHVlIHRvIHRoZSBtb2RlbC4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAq
IEByZXR1cm4ge3ZvaWR9DQorICAgICAqLw0KKyAgICBzdG9wRWRpdGluZyA6IGZ1bmN0aW9uKCkN
CisgICAgew0KKyAgICAgIHRoaXMuZmx1c2hFZGl0b3IoKTsNCisgICAgICB0aGlzLmNhbmNlbEVk
aXRpbmcoKTsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFdyaXRlcyB0aGUgZWRp
dG9yJ3MgdmFsdWUgdG8gdGhlIG1vZGVsLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXIN
CisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIGZsdXNoRWRpdG9yIDogZnVu
Y3Rpb24oKQ0KKyAgICB7DQorICAgICAgaWYgKHRoaXMuaXNFZGl0aW5nKCkpDQorICAgICAgew0K
KyAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5fY2VsbEVkaXRvckZhY3RvcnkuZ2V0Q2VsbEVkaXRv
clZhbHVlKHRoaXMuX2NlbGxFZGl0b3IpOw0KKyAgICAgICAgdGhpcy5nZXRUYWJsZSgpLmdldFRh
YmxlTW9kZWwoKS5zZXRWYWx1ZSh0aGlzLl9mb2N1c2VkQ29sLCB0aGlzLl9mb2N1c2VkUm93LCB2
YWx1ZSk7DQorDQorICAgICAgICB0aGlzLl90YWJsZS5mb2N1cygpOw0KKyAgICAgIH0NCisgICAg
fSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFN0b3BzIGVkaXRpbmcgd2l0aG91dCB3cml0aW5n
IHRoZSBlZGl0b3IncyB2YWx1ZSB0byB0aGUgbW9kZWwuDQorICAgICAqDQorICAgICAqIEB0eXBl
IG1lbWJlcg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8NCisgICAgY2FuY2VsRWRp
dGluZyA6IGZ1bmN0aW9uKCkNCisgICAgew0KKyAgICAgIGlmICh0aGlzLmlzRWRpdGluZygpICYm
ICEgdGhpcy5fY2VsbEVkaXRvci5wZW5kaW5nRGlzcG9zZSkNCisgICAgICB7DQorICAgICAgICBp
ZiAodGhpcy5fY2VsbEVkaXRvcklzTW9kYWxXaW5kb3cpDQorICAgICAgICB7DQorICAgICAgICAg
IC8vIERlZmVyIHRoZSBhY3R1YWwgZGlzcG9zaW5nIG9mIHRoZSBjZWxsIGVkaXRvciBicmllZmx5
LCBhcyB0aGVyZQ0KKyAgICAgICAgICAvLyBtYXkgYmUgbW9yZSBhY2Nlc3NlcyB0byBpdCBmb3Ig
YSBzaG9ydCB3aGlsZSBhZnRlciB3ZSBsZWF2ZSB0aGlzDQorICAgICAgICAgIC8vIGZ1bmN0aW9u
Lg0KKyAgICAgICAgICBxeC5jbGllbnQuVGltZXIub25jZShmdW5jdGlvbigpDQorICAgICAgICAg
IHsNCisgICAgICAgICAgICB2YXIgZCA9IHF4LnVpLmNvcmUuQ2xpZW50RG9jdW1lbnQuZ2V0SW5z
dGFuY2UoKTsNCisgICAgICAgICAgICBkLnJlbW92ZSh0aGlzLl9jZWxsRWRpdG9yKTsNCisNCisg
ICAgICAgICAgICB0aGlzLl9jZWxsRWRpdG9yLnJlbW92ZUV2ZW50TGlzdGVuZXIoDQorICAgICAg
ICAgICAgICAiZGlzYXBwZWFyIiwNCisgICAgICAgICAgICAgIHRoaXMuX29uQ2VsbEVkaXRvck1v
ZGFsV2luZG93Q2xvc2UsDQorICAgICAgICAgICAgICB0aGlzDQorICAgICAgICAgICAgKTsNCisN
CisgICAgICAgICAgICB0aGlzLl9jZWxsRWRpdG9yLmRpc3Bvc2UoKTsNCisgICAgICAgICAgICB0
aGlzLl9jZWxsRWRpdG9yID0gbnVsbDsNCisgICAgICAgICAgICB0aGlzLl9jZWxsRWRpdG9yRmFj
dG9yeSA9IG51bGw7DQorICAgICAgICAgIH0sIHRoaXMsIDApOw0KKw0KKyAgICAgICAgICB0aGlz
Ll9jZWxsRWRpdG9yLnBlbmRpbmdEaXNwb3NlID0gdHJ1ZTsNCisgICAgICAgIH0NCisgICAgICAg
IGVsc2UNCisgICAgICAgIHsNCisgICAgICAgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3IucmVtb3Zl
KHRoaXMuX2NlbGxFZGl0b3IpOw0KKyAgICAgICAgICB0aGlzLl9mb2N1c0luZGljYXRvci5yZW1v
dmVTdGF0ZSgiZWRpdGluZyIpOw0KKyAgICAgICAgICB0aGlzLl9jZWxsRWRpdG9yLmRpc3Bvc2Uo
KTsNCisgICAgICAgICAgdGhpcy5fY2VsbEVkaXRvciA9IG51bGw7DQorICAgICAgICAgIHRoaXMu
X2NlbGxFZGl0b3JGYWN0b3J5ID0gbnVsbDsNCisgICAgICAgIH0NCisgICAgICB9DQorICAgIH0s
DQorDQorDQorICAgIC8qKg0KKyAgICAgKiBFdmVudCBoYW5kbGVyLiBDYWxsZWQgd2hlbiB0aGUg
bW9kYWwgd2luZG93IG9mIHRoZSBjZWxsIGVkaXRvciBjbG9zZXMuDQorICAgICAqDQorICAgICAq
IEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZXZ0IHtNYXB9IHRoZSBldmVudC4NCisgICAg
ICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF9vbkNlbGxFZGl0b3JNb2RhbFdpbmRv
d0Nsb3NlIDogZnVuY3Rpb24oZXZ0KQ0KKyAgICB7DQorICAgICAgdGhpcy5zdG9wRWRpdGluZygp
Ow0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogUmV0dXJucyB0aGUgbW9kZWwgaW5k
ZXggb2YgdGhlIGNvbHVtbiB0aGUgbW91c2UgaXMgb3ZlciBvciBudWxsIGlmIHRoZSBtb3VzZQ0K
KyAgICAgKiBpcyBub3Qgb3ZlciBhIGNvbHVtbi4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVt
YmVyDQorICAgICAqIEBwYXJhbSBwYWdlWCB7SW50ZWdlcn0gdGhlIHggcG9zaXRpb24gb2YgdGhl
IG1vdXNlIGluIHRoZSBwYWdlIChpbiBwaXhlbHMpLg0KKyAgICAgKiBAcmV0dXJuIHtJbnRlZ2Vy
fSB0aGUgbW9kZWwgaW5kZXggb2YgdGhlIGNvbHVtbiB0aGUgbW91c2UgaXMgb3Zlci4NCisgICAg
ICovDQorICAgIF9nZXRDb2x1bW5Gb3JQYWdlWCA6IGZ1bmN0aW9uKHBhZ2VYKQ0KKyAgICB7DQor
ICAgICAgdmFyIGhlYWRlckxlZnRYID0gcXguYm9tLmVsZW1lbnQuTG9jYXRpb24uZ2V0TGVmdCh0
aGlzLl9oZWFkZXIuZ2V0RWxlbWVudCgpKTsNCisNCisgICAgICB2YXIgY29sdW1uTW9kZWwgPSB0
aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVDb2x1bW5Nb2RlbCgpOw0KKyAgICAgIHZhciBwYW5lTW9k
ZWwgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVsKCk7DQorICAgICAgdmFyIGNvbENvdW50ID0gcGFu
ZU1vZGVsLmdldENvbHVtbkNvdW50KCk7DQorICAgICAgdmFyIGN1cnJYID0gaGVhZGVyTGVmdFg7
DQorDQorICAgICAgZm9yICh2YXIgeD0wOyB4PGNvbENvdW50OyB4KyspDQorICAgICAgew0KKyAg
ICAgICAgdmFyIGNvbCA9IHBhbmVNb2RlbC5nZXRDb2x1bW5BdFgoeCk7DQorICAgICAgICB2YXIg
Y29sV2lkdGggPSBjb2x1bW5Nb2RlbC5nZXRDb2x1bW5XaWR0aChjb2wpOw0KKyAgICAgICAgY3Vy
clggKz0gY29sV2lkdGg7DQorDQorICAgICAgICBpZiAocGFnZVggPCBjdXJyWCkgew0KKyAgICAg
ICAgICByZXR1cm4gY29sOw0KKyAgICAgICAgfQ0KKyAgICAgIH0NCisNCisgICAgICByZXR1cm4g
bnVsbDsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFJldHVybnMgdGhlIG1vZGVs
IGluZGV4IG9mIHRoZSBjb2x1bW4gdGhhdCBzaG91bGQgYmUgcmVzaXplZCB3aGVuIGRyYWdnaW5n
DQorICAgICAqIHN0YXJ0cyBoZXJlLiBSZXR1cm5zIC0xIGlmIHRoZSBtb3VzZSBpcyBpbiBubyBy
ZXNpemUgcmVnaW9uIG9mIGFueSBjb2x1bW4uDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJl
cg0KKyAgICAgKiBAcGFyYW0gcGFnZVgge0ludGVnZXJ9IHRoZSB4IHBvc2l0aW9uIG9mIHRoZSBt
b3VzZSBpbiB0aGUgcGFnZSAoaW4gcGl4ZWxzKS4NCisgICAgICogQHJldHVybiB7SW50ZWdlcn0g
dGhlIGNvbHVtbiBpbmRleC4NCisgICAgICovDQorICAgIF9nZXRSZXNpemVDb2x1bW5Gb3JQYWdl
WCA6IGZ1bmN0aW9uKHBhZ2VYKQ0KKyAgICB7DQorICAgICAgdmFyIGhlYWRlckxlZnRYID0gcXgu
Ym9tLmVsZW1lbnQuTG9jYXRpb24uZ2V0TGVmdCh0aGlzLl9oZWFkZXIuZ2V0RWxlbWVudCgpKTsN
CisNCisgICAgICB2YXIgY29sdW1uTW9kZWwgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVDb2x1
bW5Nb2RlbCgpOw0KKyAgICAgIHZhciBwYW5lTW9kZWwgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVs
KCk7DQorICAgICAgdmFyIGNvbENvdW50ID0gcGFuZU1vZGVsLmdldENvbHVtbkNvdW50KCk7DQor
ICAgICAgdmFyIGN1cnJYID0gaGVhZGVyTGVmdFg7DQorICAgICAgdmFyIHJlZ2lvblJhZGl1cyA9
IHF4LnVpLnRhYmxlLnBhbmUuU2Nyb2xsZXIuUkVTSVpFX1JFR0lPTl9SQURJVVM7DQorDQorICAg
ICAgZm9yICh2YXIgeD0wOyB4PGNvbENvdW50OyB4KyspDQorICAgICAgew0KKyAgICAgICAgdmFy
IGNvbCA9IHBhbmVNb2RlbC5nZXRDb2x1bW5BdFgoeCk7DQorICAgICAgICB2YXIgY29sV2lkdGgg
PSBjb2x1bW5Nb2RlbC5nZXRDb2x1bW5XaWR0aChjb2wpOw0KKyAgICAgICAgY3VyclggKz0gY29s
V2lkdGg7DQorDQorICAgICAgICBpZiAocGFnZVggPj0gKGN1cnJYIC0gcmVnaW9uUmFkaXVzKSAm
JiBwYWdlWCA8PSAoY3VyclggKyByZWdpb25SYWRpdXMpKSB7DQorICAgICAgICAgIHJldHVybiBj
b2w7DQorICAgICAgICB9DQorICAgICAgfQ0KKw0KKyAgICAgIHJldHVybiAtMTsNCisgICAgfSwN
CisNCisNCisgICAgLyoqDQorICAgICAqIFJldHVybnMgdGhlIG1vZGVsIGluZGV4IG9mIHRoZSBy
b3cgdGhlIG1vdXNlIGlzIGN1cnJlbnRseSBvdmVyLiBSZXR1cm5zIC0xIGlmDQorICAgICAqIHRo
ZSBtb3VzZSBpcyBvdmVyIHRoZSBoZWFkZXIuIFJldHVybnMgbnVsbCBpZiB0aGUgbW91c2UgaXMg
bm90IG92ZXIgYW55DQorICAgICAqIGNvbHVtbi4NCisgICAgICoNCisgICAgICogQHR5cGUgbWVt
YmVyDQorICAgICAqIEBwYXJhbSBwYWdlWCB7SW50ZWdlcn0gdGhlIG1vdXNlIHggcG9zaXRpb24g
aW4gdGhlIHBhZ2UuDQorICAgICAqIEBwYXJhbSBwYWdlWSB7SW50ZWdlcn0gdGhlIG1vdXNlIHkg
cG9zaXRpb24gaW4gdGhlIHBhZ2UuDQorICAgICAqIEByZXR1cm4ge0ludGVnZXJ9IHRoZSBtb2Rl
bCBpbmRleCBvZiB0aGUgcm93IHRoZSBtb3VzZSBpcyBjdXJyZW50bHkgb3Zlci4NCisgICAgICov
DQorICAgIF9nZXRSb3dGb3JQYWdlUG9zIDogZnVuY3Rpb24ocGFnZVgsIHBhZ2VZKQ0KKyAgICB7
DQorICAgICAgdmFyIHBhbmVDbGlwcGVyRWxlbSA9IHRoaXMuX3BhbmVDbGlwcGVyLmdldEVsZW1l
bnQoKTsNCisNCisgICAgICB2YXIgcGFuZUNsaXBwZXJQb3MgPSBxeC5ib20uZWxlbWVudC5Mb2Nh
dGlvbi5nZXQocGFuZUNsaXBwZXJFbGVtKTsNCisNCisgICAgICBpZiAocGFnZVggPCBwYW5lQ2xp
cHBlclBvcy5sZWZ0IHx8IHBhZ2VYID4gcGFuZUNsaXBwZXJQb3MucmlnaHQpDQorICAgICAgew0K
KyAgICAgICAgLy8gVGhlcmUgd2FzIG5vIGNlbGwgb3IgaGVhZGVyIGNlbGwgaGl0DQorICAgICAg
ICByZXR1cm4gbnVsbDsNCisgICAgICB9DQorDQorICAgICAgaWYgKHBhZ2VZID49IHBhbmVDbGlw
cGVyUG9zLnRvcCAmJiBwYWdlWSA8PSBwYW5lQ2xpcHBlclBvcy5ib3R0b20pDQorICAgICAgew0K
KyAgICAgICAgLy8gVGhpcyBldmVudCBpcyBpbiB0aGUgcGFuZSAtPiBHZXQgdGhlIHJvdw0KKyAg
ICAgICAgdmFyIHJvd0hlaWdodCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRSb3dIZWlnaHQoKTsNCisN
CisgICAgICAgIHZhciBzY3JvbGxZID0gdGhpcy5fdmVyU2Nyb2xsQmFyLmdldFZhbHVlKCk7DQor
DQorICAgICAgICBpZiAodGhpcy5nZXRUYWJsZSgpLmdldEtlZXBGaXJzdFZpc2libGVSb3dDb21w
bGV0ZSgpKSB7DQorICAgICAgICAgIHNjcm9sbFkgPSBNYXRoLmZsb29yKHNjcm9sbFkgLyByb3dI
ZWlnaHQpICogcm93SGVpZ2h0Ow0KKyAgICAgICAgfQ0KKw0KKyAgICAgICAgdmFyIHRhYmxlWSA9
IHNjcm9sbFkgKyBwYWdlWSAtIHBhbmVDbGlwcGVyUG9zLnRvcDsNCisgICAgICAgIHZhciByb3cg
PSBNYXRoLmZsb29yKHRhYmxlWSAvIHJvd0hlaWdodCk7DQorDQorICAgICAgICB2YXIgcm93Q291
bnQgPSB0aGlzLmdldFRhYmxlKCkuZ2V0VGFibGVNb2RlbCgpLmdldFJvd0NvdW50KCk7DQorICAg
ICAgICByZXR1cm4gKHJvdyA8IHJvd0NvdW50KSA/IHJvdyA6IG51bGw7DQorICAgICAgfQ0KKw0K
KyAgICAgIHZhciBoZWFkZXJQb3MgPSBxeC5ib20uZWxlbWVudC5Mb2NhdGlvbi5nZXQodGhpcy5f
aGVhZGVyQ2xpcHBlci5nZXRFbGVtZW50KCkpOw0KKw0KKyAgICAgIGlmICgNCisgICAgICAgIHBh
Z2VZID49IGhlYWRlclBvcy50b3AgJiYNCisgICAgICAgIHBhZ2VZIDw9IGhlYWRlclBvcy5ib3R0
b20gJiYNCisgICAgICAgIHBhZ2VYIDw9IGhlYWRlclBvcy5yaWdodCkNCisgICAgICB7DQorICAg
ICAgICAvLyBUaGlzIGV2ZW50IGlzIGluIHRoZSBwYW5lIC0+IFJldHVybiAtMSBmb3IgdGhlIGhl
YWRlcg0KKyAgICAgICAgcmV0dXJuIC0xOw0KKyAgICAgIH0NCisNCisgICAgICByZXR1cm4gbnVs
bDsNCisgICAgfSwNCisNCisNCisgICAgLyoqDQorICAgICAqIFNldHMgdGhlIHdpZGdldCB0aGF0
IHNob3VsZCBiZSBzaG93biBpbiB0aGUgdG9wIHJpZ2h0IGNvcm5lci4NCisgICAgICoNCisgICAg
ICogVGhlIHdpZGdldCB3aWxsIG5vdCBiZSBkaXNwb3NlZCwgd2hlbiB0aGlzIHRhYmxlIHNjcm9s
bGVyIGlzIGRpc3Bvc2VkLiBTbyB0aGUNCisgICAgICogY2FsbGVyIGhhcyB0byBkaXNwb3NlIGl0
Lg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICogQHBhcmFtIHdpZGdldCB7
cXgudWkuY29yZS5XaWRnZXR9IFRoZSB3aWRnZXQgdG8gc2V0LiBNYXkgYmUgbnVsbC4NCisgICAg
ICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIHNldFRvcFJpZ2h0V2lkZ2V0IDogZnVu
Y3Rpb24od2lkZ2V0KQ0KKyAgICB7DQorICAgICAgdmFyIG9sZFdpZGdldCA9IHRoaXMuX3RvcFJp
Z2h0V2lkZ2V0Ow0KKw0KKyAgICAgIGlmIChvbGRXaWRnZXQgIT0gbnVsbCkgew0KKyAgICAgICAg
dGhpcy5fdG9wLnJlbW92ZShvbGRXaWRnZXQpOw0KKyAgICAgIH0NCisNCisgICAgICBpZiAod2lk
Z2V0ICE9IG51bGwpDQorICAgICAgew0KKyAgICAgICAgdGhpcy5fdG9wLnJlbW92ZSh0aGlzLl9z
cGFjZXIpOw0KKyAgICAgICAgdGhpcy5fdG9wLmFkZCh3aWRnZXQpOw0KKyAgICAgIH0NCisgICAg
ICBlbHNlIGlmIChvbGRXaWRnZXQgIT0gbnVsbCkNCisgICAgICB7DQorICAgICAgICB0aGlzLl90
b3AuYWRkKHRoaXMuX3NwYWNlcik7DQorICAgICAgfQ0KKw0KKyAgICAgIHRoaXMuX3RvcFJpZ2h0
V2lkZ2V0ID0gd2lkZ2V0Ow0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogUmV0dXJu
cyB0aGUgaGVhZGVyLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1iZXINCisgICAgICogQHJl
dHVybiB7cXgudWkudGFibGUucGFuZS5IZWFkZXJ9IHRoZSBoZWFkZXIuDQorICAgICAqLw0KKyAg
ICBnZXRIZWFkZXIgOiBmdW5jdGlvbigpIHsNCisgICAgICByZXR1cm4gdGhpcy5faGVhZGVyOw0K
KyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogUmV0dXJucyB0aGUgdGFibGUgcGFuZS4N
CisgICAgICoNCisgICAgICogQHR5cGUgbWVtYmVyDQorICAgICAqIEByZXR1cm4ge3F4LnVpLnRh
YmxlLnBhbmUuUGFuZX0gdGhlIHRhYmxlIHBhbmUuDQorICAgICAqLw0KKyAgICBnZXRUYWJsZVBh
bmUgOiBmdW5jdGlvbigpIHsNCisgICAgICByZXR1cm4gdGhpcy5fdGFibGVQYW5lOw0KKyAgICB9
LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogUmV0dXJucyB3aGljaCBzY3JvbGxiYXJzIGFyZSBu
ZWVkZWQuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJlcg0KKyAgICAgKiBAcGFyYW0gZm9y
Y2VIb3Jpem9udGFsIHtCb29sZWFuID8gZmFsc2V9IFdoZXRoZXIgdG8gc2hvdyB0aGUgaG9yaXpv
bnRhbA0KKyAgICAgKiAgICAgIHNjcm9sbGJhciBhbHdheXMuDQorICAgICAqIEBwYXJhbSBwcmV2
ZW50VmVydGljYWwge0Jvb2xlYW4gPyBmYWxzZX0gV2hldGhlciB0cCBzaG93IHRoZSB2ZXJ0aWNh
bCBzY3JvbGxiYXINCisgICAgICogICAgICBuZXZlci4NCisgICAgICogQHJldHVybiB7SW50ZWdl
cn0gd2hpY2ggc2Nyb2xsYmFycyBhcmUgbmVlZGVkLiBUaGlzIG1heSBiZSBhbnkgY29tYmluYXRp
b24gb2YNCisgICAgICogICAgICB7QGxpbmsgI0hPUklaT05UQUxfU0NST0xMQkFSfSBvciB7QGxp
bmsgI1ZFUlRJQ0FMX1NDUk9MTEJBUn0NCisgICAgICogICAgICAoY29tYmluZWQgYnkgT1IpLg0K
KyAgICAgKi8NCisgICAgZ2V0TmVlZGVkU2Nyb2xsQmFycyA6IGZ1bmN0aW9uKGZvcmNlSG9yaXpv
bnRhbCwgcHJldmVudFZlcnRpY2FsKQ0KKyAgICB7DQorICAgICAgdmFyIGJhcldpZHRoID0gdGhp
cy5fdmVyU2Nyb2xsQmFyLmdldFByZWZlcnJlZEJveFdpZHRoKCk7DQorDQorICAgICAgLy8gR2V0
IHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSB2aWV3ICh3aXRob3V0IHNjcm9sbCBiYXJzKQ0K
KyAgICAgIHZhciB2aWV3V2lkdGggPSB0aGlzLl9wYW5lQ2xpcHBlci5nZXRJbm5lcldpZHRoKCk7
DQorDQorICAgICAgaWYgKHRoaXMuZ2V0VmVydGljYWxTY3JvbGxCYXJWaXNpYmxlKCkpIHsNCisg
ICAgICAgIHZpZXdXaWR0aCArPSBiYXJXaWR0aDsNCisgICAgICB9DQorDQorICAgICAgdmFyIHZp
ZXdIZWlnaHQgPSB0aGlzLl9wYW5lQ2xpcHBlci5nZXRJbm5lckhlaWdodCgpOw0KKw0KKyAgICAg
IGlmICh0aGlzLmdldEhvcml6b250YWxTY3JvbGxCYXJWaXNpYmxlKCkpIHsNCisgICAgICAgIHZp
ZXdIZWlnaHQgKz0gYmFyV2lkdGg7DQorICAgICAgfQ0KKw0KKyAgICAgIC8vIEdldCB0aGUgKHZp
cnR1YWwpIHdpZHRoIGFuZCBoZWlnaHQgb2YgdGhlIHBhbmUNCisgICAgICB2YXIgcGFuZVdpZHRo
ID0gdGhpcy5nZXRUYWJsZVBhbmVNb2RlbCgpLmdldFRvdGFsV2lkdGgoKTsNCisgICAgICB2YXIg
cGFuZUhlaWdodCA9IHRoaXMuZ2V0VGFibGUoKS5nZXRSb3dIZWlnaHQoKSAqIHRoaXMuZ2V0VGFi
bGUoKS5nZXRUYWJsZU1vZGVsKCkuZ2V0Um93Q291bnQoKTsNCisNCisgICAgICAvLyBDaGVjayB3
aGljaCBzY3JvbGxiYXJzIGFyZSBuZWVkZWQNCisgICAgICB2YXIgaG9yTmVlZGVkID0gZmFsc2U7
DQorICAgICAgdmFyIHZlck5lZWRlZCA9IGZhbHNlOw0KKw0KKyAgICAgIGlmIChwYW5lV2lkdGgg
PiB2aWV3V2lkdGgpDQorICAgICAgew0KKyAgICAgICAgaG9yTmVlZGVkID0gdHJ1ZTsNCisNCisg
ICAgICAgIGlmIChwYW5lSGVpZ2h0ID4gdmlld0hlaWdodCAtIGJhcldpZHRoKSB7DQorICAgICAg
ICAgIHZlck5lZWRlZCA9IHRydWU7DQorICAgICAgICB9DQorICAgICAgfQ0KKyAgICAgIGVsc2Ug
aWYgKHBhbmVIZWlnaHQgPiB2aWV3SGVpZ2h0KQ0KKyAgICAgIHsNCisgICAgICAgIHZlck5lZWRl
ZCA9IHRydWU7DQorDQorICAgICAgICBpZiAoIXByZXZlbnRWZXJ0aWNhbCAmJiAocGFuZVdpZHRo
ID4gdmlld1dpZHRoIC0gYmFyV2lkdGgpKSB7DQorICAgICAgICAgIGhvck5lZWRlZCA9IHRydWU7
DQorICAgICAgICB9DQorICAgICAgfQ0KKw0KKyAgICAgIC8vIENyZWF0ZSB0aGUgbWFzaw0KKyAg
ICAgIHZhciBob3JCYXIgPSBxeC51aS50YWJsZS5wYW5lLlNjcm9sbGVyLkhPUklaT05UQUxfU0NS
T0xMQkFSOw0KKyAgICAgIHZhciB2ZXJCYXIgPSBxeC51aS50YWJsZS5wYW5lLlNjcm9sbGVyLlZF
UlRJQ0FMX1NDUk9MTEJBUjsNCisgICAgICByZXR1cm4gKChmb3JjZUhvcml6b250YWwgfHwgaG9y
TmVlZGVkKSA/IGhvckJhciA6IDApIHwgKChwcmV2ZW50VmVydGljYWwgfHwgIXZlck5lZWRlZCkg
PyAwIDogdmVyQmFyKTsNCisgICAgfSwNCisNCisNCisgICAgLy8gcHJvcGVydHkgYXBwbHkgbWV0
aG9kDQorICAgIF9hcHBseVNjcm9sbFRpbWVvdXQgOiBmdW5jdGlvbih2YWx1ZSwgb2xkKQ0KKyAg
ICB7DQorICAgICAgLy8gQ2xlYXIgb2xkIHRpbWVyIGlmIGl0J3MgcHJlc2VudA0KKyAgICAgIGlm
ICh0aGlzLl91cGRhdGVJbnRlcnZhbCkNCisgICAgICB7DQorICAgICAgICB3aW5kb3cuY2xlYXJJ
bnRlcnZhbCh0aGlzLl91cGRhdGVJbnRlcnZhbCk7DQorICAgICAgICB0aGlzLl91cGRhdGVJbnRl
cnZhbCA9IG51bGw7DQorICAgICAgfQ0KKyAgICAgIC8vIFNldCB1cCB3cmFwcGVyIGlmIHJlcXVp
cmVkDQorICAgICAgaWYgKCF0aGlzLl9vbmludGVydmFsV3JhcHBlcikgew0KKyAgICAgICAgdGhp
cy5fb25pbnRlcnZhbFdyYXBwZXIgPSBxeC5sYW5nLkZ1bmN0aW9uLmJpbmQodGhpcy5fb25pbnRl
cnZhbCwgdGhpcyk7DQorICAgICAgfQ0KKyAgICAgIC8vIFNldCB1cCBuZXcgdGltZXIgaWYgaW50
ZXJ2YWwgaXMgbm9uLXplcm8NCisgICAgICBpZiAodmFsdWUpIHsNCisgICAgICAgIHRoaXMuX3Vw
ZGF0ZUludGVydmFsID0gd2luZG93LnNldEludGVydmFsKHRoaXMuX29uaW50ZXJ2YWxXcmFwcGVy
LCB2YWx1ZSk7DQorICAgICAgfQ0KKyAgICB9LA0KKw0KKw0KKyAgICAvKioNCisgICAgICogRG9l
cyBhIHBvc3Rwb25lZCB1cGRhdGUgb2YgdGhlIGNvbnRlbnQuDQorICAgICAqDQorICAgICAqIEB0
eXBlIG1lbWJlcg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKiBAc2VlICNfdXBkYXRl
Q29udGVudA0KKyAgICAgKi8NCisgICAgX3Bvc3Rwb25lZFVwZGF0ZUNvbnRlbnQgOiBmdW5jdGlv
bigpDQorICAgIHsNCisgICAgICB0aGlzLl91cGRhdGVDb250ZW50UGxhbm5lZCA9IHRydWU7DQor
ICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBUaW1lciBldmVudCBoYW5kbGVyLiBQZXJp
b2RpY2FsbHkgY2hlY2tzIHdoZXRoZXIgYSB0YWJlIHVwZGF0ZSBpcw0KKyAgICAgKiByZXF1aXJl
ZC4gVGhlIHVwZGF0ZSBpbnRlcnZhbCBpcyBjb250cm9sZWQgYnkgdGhlIHtAbGluayAjc2Nyb2xs
VGltZW91dH0NCisgICAgICogcHJvcGVydHkuDQorICAgICAqDQorICAgICAqIEB0eXBlIG1lbWJl
cg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8NCisgICAgX29uaW50ZXJ2YWwgOiBm
dW5jdGlvbigpDQorICAgIHsNCisgICAgICBpZiAodGhpcy5fdXBkYXRlQ29udGVudFBsYW5uZWQg
JiYgIXRoaXMuX3RhYmxlUGFuZS5fbGF5b3V0UGVuZGluZykgew0KKyAgICAgICAgdGhpcy5fdXBk
YXRlQ29udGVudFBsYW5uZWQgPSBmYWxzZTsNCisgICAgICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnQo
KTsNCisgICAgICB9DQorICAgIH0sDQorDQorDQorICAgIC8qKg0KKyAgICAgKiBVcGRhdGVzIHRo
ZSBjb250ZW50LiBTZXRzIHRoZSByaWdodCBzZWN0aW9uIHRoZSB0YWJsZSBwYW5lIHNob3VsZCBz
aG93IGFuZA0KKyAgICAgKiBkb2VzIHRoZSBzY3JvbGxpbmcuDQorICAgICAqDQorICAgICAqIEB0
eXBlIG1lbWJlcg0KKyAgICAgKiBAcmV0dXJuIHt2b2lkfQ0KKyAgICAgKi8NCisgICAgX3VwZGF0
ZUNvbnRlbnQgOiBmdW5jdGlvbigpDQorICAgIHsNCisgICAgICBpZiAoIXRoaXMuaXNTZWVhYmxl
KCkpIHsNCisgICAgICAgIHJldHVybjsNCisgICAgICB9DQorDQorICAgICAgdmFyIHBhbmVIZWln
aHQgPSB0aGlzLl9wYW5lQ2xpcHBlci5nZXRJbm5lckhlaWdodCgpOw0KKyAgICAgIHZhciBzY3Jv
bGxYID0gdGhpcy5faG9yU2Nyb2xsQmFyLmdldFZhbHVlKCk7DQorICAgICAgdmFyIHNjcm9sbFkg
PSB0aGlzLl92ZXJTY3JvbGxCYXIuZ2V0VmFsdWUoKTsNCisgICAgICB2YXIgcm93SGVpZ2h0ID0g
dGhpcy5nZXRUYWJsZSgpLmdldFJvd0hlaWdodCgpOw0KKw0KKyAgICAgIHZhciBmaXJzdFJvdyA9
IE1hdGguZmxvb3Ioc2Nyb2xsWSAvIHJvd0hlaWdodCk7DQorICAgICAgdmFyIG9sZEZpcnN0Um93
ID0gdGhpcy5fdGFibGVQYW5lLmdldEZpcnN0VmlzaWJsZVJvdygpOw0KKyAgICAgIHRoaXMuX3Rh
YmxlUGFuZS5zZXRGaXJzdFZpc2libGVSb3coZmlyc3RSb3cpOw0KKw0KKyAgICAgIHZhciByb3dD
b3VudCA9IE1hdGguY2VpbChwYW5lSGVpZ2h0IC8gcm93SGVpZ2h0KTsNCisgICAgICB2YXIgcGFu
ZU9mZnNldCA9IDA7DQorICAgICAgdmFyIGZpcnN0VmlzaWJsZVJvd0NvbXBsZXRlID0gdGhpcy5n
ZXRUYWJsZSgpLmdldEtlZXBGaXJzdFZpc2libGVSb3dDb21wbGV0ZSgpOw0KKw0KKyAgICAgIGlm
ICghZmlyc3RWaXNpYmxlUm93Q29tcGxldGUpDQorICAgICAgew0KKw0KKyAgICAgICAgLy8gTk9U
RTogV2UgZG9uJ3QgY29uc2lkZXIgcGFuZU9mZnNldCwgYmVjYXVzZSB0aGlzIG1heSBjYXVzZSBh
bHRlcm5hdGluZw0KKyAgICAgICAgLy8gICAgICAgYWRkaW5nIGFuZCBkZWxldGluZyBvZiBvbmUg
cm93IHdoZW4gc2NvbGxpbmcuIEluc3RlYWQgd2UgYWRkIG9uZSByb3cNCisgICAgICAgIC8vICAg
ICAgIGluIGV2ZXJ5IGNhc2UuDQorICAgICAgICByb3dDb3VudCsrOw0KKw0KKyAgICAgICAgcGFu
ZU9mZnNldCA9IHNjcm9sbFkgJSByb3dIZWlnaHQ7DQorICAgICAgfQ0KKw0KKyAgICAgIHRoaXMu
X3RhYmxlUGFuZS5zZXRWaXNpYmxlUm93Q291bnQocm93Q291bnQpOw0KKw0KKyAgICAgIGlmIChm
aXJzdFJvdyAhPSBvbGRGaXJzdFJvdykgew0KKyAgICAgICAgdGhpcy5fdXBkYXRlRm9jdXNJbmRp
Y2F0b3IoKTsNCisgICAgICB9DQorDQorICAgICAgLy8gV29ya2Fyb3VuZDogV2UgY2FuJ3QgdXNl
IHNjcm9sbExlZnQgZm9yIHRoZSBoZWFkZXIgYmVjYXVzZSBJRQ0KKyAgICAgIC8vICAgICAgIGF1
dG9tYXRpY2FsbHkgc2Nyb2xscyB0aGUgaGVhZGVyIGJhY2ssIHdoZW4gYSBjb2x1bW4gaXMNCisg
ICAgICAvLyAgICAgICByZXNpemVkLg0KKyAgICAgIHRoaXMuX2hlYWRlci5zZXRMZWZ0KC1zY3Jv
bGxYKTsNCisNCisgICAgICAvLyBPbmx5IHNjcm9sbCBsZWZ0IGlmIHRoZSBzY3JvbGxMZWZ0IHZh
bHVlIGhhcw0KKyAgICAgIC8vIGNoYW5nZWQNCisgICAgICAvLw0KKyAgICAgIGlmKHRoaXMuX3Bh
bmVDbGlwcGVyLl9fc2Nyb2xsTGVmdCAhPSBzY3JvbGxYKSB7DQorICAgICAgICB0aGlzLl9wYW5l
Q2xpcHBlci5fX3Njcm9sbExlZnQgPSBzY3JvbGxYOw0KKyAgICAgICAgdGhpcy5fcGFuZUNsaXBw
ZXIuc2V0U2Nyb2xsTGVmdChzY3JvbGxYKTsNCisgICAgICB9DQorDQorICAgICAgLy8gQXZvaWQg
ZXhwZW5zaXZlIGNhbGxzIHRvIHNldFNjcm9sbFRvcCBpZg0KKyAgICAgIC8vIHNjcm9sbGluZyBp
cyBub3QgbmVlZGVkDQorICAgICAgLy8NCisgICAgICBpZiAoISBmaXJzdFZpc2libGVSb3dDb21w
bGV0ZSApIHsNCisgICAgICAgIHRoaXMuX3BhbmVDbGlwcGVyLnNldFNjcm9sbFRvcChwYW5lT2Zm
c2V0KTsNCisgICAgICB9DQorDQorICAgICAgLy8gdGhpcy5kZWJ1ZygicGFuZUhlaWdodDoiK3Bh
bmVIZWlnaHQrIixyb3dIZWlnaHQ6Iityb3dIZWlnaHQrIixmaXJzdFJvdzoiK2ZpcnN0Um93KyIs
cm93Q291bnQ6Iityb3dDb3VudCsiLHBhbmVPZmZzZXQ6IitwYW5lT2Zmc2V0KTsNCisgICAgfSwN
CisNCisgICAgLyoqDQorICAgICAqIFVwZGF0ZXMgdGhlIGxvY2F0aW9uIGFuZCB0aGUgdmlzaWJp
bGl0eSBvZiB0aGUgZm9jdXMgaW5kaWNhdG9yLg0KKyAgICAgKg0KKyAgICAgKiBAdHlwZSBtZW1i
ZXINCisgICAgICogQHJldHVybiB7dm9pZH0NCisgICAgICovDQorICAgIF91cGRhdGVGb2N1c0lu
ZGljYXRvciA6IGZ1bmN0aW9uKCkNCisgICAgew0KKyAgICAgIGlmKCF0aGlzLl9zaG93Q2VsbEZv
Y3VzSW5kaWNhdG9yKSB7DQorICAgICAgICByZXR1cm47DQorICAgICAgfQ0KKw0KKyAgICAgIHZh
ciB0YWJsZSA9IHRoaXMuZ2V0VGFibGUoKTsNCisNCisgICAgICBpZiAoIXRhYmxlLmdldEVuYWJs
ZWQoKSkgew0KKyAgICAgICAgcmV0dXJuOw0KKyAgICAgIH0NCisNCisgICAgICBpZiAodGhpcy5f
Zm9jdXNlZENvbCA9PSBudWxsKSB7DQorICAgICAgICB0aGlzLl9mb2N1c0luZGljYXRvci5oaWRl
KCk7DQorICAgICAgfQ0KKyAgICAgIGVsc2UNCisgICAgICB7DQorICAgICAgICB2YXIgeFBvcyA9
IHRoaXMuZ2V0VGFibGVQYW5lTW9kZWwoKS5nZXRYKHRoaXMuX2ZvY3VzZWRDb2wpOw0KKw0KKyAg
ICAgICAgaWYgKHhQb3MgPT0gLTEpIHsNCisgICAgICAgICAgdGhpcy5fZm9jdXNJbmRpY2F0b3Iu
aGlkZSgpOw0KKyAgICAgICAgfQ0KKyAgICAgICAgZWxzZQ0KKyAgICAgICAgew0KKyAgICAgICAg
ICB2YXIgY29sdW1uTW9kZWwgPSB0YWJsZS5nZXRUYWJsZUNvbHVtbk1vZGVsKCk7DQorICAgICAg
ICAgIHZhciBwYW5lTW9kZWwgPSB0aGlzLmdldFRhYmxlUGFuZU1vZGVsKCk7DQorDQorICAgICAg
ICAgIHZhciBmaXJzdFJvdyA9IHRoaXMuX3RhYmxlUGFuZS5nZXRGaXJzdFZpc2libGVSb3coKTsN
CisgICAgICAgICAgdmFyIHJvd0hlaWdodCA9IHRhYmxlLmdldFJvd0hlaWdodCgpOw0KKw0KKyAg
ICAgICAgICB0aGlzLl9mb2N1c0luZGljYXRvci5zZXRIZWlnaHQocm93SGVpZ2h0ICsgMyk7DQor
ICAgICAgICAgIHRoaXMuX2ZvY3VzSW5kaWNhdG9yLnNldFdpZHRoKGNvbHVtbk1vZGVsLmdldENv
bHVtbldpZHRoKHRoaXMuX2ZvY3VzZWRDb2wpICsgMyk7DQorICAgICAgICAgIHRoaXMuX2ZvY3Vz
SW5kaWNhdG9yLnNldFRvcCgodGhpcy5fZm9jdXNlZFJvdyAtIGZpcnN0Um93KSAqIHJvd0hlaWdo
dCAtIDIpOw0KKyAgICAgICAgICB0aGlzLl9mb2N1c0luZGljYXRvci5zZXRMZWZ0KHBhbmVNb2Rl
bC5nZXRDb2x1bW5MZWZ0KHRoaXMuX2ZvY3VzZWRDb2wpIC0gMik7DQorDQorICAgICAgICAgIHRo
aXMuX2ZvY3VzSW5kaWNhdG9yLnNob3coKTsNCisgICAgICAgIH0NCisgICAgICB9DQorICAgIH0N
CisgIH0sDQorDQorDQorDQorDQorICAvKg0KKyAgKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCisgICAg
IERFU1RSVUNUT1INCisgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQorICAqLw0KKw0KKyAgZGVzdHJ1
Y3QgOiBmdW5jdGlvbigpDQorICB7DQorICAgIGlmICh0aGlzLmdldEVsZW1lbnQoKSAhPSBudWxs
KSB7DQorICAgICAgdGhpcy5nZXRFbGVtZW50KCkub25zZWxlY3RzdGFydCA9IG51bGw7DQorICAg
IH0NCisNCisgICAgaWYgKHRoaXMuX3VwZGF0ZUludGVydmFsKQ0KKyAgICB7DQorICAgICAgd2lu
ZG93LmNsZWFySW50ZXJ2YWwodGhpcy5fdXBkYXRlSW50ZXJ2YWwpOw0KKyAgICAgIHRoaXMuX3Vw
ZGF0ZUludGVydmFsID0gbnVsbDsNCisgICAgfQ0KKw0KKyAgICB0aGlzLl9kaXNwb3NlT2JqZWN0
cygiX3ZlclNjcm9sbEJhciIsICJfaG9yU2Nyb2xsQmFyIiwgIl9oZWFkZXIiLCAiX2hlYWRlckNs
aXBwZXIiLA0KKyAgICAgICJfc3BhY2VyIiwgIl90b3AiLCAiX3RhYmxlUGFuZSIsICJfcGFuZUNs
aXBwZXIiLCAiX3Jlc2l6ZUxpbmUiLCAiX3RhYmxlIiwNCisgICAgICAiX2ZvY3VzSW5kaWNhdG9y
IiwgIl90b3BSaWdodFdpZGdldCIpOw0KKyAgfQ0KK30pOw0K
</data>

          </attachment>
      

    </bug>